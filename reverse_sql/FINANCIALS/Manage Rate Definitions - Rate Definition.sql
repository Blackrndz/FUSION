/* ****************************************************************************
 * $Revision: 78239 $:
 * $Author: pisan.jariyasettachok $:
 * $Date: 2022-04-07 22:37:05 +0700 (Thu, 07 Apr 2022) $:
 * $HeadURL: https://svn03.rapid4cloud.com/svn/a/dev/rapidesuite/controldata/FUSION_11.1.13/trunk/core/reverse_sql/FINANCIALS/Manage%20Rate%20Definitions%20-%20Rate%20Definition.sql $:
 * $Id: Manage Rate Definitions - Rate Definition.sql 78239 2022-04-07 15:37:05Z pisan.jariyasettachok $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */

-- RSC_PREREQUISITE_OBJECTS=PAY_RATE_DEFINITIONS_F
-- RSC_PREREQUISITE_OBJECTS=PAY_RATE_DEFINITIONS_F_TL
-- RSC_PREREQUISITE_OBJECTS=PAY_BALANCE_DIMENSIONS
 
SELECT  payRATEDEFTLEO.NAME RES_NAME
,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE  LOOKUP_CODE = payRATEDEFEO.TYPE
	AND LOOKUP_TYPE = 'PAY_RATE_DEFINITION_TYPES' AND LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))) RES_CATEGORY
,(SELECT NAME FROM  PER_LEGISLATIVE_DATA_GROUPS_VL WHERE LEGISLATIVE_DATA_GROUP_ID = payRATEDEFEO.LEGISLATIVE_DATA_GROUP_ID) RES_LEGISLATIVE_DATA_GROUP
,TO_CHAR(payRATEDEFEO.EFFECTIVE_START_DATE,'DD-Mon-YYYY') RES_EFFECTIVE_START_DATE
,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE  LOOKUP_CODE = payRATEDEFEO.STORAGE_TYPE
	AND LOOKUP_TYPE = 'ORA_PAY_RATE_STORAGE_TYPE' AND LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))) RES_STORAGE_TYPE
,(SELECT ELEMENT_NAME FROM PAY_ELEMENT_TYPES_VL WHERE ELEMENT_TYPE_ID = payRATEDEFEO.ELEMENT_TYPE_ID
	AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND NVL(EFFECTIVE_END_DATE ,TO_DATE('31-12-4712','DD-MM-YYYY'))) RES_ELEMENT_NAME
,payRATEDEFEO.SHORT_NAME RES_SHORT_NAME 
,TO_CHAR(payRATEDEFEO.EFFECTIVE_END_DATE,'DD-Mon-YYYY') RES_EFFECTIVE_END_DATE
,(SELECT NAME FROM PAY_VALUE_DEFINITIONS_TL WHERE VALUE_DEFN_ID = payRATEDEFEO.VALUE_BY_CRITERIA_ID   
	AND LANGUAGE = USERENV('LANG'))RES_VALUE_BY_CRITERIA_NAME
,payRATEDEFEO.VBC_VALUE_IDENTIFIER RES_CRITERIA_VALUE
,(SELECT FORMULA_NAME
	FROM FF_FORMULAS_TL
	WHERE LANGUAGE = USERENV('LANG')
	AND FORMULA_ID = payRATEDEFEO.CALCULATION_FORMULA_ID 
	) RES_CALCULATION_FORMULA
,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE  LOOKUP_CODE = payRATEDEFEO.PERIODICITY_TYPE
	AND LOOKUP_TYPE = 'ORA_PAY_RATE_PERIOD_OR_UNIT' AND LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))) RES_PERIOD_OR_UNIT
,(SELECT SUBSTR(MEANING,1,LENGTH(MEANING)-6)  FROM FND_LOOKUP_VALUES WHERE  LOOKUP_CODE =  payBALANCEDIMENEO.DIMENSION_LEVEL
	AND LOOKUP_TYPE = 'PAY_DIMENSION_LEVEL' AND LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))) RES_EMPLOYMENT_LEVEL
,DECODE(payRATEDEFEO.STATUS,'A','Active','Inactive') RES_STATUS
,DECODE(payRATEDEFEO.BASE_SALARY_FLAG,'Y','Yes','No') RES_BASE_RATE
,DECODE(payRATEDEFEO.OVERALL_SALARY_FLAG,'Y','Yes','No') RES_OVERALL_SALARY
,DECODE(payRATEDEFEO.REPORTING_RATE_FLAG,'Y','Yes','No') RES_REPORTING_REQUIRED
,DECODE(payRATEDEFEO.USE_REPORT_VALUE_FOR_CALC,'Y','No','Yes') RES_CALCULATE_LIVE_RATES

--Return Rate Details
,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE  LOOKUP_CODE = payRATEDEFEO.DEFAULT_RTN_PERIODICITY
	AND LOOKUP_TYPE = 'PAY_TMPLT_ET_TIME_DEFINITION' AND LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))) RES_RETURNED_RATE_PERIODICITY
,(SELECT FORMULA_NAME
	FROM FF_FORMULAS_TL
	WHERE LANGUAGE = USERENV('LANG')
	AND FORMULA_ID = payRATEDEFEO.CONVERSION_FORMULA_ID
	) RES_RETURNED_RATE_PERIODICITY_
,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE  LOOKUP_CODE = payRATEDEFEO.RETURN_FACTOR_TYPE
	AND LOOKUP_TYPE = 'PAY_RATE_FACTOR_TYPES' AND LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))) RES_RETURNED_RATE_FACTOR_RULE
,(CASE WHEN payRATEDEFEO.RETURN_FACTOR_TYPE = 'VBC'
	THEN (SELECT NAME FROM PAY_VALUE_DEFINITIONS_TL WHERE VALUE_DEFN_ID = payRATEDEFEO.RETURN_FACTOR_VALUE AND LANGUAGE = USERENV('LANG')) 
	ELSE payRATEDEFEO.RETURN_FACTOR_VALUE END) RES_RETURNED_RATE_FACTOR_RULE_
,payRATEDEFEO.RETURN_FACTOR_IDENTIFIER RES_RETURNED_RATE_CRITERIA_VAL

,(SELECT NAME FROM FND_CURRENCIES_VL WHERE CURRENCY_CODE = payRATEDEFEO.DEFAULT_RTN_CURRENCY) RES_RETURNED_RATE_CURRENCY
,payRATEDEFEO.RETURN_PRECISION RES_RETURNED_RATE_DECIMAL_DISP
,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE  LOOKUP_CODE = payRATEDEFEO.RETURN_ROUNDING
	AND LOOKUP_TYPE = 'ORA_PAY_RATE_ROUNDING' AND LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))) RES_RETURNED_RATE_ROUNDING_RUL

,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE  LOOKUP_CODE = payRATEDEFEO.MIN_TYPE
	AND LOOKUP_TYPE = 'PAY_RATE_MIN_MAX_TYPES' AND LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))) RES_RETURNED_RATE_MINIMUM_RATE
,(CASE WHEN payRATEDEFEO.MIN_TYPE = 'VBC'
	THEN (SELECT NAME FROM PAY_VALUE_DEFINITIONS_TL WHERE VALUE_DEFN_ID = payRATEDEFEO.MIN_VALUE
			AND LANGUAGE = USERENV('LANG'))
	WHEN payRATEDEFEO.MIN_TYPE = 'RD' 
	THEN (SELECT NAME FROM PAY_RATE_DEFINITIONS_F_TL WHERE RATE_DEFINITION_ID = payRATEDEFEO.MIN_VALUE
			AND LANGUAGE = USERENV('LANG'))
	ELSE payRATEDEFEO.MIN_VALUE END) RES_RETURNED_RATE_MINIMUM_RA_0
,payRATEDEFEO.MIN_VALUE_IDENTIFIER RES_RETURNED_RATE_MINIMUM_RA_1

,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE  LOOKUP_CODE = payRATEDEFEO.MAX_TYPE 
	AND LOOKUP_TYPE = 'PAY_RATE_MIN_MAX_TYPES' AND LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))) RES_RETURNED_RATE_MAXIMUM_RATE
,(CASE WHEN payRATEDEFEO.MAX_TYPE = 'VBC'
	THEN (SELECT NAME FROM PAY_VALUE_DEFINITIONS_TL WHERE VALUE_DEFN_ID = payRATEDEFEO.MAX_VALUE
			AND LANGUAGE = USERENV('LANG'))
	WHEN payRATEDEFEO.MAX_TYPE = 'RD' 
	THEN (SELECT NAME FROM PAY_RATE_DEFINITIONS_F_TL WHERE RATE_DEFINITION_ID = payRATEDEFEO.MAX_VALUE
			AND LANGUAGE = USERENV('LANG')
			AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND NVL(EFFECTIVE_END_DATE,TO_DATE('4712-12-31','YYYY-MM-DD')))
	ELSE payRATEDEFEO.MAX_VALUE END) RES_RETURNED_RATE_MAXIMUM_RA_2
,payRATEDEFEO.MAX_VALUE_IDENTIFIER  RES_RETURNED_RATE_MAXIMUM_RA_3

,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE  LOOKUP_CODE = payRATEDEFEO.LIMIT_MODE 
	AND LOOKUP_TYPE = 'ORA_PAY_RATE_LIMIT_MODE' AND LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))) RES_RETURNED_RATE_LIMIT_VIOLAT
,DECODE(payRATEDEFEO.FTE_FLAG,'Y','Yes','No') RES_RETURNED_RATE_RETURN_FULL_

--Override and Default
,DECODE(payRATEDEFEO.AMOUNT_ENTERABLE,'Y','Yes','No') RES_OVERRIDE_RULES_OVERRIDE_AL
,(SELECT FORMULA_NAME
	FROM FF_FORMULAS_TL
	WHERE LANGUAGE = USERENV('LANG')
	AND FORMULA_ID = payRATEDEFEO.VALIDATION_FORMULA_ID
	) RES_OVERRIDE_RULES_VALIDATION_
,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE  LOOKUP_CODE = payRATEDEFEO.DEFAULT_SOURCE_TYPE 
	AND LOOKUP_TYPE = 'ORA_PAY_RATE_DEFAULT_SOURCE' AND LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))) RES_DEFAULTING_RULES_DEFAULT_T
,(CASE WHEN payRATEDEFEO.DEFAULT_SOURCE_TYPE = 'VBC'
	THEN (SELECT NAME FROM PAY_VALUE_DEFINITIONS_TL WHERE VALUE_DEFN_ID = payRATEDEFEO.DEFAULT_SOURCE_VALUE
			AND LANGUAGE = USERENV('LANG'))
	WHEN payRATEDEFEO.DEFAULT_SOURCE_TYPE = 'F' 
	THEN  (SELECT FORMULA_NAME
			FROM FF_FORMULAS_TL
			WHERE LANGUAGE = USERENV('LANG')
			AND FORMULA_ID = payRATEDEFEO.DEFAULT_SOURCE_VALUE
			)
	ELSE payRATEDEFEO.DEFAULT_SOURCE_VALUE END) RES_DEFAULTING_RULES_DEFAULT_V
,payRATEDEFEO.DEFAULT_FACTOR_IDENTIFIER RES_DEFAULTING_RULES_CRITERIA_
	
--Contributor Rules
,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE  LOOKUP_CODE = payRATEDEFEO.DEFAULT_CALC_PERIODICITY
	AND LOOKUP_TYPE = 'PAY_TMPLT_ET_TIME_DEFINITION' AND LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))) RES_CONTRIBUTOR_RULES_CONTRIBU
,DECODE(payRATEDEFEO.DEFAULT_FTE_FLAG,'Y','Yes','No') RES_CONTRIBUTOR_RULES_PROCESS_


,payRATEDEFEO.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,payRATEDEFEO.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,payRATEDEFEO.CREATED_BY RSC_CREATED_BY
,payRATEDEFEO.CREATION_DATE RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,NULL RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,(SELECT LEGISLATION_CODE 
	FROM PER_LEGISLATIVE_DATA_GROUPS
	WHERE LEGISLATIVE_DATA_GROUP_ID = payRATEDEFEO.LEGISLATIVE_DATA_GROUP_ID
	) RSC_COUNTRY_ID

FROM PAY_RATE_DEFINITIONS_F payRATEDEFEO
,PAY_RATE_DEFINITIONS_F_TL payRATEDEFTLEO
,PAY_BALANCE_DIMENSIONS payBALANCEDIMENEO
WHERE payRATEDEFEO.RATE_DEFINITION_ID = payRATEDEFTLEO.RATE_DEFINITION_ID
AND payBALANCEDIMENEO.BALANCE_DIMENSION_ID(+) = payRATEDEFEO.DEFAULT_BAL_DIMENSION_ID
AND SYSDATE BETWEEN payRATEDEFEO.EFFECTIVE_START_DATE AND NVL(payRATEDEFEO.EFFECTIVE_END_DATE,TO_DATE('4712-12-31','YYYY-MM-DD'))
AND payRATEDEFTLEO.LANGUAGE = USERENV('LANG')
ORDER BY RES_NAME