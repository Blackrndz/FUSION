/* ****************************************************************************
* $Revision: 56739 $:
* $Author: pisan.jariyasettachok $:
* $Date: 2016-07-20 09:09:10 +0700 (Wed, 20 Jul 2016) $:
* $HeadURL: http://svn01.rapidesuite.com:999/svn/a/dev/rapidesuite/controldata/FUSION_11.1.9/trunk/core/reverse_sql/FINANCIALS/Manage%20Fixed%20Assets%20Key%20Flexfields%20-%20Segment%20Instance.sql $:
* $Id: Manage Fixed Assets Key Flexfields - Segment Instance.sql 56739 2016-07-20 02:09:10Z pisan.jariyasettachok $:
* ****************************************************************************
* Description:
* ************************************************************************** */

-- RSC_PREREQUISITE_OBJECTS=AP_INVOICES_PKG
-- STRICTLY_BATCH_SEQ = RES_INVOICE_ID,RES_LINE_NUMBER

SELECT InvoicesE0.INVOICE_ID RES_INVOICE_ID
,InvoiceLinesE0.LINE_NUMBER RES_LINE_NUMBER
,InvoiceLinesE0.LINE_TYPE_LOOKUP_CODE RES_LINE_TYPE
,InvoiceLinesE0.AMOUNT RES_AMOUNT
,InvoiceLinesE0.QUANTITY_INVOICED RES_INVOICE_QUANTITY
,InvoiceLinesE0.UNIT_PRICE RES_UNIT_PRICE
,InvoiceLinesE0.UNIT_MEAS_LOOKUP_CODE RES_UOM
,REPLACE(REPLACE(InvoiceLinesE0.DESCRIPTION,chr(13),' '),chr(10),' ') RES_DESCRIPTION
,(SELECT SEGMENT1
	FROM PO_HEADERS_ALL
	WHERE PO_HEADER_ID = InvoiceLinesE0.PO_HEADER_ID
	) RES_PO_NUMBER
,(SELECT LINE_NUM
	FROM PO_LINES_ALL
	WHERE PO_LINE_ID = InvoiceLinesE0.PO_LINE_ID
	) RES_PO_LINE_NUMBER
,(SELECT SHIPMENT_NUM 
	FROM PO_LINE_LOCATIONS_ALL
	WHERE LINE_LOCATION_ID = InvoiceLinesE0.PO_LINE_LOCATION_ID
	) RES_PO_SCHEDULE_NUMBER
,(SELECT DISTRIBUTION_NUM 
	FROM PO_DISTRIBUTIONS_ALL
	WHERE PO_DISTRIBUTION_ID = InvoiceLinesE0.PO_DISTRIBUTION_ID
	) RES_PO_DISTRIBUTION_NUMBER
,REPLACE(REPLACE(InvoiceLinesE0.ITEM_DESCRIPTION,chr(13),' '),chr(10),' ') RES_ITEM_DESCRIPTION
,InvoiceLinesE0.PO_RELEASE_ID RES_PO_RELEASE_NUMBER -- PO_RELEASE_ID
,(SELECT CATEGORY_NAME 
	FROM FND_DOCUMENT_CATEGORIES
	WHERE CATEGORY_ID = InvoiceLinesE0.PURCHASING_CATEGORY_ID
	) RES_PURCHASING_CATEGORY
,(SELECT RECEIPT_NUM 
	FROM RCV_SHIPMENT_HEADERS
	WHERE SHIPMENT_HEADER_ID = rcvTrxsE0.SHIPMENT_HEADER_ID
	) RES_RECEIPT_NUMBER
,(SELECT LINE_NUM 
	FROM RCV_SHIPMENT_LINES
	WHERE SHIPMENT_LINE_ID = rcvTrxsE0.SHIPMENT_LINE_ID
	) RES_RECEIPT_LINE_NUMBER
,InvoiceLinesE0.CONSUMPTION_ADVICE_HEADER_ID RES_CONSUMPTION_ADVICE_NUMBER -- Translate ??
,InvoiceLinesE0.CONSUMPTION_ADVICE_LINE_ID RES_CONSUMPTION_ADVICE_LINE_NU -- Translate ??
,'' RES_PACKING_SLIP
,InvoiceLinesE0.FINAL_MATCH_FLAG RES_FINAL_MATCH
,FND_FLEX_EXT.GET_SEGS(APPLICATION_SHORT_NAME => 'GL',KEY_FLEX_CODE => 'GL#',STRUCTURE_NUMBER => (SELECT CHART_OF_ACCOUNTS_ID FROM GL_CODE_COMBINATIONS WHERE CODE_COMBINATION_ID = invDistsE0.DIST_CODE_COMBINATION_ID),COMBINATION_ID => invDistsE0.DIST_CODE_COMBINATION_ID) RES_DISTRIBUTION_COMBINATION
,(SELECT SET_NAME
	FROM FND_SETID_SETS
	WHERE SET_ID = InvoiceLinesE0.DISTRIBUTION_SET_ID
	) RES_DISTRIBUTION_SET
,TO_CHAR(InvoiceLinesE0.ACCOUNTING_DATE,'YYYY/MM/DD') RES_ACCOUNTING_DATE
,InvoiceLinesE0.ACCOUNT_SEGMENT RES_OVERLAY_ACCOUNT_SEGMENT
,InvoiceLinesE0.BALANCING_SEGMENT RES_OVERLAY_PRIMARY_BALANCING_
,InvoiceLinesE0.COST_CENTER_SEGMENT RES_OVERLAY_COST_CENTER_SEGMEN
,InvoiceLinesE0.TAX_CLASSIFICATION_CODE RES_TAX_CLASSIFICATION_CODE
,(SELECT LOCATION_NAME
	FROM PER_LOCATION_DETAILS_F_VL
	WHERE SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
	AND LOCATION_ID = InvoiceLinesE0.SHIP_TO_LOCATION_ID
	) RES_SHIP_TO_LOCATION
,(SELECT LOCATION_NAME
	FROM PER_LOCATION_DETAILS_F_VL
	WHERE SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
	AND LOCATION_ID = InvoiceLinesE0.SHIP_FROM_LOCATION_ID
	) RES_SHIP_FROM_LOCATION
,(SELECT LOCATION_NAME
	FROM PER_LOCATION_DETAILS_F_VL
	WHERE SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
	AND LOCATION_ID = InvoiceLinesE0.FINAL_DISCHARGE_LOCATION_ID 
	) RES_LOCATION_OF_FINAL_DISCHARG
,InvoiceLinesE0.TRX_BUSINESS_CATEGORY RES_TRANSACTION_BUSINESS_CATEG
,InvoiceLinesE0.PRODUCT_FISC_CLASSIFICATION RES_PRODUCT_FISCAL_CLASSIFICAT
,InvoiceLinesE0.INTENDED_USE_CLASSIF_ID RES_INTENDED_USE -- Translate ??
,InvoiceLinesE0.USER_DEFINED_FISC_CLASS RES_USER_DEFINED_FISCAL_CLASSI
,InvoiceLinesE0.PRODUCT_TYPE RES_PRODUCT_TYPE
,InvoiceLinesE0.ASSESSABLE_VALUE RES_ASSESSABLE_VALUE
,InvoiceLinesE0.PRODUCT_CATEGORY RES_PRODUCT_CATEGORY
,InvoiceLinesE0.CONTROL_AMOUNT RES_TAX_CONTROL_AMOUNT
,InvoiceLinesE0.TAX_REGIME_CODE RES_TAX_REGIME_CODE
,InvoiceLinesE0.TAX RES_TAX
,InvoiceLinesE0.TAX_STATUS_CODE RES_TAX_STATUS_CODE
,InvoiceLinesE0.TAX_JURISDICTION_CODE RES_TAX_JURISDICTION_CODE
,InvoiceLinesE0.TAX_RATE_CODE RES_TAX_RATE_CODE
,InvoiceLinesE0.TAX_RATE RES_TAX_RATE
,InvoiceLinesE0.AWT_GROUP_ID RES_WITHHOLDING_TAX_GROUP
,InvoiceLinesE0.TYPE_1099 RES_INCOME_TAX_TYPE
,InvoiceLinesE0.INCOME_TAX_REGION RES_INCOME_TAX_REGION
,InvoiceLinesE0.PRORATE_ACROSS_ALL_ITEMS RES_PRORATE_ACROSS_ALL_ITEM_LI
,InvoiceLinesE0.LINE_GROUP_NUMBER RES_LINE_GROUP_NUMBER
,InvoiceLinesE0.COST_FACTOR_ID RES_COST_FACTOR_NAME  -- Translate ???
,InvoiceLinesE0.STAT_AMOUNT RES_STATISTICAL_QUANTITY
,InvoiceLinesE0.ASSETS_TRACKING_FLAG RES_TRACK_AS_ASSET
,InvoiceLinesE0.ASSET_BOOK_TYPE_CODE RES_ASSET_BOOK_TYPE_CODE
,InvoiceLinesE0.ASSET_CATEGORY_ID RES_ASSET_CATEGORY_ID
,InvoiceLinesE0.SERIAL_NUMBER RES_SERIAL_NUMBER
,InvoiceLinesE0.MANUFACTURER RES_MANUFACTURER
,InvoiceLinesE0.MODEL_NUMBER RES_MODEL_NUMBER
,InvoiceLinesE0.WARRANTY_NUMBER RES_WARRANTY_NUMBER
,'' RES_PRICE_CORRECTION_LINE
,(SELECT INVOICE_NUM
	FROM AP_INVOICES_ALL
	WHERE INVOICE_ID = InvoiceLinesE0.CORRECTED_INV_ID
	) RES_PRICE_CORRECTION_INVOICE_N
,InvoiceLinesE0.CORRECTED_LINE_NUMBER RES_PRICE_CORRECTION_INVOICE_L
,RequesterE0.FIRST_NAME RES_REQUESTER_FIRST_NAME
,RequesterE0.LAST_NAME RES_REQUESTER_LAST_NAME
,(SELECT PERSON_NUMBER
	FROM PER_ALL_PEOPLE_F
	WHERE PERSON_ID = InvoiceLinesE0.REQUESTER_ID
	AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
	) RES_REQUESTER_EMPLOYEE_NUMBER
,InvoiceLinesE0.ATTRIBUTE_CATEGORY RES_ATTRIBUTE_CATEGORY
,InvoiceLinesE0.ATTRIBUTE1 RES_ATTRIBUTE_1
,InvoiceLinesE0.ATTRIBUTE2 RES_ATTRIBUTE_2
,InvoiceLinesE0.ATTRIBUTE3 RES_ATTRIBUTE_3
,InvoiceLinesE0.ATTRIBUTE4 RES_ATTRIBUTE_4
,InvoiceLinesE0.ATTRIBUTE5 RES_ATTRIBUTE_5
,InvoiceLinesE0.ATTRIBUTE6 RES_ATTRIBUTE_6
,InvoiceLinesE0.ATTRIBUTE7 RES_ATTRIBUTE_7
,InvoiceLinesE0.ATTRIBUTE8 RES_ATTRIBUTE_8
,InvoiceLinesE0.ATTRIBUTE9 RES_ATTRIBUTE_9
,InvoiceLinesE0.ATTRIBUTE10 RES_ATTRIBUTE_10
,InvoiceLinesE0.ATTRIBUTE11 RES_ATTRIBUTE_11
,InvoiceLinesE0.ATTRIBUTE12 RES_ATTRIBUTE_12
,InvoiceLinesE0.ATTRIBUTE13 RES_ATTRIBUTE_13
,InvoiceLinesE0.ATTRIBUTE14 RES_ATTRIBUTE_14
,InvoiceLinesE0.ATTRIBUTE15 RES_ATTRIBUTE_15
,InvoiceLinesE0.ATTRIBUTE_NUMBER1 RES_ATTRIBUTE_NUMBER_1
,InvoiceLinesE0.ATTRIBUTE_NUMBER2 RES_ATTRIBUTE_NUMBER_2
,InvoiceLinesE0.ATTRIBUTE_NUMBER3 RES_ATTRIBUTE_NUMBER_3
,InvoiceLinesE0.ATTRIBUTE_NUMBER4 RES_ATTRIBUTE_NUMBER_4
,InvoiceLinesE0.ATTRIBUTE_NUMBER5 RES_ATTRIBUTE_NUMBER_5
,InvoiceLinesE0.ATTRIBUTE_DATE1 RES_ATTRIBUTE_DATE_1
,InvoiceLinesE0.ATTRIBUTE_DATE2 RES_ATTRIBUTE_DATE_2
,InvoiceLinesE0.ATTRIBUTE_DATE3 RES_ATTRIBUTE_DATE_3
,InvoiceLinesE0.ATTRIBUTE_DATE4 RES_ATTRIBUTE_DATE_4
,InvoiceLinesE0.ATTRIBUTE_DATE5 RES_ATTRIBUTE_DATE_5
,InvoiceLinesE0.GLOBAL_ATTRIBUTE_CATEGORY RES_GLOBAL_ATTRIBUTE_CATEGORY
,InvoiceLinesE0.GLOBAL_ATTRIBUTE1 RES_GLOBAL_ATTRIBUTE_1
,InvoiceLinesE0.GLOBAL_ATTRIBUTE2 RES_GLOBAL_ATTRIBUTE_2
,InvoiceLinesE0.GLOBAL_ATTRIBUTE3 RES_GLOBAL_ATTRIBUTE_3
,InvoiceLinesE0.GLOBAL_ATTRIBUTE4 RES_GLOBAL_ATTRIBUTE_4
,InvoiceLinesE0.GLOBAL_ATTRIBUTE5 RES_GLOBAL_ATTRIBUTE_5
,InvoiceLinesE0.GLOBAL_ATTRIBUTE6 RES_GLOBAL_ATTRIBUTE_6
,InvoiceLinesE0.GLOBAL_ATTRIBUTE7 RES_GLOBAL_ATTRIBUTE_7
,InvoiceLinesE0.GLOBAL_ATTRIBUTE8 RES_GLOBAL_ATTRIBUTE_8
,InvoiceLinesE0.GLOBAL_ATTRIBUTE9 RES_GLOBAL_ATTRIBUTE_9
,InvoiceLinesE0.GLOBAL_ATTRIBUTE10 RES_GLOBAL_ATTRIBUTE_10
,InvoiceLinesE0.GLOBAL_ATTRIBUTE11 RES_GLOBAL_ATTRIBUTE_11
,InvoiceLinesE0.GLOBAL_ATTRIBUTE12 RES_GLOBAL_ATTRIBUTE_12
,InvoiceLinesE0.GLOBAL_ATTRIBUTE13 RES_GLOBAL_ATTRIBUTE_13
,InvoiceLinesE0.GLOBAL_ATTRIBUTE14 RES_GLOBAL_ATTRIBUTE_14
,InvoiceLinesE0.GLOBAL_ATTRIBUTE15 RES_GLOBAL_ATTRIBUTE_15
,InvoiceLinesE0.GLOBAL_ATTRIBUTE16 RES_GLOBAL_ATTRIBUTE_16
,InvoiceLinesE0.GLOBAL_ATTRIBUTE17 RES_GLOBAL_ATTRIBUTE_17
,InvoiceLinesE0.GLOBAL_ATTRIBUTE18 RES_GLOBAL_ATTRIBUTE_18
,InvoiceLinesE0.GLOBAL_ATTRIBUTE19 RES_GLOBAL_ATTRIBUTE_19
,InvoiceLinesE0.GLOBAL_ATTRIBUTE20 RES_GLOBAL_ATTRIBUTE_20
,InvoiceLinesE0.GLOBAL_ATTRIBUTE_NUMBER1 RES_GLOBAL_ATTRIBUTE_NUMBER_1
,InvoiceLinesE0.GLOBAL_ATTRIBUTE_NUMBER2 RES_GLOBAL_ATTRIBUTE_NUMBER_2
,InvoiceLinesE0.GLOBAL_ATTRIBUTE_NUMBER3 RES_GLOBAL_ATTRIBUTE_NUMBER_3
,InvoiceLinesE0.GLOBAL_ATTRIBUTE_NUMBER4 RES_GLOBAL_ATTRIBUTE_NUMBER_4
,InvoiceLinesE0.GLOBAL_ATTRIBUTE_NUMBER5 RES_GLOBAL_ATTRIBUTE_NUMBER_5
,InvoiceLinesE0.GLOBAL_ATTRIBUTE_DATE1 RES_GLOBAL_ATTRIBUTE_DATE_1
,InvoiceLinesE0.GLOBAL_ATTRIBUTE_DATE2 RES_GLOBAL_ATTRIBUTE_DATE_2
,InvoiceLinesE0.GLOBAL_ATTRIBUTE_DATE3 RES_GLOBAL_ATTRIBUTE_DATE_3
,InvoiceLinesE0.GLOBAL_ATTRIBUTE_DATE4 RES_GLOBAL_ATTRIBUTE_DATE_4
,InvoiceLinesE0.GLOBAL_ATTRIBUTE_DATE5 RES_GLOBAL_ATTRIBUTE_DATE_5
,NULL RES_PROJECT_ID
,NULL RES_TASK_ID
,NULL RES_EXPENDITURE_TYPE_ID
,TO_CHAR(InvoiceLinesE0.EXPENDITURE_ITEM_DATE,'YYYY/MM/DD') RES_EXPENDITURE_ITEM_DATE
,NULL RES_EXPENDITURE_ORGANIZATION_I
,(SELECT SEGMENT1
	FROM PJF_PROJECTS_ALL_VL
	WHERE PROJECT_ID = InvoiceLinesE0.PJC_PROJECT_ID 
	) RES_PROJECT_NUMBER
,(SELECT ELEMENT_NUMBER
	FROM PJF_PROJ_ELEMENTS_VL
	WHERE PROJ_ELEMENT_ID = InvoiceLinesE0.PJC_TASK_ID 
	) RES_TASK_NUMBER 
,(SELECT EXPENDITURE_TYPE_NAME 
	FROM PJF_EXP_TYPES_TL
	WHERE LANGUAGE = USERENV('LANG')
	AND EXPENDITURE_TYPE_ID = InvoiceLinesE0.PJC_EXPENDITURE_TYPE_ID 
	) RES_EXPENDITURE_TYPE
,(SELECT NAME
	FROM HR_ORGANIZATION_UNITS
	WHERE ORGANIZATION_ID = InvoiceLinesE0.EXPENDITURE_ORGANIZATION_ID
	) RES_EXPENDITURE_ORGANIZATION
,InvoiceLinesE0.PJC_RESERVED_ATTRIBUTE1 RES_FUNDING_SOURCE_ID
,InvoiceLinesE0.PJC_RESERVED_ATTRIBUTE2 RES_PJC_RESERVED_ATTRIBUTE_2
,InvoiceLinesE0.PJC_RESERVED_ATTRIBUTE3 RES_PJC_RESERVED_ATTRIBUTE_3
,InvoiceLinesE0.PJC_RESERVED_ATTRIBUTE4 RES_PJC_RESERVED_ATTRIBUTE_4
,InvoiceLinesE0.PJC_RESERVED_ATTRIBUTE5 RES_PJC_RESERVED_ATTRIBUTE_5
,InvoiceLinesE0.PJC_RESERVED_ATTRIBUTE6 RES_PJC_RESERVED_ATTRIBUTE_6
,InvoiceLinesE0.PJC_RESERVED_ATTRIBUTE7 RES_PJC_RESERVED_ATTRIBUTE_7
,InvoiceLinesE0.PJC_RESERVED_ATTRIBUTE8 RES_PJC_RESERVED_ATTRIBUTE_8
,InvoiceLinesE0.PJC_RESERVED_ATTRIBUTE9 RES_PJC_RESERVED_ATTRIBUTE_9
,InvoiceLinesE0.PJC_RESERVED_ATTRIBUTE10 RES_PJC_RESERVED_ATTRIBUTE_10
,InvoiceLinesE0.PJC_USER_DEF_ATTRIBUTE1 RES_PJC_USER_DEFINED_ATTRIBUTE
,InvoiceLinesE0.PJC_USER_DEF_ATTRIBUTE2 RES_PJC_USER_DEFINED_ATTRIBU_0
,InvoiceLinesE0.PJC_USER_DEF_ATTRIBUTE3 RES_PJC_USER_DEFINED_ATTRIBU_1
,InvoiceLinesE0.PJC_USER_DEF_ATTRIBUTE4 RES_PJC_USER_DEFINED_ATTRIBU_2
,InvoiceLinesE0.PJC_USER_DEF_ATTRIBUTE5 RES_PJC_USER_DEFINED_ATTRIBU_3
,InvoiceLinesE0.PJC_USER_DEF_ATTRIBUTE6 RES_PJC_USER_DEFINED_ATTRIBU_4
,InvoiceLinesE0.PJC_USER_DEF_ATTRIBUTE7 RES_PJC_USER_DEFINED_ATTRIBU_5
,InvoiceLinesE0.PJC_USER_DEF_ATTRIBUTE8 RES_PJC_USER_DEFINED_ATTRIBU_6
,InvoiceLinesE0.PJC_USER_DEF_ATTRIBUTE9 RES_PJC_USER_DEFINED_ATTRIBU_7
,InvoiceLinesE0.PJC_USER_DEF_ATTRIBUTE10 RES_PJC_USER_DEFINED_ATTRIBU_8
,InvoiceLinesE0.FISCAL_CHARGE_TYPE RES_FISCAL_CHARGE_TYPE
,TO_CHAR(InvoiceLinesE0.DEF_ACCTG_START_DATE,'YYYY/MM/DD') RES_MULTIPERIOD_ACCOUNTING_STA
,TO_CHAR(InvoiceLinesE0.DEF_ACCTG_END_DATE,'YYYY/MM/DD') RES_MULTIPERIOD_ACCOUNTING_END
,FND_FLEX_EXT.GET_SEGS(APPLICATION_SHORT_NAME => 'GL',KEY_FLEX_CODE => 'GL#',STRUCTURE_NUMBER => (SELECT CHART_OF_ACCOUNTS_ID FROM GL_CODE_COMBINATIONS WHERE CODE_COMBINATION_ID = InvoiceLinesE0.DEF_ACCTG_ACCRUAL_CCID),COMBINATION_ID => InvoiceLinesE0.DEF_ACCTG_ACCRUAL_CCID) RES_MULTIPERIOD_ACCOUNTING_ACC
,NULL RES_PROJECT_NAME
,NULL RES_TASK_NAME
,(SELECT NAME
	FROM PJF_WORK_TYPES_TL
	WHERE LANGUAGE = USERENV('LANG')
	AND WORK_TYPE_ID = InvoiceLinesE0.PJC_WORK_TYPE_ID 
	) RES_WORK_TYPE
,NULL RES_CONTRACT_NAME
,NULL RES_CONTRACT_NUMBER
,NULL RES_FUNDING_SOURCE_NAME
,NULL RES_FUNDING_SOURCE_NUMBER
,InvoiceLinesE0.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,InvoiceLinesE0.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,InvoiceLinesE0.CREATED_BY RSC_CREATED_BY
,InvoiceLinesE0.CREATION_DATE RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,InvoiceLinesE0.ORG_ID RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM AP_INVOICES_ALL InvoicesE0
,AP_INVOICE_LINES_ALL InvoiceLinesE0
,AP_INVOICE_DISTRIBUTIONS_ALL invDistsE0
,(SELECT * 
	FROM PER_PERSON_NAMES_F
	WHERE SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
	) RequesterE0
,RCV_TRANSACTIONS rcvTrxsE0
WHERE InvoicesE0.INVOICE_ID = InvoiceLinesE0.INVOICE_ID
AND InvoiceLinesE0.INVOICE_ID = invDistsE0.INVOICE_ID
AND InvoiceLinesE0.LINE_NUMBER = invDistsE0.INVOICE_LINE_NUMBER
AND (invDistsE0.AMOUNT > 0 OR invDistsE0.LINE_TYPE_LOOKUP_CODE != 'NONREC_TAX')
AND InvoicesE0.PAYMENT_STATUS_FLAG IN ('P','N')
AND InvoiceLinesE0.REQUESTER_ID =  RequesterE0.PERSON_ID(+)
AND InvoiceLinesE0.RCV_TRANSACTION_ID = rcvTrxsE0.TRANSACTION_ID(+)
AND EXISTS (SELECT 1 FROM AP_PAYMENT_SCHEDULES_ALL
	WHERE INVOICE_ID = InvoicesE0.INVOICE_ID
	AND NVL(AMOUNT_REMAINING,0) != 0)
AND (InvoicesE0.VENDOR_ID != -10016) -- Remove Employee type
AND NVL(InvoiceLinesE0.DISCARDED_FLAG,'N') = 'N' --Remove canceled
AND AP_INVOICES_PKG.GET_APPROVAL_STATUS(InvoicesE0.INVOICE_ID,InvoicesE0.INVOICE_AMOUNT,InvoicesE0.PAYMENT_STATUS_FLAG,InvoicesE0.INVOICE_TYPE_LOOKUP_CODE) = 'APPROVED'
AND AP_INVOICES_PKG.GET_POSTING_STATUS(InvoicesE0.INVOICE_ID) = 'N'


UNION

SELECT InvoicesE0.INVOICE_ID RES_INVOICE_ID
,(SELECT MAX(LINE_NUMBER) + 1
	FROM AP_INVOICE_LINES_ALL
	WHERE INVOICE_ID = InvoicesE0.INVOICE_ID
	GROUP BY INVOICE_ID
	) RES_LINE_NUMBER
,'ITEM' RES_LINE_TYPE
,((ApPaymentSchedulsAllE0.GROSS_AMOUNT - ApPaymentSchedulsAllE0.AMOUNT_REMAINING)*-1) RES_AMOUNT
,1 RES_INVOICE_QUANTITY
,((ApPaymentSchedulsAllE0.GROSS_AMOUNT - ApPaymentSchedulsAllE0.AMOUNT_REMAINING)*-1) RES_UNIT_PRICE
,NULL RES_UOM
,'PAID AMOUNT' RES_DESCRIPTION
,NULL RES_PO_NUMBER
,NULL RES_PO_LINE_NUMBER
,NULL RES_PO_SCHEDULE_NUMBER
,NULL RES_PO_DISTRIBUTION_NUMBER
,NULL RES_ITEM_DESCRIPTION
,NULL RES_PO_RELEASE_NUMBER
,NULL RES_PURCHASING_CATEGORY 
,NULL RES_RECEIPT_NUMBER
,NULL RES_RECEIPT_LINE_NUMBER
,NULL RES_CONSUMPTION_ADVICE_NUMBER
,NULL RES_CONSUMPTION_ADVICE_LINE_NU
,NULL RES_PACKING_SLIP
,NULL RES_FINAL_MATCH
,FND_FLEX_EXT.GET_SEGS(APPLICATION_SHORT_NAME => 'GL',KEY_FLEX_CODE => 'GL#',STRUCTURE_NUMBER => (SELECT CHART_OF_ACCOUNTS_ID FROM GL_CODE_COMBINATIONS WHERE CODE_COMBINATION_ID = InvoicesE0.ACCTS_PAY_CODE_COMBINATION_ID),COMBINATION_ID => InvoicesE0.ACCTS_PAY_CODE_COMBINATION_ID) RES_DISTRIBUTION_COMBINATION
,NULL RES_DISTRIBUTION_SET
,(SELECT MAX(TO_CHAR(ApChecksE0.CHECK_DATE,'YYYY/MM/DD'))
	FROM AP_INVOICE_PAYMENTS_ALL ApPaymentsE0
	,AP_CHECKS_ALL ApChecksE0
	WHERE InvoicesE0.INVOICE_ID = ApPaymentsE0.INVOICE_ID
	AND ApPaymentsE0.CHECK_ID = ApChecksE0.CHECK_ID
	) RES_ACCOUNTING_DATE
,NULL RES_OVERLAY_ACCOUNT_SEGMENT
,NULL RES_OVERLAY_PRIMARY_BALANCING_
,NULL RES_OVERLAY_COST_CENTER_SEGMEN
,NULL RES_TAX_CLASSIFICATION_CODE
,NULL RES_SHIP_TO_LOCATION
,NULL RES_SHIP_FROM_LOCATION
,NULL RES_LOCATION_OF_FINAL_DISCHARG
,NULL RES_TRANSACTION_BUSINESS_CATEG
,NULL RES_PRODUCT_FISCAL_CLASSIFICAT
,NULL RES_INTENDED_USE
,NULL RES_USER_DEFINED_FISCAL_CLASSI
,NULL RES_PRODUCT_TYPE
,NULL RES_ASSESSABLE_VALUE
,NULL RES_PRODUCT_CATEGORY
,NULL RES_TAX_CONTROL_AMOUNT
,NULL RES_TAX_REGIME_CODE
,NULL RES_TAX
,NULL RES_TAX_STATUS_CODE
,NULL RES_TAX_JURISDICTION_CODE
,NULL RES_TAX_RATE_CODE
,NULL RES_TAX_RATE
,NULL RES_WITHHOLDING_TAX_GROUP
,NULL RES_INCOME_TAX_TYPE
,NULL RES_INCOME_TAX_REGION
,NULL RES_PRORATE_ACROSS_ALL_ITEM_LI
,NULL RES_LINE_GROUP_NUMBER
,NULL RES_COST_FACTOR_NAME 
,NULL RES_STATISTICAL_QUANTITY
,NULL RES_TRACK_AS_ASSET
,NULL RES_ASSET_BOOK_TYPE_CODE
,NULL RES_ASSET_CATEGORY_ID
,NULL RES_SERIAL_NUMBER
,NULL RES_MANUFACTURER
,NULL RES_MODEL_NUMBER
,NULL RES_WARRANTY_NUMBER
,NULL RES_PRICE_CORRECTION_LINE
,NULL RES_PRICE_CORRECTION_INVOICE_N
,NULL RES_PRICE_CORRECTION_INVOICE_L
,NULL RES_REQUESTER_FIRST_NAME
,NULL RES_REQUESTER_LAST_NAME
,NULL RES_REQUESTER_EMPLOYEE_NUMBER
,NULL RES_ATTRIBUTE_CATEGORY
,NULL RES_ATTRIBUTE_1
,NULL RES_ATTRIBUTE_2
,NULL RES_ATTRIBUTE_3
,NULL RES_ATTRIBUTE_4
,NULL RES_ATTRIBUTE_5
,NULL RES_ATTRIBUTE_6
,NULL RES_ATTRIBUTE_7
,NULL RES_ATTRIBUTE_8
,NULL RES_ATTRIBUTE_9
,NULL RES_ATTRIBUTE_10
,NULL RES_ATTRIBUTE_11
,NULL RES_ATTRIBUTE_12
,NULL RES_ATTRIBUTE_13
,NULL RES_ATTRIBUTE_14
,NULL RES_ATTRIBUTE_15
,NULL RES_ATTRIBUTE_NUMBER_1
,NULL RES_ATTRIBUTE_NUMBER_2
,NULL RES_ATTRIBUTE_NUMBER_3
,NULL RES_ATTRIBUTE_NUMBER_4
,NULL RES_ATTRIBUTE_NUMBER_5
,NULL RES_ATTRIBUTE_DATE_1
,NULL RES_ATTRIBUTE_DATE_2
,NULL RES_ATTRIBUTE_DATE_3
,NULL RES_ATTRIBUTE_DATE_4
,NULL RES_ATTRIBUTE_DATE_5
,NULL RES_GLOBAL_ATTRIBUTE_CATEGORY
,NULL RES_GLOBAL_ATTRIBUTE_1
,NULL RES_GLOBAL_ATTRIBUTE_2
,NULL RES_GLOBAL_ATTRIBUTE_3
,NULL RES_GLOBAL_ATTRIBUTE_4
,NULL RES_GLOBAL_ATTRIBUTE_5
,NULL RES_GLOBAL_ATTRIBUTE_6
,NULL RES_GLOBAL_ATTRIBUTE_7
,NULL RES_GLOBAL_ATTRIBUTE_8
,NULL RES_GLOBAL_ATTRIBUTE_9
,NULL RES_GLOBAL_ATTRIBUTE_10
,NULL RES_GLOBAL_ATTRIBUTE_11
,NULL RES_GLOBAL_ATTRIBUTE_12
,NULL RES_GLOBAL_ATTRIBUTE_13
,NULL RES_GLOBAL_ATTRIBUTE_14
,NULL RES_GLOBAL_ATTRIBUTE_15
,NULL RES_GLOBAL_ATTRIBUTE_16
,NULL RES_GLOBAL_ATTRIBUTE_17
,NULL RES_GLOBAL_ATTRIBUTE_18
,NULL RES_GLOBAL_ATTRIBUTE_19
,NULL RES_GLOBAL_ATTRIBUTE_20
,NULL RES_GLOBAL_ATTRIBUTE_NUMBER_1
,NULL RES_GLOBAL_ATTRIBUTE_NUMBER_2
,NULL RES_GLOBAL_ATTRIBUTE_NUMBER_3
,NULL RES_GLOBAL_ATTRIBUTE_NUMBER_4
,NULL RES_GLOBAL_ATTRIBUTE_NUMBER_5
,NULL RES_GLOBAL_ATTRIBUTE_DATE_1
,NULL RES_GLOBAL_ATTRIBUTE_DATE_2
,NULL RES_GLOBAL_ATTRIBUTE_DATE_3
,NULL RES_GLOBAL_ATTRIBUTE_DATE_4
,NULL RES_GLOBAL_ATTRIBUTE_DATE_5
,NULL RES_PROJECT_ID
,NULL RES_TASK_ID
,NULL RES_EXPENDITURE_TYPE_ID
,NULL RES_EXPENDITURE_ITEM_DATE
,NULL RES_EXPENDITURE_ORGANIZATION_I
,NULL RES_PROJECT_NUMBER
,NULL RES_TASK_NUMBER
,NULL RES_EXPENDITURE_TYPE
,NULL RES_EXPENDITURE_ORGANIZATION
,NULL RES_FUNDING_SOURCE_ID
,NULL RES_PJC_RESERVED_ATTRIBUTE_2
,NULL RES_PJC_RESERVED_ATTRIBUTE_3
,NULL RES_PJC_RESERVED_ATTRIBUTE_4
,NULL RES_PJC_RESERVED_ATTRIBUTE_5
,NULL RES_PJC_RESERVED_ATTRIBUTE_6
,NULL RES_PJC_RESERVED_ATTRIBUTE_7
,NULL RES_PJC_RESERVED_ATTRIBUTE_8
,NULL RES_PJC_RESERVED_ATTRIBUTE_9
,NULL RES_PJC_RESERVED_ATTRIBUTE_10
,NULL RES_PJC_USER_DEFINED_ATTRIBUTE
,NULL RES_PJC_USER_DEFINED_ATTRIBU_0
,NULL RES_PJC_USER_DEFINED_ATTRIBU_1
,NULL RES_PJC_USER_DEFINED_ATTRIBU_2
,NULL RES_PJC_USER_DEFINED_ATTRIBU_3
,NULL RES_PJC_USER_DEFINED_ATTRIBU_4
,NULL RES_PJC_USER_DEFINED_ATTRIBU_5
,NULL RES_PJC_USER_DEFINED_ATTRIBU_6
,NULL RES_PJC_USER_DEFINED_ATTRIBU_7
,NULL RES_PJC_USER_DEFINED_ATTRIBU_8
,NULL RES_FISCAL_CHARGE_TYPE
,NULL RES_MULTIPERIOD_ACCOUNTING_STA
,NULL RES_MULTIPERIOD_ACCOUNTING_END
,NULL RES_MULTIPERIOD_ACCOUNTING_ACC
,NULL RES_PROJECT_NAME
,NULL RES_TASK_NAME
,NULL RES_WORK_TYPE
,NULL RES_CONTRACT_NAME
,NULL RES_CONTRACT_NUMBER
,NULL RES_FUNDING_SOURCE_NAME
,NULL RES_FUNDING_SOURCE_NUMBER
,InvoiceLinesE0.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,InvoiceLinesE0.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,InvoiceLinesE0.CREATED_BY RSC_CREATED_BY
,InvoiceLinesE0.CREATION_DATE RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,InvoiceLinesE0.ORG_ID RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM AP_INVOICES_ALL InvoicesE0
,AP_INVOICE_LINES_ALL InvoiceLinesE0
,AP_PAYMENT_SCHEDULES_ALL ApPaymentSchedulsAllE0
/*,AP_INVOICE_PAYMENTS_ALL ApPaymentsE0
,AP_CHECKS_ALL ApChecksE0*/
WHERE InvoicesE0.INVOICE_ID = InvoiceLinesE0.INVOICE_ID
AND InvoicesE0.PAYMENT_STATUS_FLAG IN ('P')
AND InvoicesE0.INVOICE_ID = ApPaymentSchedulsAllE0.INVOICE_ID
/*AND InvoicesE0.INVOICE_ID = ApPaymentsE0.INVOICE_ID
AND ApPaymentsE0.CHECK_ID = ApChecksE0.CHECK_ID*/
AND NVL(ApPaymentSchedulsAllE0.AMOUNT_REMAINING,0) != 0
AND InvoiceLinesE0.LINE_NUMBER = 1
AND (InvoicesE0.VENDOR_ID != -10016) -- Remove Employee type
AND AP_INVOICES_PKG.GET_APPROVAL_STATUS(InvoicesE0.INVOICE_ID,InvoicesE0.INVOICE_AMOUNT,InvoicesE0.PAYMENT_STATUS_FLAG,InvoicesE0.INVOICE_TYPE_LOOKUP_CODE) = 'APPROVED'
AND AP_INVOICES_PKG.GET_POSTING_STATUS(InvoicesE0.INVOICE_ID) = 'N'


ORDER BY RES_INVOICE_ID
,RES_LINE_NUMBER