/* ****************************************************************************
* $Revision: 78229 $:
* $Author: pisan.jariyasettachok $:
* $Date: 2022-04-07 14:37:05 +0700 (Thu, 07 Apr 2022) $:
* $HeadURL: https://svn03.rapid4cloud.com/svn/a/dev/rapidesuite/controldata/FUSION_11.1.13/trunk/core/reverse_sql/FINANCIALS/Manage%20HCM%20Role%20Provisioning%20Rules%20-%20Role%20Mappings.sql $:
* $Id: Manage HCM Role Provisioning Rules - Role Mappings.sql 78229 2022-04-07 07:37:05Z pisan.jariyasettachok $:
* ****************************************************************************
* Description:
* ************************************************************************** */

-- RSC_PREREQUISITE_OBJECTS=PER_ROLE_MAPPINGS

SELECT RoleMappingEO.MAPPING_NAME RES_MAPPING_NAME
,TO_CHAR(RoleMappingEO.Date_From,'DD-Mon-YYYY') RES_FROM_DATE
,TO_CHAR(RoleMappingEO.Date_TO,'DD-Mon-YYYY') RES_TO_DATE
,(SELECT NAME 
	FROM HR_ORGANIZATION_UNITS_F_TL
	WHERE LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
	AND organization_id = RoleMappingEO.legal_employer_id 
	) RES_LEGAL_EMPLOYER
,(SELECT BU_NAME
	FROM FUN_ALL_BUSINESS_UNITS_V
	WHERE BU_ID = RoleMappingEO.business_unit_id
	) RES_BUSINESS_UNIT
,(SELECT NAME 
	FROM HR_ORGANIZATION_UNITS_F_TL
	WHERE LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
	AND organization_id = RoleMappingEO.department_id
	) RES_DEPARTMENT
,(SELECT NAME
	FROM PER_JOBS_F_TL
	WHERE LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
	AND job_id = RoleMappingEO.job_id
	) RES_JOB
,(SELECT NAME
	FROM HR_ALL_POSITIONS_F_TL
	WHERE LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
	AND position_id = RoleMappingEO.position_id
	) RES_POSITION
,(SELECT NAME
	FROM PER_GRADES_F_TL
	WHERE LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
	AND GRADE_ID = RoleMappingEO.grade_id
	) RES_GRADE
,LocationDPEO.LOCATION_NAME RES_LOCATION_NAME
,LocationDPEO.INTERNAL_LOCATION_CODE RES_LOCATION_CODE
,(SELECT MEANING
	FROM FND_LOOKUP_VALUES
	WHERE LANGUAGE = USERENV('LANG')
	AND LOOKUP_TYPE = 'PER_PERIOD_TYPE'
	AND LOOKUP_CODE = RoleMappingEO.ASSIGNMENT_TYPE
	) RES_ASSIGNMENT_TYPE
,(SELECT MEANING
	FROM FND_LOOKUP_VALUES
	WHERE LANGUAGE = USERENV('LANG')
	AND LOOKUP_TYPE = 'SYSTEM_PERSON_TYPE'
	AND LOOKUP_CODE = RoleMappingEO.SYSTEM_PERSON_TYPE
	) RES_SYSTEM_PERSON_TYPE
,(SELECT USER_PERSON_TYPE
	FROM PER_PERSON_TYPES_TL
	WHERE LANGUAGE = USERENV('LANG')
	AND person_type_id = RoleMappingEO.user_person_type_id
	) RES_USER_PERSON_TYPE
,DECODE(RoleMappingEO.ASSIGNMENT_STATUS,'ACTIVE','Active','INACTIVE','Inactive') RES_HR_ASSIGNMENT_STATUS

,(SELECT USER_STATUS
	FROM PER_ASSIGNMENT_STATUS_TYPES_TL
	WHERE LANGUAGE = USERENV('LANG')
	AND ASSIGNMENT_STATUS_TYPE_ID = RoleMappingEO.ASSIGNMENT_STATUS_TYPE_ID 
	) RES_ASSIGNMENT_STATUS
,(SELECT ROLE_NAME
	FROM JTF_RS_ROLES_TL
	WHERE LANGUAGE = USERENV('LANG')
	AND ROLE_ID = RoleMappingEO.RESOURCE_ROLE_ID
	) RES_RESOURCE_ROLE
,(SELECT PARTY_USAGE_NAME
	FROM HZ_PARTY_USAGES_TL
	WHERE LANGUAGE = USERENV('LANG')
	AND PARTY_USAGE_CODE = RoleMappingEO.PARTY_USAGE_CODE
	) RES_PARTY_TYPE_USAGE
,RoleMappingEO.CONTACT_ROLE RES_CONTACT_ROLE
,DECODE (RoleMappingEO.CURRENT_MANAGER_FLAG, 'Y', 'Yes', 'N', 'No') RES_MANAGER_WITH_REPORTS
,(SELECT MEANING 
	FROM FND_LOOKUP_VALUES
	WHERE LANGUAGE = USERENV('LANG')
	AND LOOKUP_TYPE = 'PER_SUPERVISOR_TYPE'
	AND LOOKUP_CODE = RoleMappingEO.MANAGER_TYPE
	) RES_MANAGER_TYPE
,(SELECT MEANING 
	FROM FND_LOOKUP_VALUES_VL
	WHERE LOOKUP_TYPE = 'PER_RESPONSIBILITY_TYPES'
	AND LOOKUP_CODE = RoleMappingEO.RESPONSIBILITY_TYPE
	) RES_RESPONSIBILITY_TYPE
,(SELECT NAME
	FROM PER_LEGISLATIVE_DATA_GROUPS_TL
	WHERE LANGUAGE = USERENV('LANG')
	AND LEGISLATIVE_DATA_GROUP_ID = RoleMappingEO.LEGISLATIVE_DATA_GROUP_ID 
	) RES_LEGISLATIVE_DATA_GROUP
,RoleMappingEO.LAST_UPDATED_BY  RSC_LAST_UPDATED_BY
,RoleMappingEO.LAST_UPDATE_DATE  RSC_LAST_UPDATE_DATE
,RoleMappingEO.CREATED_BY  RSC_CREATED_BY
,RoleMappingEO.CREATION_DATE  RSC_CREATION_DATE
, null RSC_LEDGER_ID
, null RSC_CHART_OF_ACCOUNTS_ID
, RoleMappingEO.BUSINESS_UNIT_ID RSC_BUSINESS_UNIT_ID
, null RSC_LEGAL_ENTITY_ID
, null RSC_ORGANIZATION_ID
, null RSC_BUSINESS_GROUP_ID
, NULL RSC_ENTERPRISE_ID
, NULL RSC_COUNTRY_ID

FROM PER_ROLE_MAPPINGS RoleMappingEO
,(SELECT LOCATION_ID
	,LOCATION_NAME
	,INTERNAL_LOCATION_CODE
	FROM HR_LOCATIONS_ALL_F_VL 
	WHERE (sysdate BETWEEN effective_start_date AND effective_end_date)
	) LocationDPEO
WHERE RoleMappingEO.LOCATION_ID = LocationDPEO.LOCATION_ID(+)
ORDER BY RoleMappingEO.mapping_name