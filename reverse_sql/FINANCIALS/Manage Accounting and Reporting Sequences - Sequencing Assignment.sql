/* ****************************************************************************
 * $Revision: 80520 $:
 * $Author: pisan.jariyasettachok $:
 * $Date: 2023-03-22 16:06:27 +0700 (Wed, 22 Mar 2023) $:
 * $HeadURL: https://svn03.rapid4cloud.com/svn/a/dev/rapidesuite/controldata/FUSION_11.1.13/trunk/core/reverse_sql/FINANCIALS/Manage%20Accounting%20and%20Reporting%20Sequences%20-%20Sequencing%20Assignment.sql $:
 * $Id: Manage Accounting and Reporting Sequences - Sequencing Assignment.sql 80520 2023-03-22 09:06:27Z pisan.jariyasettachok $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */


SELECT GlLedgers.NAME AS RES_LEDGER
,LedgerLePEO.LEGAL_ENTITY_NAME AS RES_LEGAL_ENTITY
,(SELECT DISTINCT GLUP.MEANING
	FROM GL_LOOKUPS GLUP
	WHERE GLUP.LOOKUP_TYPE         = 'FUN_SEQ_JRNL_ENTRY_TYPE'
	AND((FunSeqContexts.TABLE_NAME = 'GL_JE_HEADERS'
	AND GLUP.LOOKUP_CODE           = 'GENERAL_LEDGER')
	OR(FunSeqContexts.TABLE_NAME   = 'XLA_AE_HEADERS'
	AND GLUP.LOOKUP_CODE           = 'SUBLEDGER'))
	) AS RES_JOURNAL_ENTRY_TYPE
,(SELECT DISTINCT GLLookupEO3.MEANING
	FROM FUN_SEQ_RULES FunSeqRules3
	,GL_LOOKUPS GLLookupEO3
	WHERE FunSeqRules3.EVENT_CODE = GLLookupEO3.LOOKUP_CODE
	AND FunSeqRules3.EVENT_CODE   = FunSeqContexts.EVENT_CODE
	AND GLLookupEO3.LOOKUP_TYPE   = 'FUN_SEQ_EVENT'
	) AS RES_SEQUENCING_EVENT
,(SELECT DECODE(BALANCE_TYPE,'A',DECODE(PRIORITY,null,'Association',DECODE(SEQ_HEADER_ID,null,'Exclusion','Exception'))) 
	FROM FUN_SEQ_ASSIGNMENTS 
	WHERE ASSIGNMENT_ID = FunSeqAssignments.LINK_TO_ASSIGNMENT_ID
	) RES_PARENT_TYPE
,(SELECT HEADER_NAME 
	FROM FUN_SEQ_HEADERS 
	WHERE SEQ_HEADER_ID = (SELECT seq_header_id FROM FUN_SEQ_ASSIGNMENTS fsa WHERE  fsa.ASSIGNMENT_ID = FunSeqAssignments.LINK_TO_ASSIGNMENT_ID)
	) AS RES_PARENT_NAME
,(SELECT TO_CHAR(START_DATE,'DD-Mon-YYYY') 
	FROM FUN_SEQ_ASSIGNMENTS 
	WHERE ASSIGNMENT_ID = FunSeqAssignments.LINK_TO_ASSIGNMENT_ID
	) AS RES_PARENT_START_DATE
,(SELECT TO_CHAR(END_DATE,'DD-Mon-YYYY') 
	FROM FUN_SEQ_ASSIGNMENTS 
	WHERE ASSIGNMENT_ID = FunSeqAssignments.LINK_TO_ASSIGNMENT_ID
	) AS RES_PARENT_END_DATE
,DECODE(FunSeqAssignments.BALANCE_TYPE,'A',DECODE(FunSeqAssignments.PRIORITY,null,'Association',DECODE(FunSeqAssignments.SEQ_HEADER_ID,null,'Exclusion','Exception'))) AS RES_TYPE
,(SELECT DISTINCT LKUPS.MEANING
	FROM GL_LOOKUPS LKUPS
	WHERE LKUPS.LOOKUP_TYPE = 'FUN_SEQ_STATUS'
	AND LKUPS.LOOKUP_CODE   = FunSeqAssignments.USE_STATUS_CODE
	) AS RES_STATUS
,FunSeqAssignments.PRIORITY AS RES_PRIORITY
,(SELECT HEADER_NAME 
	FROM FUN_SEQ_HEADERS 
	WHERE SEQ_HEADER_ID = FunSeqAssignments.SEQ_HEADER_ID
	) AS RES_NAME
,TO_CHAR(FunSeqAssignments.START_DATE,'DD-Mon-YYYY') AS RES_START_DATE
,TO_CHAR(FunSeqAssignments.END_DATE,'DD-Mon-YYYY') AS RES_END_DATE
,NVL((SELECT user_je_source_name 
		FROM GL_JE_SOURCES_VL aa 
		WHERE aa.je_source_name  = FunSeqAssignments.JOURNAL_SOURCE 
		AND language  = userenv('LANG')),'All'
	) AS RES_JOURNAL_SOURCE
,nvl((SELECT user_je_category_name from GL_JE_CATEGORIES_TL 
      WHERE je_category_name = FunSeqAssignments.JOURNAL_CATEGORY
		AND language  = userenv('LANG')),'All'
	) AS RES_JOURNAL_CATEGORY
,FunSeqAssignments.ACCOUNTING_EVENT_TYPE AS RES_ACCOUNTING_EVENT_TYPE
,ACC_EVENT_TYPE.NAME RES_ACCOUNTING_EVENT_NAME
,ACC_EVENT_TYPE.APPLICATION_NAME RES_ACCOUNTING_EVENT_APPLICATI
,(SELECT MEANING 
	FROM fnd_lookups 
	WHERE LOOKUP_TYPE = 'IBY_PROCESS_TYPES' 
	AND LOOKUP_CODE =  FunSeqAssignments.ACCOUNTING_ENTRY_TYPE
	) AS RES_ACCOUNTING_ENTRY_TYPE
,FunSeqAssignments.DOCUMENT_CATEGORY RES_DOCUMENT_CATEGORY_CODE
,DOC_CAT.NAME AS RES_DOCUMENT_CATEGORY_NAME
,DOC_CAT.APPLICATION_NAME RES_DOCUMENT_APPLICATION_NAME
,FunSeqAssignments.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,FunSeqAssignments.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,FunSeqAssignments.CREATED_BY RSC_CREATED_BY
,FunSeqAssignments.CREATION_DATE RSC_CREATION_DATE
,PGL.PRIMARY_LEDGER_ID RSC_LEDGER_ID
,null RSC_CHART_OF_ACCOUNTS_ID
,null RSC_BUSINESS_UNIT_ID
,null RSC_LEGAL_ENTITY_ID
,null RSC_ORGANIZATION_ID
,null RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID
FROM FUN_SEQ_ASSIGNMENTS FunSeqAssignments
,FUN_SEQ_CONTEXTS FunSeqContexts
,GL_LEDGERS GlLedgers
,GL_LEDGER_LE_V LedgerLePEO
,(SELECT DISTINCT RSHIP.TARGET_LEDGER_ID
	,RSHIP.PRIMARY_LEDGER_ID 
	FROM GL_LEDGER_RELATIONSHIPS RSHIP
	WHERE (RSHIP.RELATIONSHIP_TYPE_CODE <> 'NONE'
	AND RSHIP.TARGET_LEDGER_CATEGORY_CODE = 'SECONDARY')
	OR (RSHIP.RELATIONSHIP_TYPE_CODE = 'NONE'
	AND RSHIP.TARGET_LEDGER_CATEGORY_CODE = 'PRIMARY')
	OR (RSHIP.RELATIONSHIP_TYPE_CODE <> 'NONE'
	AND RSHIP.TARGET_LEDGER_CATEGORY_CODE = 'ALC')
	) PGL
,(SELECT EventTypePEO.NAME
	,EventTypePEO.EVENT_TYPE_CODE
	,ApplicationPEO.APPLICATION_NAME
	FROM XLA_EVENT_TYPES_VL EventTypePEO
	,XLA_EVENT_CLASSES_VL EventClassPEO
	,FND_APPLICATION_VL ApplicationPEO
	WHERE EventTypePEO.APPLICATION_ID = ApplicationPEO.APPLICATION_ID
	AND EventClassPEO.APPLICATION_ID  = ApplicationPEO.APPLICATION_ID
	and EVENTTYPEPEO.ENTITY_CODE      = EVENTCLASSPEO.ENTITY_CODE
	and EVENTTYPEPEO.EVENT_CLASS_CODE = EVENTCLASSPEO.EVENT_CLASS_CODE) ACC_EVENT_TYPE 
,(SELECT FNDDOC.APPLICATION_ID
	, FNDDOC.CODE
	, FNDDOC.NAME
	, FNDDOC.DESCRIPTION
	, FNDAPP.APPLICATION_NAME
	FROM FND_DOC_SEQUENCE_CATEGORIES FNDDOC
	, FND_APPLICATION_VL FNDAPP
	WHERE FNDDOC.APPLICATION_ID = FNDAPP.APPLICATION_ID)	DOC_CAT  
WHERE FunSeqContexts.CONTEXT_VALUE  = GlLedgers.LEDGER_ID(+)
AND FunSeqContexts.SEQ_CONTEXT_ID = FunSeqAssignments.SEQ_CONTEXT_ID
AND FunSeqContexts.LEGAL_ENTITY_ID = LedgerLePEO.LEGAL_ENTITY_ID(+)
AND FunSeqContexts.CONTEXT_VALUE    = LedgerLePEO.LEDGER_ID(+)
and FunSeqAssignments.ACCOUNTING_EVENT_TYPE = ACC_EVENT_TYPE.EVENT_TYPE_CODE(+)
and FunSeqAssignments.DOCUMENT_CATEGORY = DOC_CAT.CODE(+)
AND FunSeqContexts.TABLE_NAME       > 'FUN_TRX_BATCHES'
AND FunSeqContexts.CONTEXT_TYPE     > 'INTERCOMPANY_BATCH_SOURCE'
AND (FunSeqAssignments.LINK_TO_ASSIGNMENT_ID IS NULL 
OR FunSeqAssignments.LINK_TO_ASSIGNMENT_ID IN (SELECT ASSIGNMENT_ID FROM FUN_SEQ_ASSIGNMENTS))
AND GlLedgers.LEDGER_ID = PGL.TARGET_LEDGER_ID(+)
ORDER BY GlLedgers.NAME
,LedgerLePEO.LEGAL_ENTITY_NAME
,CASE RES_TYPE WHEN 'Association' THEN 1 ELSE 2 END
,RES_NAME
,FunSeqAssignments.START_DATE 
,FunSeqAssignments.END_DATE