/* ****************************************************************************
 * $Revision:  $:
 * $Author: Nasrullah.Dusenmahamad $:
 * $Date: 2017-08-29  $:
 * $HeadURL: $:
 * $Id: Manage Suppliers - Supplier.sql  $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */

-- STRICTLY_BATCH_SEQ = RES_SUPPLIER_NUMBER

SELECT 'CREATE' RES_IMPORT_ACTION
,SupplierPartyPEO.PARTY_NAME RES_SUPPLIER_NAME
,NULL RES_SUPPLIER_NAME_NEW
,SupplierEO.SEGMENT1 RES_SUPPLIER_NUMBER
,AdditionalPartyNamePEO.PARTY_NAME RES_ALTERNATE_NAME
,SupplierEO.ORGANIZATION_TYPE_LOOKUP_CODE RES_TAX_ORGANIZATION_TYPE
,SupplierEO.VENDOR_TYPE_LOOKUP_CODE RES_SUPPLIER_TYPE
,TO_CHAR(SupplierEO.END_DATE_ACTIVE,'YYYY/MM/DD') RES_INACTIVE_DATE
,SupplierEO.BUSINESS_RELATIONSHIP RES_BUSINESS_RELATIONSHIP
,(SELECT PartyPEO.PARTY_NAME
	FROM POZ_SUPPLIERS SupplierPEO
	,HZ_PARTIES PartyPEO
	WHERE SupplierPEO.party_id = PartyPEO.PARTY_ID
    AND SupplierPEO.vendor_id = SupplierEO.PARENT_VENDOR_ID
	) RES_PARENT_SUPPLIER
,(SELECT aa.PARTY_NAME  
   FROM HZ_ADDTNL_PARTY_NAMES aa
   WHERE SupplierEO.PARTY_ID = aa.PARTY_ID
   AND aa.PARTY_NAME_TYPE = 'ALIAS'
   AND aa.PREFERRED_FLAG ='Y'
   ) RES_ALIAS
,SupplierPartyPEO.DUNS_NUMBER_C RES_D_U_N_S_NUMBER
,SupplierEO.ONE_TIME_FLAG RES_ONE_TIME_SUPPLIER
,SupplierEO.CUSTOMER_NUM RES_CUSTOMER_NUMBER
,SupplierEO.STANDARD_INDUSTRY_CLASS RES_SIC
,SupplierPiiEO.NI_NUMBER RES_NATIONAL_INSURANCE_NUMBER
,SupplierEO.CORPORATE_WEBSITE RES_CORPORATE_WEB_SITE
,OrganizationDEO.CEO_TITLE RES_CHIEF_EXECUTIVE_TITLE
,OrganizationDEO.CEO_NAME RES_CHIEF_EXECUTIVE_NAME
,Buss.LOOKUP_CODE RES_BUSINESS_CLASSIFICATIONS_N
,SupplierEO.TAXPAYER_COUNTRY RES_TAXPAYER_COUNTRY
,SupplierPiiEO.INCOME_TAX_ID RES_TAXPAYER_ID
,SupplierEO.FEDERAL_REPORTABLE_FLAG RES_FEDERAL_REPORTABLE
,SupplierEO.TYPE_1099 RES_FEDERAL_INCOME_TAX_TYPE
,SupplierEO.STATE_REPORTABLE_FLAG RES_STATE_REPORTABLE
,SupplierEO.TAX_REPORTING_NAME RES_TAX_REPORTING_NAME
,SupplierEO.NAME_CONTROL RES_NAME_CONTROL
,TO_CHAR(SupplierEO.TAX_VERIFICATION_DATE,'YYYY/MM/DD') RES_TAX_VERIFICATION_DATE
,SupplierEO.ALLOW_AWT_FLAG RES_USE_WITHHOLDING_TAX
,(SELECT CONDITION_GROUP_NAME
	FROM ZX_CONDITION_GROUPS_TL
	WHERE LANGUAGE = USERENV('LANG')
	AND CONDITION_GROUP_ID = SupplierEO.AWT_GROUP_ID  
	) RES_WITHHOLDING_TAX_GROUP
,SupplierEO.VAT_CODE RES_VAT_CODE
,NVL(SupplierEO.VAT_REGISTRATION_NUM,PartyTaxProfileGenericPEO.REP_REGISTRATION_NUMBER) RES_TAX_REGISTRATION_NUMBER
,SupplierEO.AUTO_TAX_CALC_OVERRIDE RES_AUTO_TAX_CALC_OVERRIDE
,(select pmthds.payment_method_code
	from IBY_PAYMENT_METHODS_VL pmthds
	where pmthds.payment_method_code = (SELECT payment_method_code
		FROM iby_ext_party_pmt_mthds m
		WHERE m.ext_pmt_party_id = IbyExternalPayeesAll.EXT_PAYEE_ID
		AND m.primary_flag = 'Y'
		AND m.payment_function = IbyExternalPayeesAll.payment_function)    
	) RES_PAYMENT_METHOD
,IbyExternalPayeesAll.DELIVERY_CHANNEL_CODE RES_DELIVERY_CHANNEL
,IbyExternalPayeesAll.BANK_INSTRUCTION1_CODE RES_BANK_INSTRUCTION_1
,IbyExternalPayeesAll.BANK_INSTRUCTION2_CODE RES_BANK_INSTRUCTION_2
,IbyExternalPayeesAll.BANK_INSTRUCTION_DETAILS RES_BANK_INSTRUCTION
,IbyExternalPayeesAll.SETTLEMENT_PRIORITY RES_SETTLEMENT_PRIORITY
,IbyExternalPayeesAll.PAYMENT_TEXT_MESSAGE1 RES_PAYMENT_TEXT_MESSAGE_1
,IbyExternalPayeesAll.PAYMENT_TEXT_MESSAGE2 RES_PAYMENT_TEXT_MESSAGE_2
,IbyExternalPayeesAll.PAYMENT_TEXT_MESSAGE3 RES_PAYMENT_TEXT_MESSAGE_3
,IbyExternalPayeesAll.BANK_CHARGE_BEARER RES_BANK_CHARGE_BEARER
,(SELECT (DECODE(TerritoryPEO.TERRITORY_SHORT_NAME, NULL, NULL
		, TerritoryPEO.TERRITORY_SHORT_NAME  || ' - ')  || PaymentCodePEO.MEANING)          
	FROM IBY_PAYMENT_CODES_VL PaymentCodePEO
    ,FND_TERRITORIES_VL TerritoryPEO
	WHERE PaymentCodePEO.TERRITORY_CODE = TerritoryPEO.TERRITORY_CODE (+)
	AND PaymentCodePEO.PAYMENT_CODE_TYPE = 'PAYMENT_REASON'
	AND PaymentCodePEO.PAYMENT_CODE = IbyExternalPayeesAll.PAYMENT_REASON_CODE 
	) RES_PAYMENT_REASON
,IbyExternalPayeesAll.PAYMENT_REASON_COMMENTS RES_PAYMENT_REASON_COMMENTS
,NULL RES_PAYMENT_FORMAT
,SupplierEO.ATTRIBUTE_CATEGORY RES_ATTRIBUTE_CATEGORY
,SupplierEO.ATTRIBUTE1 RES_ATTRIBUTE1
,SupplierEO.ATTRIBUTE2 RES_ATTRIBUTE2
,SupplierEO.ATTRIBUTE3 RES_ATTRIBUTE3
,SupplierEO.ATTRIBUTE4 RES_ATTRIBUTE4
,SupplierEO.ATTRIBUTE5 RES_ATTRIBUTE5
,SupplierEO.ATTRIBUTE6 RES_ATTRIBUTE6
,SupplierEO.ATTRIBUTE7 RES_ATTRIBUTE7
,SupplierEO.ATTRIBUTE8 RES_ATTRIBUTE8
,SupplierEO.ATTRIBUTE9 RES_ATTRIBUTE9
,SupplierEO.ATTRIBUTE10 RES_ATTRIBUTE10
,SupplierEO.ATTRIBUTE11 RES_ATTRIBUTE11
,SupplierEO.ATTRIBUTE12 RES_ATTRIBUTE12
,SupplierEO.ATTRIBUTE13 RES_ATTRIBUTE13
,SupplierEO.ATTRIBUTE14 RES_ATTRIBUTE14
,SupplierEO.ATTRIBUTE15 RES_ATTRIBUTE15
,SupplierEO.ATTRIBUTE16 RES_ATTRIBUTE16
,SupplierEO.ATTRIBUTE17 RES_ATTRIBUTE17
,SupplierEO.ATTRIBUTE18 RES_ATTRIBUTE18
,SupplierEO.ATTRIBUTE19 RES_ATTRIBUTE19
,SupplierEO.ATTRIBUTE20 RES_ATTRIBUTE20
,SupplierEO.ATTRIBUTE_DATE1 RES_ATTRIBUTE_DATE1
,SupplierEO.ATTRIBUTE_DATE2 RES_ATTRIBUTE_DATE2
,SupplierEO.ATTRIBUTE_DATE3 RES_ATTRIBUTE_DATE3
,SupplierEO.ATTRIBUTE_DATE4 RES_ATTRIBUTE_DATE4
,SupplierEO.ATTRIBUTE_DATE5 RES_ATTRIBUTE_DATE5
,SupplierEO.ATTRIBUTE_DATE6 RES_ATTRIBUTE_DATE6
,SupplierEO.ATTRIBUTE_DATE7 RES_ATTRIBUTE_DATE7
,SupplierEO.ATTRIBUTE_DATE8 RES_ATTRIBUTE_DATE8
,SupplierEO.ATTRIBUTE_DATE9 RES_ATTRIBUTE_DATE9
,SupplierEO.ATTRIBUTE_DATE10 RES_ATTRIBUTE_DATE10
,SupplierEO.ATTRIBUTE_TIMESTAMP1 RES_ATTRIBUTE_TIMESTAMP1
,SupplierEO.ATTRIBUTE_TIMESTAMP2 RES_ATTRIBUTE_TIMESTAMP2
,SupplierEO.ATTRIBUTE_TIMESTAMP3 RES_ATTRIBUTE_TIMESTAMP3
,SupplierEO.ATTRIBUTE_TIMESTAMP4 RES_ATTRIBUTE_TIMESTAMP4
,SupplierEO.ATTRIBUTE_TIMESTAMP5 RES_ATTRIBUTE_TIMESTAMP5
,SupplierEO.ATTRIBUTE_TIMESTAMP6 RES_ATTRIBUTE_TIMESTAMP6
,SupplierEO.ATTRIBUTE_TIMESTAMP7 RES_ATTRIBUTE_TIMESTAMP7
,SupplierEO.ATTRIBUTE_TIMESTAMP8 RES_ATTRIBUTE_TIMESTAMP8
,SupplierEO.ATTRIBUTE_TIMESTAMP9 RES_ATTRIBUTE_TIMESTAMP9
,SupplierEO.ATTRIBUTE_TIMESTAMP10 RES_ATTRIBUTE_TIMESTAMP10
,SupplierEO.ATTRIBUTE_NUMBER1 RES_ATTRIBUTE_NUMBER1
,SupplierEO.ATTRIBUTE_NUMBER2 RES_ATTRIBUTE_NUMBER2
,SupplierEO.ATTRIBUTE_NUMBER3 RES_ATTRIBUTE_NUMBER3
,SupplierEO.ATTRIBUTE_NUMBER4 RES_ATTRIBUTE_NUMBER4
,SupplierEO.ATTRIBUTE_NUMBER5 RES_ATTRIBUTE_NUMBER5
,SupplierEO.ATTRIBUTE_NUMBER6 RES_ATTRIBUTE_NUMBER6
,SupplierEO.ATTRIBUTE_NUMBER7 RES_ATTRIBUTE_NUMBER7
,SupplierEO.ATTRIBUTE_NUMBER8 RES_ATTRIBUTE_NUMBER8
,SupplierEO.ATTRIBUTE_NUMBER9 RES_ATTRIBUTE_NUMBER9
,SupplierEO.ATTRIBUTE_NUMBER10 RES_ATTRIBUTE_NUMBER10
,SupplierEO.GLOBAL_ATTRIBUTE_CATEGORY RES_GLOBAL_ATTRIBUTE_CATEGORY
,SupplierEO.GLOBAL_ATTRIBUTE1 RES_GLOBAL_ATTRIBUTE1
,SupplierEO.GLOBAL_ATTRIBUTE2 RES_GLOBAL_ATTRIBUTE2
,SupplierEO.GLOBAL_ATTRIBUTE3 RES_GLOBAL_ATTRIBUTE3
,SupplierEO.GLOBAL_ATTRIBUTE4 RES_GLOBAL_ATTRIBUTE4
,SupplierEO.GLOBAL_ATTRIBUTE5 RES_GLOBAL_ATTRIBUTE5
,SupplierEO.GLOBAL_ATTRIBUTE6 RES_GLOBAL_ATTRIBUTE6
,SupplierEO.GLOBAL_ATTRIBUTE7 RES_GLOBAL_ATTRIBUTE7
,SupplierEO.GLOBAL_ATTRIBUTE8 RES_GLOBAL_ATTRIBUTE8
,SupplierEO.GLOBAL_ATTRIBUTE9 RES_GLOBAL_ATTRIBUTE9
,SupplierEO.GLOBAL_ATTRIBUTE10 RES_GLOBAL_ATTRIBUTE10
,SupplierEO.GLOBAL_ATTRIBUTE11 RES_GLOBAL_ATTRIBUTE11
,SupplierEO.GLOBAL_ATTRIBUTE12 RES_GLOBAL_ATTRIBUTE12
,SupplierEO.GLOBAL_ATTRIBUTE13 RES_GLOBAL_ATTRIBUTE13
,SupplierEO.GLOBAL_ATTRIBUTE14 RES_GLOBAL_ATTRIBUTE14
,SupplierEO.GLOBAL_ATTRIBUTE15 RES_GLOBAL_ATTRIBUTE15
,SupplierEO.GLOBAL_ATTRIBUTE16 RES_GLOBAL_ATTRIBUTE16
,SupplierEO.GLOBAL_ATTRIBUTE17 RES_GLOBAL_ATTRIBUTE17
,SupplierEO.GLOBAL_ATTRIBUTE18 RES_GLOBAL_ATTRIBUTE18
,SupplierEO.GLOBAL_ATTRIBUTE19 RES_GLOBAL_ATTRIBUTE19
,SupplierEO.GLOBAL_ATTRIBUTE20 RES_GLOBAL_ATTRIBUTE20
,SupplierEO.GLOBAL_ATTRIBUTE_DATE1 RES_GLOBAL_ATTRIBUTE_DATE1
,SupplierEO.GLOBAL_ATTRIBUTE_DATE2 RES_GLOBAL_ATTRIBUTE_DATE2
,SupplierEO.GLOBAL_ATTRIBUTE_DATE3 RES_GLOBAL_ATTRIBUTE_DATE3
,SupplierEO.GLOBAL_ATTRIBUTE_DATE4 RES_GLOBAL_ATTRIBUTE_DATE4
,SupplierEO.GLOBAL_ATTRIBUTE_DATE5 RES_GLOBAL_ATTRIBUTE_DATE5
,SupplierEO.GLOBAL_ATTRIBUTE_DATE6 RES_GLOBAL_ATTRIBUTE_DATE6
,SupplierEO.GLOBAL_ATTRIBUTE_DATE7 RES_GLOBAL_ATTRIBUTE_DATE7
,SupplierEO.GLOBAL_ATTRIBUTE_DATE8 RES_GLOBAL_ATTRIBUTE_DATE8
,SupplierEO.GLOBAL_ATTRIBUTE_DATE9 RES_GLOBAL_ATTRIBUTE_DATE9
,SupplierEO.GLOBAL_ATTRIBUTE_DATE10 RES_GLOBAL_ATTRIBUTE_DATE10
,SupplierEO.GLOBAL_ATTRIBUTE_TIMESTAMP1 RES_GLOBAL_ATTRIBUTE_TIMESTAMP
,SupplierEO.GLOBAL_ATTRIBUTE_TIMESTAMP2 RES_GLOBAL_ATTRIBUTE_TIMESTA_0
,SupplierEO.GLOBAL_ATTRIBUTE_TIMESTAMP3 RES_GLOBAL_ATTRIBUTE_TIMESTA_1
,SupplierEO.GLOBAL_ATTRIBUTE_TIMESTAMP4 RES_GLOBAL_ATTRIBUTE_TIMESTA_2
,SupplierEO.GLOBAL_ATTRIBUTE_TIMESTAMP5 RES_GLOBAL_ATTRIBUTE_TIMESTA_3
,SupplierEO.GLOBAL_ATTRIBUTE_TIMESTAMP6 RES_GLOBAL_ATTRIBUTE_TIMESTA_4
,SupplierEO.GLOBAL_ATTRIBUTE_TIMESTAMP7 RES_GLOBAL_ATTRIBUTE_TIMESTA_5
,SupplierEO.GLOBAL_ATTRIBUTE_TIMESTAMP8 RES_GLOBAL_ATTRIBUTE_TIMESTA_6
,SupplierEO.GLOBAL_ATTRIBUTE_TIMESTAMP9 RES_GLOBAL_ATTRIBUTE_TIMESTA_7
,SupplierEO.GLOBAL_ATTRIBUTE_TIMESTAMP10 RES_GLOBAL_ATTRIBUTE_TIMESTA_8
,SupplierEO.GLOBAL_ATTRIBUTE_NUMBER1 RES_GLOBAL_ATTRIBUTE_NUMBER1
,SupplierEO.GLOBAL_ATTRIBUTE_NUMBER2 RES_GLOBAL_ATTRIBUTE_NUMBER2
,SupplierEO.GLOBAL_ATTRIBUTE_NUMBER3 RES_GLOBAL_ATTRIBUTE_NUMBER3
,SupplierEO.GLOBAL_ATTRIBUTE_NUMBER4 RES_GLOBAL_ATTRIBUTE_NUMBER4
,SupplierEO.GLOBAL_ATTRIBUTE_NUMBER5 RES_GLOBAL_ATTRIBUTE_NUMBER5
,SupplierEO.GLOBAL_ATTRIBUTE_NUMBER6 RES_GLOBAL_ATTRIBUTE_NUMBER6
,SupplierEO.GLOBAL_ATTRIBUTE_NUMBER7 RES_GLOBAL_ATTRIBUTE_NUMBER7
,SupplierEO.GLOBAL_ATTRIBUTE_NUMBER8 RES_GLOBAL_ATTRIBUTE_NUMBER8
,SupplierEO.GLOBAL_ATTRIBUTE_NUMBER9 RES_GLOBAL_ATTRIBUTE_NUMBER9
,SupplierEO.GLOBAL_ATTRIBUTE_NUMBER10 RES_GLOBAL_ATTRIBUTE_NUMBER10
,NULL RES_BATCH_ID
,SupplierPartyPEO.PARTY_NUMBER RES_REGISTRY_ID
,'END' RES_END
,SupplierEO.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,SupplierEO.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,SupplierEO.CREATED_BY RSC_CREATED_BY
,SupplierEO.CREATION_DATE RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,NULL RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM POZ_SUPPLIERS SupplierEO
,POZ_SUPPLIERS_PII SupplierPiiEO
,HZ_PARTIES SupplierPartyPEO
,ZX_PARTY_TAX_PROFILE PartyTaxProfileGenericPEO
,HZ_ADDTNL_PARTY_NAMES AdditionalPartyNamePEO
,HZ_ORGANIZATION_PROFILES OrganizationDEO
,POZ_BUS_CLASSIFICATIONS  Buss
,(SELECT * FROM IBY_EXTERNAL_PAYEES_ALL  
	WHERE PARTY_SITE_ID IS NULL AND SUPPLIER_SITE_ID IS NULL )IbyExternalPayeesAll

WHERE SupplierEO.VENDOR_ID                         = SupplierPiiEO.VENDOR_ID (+)
AND SupplierEO.party_id                          = SupplierPartyPEO.party_id
AND SupplierPartyPEO.party_id                    = PartyTaxProfileGenericPEO.party_id(+)
AND SupplierEO.PARTY_ID                            = AdditionalPartyNamePEO.PARTY_ID(+)
AND AdditionalPartyNamePEO.PARTY_NAME_TYPE(+)    = 'PHONETIC'
AND AdditionalPartyNamePEO.PREFERRED_FLAG(+)     ='Y'
AND PartyTaxProfileGenericPEO.party_type_code(+) = 'THIRD_PARTY'
and SupplierPartyPEO.PARTY_ID  = OrganizationDEO.PARTY_ID
and SupplierEO.VENDOR_ID = Buss.VENDOR_ID(+)
and SupplierEO.PARTY_ID = Buss.PARTY_ID(+)
and SupplierEO.PARTY_ID = IbyExternalPayeesAll.PAYEE_PARTY_ID(+)
ORDER BY SupplierEO.SEGMENT1