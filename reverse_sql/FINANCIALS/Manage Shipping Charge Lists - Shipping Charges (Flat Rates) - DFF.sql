/* ****************************************************************************
* $Revision:  $:
* $Author: Nasrullah Dusenmahamad $:
* $Date: 2017-11-01 $:
* $HeadURL:  $:
* $Id: Manage Shipping Charge Lists - Shipping Charges (Flat Rates) - DFF.sql  $:
* ****************************************************************************
* Description:
* ************************************************************************** */

-- syntax: APPLICATION_ID##RES##DFF_CODE (Descriptive Flexfield name)
-- DFF_LOGIC_TO_APPLY=667##RES##QP_SHIPPING_CHARGE_LISTS_FLEX
-- DFF_ATTRIBUTES=ATTRIBUTE_CHAR,ATTRIBUTE_NUMBER,ATTRIBUTE_DATE,ATTRIBUTE_TIMESTAMP

-- IMPORTANT:
-- - the alias names for the Foreign keys must be the same as in the inventory.
-- - the alias name for context code must be RES_CONTEXT_CODE
-- - NO ALIASES for atributes fields. 

-- RSC_PREREQUISITE_OBJECTS=QP_SHIPPING_CHARGE_LISTS_VL
-- RSC_PREREQUISITE_OBJECTS=QP_SHIPPING_CHARGES
-- RSC_PREREQUISITE_OBJECTS=QP_SHIPPING_DETAILS
-- RSC_PREREQUISITE_OBJECTS=QP_CHARGE_DEFINITIONS_VL

SELECT SHIPPING.NAME 																							RES_NAME
,CHARGES.CHARGE_LINE_NUMBER  																					RES_LINE_NUMBER
,(
SELECT DISTINCT (PartyPEO.PARTY_NAME||'-'||ModeOfTransportPEO.MEANING||'-'||ServiceLevelPEO.MEANING) AS ShipMethod
	FROM WSH_ORG_CARRIER_SERVICES WarehouseCarrierServicePEO
	,RCS_LOOKUPS ModeOfTransportPEO
	,RCS_LOOKUPS ServiceLevelPEO
	,HZ_PARTIES PartyPEO
	,WSH_CARRIERS CarrierPEO
	WHERE(WarehouseCarrierServicePEO.CARRIER_ID      = PartyPEO.PARTY_ID)
	AND(WarehouseCarrierServicePEO.MODE_OF_TRANSPORT = ModeOfTransportPEO.LOOKUP_CODE)
	AND(ModeOfTransportPEO.LOOKUP_TYPE               = 'WSH_MODE_OF_TRANSPORT')
	AND(WarehouseCarrierServicePEO.SERVICE_LEVEL     = ServiceLevelPEO.LOOKUP_CODE)
	AND(ServiceLevelPEO.LOOKUP_TYPE                  = 'WSH_SERVICE_LEVELS')
	AND(CarrierPEO.CARRIER_ID                        = WarehouseCarrierServicePEO.CARRIER_ID)
	AND(CarrierPEO.CARRIER_ID                        = PartyPEO.PARTY_ID)
  AND WarehouseCarrierServicePEO.ORG_CARRIER_SERVICE_ID =  XXX.ORG_CARRIER_SERVICE_ID
  )  RES_SHIPPING_METHOD
,(select NAME
from QP_CHARGE_DEFINITIONS_VL D
where D.CHARGE_DEFINITION_ID   = CHARGES.CHARGE_DEFINITION_ID     
) 																												RES_PRICING_CHARGE_DEFINITION
,decode((select LINE_TYPE_CODE
       from QP_SHIPPING_DETAILS A
       where A.SHIPPING_DETAIL_ID =  CHARGES.SHIPPING_DETAIL_ID
       and A.SHIPPING_CHARGE_LIST_ID =  CHARGES.SHIPPING_CHARGE_LIST_ID
       ) ,'ORA_BUY','Buy','ORA_RETURN','Return') 																RES_LINE_TYPE
,to_char(CHARGES.START_DATE,'DD-Mon-YYYY hh24:MI:SS') 															RES_START_DATE

,CHARGES.ATTRIBUTE_CATEGORY 		RES_CONTEXT_CODE
,CHARGES.ATTRIBUTE_CHAR1
,CHARGES.ATTRIBUTE_CHAR2
,CHARGES.ATTRIBUTE_CHAR3
,CHARGES.ATTRIBUTE_CHAR4
,CHARGES.ATTRIBUTE_CHAR5
,CHARGES.ATTRIBUTE_CHAR6
,CHARGES.ATTRIBUTE_CHAR7
,CHARGES.ATTRIBUTE_CHAR8
,CHARGES.ATTRIBUTE_CHAR9
,CHARGES.ATTRIBUTE_CHAR10
,CHARGES.ATTRIBUTE_CHAR11
,CHARGES.ATTRIBUTE_CHAR12
,CHARGES.ATTRIBUTE_CHAR13
,CHARGES.ATTRIBUTE_CHAR14
,CHARGES.ATTRIBUTE_CHAR15
,CHARGES.ATTRIBUTE_CHAR16
,CHARGES.ATTRIBUTE_CHAR17
,CHARGES.ATTRIBUTE_CHAR18
,CHARGES.ATTRIBUTE_CHAR19
,CHARGES.ATTRIBUTE_CHAR20
,CHARGES.ATTRIBUTE_NUMBER1
,CHARGES.ATTRIBUTE_NUMBER2
,CHARGES.ATTRIBUTE_NUMBER3
,CHARGES.ATTRIBUTE_NUMBER4
,CHARGES.ATTRIBUTE_NUMBER5
,CHARGES.ATTRIBUTE_NUMBER6
,CHARGES.ATTRIBUTE_NUMBER7
,CHARGES.ATTRIBUTE_NUMBER8
,CHARGES.ATTRIBUTE_NUMBER9
,CHARGES.ATTRIBUTE_NUMBER10
,TO_CHAR(CHARGES.ATTRIBUTE_DATE1,'DD-Mon-YYYY') ATTRIBUTE_DATE1
,TO_CHAR(CHARGES.ATTRIBUTE_DATE2,'DD-Mon-YYYY') ATTRIBUTE_DATE2
,TO_CHAR(CHARGES.ATTRIBUTE_DATE3,'DD-Mon-YYYY') ATTRIBUTE_DATE3
,TO_CHAR(CHARGES.ATTRIBUTE_DATE4,'DD-Mon-YYYY') ATTRIBUTE_DATE4
,TO_CHAR(CHARGES.ATTRIBUTE_DATE5,'DD-Mon-YYYY') ATTRIBUTE_DATE5
,CHARGES.ATTRIBUTE_TIMESTAMP1
,CHARGES.ATTRIBUTE_TIMESTAMP2
,CHARGES.ATTRIBUTE_TIMESTAMP3
,CHARGES.ATTRIBUTE_TIMESTAMP4
,CHARGES.ATTRIBUTE_TIMESTAMP5
 
,CHARGES.LAST_UPDATED_BY 				RSC_LAST_UPDATED_BY
,CHARGES.LAST_UPDATE_DATE 				RSC_LAST_UPDATE_DATE
,CHARGES.CREATED_BY 					RSC_CREATED_BY
,CHARGES.CREATION_DATE 					RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,SHIPPING.ORG_ID RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM   QP_SHIPPING_CHARGES  			CHARGES
     , QP_SHIPPING_CHARGE_LISTS_VL    	SHIPPING
     , QP_SHIPPING_DETAILS  			XXX
WHERE SHIPPING.SHIPPING_CHARGE_LIST_ID =  CHARGES.SHIPPING_CHARGE_LIST_ID
and CHARGES.SHIPPING_DETAIL_ID =  XXX.SHIPPING_DETAIL_ID(+)
and CHARGES.SHIPPING_CHARGE_LIST_ID =  XXX.SHIPPING_CHARGE_LIST_ID(+)
and (CHARGES.ATTRIBUTE_CATEGORY IS NOT NULL
OR CHARGES.ATTRIBUTE_CHAR1            IS NOT NULL
OR CHARGES.ATTRIBUTE_CHAR2            IS NOT NULL
OR CHARGES.ATTRIBUTE_CHAR3            IS NOT NULL
OR CHARGES.ATTRIBUTE_CHAR4            IS NOT NULL
OR CHARGES.ATTRIBUTE_CHAR5            IS NOT NULL
OR CHARGES.ATTRIBUTE_CHAR6            IS NOT NULL
OR CHARGES.ATTRIBUTE_CHAR7            IS NOT NULL
OR CHARGES.ATTRIBUTE_CHAR8            IS NOT NULL
OR CHARGES.ATTRIBUTE_CHAR9            IS NOT NULL
OR CHARGES.ATTRIBUTE_CHAR10           IS NOT NULL
OR CHARGES.ATTRIBUTE_CHAR11           IS NOT NULL
OR CHARGES.ATTRIBUTE_CHAR12           IS NOT NULL
OR CHARGES.ATTRIBUTE_CHAR13           IS NOT NULL
OR CHARGES.ATTRIBUTE_CHAR14           IS NOT NULL
OR CHARGES.ATTRIBUTE_CHAR15           IS NOT NULL
OR CHARGES.ATTRIBUTE_CHAR16           IS NOT NULL
OR CHARGES.ATTRIBUTE_CHAR17           IS NOT NULL
OR CHARGES.ATTRIBUTE_CHAR18           IS NOT NULL
OR CHARGES.ATTRIBUTE_CHAR19           IS NOT NULL
OR CHARGES.ATTRIBUTE_CHAR20           IS NOT NULL
OR CHARGES.ATTRIBUTE_NUMBER1     IS NOT NULL
OR CHARGES.ATTRIBUTE_NUMBER2     IS NOT NULL
OR CHARGES.ATTRIBUTE_NUMBER3     IS NOT NULL
OR CHARGES.ATTRIBUTE_NUMBER4     IS NOT NULL
OR CHARGES.ATTRIBUTE_NUMBER5     IS NOT NULL
OR CHARGES.ATTRIBUTE_NUMBER6     IS NOT NULL
OR CHARGES.ATTRIBUTE_NUMBER7     IS NOT NULL
OR CHARGES.ATTRIBUTE_NUMBER8     IS NOT NULL
OR CHARGES.ATTRIBUTE_NUMBER9     IS NOT NULL
OR CHARGES.ATTRIBUTE_NUMBER10    IS NOT NULL
OR CHARGES.ATTRIBUTE_DATE1       IS NOT NULL
OR CHARGES.ATTRIBUTE_DATE2       IS NOT NULL
OR CHARGES.ATTRIBUTE_DATE3       IS NOT NULL
OR CHARGES.ATTRIBUTE_DATE4       IS NOT NULL
OR CHARGES.ATTRIBUTE_DATE5       IS NOT NULL
OR CHARGES.ATTRIBUTE_TIMESTAMP1  IS NOT NULL
OR CHARGES.ATTRIBUTE_TIMESTAMP2  IS NOT NULL
OR CHARGES.ATTRIBUTE_TIMESTAMP3  IS NOT NULL
OR CHARGES.ATTRIBUTE_TIMESTAMP4  IS NOT NULL
OR CHARGES.ATTRIBUTE_TIMESTAMP5  IS NOT NULL)
ORDER BY SHIPPING.NAME