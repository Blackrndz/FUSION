/* ****************************************************************************
 * $Revision:  $:
 * $Author: Nasrullah Dusenmahamad $:
 * $Date: 2018-03-20  $:
 * $HeadURL: $:
 * $Id: Configure Exception Sets - Exception  $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */
 
-- RSC_PREREQUISITE_OBJECTS=WLF_PROPERTIES

SELECT (SELECT DECODE(VALUE,'N','Do not enable enrollment questionnaires','Enable enrollment questionnaire creation')
	FROM WLF_PROPERTIES
	WHERE NAME = 'LRNR_ENROLL_QSTNR'
	) RES_SHOW_ENROLLMENT_QUESTIONNA
	
/*(SELECT NAME
    FROM HRQ_QUESTIONNAIRES_VL
    WHERE QUESTIONNAIRE_ID = (SELECT VALUE
		FROM WLF_PROPERTIES
		WHERE NAME = 'LRNR_QUESTIONNAIRE_ID')
	) Questnaire*/


-- Administrator Settings

,'Active' RES_CREATED_BY_LEARNING_ADMINI
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'ORA_WLF_INIT_ASSGN_STATE_SEC'
    AND LOOKUP_CODE = (SELECT VALUE
		FROM WLF_PROPERTIES
		WHERE NAME = 'ORA_WLF_INIT_ASSGN_STATE_SEC')
	) RES_FOR_COURSES_IN_A_SPECIALIZ


-- Self-Service Settings

,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'ORA_WLF_VIEW_MODE'
    AND LOOKUP_CODE = (SELECT VALUE
		FROM WLF_PROPERTIES
		WHERE NAME = 'ORA_WLF_VIEW_MODE')
	) RES_VIEW_MODE


-- Learner Self-Service Settings

,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'ORA_WLF_INIT_ASSGN_STATE_EMP'
    AND LOOKUP_CODE = (SELECT VALUE
		FROM WLF_PROPERTIES
		WHERE NAME = 'ORA_WLF_INIT_ASSGN_STATE_EMP')
	) RES_LEARNER_ENROLLMENT_SETTING
,(CASE
	WHEN (SELECT VALUE FROM WLF_PROPERTIES WHERE NAME = 'ORA_WLF_INIT_ASSGN_STATE_EMP') != 'ORA_ASSN_REC_NONE' THEN
		(SELECT DECODE(VALUE,'Y','Yes','No')
			FROM WLF_PROPERTIES
			WHERE NAME = 'SS_SHOW_REQ_FORM')
	END) RES_LEARNER_SHOW_ENROLLMENT_FO
,(CASE
	WHEN (SELECT VALUE FROM WLF_PROPERTIES WHERE NAME = 'ORA_WLF_INIT_ASSGN_STATE_EMP') = 'ORA_ASSN_REC_REQUESTED' THEN
		(SELECT DECODE(VALUE,'ORA_AUTOMATIC','Yes','No')
			FROM WLF_PROPERTIES
			WHERE NAME = 'ORA_SS_ACTIVATE_ON_APPROVE')
	END) RES_LEARNER_ACTIVATE_ENROLLMEN
,(SELECT DECODE(VALUE,'NOT_DEFERRED','No',NULL,'No','Yes')
	FROM WLF_PROPERTIES
	WHERE NAME = 'PREREQ_SELF_EVAL_TYPE'
	) RES_LEARNER_ALLOW_ENROLLMENT_W

/**/
,(CASE
	WHEN (SELECT DECODE(VALUE,'NOT_DEFERRED','No',NULL,'No','Yes')
	FROM WLF_PROPERTIES
	WHERE NAME = 'PREREQ_SELF_EVAL_TYPE') = 'Yes' THEN
		NVL((SELECT DECODE(VALUE,NULL,'No','Yes')
		FROM WLF_PROPERTIES
		WHERE NAME = 'PREREQ_SELF_EVAL_DAYS'
		),'No')
	END)RES_LEARNER_WITHDRAW_ENROLLMEN
/**/

,(SELECT VALUE
	FROM WLF_PROPERTIES
	WHERE NAME = 'PREREQ_SELF_EVAL_DAYS'
	) RES_LEARNER_NUMBER_OF_DAYS


-- Manager Self-Service Settings

,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'ORA_WLF_INIT_ASSGN_STATE_MGR'
    AND LOOKUP_CODE = (SELECT VALUE
		FROM WLF_PROPERTIES
		WHERE NAME = 'ORA_WLF_INIT_ASSGN_STATE_MGR')
	) RES_MANAGER_ENROLLMENT_SETTING
,(CASE
	WHEN (SELECT VALUE FROM WLF_PROPERTIES WHERE NAME = 'ORA_WLF_INIT_ASSGN_STATE_MGR') = 'ORA_ASSN_REC_REQUESTED' THEN
		(SELECT DECODE(VALUE,'ORA_AUTOMATIC','Yes','No')
			FROM WLF_PROPERTIES
			WHERE NAME = 'ORA_MNGR_ACTIVATE_ON_APPROVE')
	END) RES_MANAGER_ACTIVATE_ENROLLMEN
,NVL((SELECT 'Yes'
	FROM WLF_PROPERTIES
	WHERE NAME = 'PREREQ_MGR_EVAL_DAYS'
	),'No') RES_MANAGER_WITHDRAW_ENROLLMEN
,(SELECT VALUE
	FROM WLF_PROPERTIES
	WHERE NAME = 'PREREQ_MGR_EVAL_DAYS'
	) RES_MANAGER_NUMBER_OF_DAYS
,(SELECT DECODE(VALUE,'Y','Yes','No')
	FROM WLF_PROPERTIES
	WHERE NAME = 'MGR_ENROLL_COMPLETE'
	) RES_MANAGER_ALLOW_A_MANAGER_TO


-- Virtual Instructor Led Training Activity Completion Rules

,NVL((SELECT DECODE(VALUE,'Y','Yes','No')
	FROM WLF_PROPERTIES
	WHERE NAME = 'ORA_WLF_VILT_AUTOCOMPLETION_FLAG'
	),'No') RES_VIRTUAL_ENABLE_VIRTUAL_INS
,(CASE
	WHEN EXISTS (SELECT 1 FROM WLF_PROPERTIES WHERE NAME = 'ORA_WLF_VILT_AUTOCOMPLETION_VALUE') THEN
		(SELECT VALUE
			FROM WLF_PROPERTIES
			WHERE NAME = 'ORA_WLF_VILT_AUTOCOMPLETION_VALUE')
	END) RES_VIRTUAL_PERCENT_OF_VIRTUAL -- Virtual - Percent of virtual activity duration the learner must participate in to be marked complete.
,(CASE
	WHEN EXISTS (SELECT 1 FROM WLF_PROPERTIES WHERE NAME = 'ORA_WLF_VILT_AUTOCOMPLETION_VALUE') THEN
		(SELECT DECODE(VALUE,'Y','Yes','No')
			FROM WLF_PROPERTIES
			WHERE NAME = 'ORA_WLF_VILT_AUTOCOMPLETION_CLASS_OVERRIDE')
	END) RES_VIRTUAL_ALLOW_COMPLETION_R


--Completion Certificate Defaults

,(CASE
	WHEN EXISTS (SELECT 1
		FROM WLF_CERTIFICATES
		WHERE CERTIFICATE_TYPE = 'ORA_COMPLETION_CERTIFICATE'
		AND LEARNING_ITEM_TYPE = 'ORA_COURSE'
		AND CERTIFICATE_FILE_NAME IS NOT NULL
		) THEN
		'Certificate'
	ELSE
		'No certificate'
	END) RES_COURSE_AND_LEGACY_CERTIFIC -- Course and Legacy - Certificate Selection
,(SELECT REPLACE(CERTIFICATE_FILE_NAME,'.xdo',NULL)
	FROM WLF_CERTIFICATES
	WHERE CERTIFICATE_TYPE = 'ORA_COMPLETION_CERTIFICATE'
	AND LEARNING_ITEM_TYPE = 'ORA_COURSE'
	) RES_COURSE_AND_LEGACY_CERTIF_0 -- Course and Legacy - Certificate Title
,(CASE
	WHEN EXISTS (SELECT 1
		FROM WLF_CERTIFICATES
		WHERE CERTIFICATE_TYPE = 'ORA_COMPLETION_CERTIFICATE'
		AND LEARNING_ITEM_TYPE = 'ORA_SPECIALIZATION'
		AND CERTIFICATE_FILE_NAME IS NOT NULL
		) THEN
		'Certificate'
	ELSE
		'No certificate'
	END) RES_SPECIALIZATION_CERTIFICATE -- Course and Legacy - Certificate Title
,(SELECT REPLACE(CERTIFICATE_FILE_NAME,'.xdo',NULL)
	FROM WLF_CERTIFICATES
	WHERE CERTIFICATE_TYPE = 'ORA_COMPLETION_CERTIFICATE'
	AND LEARNING_ITEM_TYPE = 'ORA_SPECIALIZATION'
	) RES_SPECIALIZATION_CERTIFICA_1 -- Specialization - Certificate Title


-- Payment Refund Rules - Expiration

,(SELECT DECODE(VALUE,'true','Yes','No')
	FROM WLF_PROPERTIES
	WHERE NAME = 'paymentprocessor.expiration.pendingpaymentenabled'
	) RES_EXPIRE_ASSIGNMENTS_IN_PEND
,(CASE
	WHEN (SELECT VALUE FROM WLF_PROPERTIES WHERE NAME = 'paymentprocessor.expiration.pendingpaymentenabled') = 'true' THEN
		(SELECT VALUE
			FROM WLF_PROPERTIES
			WHERE NAME = 'paymentprocessor.expiration.pendingpaymentrulesset')
	END) RES_EXPIRATION_NUMBER_OF_DAYS
	
	
-- Payment Refund Rules - Default Refund Rule

,(SELECT DECODE(VALUE,'true','Yes','No')
	FROM WLF_PROPERTIES
	WHERE NAME = 'paymentprocessor.refundrules.refundenabled'
	) RES_DEFAULT_ENABLE_REFUNDS_ON_
,(CASE
	WHEN (SELECT VALUE FROM WLF_PROPERTIES WHERE NAME = 'paymentprocessor.refundrules.refundenabled') = 'true' THEN
		(SELECT VALUE
			FROM WLF_PROPERTIES
			WHERE NAME = 'paymentprocessor.refundrules.refundrulesset')
	END) RES_DEFAULT_THE_MINIMUM_NUMBER -- Default - The minimum number of days
,(SELECT DECODE(VALUE,'true','Yes','No')
	FROM WLF_PROPERTIES
	WHERE NAME = 'paymentprocessor.refundrules.refundenabledforSP'
	) RES_DEFAULT_ENABLE_REFUNDS_O_2 -- Default - Enable refunds on withdrawal from self-paced offerings
,(CASE
	WHEN (SELECT VALUE FROM WLF_PROPERTIES WHERE NAME = 'paymentprocessor.refundrules.refundenabledforSP') = 'true' THEN
		(SELECT VALUE
			FROM WLF_PROPERTIES
			WHERE NAME = 'paymentprocessor.refundrules.refundrulessetforSP')
	END) RES_DEFAULT_DAYS_AFTER_THE_ASS -- Default - Days after the assignment start date


,setupsE0.LAST_UPDATED_BY  RSC_LAST_UPDATED_BY
,setupsE0.LAST_UPDATE_DATE  RSC_LAST_UPDATE_DATE
,setupsE0.CREATED_BY  RSC_CREATED_BY
,setupsE0.CREATION_DATE  RSC_CREATION_DATE
,null RSC_LEDGER_ID
,null RSC_CHART_OF_ACCOUNTS_ID
,null RSC_BUSINESS_UNIT_ID
,null RSC_LEGAL_ENTITY_ID
,null RSC_ORGANIZATION_ID
,null RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM (SELECT LAST_UPDATED_BY
	,LAST_UPDATE_DATE
	,CREATED_BY
	,CREATION_DATE 
	,ROW_NUMBER() OVER (ORDER BY LAST_UPDATE_DATE DESC) R1
	FROM WLF_PROPERTIES 
	) setupsE0
WHERE R1 = 1