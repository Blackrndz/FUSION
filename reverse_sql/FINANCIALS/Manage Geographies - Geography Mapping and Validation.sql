/* ****************************************************************************
 * $Revision: 78229 $:
 * $Author: pisan.jariyasettachok $:
 * $Date: 2022-04-07 14:37:05 +0700 (Thu, 07 Apr 2022) $:
 * $HeadURL: https://svn03.rapid4cloud.com/svn/a/dev/rapidesuite/controldata/FUSION_11.1.13/trunk/core/reverse_sql/FINANCIALS/Manage%20Geographies%20-%20Geography%20Mapping%20and%20Validation.sql $:
 * $Id: Manage Geographies - Geography Mapping and Validation.sql 78229 2022-04-07 07:37:05Z pisan.jariyasettachok $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */
 
SELECT  hzGEOE0.GEOGRAPHY_NAME RES_COUNTRY_NAME
,(SELECT HGT.GEOGRAPHY_TYPE_NAME FROM HZ_GEOGRAPHY_TYPES_VL HGT WHERE HGT.GEOGRAPHY_TYPE = hzGEOSMAPDTLEO.GEOGRAPHY_TYPE) RES_GEOGRAPHY_TYPE
,(SELECT MEANING FROM HZ_LOOKUPS WHERE TAG = DECODE(hzGEOSMAPDTLEO.LOC_COMPONENT,'ADDL_ADDRESS_ATTRIBUTE1','ADD_INFORMATION1','ADDL_ADDRESS_ATTRIBUTE2','ADD_INFORMATION2',
	'ADDL_ADDRESS_ATTRIBUTE3','ADD_INFORMATION3','ADDL_ADDRESS_ATTRIBUTE4','ADD_INFORMATION4',hzGEOSMAPDTLEO.LOC_COMPONENT)
	AND LOOKUP_TYPE = 'HZ_ADDR_INT_COLUMNS' AND LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD')))RES_MAP_TO_ATTRIBUTE
,DECODE(hzGEOSMAPDTLEO.ENABLE_LOV_FLAG,'Y','Yes','No') RES_ENABLE_LIST_OF_VALUES
,(CASE WHEN EXISTS (SELECT 1 FROM HZ_ADDRESS_USAGES tmpADD,HZ_ADDRESS_USAGE_DTLS tmpADDDTLS WHERE tmpADD.MAP_ID = hzGEOSMAPEO.MAP_ID 
	AND tmpADDDTLS.GEOGRAPHY_TYPE = hzGEOSLEVELEO.GEOGRAPHY_TYPE AND tmpADD.STATUS_FLAG = 'A'
	AND tmpADD.USAGE_ID = tmpADDDTLS.USAGE_ID AND tmpADD.USAGE_CODE = 'TAX') 
	THEN 
		'Yes'
	ELSE 
		'No'
	END) RES_TAX_VALIDATION
,(CASE WHEN EXISTS (SELECT 1 FROM HZ_ADDRESS_USAGES tmpADD,HZ_ADDRESS_USAGE_DTLS tmpADDDTLS WHERE tmpADD.MAP_ID = hzGEOSMAPEO.MAP_ID 
	AND tmpADDDTLS.GEOGRAPHY_TYPE = hzGEOSLEVELEO.GEOGRAPHY_TYPE AND tmpADD.STATUS_FLAG = 'A'
	AND tmpADD.USAGE_ID = tmpADDDTLS.USAGE_ID AND tmpADD.USAGE_CODE = 'GEOGRAPHY') 
	THEN 
		'Yes'
	ELSE 
		'No'
	END) RES_GEOGRAPHY_VALIDATION

	
,hzGEOSMAPDTLEO.LAST_UPDATED_BY  RSC_LAST_UPDATED_BY
,hzGEOSMAPDTLEO.LAST_UPDATE_DATE  RSC_LAST_UPDATE_DATE
,hzGEOSMAPDTLEO.CREATED_BY  RSC_CREATED_BY
,hzGEOSMAPDTLEO.CREATION_DATE  RSC_CREATION_DATE
,null RSC_LEDGER_ID
,null RSC_CHART_OF_ACCOUNTS_ID
,null RSC_BUSINESS_UNIT_ID
,null RSC_LEGAL_ENTITY_ID
,null RSC_ORGANIZATION_ID
,null RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID


FROM HZ_GEOGRAPHIES hzGEOE0
,HZ_GEO_STRUCT_MAP hzGEOSMAPEO
,HZ_GEO_STRUCT_MAP_DTL hzGEOSMAPDTLEO
,HZ_GEO_STRUCTURE_LEVELS hzGEOSLEVELEO
WHERE hzGEOE0.COUNTRY_CODE = hzGEOSMAPEO.COUNTRY_CODE
AND hzGEOSMAPEO.LOC_TBL_NAME = 'PER_ADDRESSES_F'
AND hzGEOSMAPEO.MAP_ID = hzGEOSMAPDTLEO.MAP_ID
AND hzGEOSMAPEO.COUNTRY_CODE = hzGEOSLEVELEO.COUNTRY_CODE
AND hzGEOSMAPDTLEO.GEO_ELEMENT_COL = hzGEOSLEVELEO.GEOGRAPHY_ELEMENT_COLUMN
AND hzGEOSMAPDTLEO.GEOGRAPHY_TYPE = hzGEOSLEVELEO.GEOGRAPHY_TYPE
AND hzGEOSMAPDTLEO.GEOGRAPHY_TYPE <> 'COUNTRY'
ORDER BY 1