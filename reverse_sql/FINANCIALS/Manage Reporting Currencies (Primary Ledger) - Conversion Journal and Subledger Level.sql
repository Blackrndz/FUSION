/* ****************************************************************************
 * $Revision: 78229 $:
 * $Author: pisan.jariyasettachok $:
 * $Date: 2022-04-07 14:37:05 +0700 (Thu, 07 Apr 2022) $:
 * $HeadURL: https://svn03.rapid4cloud.com/svn/a/dev/rapidesuite/controldata/FUSION_11.1.13/trunk/core/reverse_sql/FINANCIALS/Manage%20Reporting%20Currencies%20(Primary%20Ledger)%20-%20Conversion%20Journal%20and%20Subledger%20Level.sql $:
 * $Id: Manage Reporting Currencies (Primary Ledger) - Conversion Journal and Subledger Level.sql 78229 2022-04-07 07:37:05Z pisan.jariyasettachok $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */

-- FIELD_TO_APPLY_FUNCTION=RES_ROUNDING_ACCOUNT/GET_CODE_COMBINATION
 
SELECT
	(SELECT NAME
	FROM GL_LEDGERS
	WHERE LEDGER_ID = GlLedgerRelationships.PRIMARY_LEDGER_ID
	) AS RES_PRIMARY_LEDGER
,GlLedgerRelationships.TARGET_LEDGER_NAME AS RES_NAME
,GlLedgers.DESCRIPTION AS RES_DESCRIPTION
,(SELECT meaning
	FROM GL_LOOKUPS
	WHERE LOOKUP_TYPE = 'GL_ASF_ALC_RELATIONSHIP_LEVEL'
	AND LOOKUP_CODE   = GlLedgerRelationships.RELATIONSHIP_TYPE_CODE
	) AS RES_CURRENCY_CONVERSION_LEVEL
,(GlLedgerRelationships.TARGET_CURRENCY_CODE || ' - ' || (select NAME from fnd_currencies_vl where CURRENCY_CODE = GlLedgerRelationships.TARGET_CURRENCY_CODE)) AS RES_CURRENCY
,DECODE(GlLedgerRelationships.RELATIONSHIP_TYPE_CODE,'BALANCE',null,GlLedgers.FIRST_LEDGER_PERIOD_NAME) AS RES_FIRST_OPENED_PERIOD
,DECODE(GlLedgerRelationships.RELATIONSHIP_TYPE_CODE,'BALANCE',null,GlLedgers.ROUNDING_CODE_COMBINATION_ID)
	AS RES_ROUNDING_ACCOUNT 
,DECODE(GlLedgerRelationships.RELATIONSHIP_TYPE_CODE,'BALANCE',null,(SELECT MEANING
	FROM gl_lookups
	WHERE LOOKUP_TYPE = 'GL_REV_RULE'
	AND lookup_code   = GlLedgers.REVAL_FROM_PRI_LGR_CURR
	)) AS RES_REVALUATION_BASIS
,DECODE(GlLedgerRelationships.RELATIONSHIP_TYPE_CODE,'BALANCE',null,NVL((SELECT MEANING
	FROM gl_lookups
	WHERE LOOKUP_TYPE = 'YES/NO'
	AND lookup_code   = GlLedgers.ENABLE_JE_APPROVAL_FLAG
	),'No')) AS RES_ENABLE_JOURNAL_APPROVAL
,DECODE(GlLedgerRelationships.RELATIONSHIP_TYPE_CODE,'BALANCE',null,(SELECT USER_CONVERSION_TYPE
	FROM GL_DAILY_CONVERSION_TYPES
	WHERE CONVERSION_TYPE = GlLedgerRelationships.ALC_DEFAULT_CONV_RATE_TYPE
	)) AS RES_DEFAULT_CONVERSION_RATE_TY
,DECODE(GlLedgerRelationships.RELATIONSHIP_TYPE_CODE,'BALANCE',null,(SELECT MEANING
	FROM gl_lookups
	WHERE LOOKUP_TYPE = 'YES/NO'
	AND lookup_code   = GlLedgerRelationships.ALC_INHERIT_CONVERSION_TYPE
	)) AS RES_RETAIN_TRANSACTION_RATE_TY
,DECODE(GlLedgerRelationships.RELATIONSHIP_TYPE_CODE,'BALANCE',null,(SELECT meaning
	FROM gl_lookups
	WHERE LOOKUP_TYPE = 'GL_ASF_ALC_RATE_ACTION'
	AND lookup_code   = GlLedgerRelationships.ALC_NO_RATE_ACTION_CODE
	)) AS RES_MISSING_CONVERSION_RATE
,DECODE(GlLedgerRelationships.RELATIONSHIP_TYPE_CODE,'BALANCE',null,GlLedgerRelationships.ALC_MAX_DAYS_ROLL_RATE) AS RES_NUMBER_OF_DAYS_TO_FIND_LAS
,DECODE(GlLedgerRelationships.RELATIONSHIP_TYPE_CODE,'BALANCE',null,(SELECT MEANING
	FROM gl_lookups
	WHERE LOOKUP_TYPE = 'YES/NO'
	AND lookup_code   = GlLedgerRelationships.INHERIT_CREATION_USER_FLAG
	)) AS RES_RETAIN_JOURNAL_CREATOR_FRO
,DECODE(GlLedgerRelationships.RELATIONSHIP_TYPE_CODE,'BALANCE',null,GlLedgerRelationships.ALC_INIT_PERIOD) AS RES_FIRST_FUTURE_PERIOD_TO_CON
,DECODE(GlLedgerRelationships.RELATIONSHIP_TYPE_CODE,'BALANCE',null,(SELECT MEANING
	FROM gl_lookups
	WHERE LOOKUP_TYPE = 'GL_ASF_ALC_HISTCONVER_OPTION'
	AND lookup_code   = GlLedgerRelationships.ALC_INIT_CONV_OPTION_CODE
	)) AS RES_RETAIN_ORIGINAL_CONVERSION
,DECODE(GlLedgerRelationships.RELATIONSHIP_TYPE_CODE,'BALANCE',null,TO_CHAR(GlLedgerRelationships.ALC_INITIALIZING_RATE_DATE,'DD-Mon-YYYY')) AS RES_HISTORICAL_CONVERSION_DATE
,DECODE(GlLedgerRelationships.RELATIONSHIP_TYPE_CODE,'BALANCE',null,(SELECT USER_CONVERSION_TYPE
	FROM GL_DAILY_CONVERSION_TYPES
	WHERE CONVERSION_TYPE = GlLedgerRelationships.ALC_INITIALIZING_RATE_TYPE
	)) AS RES_HISTORICAL_CONVERSION_RATE
,DECODE(GlLedgerRelationships.RELATIONSHIP_TYPE_CODE,'BALANCE',null,(SELECT MEANING
	FROM gl_lookups
	WHERE LOOKUP_TYPE = 'GL_SEQUENCING_OPTIONS'
	AND lookup_code   =
		(SELECT SEQUENCING_MODE_CODE
		FROM GL_LEDGERS
		WHERE LEDGER_ID = GlLedgerRelationships.PRIMARY_LEDGER_ID
		)
	)) AS RES_SEQUENCING_BY
,DECODE(GlLedgerRelationships.RELATIONSHIP_TYPE_CODE,'BALANCE',null,DECODE(
	(SELECT AP_DOC_SEQUENCING_OPTION_FLAG FROM GL_LEDGERS WHERE LEDGER_ID = GlLedgerRelationships.PRIMARY_LEDGER_ID
	),'Y','No',DECODE(
	(SELECT AR_DOC_SEQUENCING_OPTION_FLAG FROM GL_LEDGERS WHERE LEDGER_ID = GlLedgerRelationships.PRIMARY_LEDGER_ID
	),'N','Yes','No'))) AS RES_ENFORCE_DOCUMENT_SEQUENCIN
,DECODE(GlLedgerRelationships.RELATIONSHIP_TYPE_CODE,'BALANCE',null,NVL((SELECT MEANING
	FROM gl_lookups
	WHERE LOOKUP_TYPE = 'YES/NO'
	AND lookup_code   =
		(SELECT AP_DOC_SEQUENCING_OPTION_FLAG
		FROM GL_LEDGERS
		WHERE LEDGER_ID = GlLedgerRelationships.PRIMARY_LEDGER_ID
		)
	),'No')) AS RES_ENFORCE_DOCUMENT_SEQUENC_0
,DECODE(GlLedgerRelationships.RELATIONSHIP_TYPE_CODE,'BALANCE',null,NVL((SELECT MEANING
	FROM gl_lookups
	WHERE LOOKUP_TYPE = 'YES/NO'
	AND lookup_code   =
		(SELECT AR_DOC_SEQUENCING_OPTION_FLAG
		FROM GL_LEDGERS
		WHERE LEDGER_ID = GlLedgerRelationships.PRIMARY_LEDGER_ID
		)
	),'No')) AS RES_ENFORCE_DOCUMENT_SEQUENC_1
,DECODE(GlLedgerRelationships.RELATIONSHIP_TYPE_CODE,'BALANCE',null,(SELECT MEANING
	FROM gl_lookups
	WHERE LOOKUP_TYPE = 'YES/NO'
	AND lookup_code   =
		(SELECT ENF_SEQ_DATE_CORRELATION_CODE
		FROM GL_LEDGERS
		WHERE LEDGER_ID = GlLedgerRelationships.PRIMARY_LEDGER_ID
		)
	)) AS RES_ENFORCE_CHRONOLOGICAL_ORDE
,GlLedgerRelationships.LAST_UPDATED_BY  RSC_LAST_UPDATED_BY
,GlLedgerRelationships.LAST_UPDATE_DATE  RSC_LAST_UPDATE_DATE
,GlLedgerRelationships.CREATED_BY  RSC_CREATED_BY
,GlLedgerRelationships.CREATION_DATE  RSC_CREATION_DATE
,GlLedgerRelationships.PRIMARY_LEDGER_ID RSC_LEDGER_ID
,null RSC_CHART_OF_ACCOUNTS_ID
,null RSC_BUSINESS_UNIT_ID
,null RSC_LEGAL_ENTITY_ID
,null RSC_ORGANIZATION_ID
,null RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM GL_LEDGER_RELATIONSHIPS GlLedgerRelationships
,GL_LEDGERS GlLedgers
WHERE GlLedgers.LEDGER_ID                             = GlLedgerRelationships.TARGET_LEDGER_ID
AND GlLedgerRelationships.APPLICATION_ID              = 101
AND GlLedgerRelationships.RELATIONSHIP_TYPE_CODE     != 'NONE'
AND GlLedgerRelationships.TARGET_LEDGER_CATEGORY_CODE = 'ALC'
AND GlLedgerRelationships.RELATIONSHIP_TYPE_CODE != 'BALANCE'
AND GlLedgerRelationships.SLA_LEDGER_ID not in (select LEDGER_ID from GL_LEDGERS where LEDGER_CATEGORY_CODE = 'SECONDARY')
ORDER BY RES_PRIMARY_LEDGER