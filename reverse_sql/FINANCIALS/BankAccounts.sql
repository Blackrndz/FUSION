/* ****************************************************************************
 * $Revision:  $:
 * $Author: Nasrullah.Dusenmahamad $:
 * $Date: 2017-08-25  $:
 * $HeadURL: $:
 * $Id: Manage Suppliers - Supplier Bank Accounts.sql  $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */

-- STRICTLY_BATCH_SEQ = RES_PAYEE_IDENTIFIER,RES_PAYEE_BANK_ACCOUNT_IDENTIF

SELECT NULL RES_IMPORT_BATCH_IDENTIFIER
,IbyExternalPayeesAll.EXT_PAYEE_ID RES_PAYEE_IDENTIFIER
,IbyExtBankAccounts.EXT_BANK_ACCOUNT_ID RES_PAYEE_BANK_ACCOUNT_IDENTIF
,(SELECT BANK_NAME
	FROM CE_BANKS_V
	WHERE BANK_PARTY_ID = IbyExtBankAccounts.BANK_ID
	)RES_BANK_NAME
,(SELECT BANK_BRANCH_NAME
	FROM CE_BANK_BRANCHES_V
	WHERE BRANCH_PARTY_ID = IbyExtBankAccounts.BRANCH_ID
	) RES_BRANCH_NAME
,IbyExtBankAccounts.COUNTRY_CODE RES_ACCOUNT_COUNTRY_CODE
,IbyExtBankAccounts.BANK_ACCOUNT_NAME RES_ACCOUNT_NAME
,IbyExtBankAccounts.BANK_ACCOUNT_NUM RES_ACCOUNT_NUMBER
,IbyExtBankAccounts.CURRENCY_CODE RES_ACCOUNT_CURRENCY_CODE
,IbyExtBankAccounts.FOREIGN_PAYMENT_USE_FLAG RES_ALLOW_INTERNATIONAL_PAYMEN
,to_char(IbyExtBankAccounts.START_DATE,'YYYY/MM/DD') RES_ACCOUNT_START_DATE
,to_char(IbyExtBankAccounts.END_DATE,'YYYY/MM/DD') RES_ACCOUNT_END_DATE
,IbyExtBankAccounts.IBAN RES_IBAN
,IbyExtBankAccounts.CHECK_DIGITS RES_CHECK_DIGITS
,IbyExtBankAccounts.BANK_ACCOUNT_NAME_ALT RES_ACCOUNT_ALTERNATE_NAME
,IbyExtBankAccounts.BANK_ACCOUNT_TYPE RES_ACCOUNT_TYPE_CODE
,IbyExtBankAccounts.ACCOUNT_SUFFIX RES_ACCOUNT_SUFFIX
,IbyExtBankAccounts.DESCRIPTION RES_ACCOUNT_DESCRIPTION
,IbyExtBankAccounts.AGENCY_LOCATION_CODE RES_AGENCY_LOCATION_CODE
,IbyExtBankAccounts.EXCHANGE_RATE_AGREEMENT_NUM RES_EXCHANGE_RATE_AGREEMENT_NU
,IbyExtBankAccounts.EXCHANGE_RATE_AGREEMENT_TYPE RES_EXCHANGE_RATE_AGREEMENT_TY
,IbyExtBankAccounts.EXCHANGE_RATE RES_EXCHANGE_RATE
,IbyExtBankAccounts.SECONDARY_ACCOUNT_REFERENCE RES_SECONDARY_ACCOUNT_REFERENC
,IbyExtBankAccounts.ATTRIBUTE_CATEGORY RES_ATTRIBUTE_CATEGORY
,IbyExtBankAccounts.ATTRIBUTE1 RES_ATTRIBUTE_1
,IbyExtBankAccounts.ATTRIBUTE2 RES_ATTRIBUTE_2
,IbyExtBankAccounts.ATTRIBUTE3 RES_ATTRIBUTE_3
,IbyExtBankAccounts.ATTRIBUTE4 RES_ATTRIBUTE_4
,IbyExtBankAccounts.ATTRIBUTE5 RES_ATTRIBUTE_5
,IbyExtBankAccounts.ATTRIBUTE6 RES_ATTRIBUTE_6
,IbyExtBankAccounts.ATTRIBUTE7 RES_ATTRIBUTE_7
,IbyExtBankAccounts.ATTRIBUTE8 RES_ATTRIBUTE_8
,IbyExtBankAccounts.ATTRIBUTE9 RES_ATTRIBUTE_9
,IbyExtBankAccounts.ATTRIBUTE10 RES_ATTRIBUTE_10
,IbyExtBankAccounts.ATTRIBUTE11 RES_ATTRIBUTE_11
,IbyExtBankAccounts.ATTRIBUTE12 RES_ATTRIBUTE_12
,IbyExtBankAccounts.ATTRIBUTE13 RES_ATTRIBUTE_13
,IbyExtBankAccounts.ATTRIBUTE14 RES_ATTRIBUTE_14
,IbyExtBankAccounts.ATTRIBUTE15 RES_ATTRIBUTE_15
,'END' RES_END
,IbyExtBankAccounts.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,IbyExtBankAccounts.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,IbyExtBankAccounts.CREATED_BY RSC_CREATED_BY
,IbyExtBankAccounts.CREATION_DATE RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,SupplierSiteDEO.PRC_BU_ID RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM IBY_EXTERNAL_PAYEES_ALL IbyExternalPayeesAll
,POZ_SUPPLIER_SITES_ALL_M SupplierSiteDEO
,POZ_SUPPLIERS SupplierEO
,IBY_PMT_INSTR_USES_ALL ibyPmtInstrUsesAllE0
,IBY_EXT_BANK_ACCOUNTS IbyExtBankAccounts
WHERE IbyExternalPayeesAll.PARTY_SITE_ID = SupplierSiteDEO.PARTY_SITE_ID
and IbyExternalPayeesAll.SUPPLIER_SITE_ID = SupplierSiteDEO.VENDOR_SITE_ID
AND SupplierEO.VENDOR_ID = SupplierSiteDEO.VENDOR_ID
AND IbyExternalPayeesAll.EXT_PAYEE_ID = ibyPmtInstrUsesAllE0.EXT_PMT_PARTY_ID
AND ibyPmtInstrUsesAllE0.INSTRUMENT_ID = IbyExtBankAccounts.EXT_BANK_ACCOUNT_ID

UNION
 
SELECT NULL RES_IMPORT_BATCH_IDENTIFIER
,IbyExternalPayeesAll.EXT_PAYEE_ID RES_PAYEE_IDENTIFIER
,IbyExtBankAccounts.EXT_BANK_ACCOUNT_ID RES_PAYEE_BANK_ACCOUNT_IDENTIF
,(SELECT BANK_NAME
	FROM CE_BANKS_V
	WHERE BANK_PARTY_ID = IbyExtBankAccounts.BANK_ID
	)RES_BANK_NAME
,(SELECT BANK_BRANCH_NAME
	FROM CE_BANK_BRANCHES_V
	WHERE BRANCH_PARTY_ID = IbyExtBankAccounts.BRANCH_ID
	) RES_BRANCH_NAME
,IbyExtBankAccounts.COUNTRY_CODE RES_ACCOUNT_COUNTRY_CODE
,IbyExtBankAccounts.BANK_ACCOUNT_NAME RES_ACCOUNT_NAME
,IbyExtBankAccounts.BANK_ACCOUNT_NUM RES_ACCOUNT_NUMBER
,IbyExtBankAccounts.CURRENCY_CODE RES_ACCOUNT_CURRENCY_CODE
,IbyExtBankAccounts.FOREIGN_PAYMENT_USE_FLAG RES_ALLOW_INTERNATIONAL_PAYMEN
,to_char(IbyExtBankAccounts.START_DATE,'YYYY/MM/DD') RES_ACCOUNT_START_DATE
,to_char(IbyExtBankAccounts.END_DATE,'YYYY/MM/DD') RES_ACCOUNT_END_DATE
,IbyExtBankAccounts.IBAN RES_IBAN
,IbyExtBankAccounts.CHECK_DIGITS RES_CHECK_DIGITS
,IbyExtBankAccounts.BANK_ACCOUNT_NAME_ALT RES_ACCOUNT_ALTERNATE_NAME
,IbyExtBankAccounts.BANK_ACCOUNT_TYPE RES_ACCOUNT_TYPE_CODE
,IbyExtBankAccounts.ACCOUNT_SUFFIX RES_ACCOUNT_SUFFIX
,IbyExtBankAccounts.DESCRIPTION RES_ACCOUNT_DESCRIPTION
,IbyExtBankAccounts.AGENCY_LOCATION_CODE RES_AGENCY_LOCATION_CODE
,IbyExtBankAccounts.EXCHANGE_RATE_AGREEMENT_NUM RES_EXCHANGE_RATE_AGREEMENT_NU
,IbyExtBankAccounts.EXCHANGE_RATE_AGREEMENT_TYPE RES_EXCHANGE_RATE_AGREEMENT_TY
,IbyExtBankAccounts.EXCHANGE_RATE RES_EXCHANGE_RATE
,IbyExtBankAccounts.SECONDARY_ACCOUNT_REFERENCE RES_SECONDARY_ACCOUNT_REFERENC
,IbyExtBankAccounts.ATTRIBUTE_CATEGORY RES_ATTRIBUTE_CATEGORY
,IbyExtBankAccounts.ATTRIBUTE1 RES_ATTRIBUTE_1
,IbyExtBankAccounts.ATTRIBUTE2 RES_ATTRIBUTE_2
,IbyExtBankAccounts.ATTRIBUTE3 RES_ATTRIBUTE_3
,IbyExtBankAccounts.ATTRIBUTE4 RES_ATTRIBUTE_4
,IbyExtBankAccounts.ATTRIBUTE5 RES_ATTRIBUTE_5
,IbyExtBankAccounts.ATTRIBUTE6 RES_ATTRIBUTE_6
,IbyExtBankAccounts.ATTRIBUTE7 RES_ATTRIBUTE_7
,IbyExtBankAccounts.ATTRIBUTE8 RES_ATTRIBUTE_8
,IbyExtBankAccounts.ATTRIBUTE9 RES_ATTRIBUTE_9
,IbyExtBankAccounts.ATTRIBUTE10 RES_ATTRIBUTE_10
,IbyExtBankAccounts.ATTRIBUTE11 RES_ATTRIBUTE_11
,IbyExtBankAccounts.ATTRIBUTE12 RES_ATTRIBUTE_12
,IbyExtBankAccounts.ATTRIBUTE13 RES_ATTRIBUTE_13
,IbyExtBankAccounts.ATTRIBUTE14 RES_ATTRIBUTE_14
,IbyExtBankAccounts.ATTRIBUTE15 RES_ATTRIBUTE_15
,'END' RES_END
,IbyExtBankAccounts.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,IbyExtBankAccounts.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,IbyExtBankAccounts.CREATED_BY RSC_CREATED_BY
,IbyExtBankAccounts.CREATION_DATE RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,NULL RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM IBY_EXTERNAL_PAYEES_ALL IbyExternalPayeesAll
--,POZ_SUPPLIER_SITES_ALL_M SupplierSiteDEO
,POZ_SUPPLIERS SupplierEO
,IBY_PMT_INSTR_USES_ALL ibyPmtInstrUsesAllE0
,IBY_EXT_BANK_ACCOUNTS IbyExtBankAccounts
WHERE SupplierEO.PARTY_ID = IbyExternalPayeesAll.PAYEE_PARTY_ID
AND IbyExternalPayeesAll.PARTY_SITE_ID IS NULL
AND IbyExternalPayeesAll.EXT_PAYEE_ID = ibyPmtInstrUsesAllE0.EXT_PMT_PARTY_ID
AND ibyPmtInstrUsesAllE0.INSTRUMENT_ID = IbyExtBankAccounts.EXT_BANK_ACCOUNT_ID


ORDER BY RES_PAYEE_IDENTIFIER