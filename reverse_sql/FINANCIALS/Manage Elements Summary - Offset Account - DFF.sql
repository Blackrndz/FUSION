/* ****************************************************************************
 * $Revision: 46258 $:
 * $Author: wuttipong.thongvises $:
 * $Date: 2015-02-18 18:08:10 +0700 (Wed, 18 Feb 2015) $:
 * $HeadURL: http://svn01.rapidesuite.com:999/svn/a/dev/rapidesuite/controldata/12.1.3/trunk/core/reverse_sql/Project%20Billing%20Super%20User-Inv/Non-Labor%20Resources%20-%20ORG.sql $:
 * $Id: Non-Labor Resources - ORG.sql 46258 2015-02-18 11:08:10Z wuttipong.thongvises $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */

-- RSC_PREREQUISITE_OBJECTS=PAY_ELEMENT_LINKS_F

WITH KFF_STRUTURE AS (SELECT ID_FLEX_NUM
	,APPLICATION_COLUMN_NAME
	,ROW_NUMBER() OVER(PARTITION BY ID_FLEX_NUM ORDER BY ID_FLEX_NUM,SEGMENT_NUM) SEQ
	,SEGMENT_NUM
	,FORM_LEFT_PROMPT
	FROM FND_ID_FLEX_SEGMENTS_VL kfSeg
	WHERE ID_FLEX_CODE = 'COST'
	AND APPLICATION_ID = 801
	AND EXISTS (SELECT 1
		FROM FND_KF_STR_INSTANCES_VL kfStr
		,FND_KF_LABELED_SEGMENTS kfLbl
		WHERE 1 = 1
		AND kfStr.STRUCTURE_ID = kfLbl.STRUCTURE_ID
		AND kfLbl.SEGMENT_LABEL_CODE = 'BALANCING'
		AND kfStr.STRUCTURE_INSTANCE_NUMBER = kfSeg.ID_FLEX_NUM
		AND kfLbl.SEGMENT_CODE = kfSeg.SEGMENT_NAME))
	
	
SELECT elementsE0.ELEMENT_NAME RES_ELEMENT_NAME
,legislativeDataGrpsE0.NAME RES_LEGISLATIVE_DATA_GROUP
,(SELECT CLASSIFICATION_NAME
    FROM PAY_ELE_CLASSIFICATIONS_VL
	WHERE BASE_CLASSIFICATION_ID = elementsE0.CLASSIFICATION_ID
	AND LEGISLATION_CODE = legislativeDataGrpsE0.LEGISLATION_CODE
	AND SYSDATE BETWEEN DATE_FROM AND NVL(DATE_TO,TO_DATE('4712-12-31','YYYY-MM-DD'))
	) RES_PRIMARY_CLASSIFICATION
,(SELECT CLASSIFICATION_NAME
    FROM PAY_ELE_CLASSIFICATIONS_VL
    WHERE BASE_CLASSIFICATION_ID = elementsE0.SECONDARY_CLASSIFICATION_ID
	AND LEGISLATION_CODE = legislativeDataGrpsE0.LEGISLATION_CODE
	AND SYSDATE BETWEEN DATE_FROM AND NVL(DATE_TO,TO_DATE('4712-12-31','YYYY-MM-DD'))
    ) RES_SECONDARY_CLASSIFICATION
,TO_CHAR(payCostalloE0.EFFECTIVE_START_DATE,'DD-Mon-YYYY') RES_EFFECTIVE_START_DATE
,payElementlinkE0.ELEMENT_LINK_NAME RES_ELEMENT_ELIGIBILITY_NAME
,KFF_STRUTURE.FORM_LEFT_PROMPT RES_FIELD_NAME
,DECODE(KFF_STRUTURE.APPLICATION_COLUMN_NAME
	,'SEGMENT1',payCostalloaccE0.SEGMENT1
	,'SEGMENT2',payCostalloaccE0.SEGMENT2
	,'SEGMENT3',payCostalloaccE0.SEGMENT3
	,'SEGMENT4',payCostalloaccE0.SEGMENT4
	,'SEGMENT5',payCostalloaccE0.SEGMENT5
	,'SEGMENT6',payCostalloaccE0.SEGMENT6
	,'SEGMENT7',payCostalloaccE0.SEGMENT7
	,'SEGMENT8',payCostalloaccE0.SEGMENT8
	,'SEGMENT9',payCostalloaccE0.SEGMENT9
	,'SEGMENT10',payCostalloaccE0.SEGMENT10
	,'SEGMENT11',payCostalloaccE0.SEGMENT11
	,'SEGMENT12',payCostalloaccE0.SEGMENT12
	,'SEGMENT13',payCostalloaccE0.SEGMENT13
	,'SEGMENT14',payCostalloaccE0.SEGMENT14
	,'SEGMENT15',payCostalloaccE0.SEGMENT15
	,'SEGMENT16',payCostalloaccE0.SEGMENT16
	,'SEGMENT17',payCostalloaccE0.SEGMENT17
	,'SEGMENT18',payCostalloaccE0.SEGMENT18
	,'SEGMENT19',payCostalloaccE0.SEGMENT19
	,'SEGMENT20',payCostalloaccE0.SEGMENT20
	,'SEGMENT21',payCostalloaccE0.SEGMENT21
	,'SEGMENT22',payCostalloaccE0.SEGMENT22
	,'SEGMENT23',payCostalloaccE0.SEGMENT23
	,'SEGMENT24',payCostalloaccE0.SEGMENT24
	,'SEGMENT25',payCostalloaccE0.SEGMENT25
	,'SEGMENT26',payCostalloaccE0.SEGMENT26
	,'SEGMENT27',payCostalloaccE0.SEGMENT27
	,'SEGMENT28',payCostalloaccE0.SEGMENT28
	,'SEGMENT29',payCostalloaccE0.SEGMENT29
	,'SEGMENT30',payCostalloaccE0.SEGMENT30
	) RES_FIELD_VALUE
,payCostalloaccE0.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,payCostalloaccE0.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,payCostalloaccE0.CREATED_BY RSC_CREATED_BY
,payCostalloaccE0.CREATION_DATE RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,NULL RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,legislativeDataGrpsE0.LEGISLATION_CODE RSC_COUNTRY_ID

FROM PAY_ELEMENT_TYPES_VL elementsE0
,PAY_ELEMENT_LINKS_F payElementlinkE0
,PAY_COST_ALLOCATIONS_F payCostalloE0
,PAY_COST_ALLOC_ACCOUNTS payCostalloaccE0
,(SELECT NAME
    ,LEGISLATIVE_DATA_GROUP_ID
	,LEGISLATION_CODE
    FROM PER_LEGISLATIVE_DATA_GROUPS_VL
    )legislativeDataGrpsE0
,KFF_STRUTURE
WHERE elementsE0.LEGISLATIVE_DATA_GROUP_ID = legislativeDataGrpsE0.LEGISLATIVE_DATA_GROUP_ID
AND elementsE0.ELEMENT_TYPE_ID = payElementlinkE0.ELEMENT_TYPE_ID 
AND payElementlinkE0.ELEMENT_LINK_ID = payCostalloE0.SOURCE_ID
AND payCostalloE0.COST_ALLOCATION_RECORD_ID = payCostalloaccE0.COST_ALLOCATION_RECORD_ID
AND payCostalloE0.SOURCE_TYPE = 'EL'
AND payCostalloaccE0.SOURCE_SUB_TYPE = 'BAL'
AND payCostalloaccE0.ID_FLEX_NUM = KFF_STRUTURE.ID_FLEX_NUM
AND NVL(payElementlinkE0.COSTING_LINK_FLAG,'N') = 'N'
ORDER BY elementsE0.ELEMENT_NAME 
,payCostalloE0.EFFECTIVE_START_DATE
,payElementlinkE0.ELEMENT_LINK_NAME
,SEQ