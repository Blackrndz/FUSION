/* ****************************************************************************
 * $Revision: 56649 $:
 * $Author: wuttipong.thongvises $:
 * $Date: 2016-07-12 11:20:44 +0700 (Tue, 12 Jul 2016) $:
 * $HeadURL: http://svn01.rapidesuite.com:999/svn/a/dev/rapidesuite/controldata/FUSION_11.1.12/branches/core/v2.2.0.0/reverse_sql/FINANCIALS/Currency%20Rates%20Manager%20-%20Rate%20Types.sql $:
 * $Id: Currency Rates Manager - Rate Types.sql 56649 2016-07-12 04:20:44Z wuttipong.thongvises $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */
 
-- RSC_PREREQUISITE_OBJECTS=XLA_SEG_RULE_DETAILS

SELECT
	(SELECT APPLICATION_NAME
	FROM XLA_SUBLEDGERS_TL
	WHERE LANGUAGE = USERENV('LANG')
	AND APPLICATION_ID = XlaSegRulesVlE0.APPLICATION_ID
	) RES_SUBLEDGER_APPLICATION
,XlaSegRulesVlE0.NAME RES_NAME
,AccountRuleDetailEO.SEQ1 RES_PRIORITY
,DECODE(AccountRuleDetailEO.VALUE_TYPE_CODE,'A','Account rule','M','Mapping set','S','Source','C','Constant','F','Formula') RES_VALUE_TYPE
,(CASE 		
	WHEN AccountRuleDetailEO.VALUE_TYPE_CODE = 'A' THEN
		(SELECT NAME
			FROM XLA_SEG_RULES_VL
			WHERE APPLICATION_ID = AccountRuleDetailEO.VALUE_SEGMENT_RULE_APPL_ID
			AND SEGMENT_RULE_TYPE_CODE = AccountRuleDetailEO.VALUE_SEGMENT_RULE_TYPE_CODE
			AND SEGMENT_RULE_CODE = AccountRuleDetailEO.VALUE_SEGMENT_RULE_CODE)
	WHEN AccountRuleDetailEO.VALUE_TYPE_CODE = 'M' THEN
		(SELECT NAME
			FROM XLA_MAPPING_SETS_VL
			WHERE MAPPING_SET_CODE = AccountRuleDetailEO.VALUE_MAPPING_SET_CODE
			AND APPLICATION_ID = AccountRuleDetailEO.APPLICATION_ID)
	WHEN AccountRuleDetailEO.VALUE_TYPE_CODE = 'S' THEN
		(SELECT NAME 
			FROM XLA_SOURCES_VL
			WHERE APPLICATION_ID = AccountRuleDetailEO.VALUE_SOURCE_APPLICATION_ID
			AND SOURCE_TYPE_CODE = AccountRuleDetailEO.VALUE_SOURCE_TYPE_CODE
			AND SOURCE_CODE = AccountRuleDetailEO.VALUE_SOURCE_CODE)
	WHEN AccountRuleDetailEO.VALUE_TYPE_CODE = 'C' THEN
		CASE
			WHEN XlaSegRulesVlE0.FLEXFIELD_ASSIGN_MODE_CODE = 'A' THEN
				FND_FLEX_EXT.GET_SEGS(APPLICATION_SHORT_NAME => 'GL'
					,KEY_FLEX_CODE => 'GL#'
					,STRUCTURE_NUMBER => XlaSegRulesVlE0.ACCOUNTING_COA_ID
					,COMBINATION_ID => AccountRuleDetailEO.VALUE_CODE_COMBINATION_ID)
			ELSE
				AccountRuleDetailEO.VALUE_CONSTANT
			END
	WHEN AccountRuleDetailEO.VALUE_TYPE_CODE = 'F' THEN
		(SELECT NAME 
			FROM XLA_FORMULAS_VL
			WHERE APPLICATION_ID = AccountRuleDetailEO.VALUE_SOURCE_APPLICATION_ID
			AND FORMULA_ORIGIN_CODE = AccountRuleDetailEO.VALUE_SOURCE_ORIGIN_CODE
			AND FORMULA_CODE = AccountRuleDetailEO.VALUE_SOURCE_CODE)
	END) RES_VALUE
,(CASE 		
	WHEN AccountRuleDetailEO.VALUE_TYPE_CODE = 'A' THEN
		(SELECT APPLICATION_NAME 
			FROM XLA_SUBLEDGERS_TL
			WHERE LANGUAGE = USERENV('LANG')
			AND APPLICATION_ID = AccountRuleDetailEO.VALUE_SEGMENT_RULE_APPL_ID)
	WHEN AccountRuleDetailEO.VALUE_TYPE_CODE = 'M' THEN
		NULL
	WHEN AccountRuleDetailEO.VALUE_TYPE_CODE = 'S' THEN
		(SELECT APPLICATION_NAME 
			FROM XLA_SUBLEDGERS_TL
			WHERE LANGUAGE = USERENV('LANG')
			AND APPLICATION_ID = AccountRuleDetailEO.VALUE_SOURCE_APPLICATION_ID)
	WHEN AccountRuleDetailEO.VALUE_TYPE_CODE = 'C' THEN
		NULL
	END) RES_SOURCE_SUBLEDGER_APPLICATI
,(SELECT segmentE0.NAME
	FROM FND_KF_STR_INSTANCES_VL strInstnE0
	,FND_KF_SEGMENTS_VL segmentE0
	WHERE strInstnE0.STRUCTURE_ID = segmentE0.STRUCTURE_ID
	AND strInstnE0.STRUCTURE_INSTANCE_ID = XlaSegRulesVlE0.ACCOUNTING_COA_ID
	AND segmentE0.COLUMN_NAME = AccountRuleDetailEO.VALUE_FLEXFIELD_SEGMENT_CODE
	)RES_SEGMENT
,AccountRuleDetailEO.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,AccountRuleDetailEO.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,AccountRuleDetailEO.CREATED_BY RSC_CREATED_BY
,AccountRuleDetailEO.CREATION_DATE RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,XlaSegRulesVlE0.ACCOUNTING_COA_ID RSC_CHART_OF_ACCOUNTS_ID
,NULL RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM XLA_SEG_RULES_VL XlaSegRulesVlE0
,(SELECT SEGMENT_RULE_DETAIL_ID
	,ACCOUNTING_COA_ID
	,APPLICATION_ID
	,AMB_CONTEXT_CODE
	,SEGMENT_RULE_TYPE_CODE
	,SEGMENT_RULE_CODE
	,USER_SEQUENCE
	,VALUE_TYPE_CODE
	,VALUE_SOURCE_APPLICATION_ID
	,VALUE_SOURCE_TYPE_CODE
	,VALUE_SOURCE_ORIGIN_CODE
	,VALUE_SOURCE_CODE
	,VALUE_CONSTANT
	,VALUE_CODE_COMBINATION_ID
	,VALUE_MAPPING_SET_CODE
	,VALUE_FLEXFIELD_SEGMENT_CODE
	,INPUT_SOURCE_APPLICATION_ID
	,INPUT_SOURCE_TYPE_CODE
	,INPUT_SOURCE_CODE
	,CREATION_DATE
	,CREATED_BY
	,LAST_UPDATE_DATE
	,LAST_UPDATED_BY
	,VALUE_SEGMENT_RULE_APPL_ID
	,VALUE_SEGMENT_RULE_TYPE_CODE
	,VALUE_SEGMENT_RULE_CODE
	,VALUE_ADR_VERSION_NUM
	,ROW_NUMBER() OVER(PARTITION BY SEGMENT_RULE_CODE,APPLICATION_ID ORDER BY USER_SEQUENCE) SEQ1
	FROM XLA_SEG_RULE_DETAILS
	) AccountRuleDetailEO
WHERE XlaSegRulesVlE0.APPLICATION_ID = AccountRuleDetailEO.APPLICATION_ID
AND XlaSegRulesVlE0.AMB_CONTEXT_CODE = AccountRuleDetailEO.AMB_CONTEXT_CODE
AND XlaSegRulesVlE0.SEGMENT_RULE_TYPE_CODE = AccountRuleDetailEO.SEGMENT_RULE_TYPE_CODE
AND XlaSegRulesVlE0.SEGMENT_RULE_CODE = AccountRuleDetailEO.SEGMENT_RULE_CODE
ORDER BY RES_SUBLEDGER_APPLICATION
,XlaSegRulesVlE0.NAME
,AccountRuleDetailEO.SEQ1