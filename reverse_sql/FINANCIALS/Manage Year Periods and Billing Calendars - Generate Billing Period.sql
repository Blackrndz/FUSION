/* ****************************************************************************
* $Revision: 78229 $:
* $Author: pisan.jariyasettachok $:
* $Date: 2022-04-07 14:37:05 +0700 (Thu, 07 Apr 2022) $:
* $HeadURL: http://svn01.rapidesuite.com:999/svn/a/dev/rapidesuite/controldata/FUSION_11.1.13/trunk/core/reverse_sql/FINANCIALS/Manage%20Year%20Periods%20and%20Billing%20Calendars%20-%20Billing%20Calendar%20Period.sql $:
* $Id: Manage Year Periods and Billing Calendars - Billing Calendar Period.sql 78229 2022-04-07 07:37:05Z pisan.jariyasettachok $:
* ****************************************************************************
* Description:
* ************************************************************************** */

-- RSC_PREREQUISITE_OBJECTS=BEN_BILL_CYCLE
-- RSC_PREREQUISITE_OBJECTS=BEN_BILL_CALENDAR

WITH tmpEO AS (SELECT BEN_BILL_CALENDAR.* ,ROW_NUMBER() OVER (PARTITION BY BILL_CYCLE_ID ORDER BY BILL_YEAR) AS ROW_NUMBER
	FROM BEN_BILL_CALENDAR ORDER BY BILL_CYCLE_ID)
,maxE0 AS (SELECT BILL_CYCLE_ID,COUNT(BILL_YEAR) AS maxyear FROM BEN_BILL_CALENDAR GROUP BY BILL_CYCLE_ID)


SELECT benBILLCYCLEO.NAME RES_CALENDAR_NAME
,(SELECT BILL_YEAR FROM tmpEO WHERE ROW_NUMBER = 1 AND BILL_CYCLE_ID = benBILLCYCLEO.BILL_CYCLE_ID) RES_START_YEAR
,(SELECT BILL_YEAR FROM tmpEO WHERE ROW_NUMBER = (SELECT maxyear FROM maxE0 WHERE BILL_CYCLE_ID = benBILLCYCLEO.BILL_CYCLE_ID)
	AND BILL_CYCLE_ID = benBILLCYCLEO.BILL_CYCLE_ID) RES_END_YEAR

, benBILLCYCLEO.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
, benBILLCYCLEO.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
, benBILLCYCLEO.CREATED_BY RSC_CREATED_BY
, benBILLCYCLEO.CREATION_DATE RSC_CREATION_DATE
, NULL RSC_LEDGER_ID
, NULL RSC_CHART_OF_ACCOUNTS_ID
, NULL RSC_BUSINESS_UNIT_ID
, NULL RSC_LEGAL_ENTITY_ID
, NULL RSC_ORGANIZATION_ID
, NULL RSC_BUSINESS_GROUP_ID
, NULL RSC_ENTERPRISE_ID
, NULL RSC_COUNTRY_ID

FROM BEN_BILL_CYCLE benBILLCYCLEO
ORDER BY benBILLCYCLEO.NAME