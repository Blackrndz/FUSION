/* ****************************************************************************
 * $Revision: 78334 $:
 * $Author: tanawat.wongjan $:
 * $Date: 2022-04-19 17:16:37 +0700 (Tue, 19 Apr 2022) $:
 * $HeadURL: https://svn03.rapid4cloud.com/svn/a/dev/rapidesuite/controldata/FUSION_11.1.13/trunk/core/reverse_sql/FINANCIALS/Manage%20Procurement%20Category%20Hierarchy%20-%20Item%20Categories.sql $:
 * $Id: Manage Procurement Category Hierarchy - Item Categories.sql 78334 2022-04-19 10:16:37Z tanawat.wongjan $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */
 
SELECT (SELECT DECODE(CATEGORY_NAME,'POR_CATEGORY_HIERARCHY_ROOT','Root Category',CATEGORY_NAME) 
			FROM POR_BROWSE_CATEGORIES_VL WHERE CATEGORY_ID = cutOFF.PK1) RES_PROCUREMENT_CATEGORY_NAME_ 
,(SELECT DECODE(CATEGORY_NAME,'POR_CATEGORY_HIERARCHY_ROOT','Root Category',CATEGORY_NAME) 
	FROM POR_BROWSE_CATEGORIES_VL WHERE CATEGORY_ID = cutOFF.PK2 ) RES_PROCUREMENT_CATEGORY_NAM_0
,(SELECT DECODE(CATEGORY_NAME,'POR_CATEGORY_HIERARCHY_ROOT','Root Category',CATEGORY_NAME) 
	FROM POR_BROWSE_CATEGORIES_VL WHERE CATEGORY_ID = cutOFF.PK3 ) RES_PROCUREMENT_CATEGORY_NAM_1
,(SELECT DECODE(CATEGORY_NAME,'POR_CATEGORY_HIERARCHY_ROOT','Root Category',CATEGORY_NAME)
	FROM POR_BROWSE_CATEGORIES_VL WHERE CATEGORY_ID = cutOFF.PK4 ) RES_PROCUREMENT_CATEGORY_NAM_2
,(SELECT DECODE(CATEGORY_NAME,'POR_CATEGORY_HIERARCHY_ROOT','Root Category',CATEGORY_NAME) 
	FROM POR_BROWSE_CATEGORIES_VL WHERE CATEGORY_ID = cutOFF.PK5 ) RES_PROCUREMENT_CATEGORY_NAM_3
,(SELECT DECODE(CATEGORY_NAME,'POR_CATEGORY_HIERARCHY_ROOT','Root Category',CATEGORY_NAME)
	FROM POR_BROWSE_CATEGORIES_VL
	WHERE CATEGORY_ID = cutOFF.PARENT_CATEGORY_ID
	) RES_PROCUREMENT_CATEGORY_NAME
,NVL((SELECT CATEGORY_NAME FROM EGP_CATEGORIES_VL WHERE CATEGORY_ID = cutOFF.CHILD_CATEGORY_ID)
		,(SELECT DECODE(CATEGORY_NAME,'POR_CATEGORY_HIERARCHY_ROOT','Root Category',CATEGORY_NAME)
			FROM POR_BROWSE_CATEGORIES_VL WHERE CATEGORY_ID = cutOFF.CHILD_CATEGORY_ID)
	) RES_ITEM_CATEGORIES_NAME
,RSC_LAST_UPDATED_BY
,RSC_LAST_UPDATE_DATE
,RSC_CREATED_BY
,RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,NULL RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM (SELECT 
SUBSTR(SYS_CONNECT_BY_PATH(BrowseCategoryTreeEO.PARENT_CATEGORY_ID,'###'),INSTR(SYS_CONNECT_BY_PATH(BrowseCategoryTreeEO.PARENT_CATEGORY_ID,'###'),'###',1,1)+3,INSTR(SYS_CONNECT_BY_PATH(BrowseCategoryTreeEO.PARENT_CATEGORY_ID,'###'),'###',1,2)-4)  PK1
,SUBSTR(SYS_CONNECT_BY_PATH(BrowseCategoryTreeEO.PARENT_CATEGORY_ID,'###'),INSTR(SYS_CONNECT_BY_PATH(BrowseCategoryTreeEO.PARENT_CATEGORY_ID,'###'),'###',1,2)+3,INSTR(SYS_CONNECT_BY_PATH(BrowseCategoryTreeEO.PARENT_CATEGORY_ID,'###'),'###',1,3) - INSTR(SYS_CONNECT_BY_PATH(BrowseCategoryTreeEO.PARENT_CATEGORY_ID,'###'),'###',1,2)-3) PK2
,SUBSTR(SYS_CONNECT_BY_PATH(BrowseCategoryTreeEO.PARENT_CATEGORY_ID,'###'),INSTR(SYS_CONNECT_BY_PATH(BrowseCategoryTreeEO.PARENT_CATEGORY_ID,'###'),'###',1,3)+3,INSTR(SYS_CONNECT_BY_PATH(BrowseCategoryTreeEO.PARENT_CATEGORY_ID,'###'),'###',1,4) - INSTR(SYS_CONNECT_BY_PATH(BrowseCategoryTreeEO.PARENT_CATEGORY_ID,'###'),'###',1,3)-3) PK3
,SUBSTR(SYS_CONNECT_BY_PATH(BrowseCategoryTreeEO.PARENT_CATEGORY_ID,'###'),INSTR(SYS_CONNECT_BY_PATH(BrowseCategoryTreeEO.PARENT_CATEGORY_ID,'###'),'###',1,4)+3,INSTR(SYS_CONNECT_BY_PATH(BrowseCategoryTreeEO.PARENT_CATEGORY_ID,'###'),'###',1,5) - INSTR(SYS_CONNECT_BY_PATH(BrowseCategoryTreeEO.PARENT_CATEGORY_ID,'###'),'###',1,4)-3) PK4
,SUBSTR(SYS_CONNECT_BY_PATH(BrowseCategoryTreeEO.PARENT_CATEGORY_ID,'###'),INSTR(SYS_CONNECT_BY_PATH(BrowseCategoryTreeEO.PARENT_CATEGORY_ID,'###'),'###',1,5)+3,INSTR(SYS_CONNECT_BY_PATH(BrowseCategoryTreeEO.PARENT_CATEGORY_ID,'###'),'###',1,6) - INSTR(SYS_CONNECT_BY_PATH(BrowseCategoryTreeEO.PARENT_CATEGORY_ID,'###'),'###',1,5)-3) PK5
,LEVEL AS a
,BrowseCategoryTreeEO.PARENT_CATEGORY_ID
,BrowseCategoryTreeEO.CHILD_CATEGORY_ID CHILD_CATEGORY_ID
,BrowseCategoryTreeEO.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,BrowseCategoryTreeEO.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,BrowseCategoryTreeEO.CREATED_BY RSC_CREATED_BY
,BrowseCategoryTreeEO.CREATION_DATE RSC_CREATION_DATE
FROM POR_BROWSE_TREES BrowseCategoryTreeEO
START WITH BrowseCategoryTreeEO.PARENT_CATEGORY_ID = '2'
CONNECT BY PRIOR BrowseCategoryTreeEO.CHILD_CATEGORY_ID = BrowseCategoryTreeEO.PARENT_CATEGORY_ID) cutOFF
WHERE PARENT_CATEGORY_ID NOT IN (SELECT CATEGORY_ID FROM POR_BROWSE_CATEGORIES_VL WHERE CATEGORY_NAME ='POR_CATEGORY_HIERARCHY_ROOT')
ORDER BY cutOFF.a,RES_PROCUREMENT_CATEGORY_NAME