/* ****************************************************************************
* $Revision: 78229 $:
* $Author: pisan.jariyasettachok $:
* $Date: 2022-04-07 14:37:05 +0700 (Thu, 07 Apr 2022) $:
* $HeadURL: https://svn03.rapid4cloud.com/svn/a/dev/rapidesuite/controldata/FUSION_11.1.13/trunk/core/reverse_sql/FINANCIALS/Manage%20Financial%20Plan%20Types%20-%20Currency%20Settings.sql $:
* $Id: Manage Financial Plan Types - Currency Settings.sql 78229 2022-04-07 07:37:05Z pisan.jariyasettachok $:
* ****************************************************************************
* Description:
* ************************************************************************** */

-- RSC_PREREQUISITE_OBJECTS=PJO_PLANNING_OPTIONS

WITH CHECK_SAME_CONV AS(SELECT PLANNING_OPTION_ID 
	,(CASE
	WHEN 	((PFC_COST_RATE_TYPE = PC_COST_RATE_TYPE AND PFC_COST_RATE_TYPE = RATE_SCH_COST_RATE_TYPE)
		AND (PFC_COST_RATE_DATE_TYPE = PC_COST_RATE_DATE_TYPE AND PFC_COST_RATE_DATE_TYPE = RATE_SCH_COST_RATE_DATE_TYPE))
		AND ( NVL(TO_CHAR(PFC_COST_RATE_DATE),'0') = NVL(TO_CHAR(PC_COST_RATE_DATE),'0') AND NVL(TO_CHAR(PFC_COST_RATE_DATE),'0') = NVL(TO_CHAR(RATE_SCH_COST_RATE_DATE),'0'))
		OR  ((PFC_REV_RATE_TYPE = PC_REV_RATE_TYPE AND PFC_REV_RATE_TYPE = RATE_SCH_REV_RATE_TYPE)
		AND (PFC_REV_RATE_DATE_TYPE = PC_REV_RATE_DATE_TYPE AND PFC_REV_RATE_DATE_TYPE = RATE_SCH_REV_RATE_DATE_TYPE))
		AND (NVL(TO_CHAR(PFC_REV_RATE_DATE),'0') = NVL(TO_CHAR(PC_REV_RATE_DATE),'0') AND NVL(TO_CHAR(PFC_REV_RATE_DATE),'0') = NVL(TO_CHAR(RATE_SCH_REV_RATE_DATE),'0')) 
		THEN 'Y'
		ELSE 'N'
		END) USE_SAME_CONV
	FROM PJO_PLANNING_OPTIONS
	WHERE PROJECT_ID = 0
	)

SELECT 	pjoPlanTypeEO.NAME											RES_NAME
,DECODE(checkSameConvsE0.USE_SAME_CONV,'Y','Yes','No') RES_USE_SAME_CONVERSION_ATTRIB
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'Y'
		THEN (SELECT USER_CONVERSION_TYPE 
				FROM GL_DAILY_CONVERSION_TYPES
					WHERE CONVERSION_TYPE = pjoPlanOptionEO.PC_COST_RATE_TYPE )				
			END) RES_RATE_TYPE
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'Y' 
		THEN (SELECT MEANING FROM FND_LOOKUPS
				WHERE LOOKUP_CODE = pjoPlanOptionEO.PC_COST_RATE_DATE_TYPE
					AND LOOKUP_TYPE = 'PJO_RATE_DRV_DATE_TYPE') 					
			END) RES_DATE_TYPE
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'Y'
		THEN TO_CHAR(pjoPlanOptionEO.PC_COST_RATE_DATE,'DD-Mon-YYYY') 				
		END)	RES_FIXED_DATE
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'Y' 
		THEN (SELECT USER_CONVERSION_TYPE 
				FROM GL_DAILY_CONVERSION_TYPES
					WHERE CONVERSION_TYPE = pjoPlanOptionEO.PC_REV_RATE_TYPE )				
			END) RES_REVENUE_RATE_TYPE
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'Y'
		 THEN (SELECT MEANING FROM FND_LOOKUPS
				WHERE LOOKUP_CODE = pjoPlanOptionEO.PC_REV_RATE_DATE_TYPE
					AND LOOKUP_TYPE = 'PJO_RATE_DRV_DATE_TYPE')	
			END)	RES_REVENUE_DATE_TYPE
,(CASE
	 WHEN checkSameConvsE0.USE_SAME_CONV = 'Y'
		THEN TO_CHAR(pjoPlanOptionEO.PC_REV_RATE_DATE,'DD-Mon-YYYY') 				
		END)	RES_REVENUE_FIXED_DATE
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'N' 
		THEN (SELECT USER_CONVERSION_TYPE 
				FROM GL_DAILY_CONVERSION_TYPES
					WHERE CONVERSION_TYPE = pjoPlanOptionEO.PC_COST_RATE_TYPE) 
					END)	RES_RATE_TYPE_FOR_PROJECT_CURR
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'N'  
		THEN (SELECT MEANING FROM FND_LOOKUPS
				WHERE LOOKUP_CODE = pjoPlanOptionEO.PC_COST_RATE_DATE_TYPE
					AND LOOKUP_TYPE = 'PJO_RATE_DRV_DATE_TYPE') 					
			END) RES_PROJECT_DATE_TYPE
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'N'  
		THEN TO_CHAR(pjoPlanOptionEO.PC_COST_RATE_DATE,'DD-Mon-YYYY') 				
		END) RES_PROJECT_FIXED_DATE
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'N' 
		THEN (SELECT USER_CONVERSION_TYPE 
				FROM GL_DAILY_CONVERSION_TYPES
					WHERE CONVERSION_TYPE = pjoPlanOptionEO.PFC_COST_RATE_TYPE)
					END)	RES_RATE_TYPE_FOR_LEDGER_CURRE
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'N'  
		THEN (SELECT MEANING FROM FND_LOOKUPS
				WHERE LOOKUP_CODE = pjoPlanOptionEO.PFC_COST_RATE_DATE_TYPE
					AND LOOKUP_TYPE = 'PJO_RATE_DRV_DATE_TYPE') 					
			END) RES_LEDGER_DATE_TYPE
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'N'  
		THEN TO_CHAR(pjoPlanOptionEO.PFC_COST_RATE_DATE,'DD-Mon-YYYY') 				
		END)  RES_LEDGER_FIXED_DATE
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'N' 
		THEN (SELECT USER_CONVERSION_TYPE 
				FROM GL_DAILY_CONVERSION_TYPES
					WHERE CONVERSION_TYPE = pjoPlanOptionEO.RATE_SCH_COST_RATE_TYPE) 
					END)	RES_RATE_TYPE_FOR_PLANNING_CUR
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'N'  
		THEN (SELECT MEANING FROM FND_LOOKUPS
				WHERE LOOKUP_CODE = pjoPlanOptionEO.RATE_SCH_COST_RATE_DATE_TYPE
					AND LOOKUP_TYPE = 'PJO_RATE_DRV_DATE_TYPE') 					
			END) RES_PLANNING_DATE_TYPE
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'N' 
		THEN TO_CHAR(pjoPlanOptionEO.RATE_SCH_COST_RATE_DATE,'DD-Mon-YYYY') 				
		END)  RES_PLANNING_FIXED_DATE
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'N' 
		THEN (SELECT USER_CONVERSION_TYPE 
				FROM GL_DAILY_CONVERSION_TYPES
					WHERE CONVERSION_TYPE = pjoPlanOptionEO.PC_REV_RATE_TYPE)
					END) RES_REVENUE_RATE_TYPE_FOR_PROJ
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'N' 
		THEN (SELECT MEANING FROM FND_LOOKUPS
				WHERE LOOKUP_CODE = pjoPlanOptionEO.PC_REV_RATE_DATE_TYPE
					AND LOOKUP_TYPE = 'PJO_RATE_DRV_DATE_TYPE') 					
			END) RES_REVENUE_PROJECT_DATE_TYPE
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'N'  
		THEN TO_CHAR(pjoPlanOptionEO.PC_REV_RATE_DATE,'DD-Mon-YYYY') 				
		END)  RES_REVENUE_PROJECT_FIXED_DATE
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'N'  
		THEN (SELECT USER_CONVERSION_TYPE 
				FROM GL_DAILY_CONVERSION_TYPES
					WHERE CONVERSION_TYPE = pjoPlanOptionEO.PFC_REV_RATE_TYPE) 
					END) RES_REVENUE_RATE_TYPE_FOR_LEDG
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'N' 
		THEN (SELECT MEANING FROM FND_LOOKUPS
				WHERE LOOKUP_CODE = pjoPlanOptionEO.PFC_REV_RATE_DATE_TYPE
					AND LOOKUP_TYPE = 'PJO_RATE_DRV_DATE_TYPE') 					
			END) RES_REVENUE_LEDGER_DATE_TYPE
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'N'  
		THEN TO_CHAR(pjoPlanOptionEO.PFC_REV_RATE_DATE,'DD-Mon-YYYY') 				
		END) RES_REVENUE_LEDGER_FIXED_DATE
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'N'  
		THEN (SELECT USER_CONVERSION_TYPE 
				FROM GL_DAILY_CONVERSION_TYPES
					WHERE CONVERSION_TYPE = pjoPlanOptionEO.RATE_SCH_REV_RATE_TYPE) 
					END) RES_REVENUE_RATE_TYPE_FOR_PLAN
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'N' 
		THEN (SELECT MEANING FROM FND_LOOKUPS
				WHERE LOOKUP_CODE = pjoPlanOptionEO.RATE_SCH_REV_RATE_DATE_TYPE
					AND LOOKUP_TYPE = 'PJO_RATE_DRV_DATE_TYPE') 					
			END) RES_REVENUE_PLANNING_DATE_TYPE
,(CASE
	WHEN checkSameConvsE0.USE_SAME_CONV = 'N'  
		THEN TO_CHAR(pjoPlanOptionEO.RATE_SCH_REV_RATE_DATE,'DD-Mon-YYYY') 				
		END) RES_REVENUE_PLANNING_FIXED_DAT
,pjoPlanOptionEO.LAST_UPDATED_BY  RSC_LAST_UPDATED_BY
,pjoPlanOptionEO.LAST_UPDATE_DATE  RSC_LAST_UPDATE_DATE
,pjoPlanOptionEO.CREATED_BY  RSC_CREATED_BY
,pjoPlanOptionEO.CREATION_DATE  RSC_CREATION_DATE
,null RSC_LEDGER_ID
,null RSC_CHART_OF_ACCOUNTS_ID
,null RSC_BUSINESS_UNIT_ID
,null RSC_LEGAL_ENTITY_ID
,null RSC_ORGANIZATION_ID
,null RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM PJO_PLAN_TYPES_VL pjoPlanTypeEO
,PJO_PLANNING_OPTIONS pjoPlanOptionEO
,CHECK_SAME_CONV checkSameConvsE0
WHERE pjoPlanTypeEO.PLAN_TYPE_CODE = 'FINANCIAL_PLAN'
AND pjoPlanTypeEO.PLAN_TYPE_ID = pjoPlanOptionEO.PLAN_TYPE_ID
AND pjoPlanOptionEO.PLANNING_OPTION_ID = checkSameConvsE0.PLANNING_OPTION_ID
AND pjoPlanOptionEO.PLAN_OPTION_LEVEL_CODE = 'PLAN_TYPE'
AND pjoPlanOptionEO.PROJECT_ID = 0
ORDER BY pjoPlanTypeEO.NAME