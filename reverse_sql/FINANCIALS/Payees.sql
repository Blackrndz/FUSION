/* ****************************************************************************
 * $Revision:  $:
 * $Author: Nasrullah.Dusenmahamad $:
 * $Date: 2017-09-13  $:
 * $HeadURL: $:
 * $Id: Manage Suppliers - Supplier Payees.sql  $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */
 
-- STRICTLY_BATCH_SEQ = RES_PAYEE_IDENTIFIER

SELECT null RES_IMPORT_BATCH_IDENTIFIER
,IbyExternalPayeesAll.EXT_PAYEE_ID RES_PAYEE_IDENTIFIER
,NULL RES_BUSINESS_UNIT_NAME
,SupplierEO.SEGMENT1 RES_SUPPLIER_NUMBER
,NULL RES_SUPPLIER_SITE
,IbyExternalPayeesAll.EXCLUSIVE_PAYMENT_FLAG RES_PAY_EACH_DOCUMENT_ALONE
,(SELECT payment_method_code
	FROM iby_ext_party_pmt_mthds m
	WHERE m.ext_pmt_party_id = EXT_PAYEE_ID
	AND m.primary_flag       = 'Y'
	AND m.payment_flow       = 'DISBURSEMENTS'
	AND m.payment_function   = IbyExternalPayeesAll.payment_function
	AND rownum               = 1
	) RES_PAYMENT_METHOD_CODE
,IbyExternalPayeesAll.DELIVERY_CHANNEL_CODE RES_DELIVERY_CHANNEL_CODE
,IbyExternalPayeesAll.SETTLEMENT_PRIORITY RES_SETTLEMENT_PRIORITY
,IbyExternalPayeesAll.REMIT_ADVICE_DELIVERY_METHOD RES_REMIT_DELIVERY_METHOD
,IbyExternalPayeesAll.REMIT_ADVICE_EMAIL RES_REMIT_ADVICE_EMAIL
,IbyExternalPayeesAll.REMIT_ADVICE_FAX RES_REMIT_ADVICE_FAX
,IbyExternalPayeesAll.BANK_INSTRUCTION1_CODE RES_BANK_INSTRUCTIONS_1
,IbyExternalPayeesAll.BANK_INSTRUCTION2_CODE RES_BANK_INSTRUCTIONS_2
,IbyExternalPayeesAll.BANK_INSTRUCTION_DETAILS RES_BANK_INSTRUCTION_DETAILS
,IbyExternalPayeesAll.PAYMENT_REASON_CODE RES_PAYMENT_REASON_CODE
,IbyExternalPayeesAll.PAYMENT_REASON_COMMENTS RES_PAYMENT_REASON_COMMENTS
,IbyExternalPayeesAll.PAYMENT_TEXT_MESSAGE1 RES_PAYMENT_MESSAGE1
,IbyExternalPayeesAll.PAYMENT_TEXT_MESSAGE2 RES_PAYMENT_MESSAGE2
,IbyExternalPayeesAll.PAYMENT_TEXT_MESSAGE3 RES_PAYMENT_MESSAGE3
,IbyExternalPayeesAll.BANK_CHARGE_BEARER RES_BANK_CHARGE_BEARER_CODE
,'END' RES_END
,IbyExternalPayeesAll.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,IbyExternalPayeesAll.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,IbyExternalPayeesAll.CREATED_BY RSC_CREATED_BY
,IbyExternalPayeesAll.CREATION_DATE RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,NULL RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM IBY_EXTERNAL_PAYEES_ALL IbyExternalPayeesAll
--,POZ_SUPPLIER_SITES_ALL_M SupplierSiteDEO
,POZ_SUPPLIERS SupplierEO
where SupplierEO.PARTY_ID = IbyExternalPayeesAll.PAYEE_PARTY_ID
AND IbyExternalPayeesAll.PARTY_SITE_ID IS NULL
 
UNION

SELECT null RES_IMPORT_BATCH_IDENTIFIER
,IbyExternalPayeesAll.EXT_PAYEE_ID RES_PAYEE_IDENTIFIER
,(select BusinessUnitPEO.BU_NAME
	from FUN_ALL_BUSINESS_UNITS_V BusinessUnitPEO 
	where BusinessUnitPEO.BU_ID = SupplierSiteDEO.PRC_BU_ID 
	) RES_BUSINESS_UNIT_NAME
,SupplierEO.SEGMENT1 RES_SUPPLIER_NUMBER
,SupplierSiteDEO.VENDOR_SITE_CODE RES_SUPPLIER_SITE
,IbyExternalPayeesAll.EXCLUSIVE_PAYMENT_FLAG RES_PAY_EACH_DOCUMENT_ALONE
,(SELECT payment_method_code
	FROM iby_ext_party_pmt_mthds m
	WHERE m.ext_pmt_party_id = EXT_PAYEE_ID
	AND m.primary_flag       = 'Y'
	AND m.payment_flow       = 'DISBURSEMENTS'
	AND m.payment_function   = IbyExternalPayeesAll.payment_function
	AND rownum               = 1
	) RES_PAYMENT_METHOD_CODE
,IbyExternalPayeesAll.DELIVERY_CHANNEL_CODE RES_DELIVERY_CHANNEL_CODE
,IbyExternalPayeesAll.SETTLEMENT_PRIORITY RES_SETTLEMENT_PRIORITY
,IbyExternalPayeesAll.REMIT_ADVICE_DELIVERY_METHOD RES_REMIT_DELIVERY_METHOD
,IbyExternalPayeesAll.REMIT_ADVICE_EMAIL RES_REMIT_ADVICE_EMAIL
,IbyExternalPayeesAll.REMIT_ADVICE_FAX RES_REMIT_ADVICE_FAX
,IbyExternalPayeesAll.BANK_INSTRUCTION1_CODE RES_BANK_INSTRUCTIONS_1
,IbyExternalPayeesAll.BANK_INSTRUCTION2_CODE RES_BANK_INSTRUCTIONS_2
,IbyExternalPayeesAll.BANK_INSTRUCTION_DETAILS RES_BANK_INSTRUCTION_DETAILS
,IbyExternalPayeesAll.PAYMENT_REASON_CODE RES_PAYMENT_REASON_CODE
,IbyExternalPayeesAll.PAYMENT_REASON_COMMENTS RES_PAYMENT_REASON_COMMENTS
,IbyExternalPayeesAll.PAYMENT_TEXT_MESSAGE1 RES_PAYMENT_MESSAGE1
,IbyExternalPayeesAll.PAYMENT_TEXT_MESSAGE2 RES_PAYMENT_MESSAGE2
,IbyExternalPayeesAll.PAYMENT_TEXT_MESSAGE3 RES_PAYMENT_MESSAGE3
,IbyExternalPayeesAll.BANK_CHARGE_BEARER RES_BANK_CHARGE_BEARER_CODE
,'END' RES_END
,IbyExternalPayeesAll.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,IbyExternalPayeesAll.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,IbyExternalPayeesAll.CREATED_BY RSC_CREATED_BY
,IbyExternalPayeesAll.CREATION_DATE RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,SupplierSiteDEO.PRC_BU_ID RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM IBY_EXTERNAL_PAYEES_ALL IbyExternalPayeesAll
,POZ_SUPPLIER_SITES_ALL_M SupplierSiteDEO
,POZ_SUPPLIERS SupplierEO
where IbyExternalPayeesAll.PARTY_SITE_ID = SupplierSiteDEO.PARTY_SITE_ID
and IbyExternalPayeesAll.SUPPLIER_SITE_ID = SupplierSiteDEO.VENDOR_SITE_ID
AND SupplierEO.VENDOR_ID = SupplierSiteDEO.VENDOR_ID
ORDER BY RES_PAYEE_IDENTIFIER