/* ****************************************************************************
 * $Revision: 74359 $:
 * $Author: tanawat.wongjan $:
 * $Date: 2020-07-20 16:16:20 +0700 (Mon, 20 Jul 2020) $:
 * $HeadURL: http://svn01.rapidesuite.com:999/svn/a/dev/rapidesuite/controldata/FUSION_11.1.13.20/trunk/core/reverse_sql/FINANCIALS/Manage%20Absence%20Types%20-%20Absence%20Types.sql $:
 * $Id: Manage Absence Types - Absence Types.sql 74359 2020-07-20 09:16:20Z tanawat.wongjan $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */
 
-- RSC_PREREQUISITE_OBJECTS=ANC_ABSENCE_TYPES_VL

SELECT ancABSENTYPEEO.NAME RES_NAME
,(SELECT TERRITORY_SHORT_NAME 
	FROM FND_TERRITORIES_TL 
	WHERE LANGUAGE = USERENV('LANG')
	AND TERRITORY_CODE = ancABSENTYPEEO.LEGISLATION_CODE
	) RES_LEGISLATION
,(SELECT NAME 
	FROM PER_LEGISLATIVE_DATA_GROUPS_TL 
	WHERE LANGUAGE = USERENV('LANG')
	AND LEGISLATIVE_DATA_GROUP_ID = ancABSENTYPEEO.LEGISLATIVE_DATA_GROUP_ID
	) RES_LEGISLATIVE_DATA_GROUP
,TO_CHAR(ancABSENTYPEEO.EFFECTIVE_START_DATE,'DD-Mon-YYYY')  RES_EFFECTIVE_START_DATE
,(SELECT MEANING 
	FROM FND_LOOKUP_VALUES 
	WHERE LOOKUP_CODE = ancABSENTYPEEO.PATTERN_CD
	AND LOOKUP_TYPE = 'ANC_ABSENCE_PATTERNS' 
	AND LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))
	) RES_PATTERN


--General Attributes
,ancABSENTYPEEO.DESCRIPTION RES_DESCRIPTION
,(SELECT MEANING 
	FROM FND_LOOKUP_VALUES 
	WHERE LOOKUP_CODE = ancABSENTYPEEO.DURATION_UOM_CD
	AND LOOKUP_TYPE = 'ANC_DURATION_UOM' 
	AND LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))
	) RES_UOM
,(SELECT MEANING 
	FROM FND_LOOKUP_VALUES 
	WHERE LOOKUP_CODE = ancABSENTYPEEO.STATUS
	AND LOOKUP_TYPE = 'ANC_SETUP_OBJ_STATUS' 
	AND LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))
	) RES_STATUS
,(SELECT MEANING 
	FROM FND_LOOKUP_VALUES 
	WHERE LOOKUP_CODE = ancABSENTYPEEO.MAP_EVENT_TYPE_CD
	AND LOOKUP_TYPE = 'ANC_MAP_EVENT_TYPE' 
	AND LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))
	) RES_EVENT_TYPE


,(SELECT BASE_FORMULA_NAME 
	FROM FF_FORMULAS_VL 
	WHERE FORMULA_ID = ancABSENTYPEEO.ABSENCE_DURATION_FORMULA_ID 
	AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND NVL(EFFECTIVE_END_DATE,TO_DATE('4712-12-31','YYYY-MM-DD'))
	) RES_CONVERSION_FORMULA	
,(SELECT BASE_FORMULA_NAME 
	FROM FF_FORMULAS_VL 
	WHERE FORMULA_ID = ancABSENTYPEEO.ABSENCE_VALIDATION_FORMULA_ID 
	AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND NVL(EFFECTIVE_END_DATE,TO_DATE('4712-12-31','YYYY-MM-DD'))
	) RES_VALIDATION_FORMULA
,(SELECT NAME 
	FROM BEN_ELIGY_PRFL 
	WHERE ELIGY_PRFL_ID = ancABSENTYPEEO.BEN_ELIG_PROFILE_ID 
	AND SYSDATE BETWEEN START_DATE AND NVL(END_DATE,TO_DATE('4712-12-31','YYYY-MM-DD'))
	) RES_ELIGIBILITY_PROFILE
,(SELECT MEANING 
	FROM FND_LOOKUP_VALUES 
	WHERE LOOKUP_CODE = ancABSENTYPEEO.LEG_GROUPING_CD
	AND LOOKUP_TYPE = 'ORA_ANC_LEG_GROUPING' 
	AND LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))
	) RES_LEGISLATIVE_GROUPING_CODE
--,DECODE(ancABSENTYPEEO.DISP_BAL_APRVL_NOTIFIY,'Y','Yes','No') RES_DISPLAY_BALANCE_IN_APPROVA 
,'' RES_DISPLAY_BALANCE_IN_APPROVA

--Duration Rules
,(SELECT MEANING 
	FROM FND_LOOKUP_VALUES 
	WHERE LOOKUP_CODE = ancABSENTYPEEO.MIN_DURATION_RULE_CD
	AND LOOKUP_TYPE = 'ANC_DURATION_RULE' 
	AND LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))
	) RES_MINIMUM_DURATION_ALERT
,ancABSENTYPEEO.MIN_DURATION RES_MINIMUM_DURATION
,(SELECT MEANING 
	FROM FND_LOOKUP_VALUES 
	WHERE LOOKUP_CODE = ancABSENTYPEEO.MAX_DURATION_RULE_CD
	AND LOOKUP_TYPE = 'ANC_DURATION_RULE' 
	AND LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))
	)  RES_MAXIMUM_DURATION_ALERT
,ancABSENTYPEEO.MAX_DURATION RES_MAXIMUM_DURATION
,(SELECT MEANING 
	FROM FND_LOOKUP_VALUES 
	WHERE LOOKUP_CODE = ancABSENTYPEEO.PARTIAL_DAY
	AND LOOKUP_TYPE = 'ANC_PARTIAL_DAY_RULE' 
	AND LANGUAGE = USERENV('LANG')
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))
	) RES_PARTIAL_DAY_RULE
,(SELECT MEANING
	FROM FND_LOOKUP_VALUES
	WHERE LANGUAGE = USERENV('LANG')
	AND LOOKUP_TYPE = 'ORA_ANC_DUR_CALC_BASIS'
	AND LOOKUP_CODE = ancABSENTYPEEO.DUR_CALC_BASIS 
	) RES_SCHEDULE_HIERARCHY_START_P


--Open-Ended Absences
,DECODE(ancABSENTYPEEO.INCL_OPENEND_ABS_EVAL,'Y','Yes','No') RES_EVALUATE_ABSENCES_FOR_SCHE
,ancABSENTYPEEO.EVAL_EXTN_PERIOD RES_EVALUATION_EXTENSION_PERIO
,ancABSENTYPEEO.EVAL_PERIOD RES_EVALUATION_PERIOD_AT_ABSEN

,(CASE
	WHEN ancABSENTYPEEO.PATTERN_CD != 'MAP' THEN
		DECODE(ancABSENTYPEEO.BASIC_ASSIGNMENT_FLAG,'Y','Yes','No')
	END) RES_ALLOW_ASSIGNMENT_SELECTION
,(CASE
	WHEN ancABSENTYPEEO.PATTERN_CD != 'MAP' AND ancABSENTYPEEO.BASIC_ASSIGNMENT_FLAG = 'Y' THEN
		DECODE(ancABSENTYPEEO.PREVENT_MULTIPLE_ASG_FLAG,'Y','Yes','No')
	END) RES_ALLOW_ONLY_ONE_ASSIGNMENT_
,(SELECT MEANING
	FROM FND_LOOKUP_VALUES
	WHERE LANGUAGE = USERENV('LANG')
	AND LOOKUP_TYPE = 'ORA_ANC_MULTI_ASSIGN_APPROVERS'
	AND LOOKUP_CODE = ancABSENTYPEEO.APPROVAL_ROUTING_CD 
	) RES_APPROVERS

--Absence Record Maintenance
,DECODE(ancABSENTYPEEO.EMP_ALLOW_UPDATES_CD,'Y','Yes','No') RES_ENABLE_EMPLOYEE_UPDATES
,DECODE(ancABSENTYPEEO.MGR_ALLOW_UPDATES_CD,'Y','Yes','No') RES_ENABLE_MANAGER_UPDATES
,DECODE(ancABSENTYPEEO.ADMIN_ALLOW_UPDATES_CD,'Y','Yes','No') RES_ENABLE_ADMINISTRATIVE_UPDA
,DECODE(ancABSENTYPEEO.EMP_LOCK_IF_CONFIRM_CD,'Y','Yes','No') RES_LOCK_IF_COMPLETED_FOR_EMPL
,DECODE(ancABSENTYPEEO.MGR_LOCK_IF_CONFIRM_CD,'Y','Yes','No') RES_LOCK_IF_COMPLETED_FOR_MANA
,DECODE(ancABSENTYPEEO.TIMECARD_AVAIL_FLAG,'Y','Yes','No') RES_ENABLE_FOR_TIME_CARD_ENTRY


--Linkage
,(CASE
	WHEN ancABSENTYPEEO.PATTERN_CD = 'II' THEN
		(SELECT MEANING 
			FROM FND_LOOKUP_VALUES 
			WHERE LANGUAGE = USERENV('LANG')
			AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))
			AND LOOKUP_TYPE = 'ANC_LINKAGE_RULE' 
			AND LOOKUP_CODE = ancABSENTYPEEO.LINKAGE_RULE_CD)
	END) RES_LINKAGE_RULE
,(CASE
	WHEN ancABSENTYPEEO.PATTERN_CD = 'II' AND ancABSENTYPEEO.LINKAGE_RULE_CD NOT IN ('M','N') THEN
		(SELECT BASE_FORMULA_NAME 
			FROM FF_FORMULAS_VL 
			WHERE FORMULA_ID = ancABSENTYPEEO.EXCLUSION_FORMULA_ID
			AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND NVL(EFFECTIVE_END_DATE,TO_DATE('4712-12-31','YYYY-MM-DD')))
	END) RES_EXCLUSION_FORMULA
,(CASE
	WHEN ancABSENTYPEEO.PATTERN_CD = 'II' AND ancABSENTYPEEO.LINKAGE_RULE_CD NOT IN ('M','N') THEN
		DECODE(ancABSENTYPEEO.LINKAGE_REASON_CD,'Y','Yes','No') 
	END) RES_EVALUATE_REASON_IN_LINKAGE
,(CASE
	WHEN ancABSENTYPEEO.PATTERN_CD = 'II' AND ancABSENTYPEEO.LINKAGE_RULE_CD NOT IN ('M','N') THEN
		(SELECT MEANING 
			FROM FND_LOOKUP_VALUES 
			WHERE LANGUAGE = USERENV('LANG')
			AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))
			AND LOOKUP_TYPE = 'ORA_ANC_LINKAGE_START_RULE' 
			AND LOOKUP_CODE = ancABSENTYPEEO.LINKAGE_START_RULE_CD)
	END) RES_LINKAGE_PERIOD_START_RULE
,(CASE
	WHEN ancABSENTYPEEO.PATTERN_CD = 'II' AND ancABSENTYPEEO.LINKAGE_RULE_CD NOT IN ('M','N') THEN
		ancABSENTYPEEO.LINKAGE_DURATION
	END) RES_LINKAGE_PERIOD
,(CASE
	WHEN ancABSENTYPEEO.PATTERN_CD = 'II' AND ancABSENTYPEEO.LINKAGE_RULE_CD NOT IN ('M','N') THEN
		(SELECT MEANING 
			FROM FND_LOOKUP_VALUES 
			WHERE LANGUAGE = USERENV('LANG')
			AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))
			AND LOOKUP_TYPE = 'ANC_SETUP_OBJ_UOM_WITHOUT_HRS' 
			AND LOOKUP_CODE = ancABSENTYPEEO.LINKAGE_UOM_CD)
	END) RES_LINKAGE_PERIOD_UOM
	
,(SELECT MEANING
	FROM FND_LOOKUP_VALUES
	WHERE LANGUAGE = USERENV('LANG')
	AND LOOKUP_TYPE = 'ORA_ANC_ATTACHMENT_TYPES_ALLOW'
	AND LOOKUP_CODE = ancABSENTYPEEO.ATTACH_TYPE 
	) RES_TYPES_ALLOWED
,DECODE(ancABSENTYPEEO.ATTACH_DURATION_FLAG,'Y','Yes','No') RES_MANDATORY_IF_ABSENCE_DURAT
,ancABSENTYPEEO.ATTACH_DURATION_PERIOD RES_PERIOD
,DECODE(ancABSENTYPEEO.ATTACH_EMP_FLAG,'Y','Yes','No') RES_MANDATORY_FOR_EMPLOYEES
,DECODE(ancABSENTYPEEO.ATTACH_MGR_FLAG,'Y','Yes','No') RES_MANDATORY_FOR_MANAGERS
,DECODE(ancABSENTYPEEO.ATTACH_ADMIN_FLAG,'Y','Yes','No') RES_MANDATORY_FOR_ADMINISTRATO

,(CASE
	WHEN ancABSENTYPEEO.PATTERN_CD = 'GENERIC' THEN
		(SELECT MEANING 
			FROM FND_LOOKUP_VALUES 
			WHERE LOOKUP_CODE = ancABSENTYPEEO.AGREEMENT_FLAG
			AND LOOKUP_TYPE = 'ORA_ANC_AGREEMENT_PRC' 
			AND LANGUAGE = USERENV('LANG')
			AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD')))
	END) RES_AGREEMENT_SELECTION


--Action Items - Reporting
,DECODE(ancABSENTYPEEO.OTBI_DLY_BREAKDOWN,'Y','Yes','No') RES_INCLUDE_IN_DAILY_REPORT_BR
,DECODE(TO_CHAR(ancABSENTYPEEO.EFFECTIVE_END_DATE ,'DD-MM-YYYY'),'31-12-4712',NULL,TO_CHAR(ancABSENTYPEEO.EFFECTIVE_END_DATE ,'DD-Mon-YYYY')) RES_EFFECTIVE_END_DATE


,ancABSENTYPEEO.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,ancABSENTYPEEO.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,ancABSENTYPEEO.CREATED_BY RSC_CREATED_BY
,ancABSENTYPEEO.CREATION_DATE RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,NULL RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,ancABSENTYPEEO.LEGISLATION_CODE RSC_COUNTRY_ID

FROM ANC_ABSENCE_TYPES_VL ancABSENTYPEEO
ORDER BY ancABSENTYPEEO.NAME
,ancABSENTYPEEO.EFFECTIVE_START_DATE