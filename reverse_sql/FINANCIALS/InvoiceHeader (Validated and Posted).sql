/* ****************************************************************************
* $Revision: 56739 $:
* $Author: pisan.jariyasettachok $:
* $Date: 2016-07-20 09:09:10 +0700 (Wed, 20 Jul 2016) $:
* $HeadURL: http://svn01.rapidesuite.com:999/svn/a/dev/rapidesuite/controldata/FUSION_11.1.9/trunk/core/reverse_sql/FINANCIALS/Manage%20Fixed%20Assets%20Key%20Flexfields%20-%20Segment%20Instance.sql $:
* $Id: Manage Fixed Assets Key Flexfields - Segment Instance.sql 56739 2016-07-20 02:09:10Z pisan.jariyasettachok $:
* ****************************************************************************
* Description:
* ************************************************************************** */

-- RSC_PREREQUISITE_OBJECTS=AP_INVOICES_PKG
-- FIELD_TO_APPLY_FUNCTION=RES_LIABILITY_COMBINATION/GET_CODE_COMBINATION
-- STRICTLY_BATCH_SEQ = RES_INVOICE_ID

SELECT InvoicesE0.INVOICE_ID RES_INVOICE_ID
,(SELECT BU_NAME
	FROM FUN_ALL_BUSINESS_UNITS_V
	WHERE BU_ID = InvoicesE0.ORG_ID
	) RES_BUSINESS_UNIT 
,InvoicesE0.SOURCE RES_SOURCE
,InvoicesE0.INVOICE_NUM RES_INVOICE_NUMBER
,InvoicesE0.INVOICE_AMOUNT RES_INVOICE_AMOUNT
,TO_CHAR(InvoicesE0.INVOICE_DATE,'YYYY/MM/DD') RES_INVOICE_DATE
,(SELECT PARTY_NAME
	FROM HZ_PARTIES parties
	,POZ_SUPPLIERS Supplier
	WHERE Supplier.PARTY_ID = parties.PARTY_ID
	AND Supplier.VENDOR_ID = InvoicesE0.VENDOR_ID 
	) RES_SUPPLIER_NAME
,(SELECT SEGMENT1
	FROM POZ_SUPPLIERS
	WHERE VENDOR_ID = InvoicesE0.VENDOR_ID 
	) RES_SUPPLIER_NUMBER
,(SELECT VENDOR_SITE_CODE
	FROM POZ_SUPPLIER_SITES_ALL_M
	WHERE VENDOR_SITE_ID = InvoicesE0.VENDOR_SITE_ID
	) RES_SUPPLIER_SITE
,InvoicesE0.INVOICE_CURRENCY_CODE RES_INVOICE_CURRENCY
,InvoicesE0.PAYMENT_CURRENCY_CODE RES_PAYMENT_CURRENCY
,REGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(InvoicesE0.DESCRIPTION,chr(13),' '),chr(10),' '), '&', '#AMP#'), '<', '#OPENTAG#'), '>', '#CLOSETAG#') RES_DESCRIPTION
,'' RES_IMPORT_SET
,InvoicesE0.INVOICE_TYPE_LOOKUP_CODE RES_INVOICE_TYPE
,(SELECT NAME
	FROM XLE_ENTITY_PROFILES
	WHERE LEGAL_ENTITY_ID = InvoicesE0.LEGAL_ENTITY_ID
	) RES_LEGAL_ENTITY
,InvoicesE0.CUST_REGISTRATION_NUMBER RES_CUSTOMER_TAX_REGISTRATION_
,InvoicesE0.CUST_REGISTRATION_CODE RES_CUSTOMER_REGISTRATION_CODE
,(SELECT REGISTRATION_NUMBER
	FROM ZX_REGISTRATIONS
	WHERE REGISTRATION_ID = InvoicesE0.FIRST_PARTY_REGISTRATION_ID
	) RES_FIRST_PARTY_TAX_REGISTRATI
,(SELECT REGISTRATION_NUMBER
	FROM ZX_REGISTRATIONS
	WHERE REGISTRATION_ID = InvoicesE0.THIRD_PARTY_REGISTRATION_ID
	) RES_SUPPLIER_TAX_REGISTRATION_ 
,(SELECT NAME 
	FROM AP_TERMS_TL
	WHERE LANGUAGE = USERENV('LANG')
	AND TERM_ID = InvoicesE0.TERMS_ID
	) RES_PAYMENT_TERMS
,TO_CHAR(InvoicesE0.TERMS_DATE,'YYYY/MM/DD') RES_TERMS_DATE
,TO_CHAR(InvoicesE0.GOODS_RECEIVED_DATE,'YYYY/MM/DD') RES_GOODS_RECEIVED_DATE
,TO_CHAR(InvoicesE0.INVOICE_RECEIVED_DATE,'YYYY/MM/DD') RES_INVOICE_RECEIVED_DATE
,TO_CHAR(InvoicesE0.GL_DATE,'YYYY/MM/DD') RES_ACCOUNTING_DATE
,InvoicesE0.PAYMENT_METHOD_CODE RES_PAYMENT_METHOD
,InvoicesE0.PAY_GROUP_LOOKUP_CODE RES_PAY_GROUP
,InvoicesE0.EXCLUSIVE_PAYMENT_FLAG RES_PAY_ALONE
,InvoicesE0.DISCOUNT_AMOUNT_TAKEN RES_DISCOUNTABLE_AMOUNT
,'' RES_PREPAYMENT_NUMBER
,'' RES_PREPAYMENT_LINE_NUMBER
,'' RES_PREPAYMENT_APPLICATION_AMO
,'' RES_PREPAYMENT_ACCOUNTING_DATE
,'' RES_INVOICE_INCLUDES_PREPAYMEN
,InvoicesE0.EXCHANGE_RATE_TYPE RES_CONVERSION_RATE_TYPE
,TO_CHAR(InvoicesE0.EXCHANGE_DATE,'YYYY/MM/DD') RES_CONVERSION_DATE
,InvoicesE0.EXCHANGE_RATE RES_CONVERSION_RATE
,InvoicesE0.ACCTS_PAY_CODE_COMBINATION_ID RES_LIABILITY_COMBINATION
,InvoicesE0.DOC_CATEGORY_CODE RES_DOCUMENT_CATEGORY_CODE
,InvoicesE0.VOUCHER_NUM RES_VOUCHER_NUMBER
,(SELECT FIRST_NAME
	FROM PER_PERSON_NAMES_F
	WHERE SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
	AND PERSON_ID = InvoicesE0.REQUEST_ID
	) RES_REQUESTER_FIRST_NAME
,(SELECT LAST_NAME
	FROM PER_PERSON_NAMES_F
	WHERE SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
	AND PERSON_ID = InvoicesE0.REQUEST_ID
	) RES_REQUESTER_LAST_NAME
,(SELECT PERSON_NUMBER
	FROM PER_ALL_PEOPLE_F
	WHERE PERSON_ID = InvoicesE0.REQUEST_ID
	AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
	) RES_REQUESTER_EMPLOYEE_NUMBER
,InvoicesE0.DELIVERY_CHANNEL_CODE RES_DELIVERY_CHANNEL_CODE
,InvoicesE0.BANK_CHARGE_BEARER RES_BANK_CHARGE_BEARER
,InvoicesE0.REMIT_TO_SUPPLIER_NAME RES_REMIT_TO_SUPPLIER
,(SELECT SEGMENT1
	FROM POZ_SUPPLIERS
	WHERE VENDOR_ID = InvoicesE0.REMIT_TO_SUPPLIER_ID
	) RES_REMIT_TO_SUPPLIER_NUMBER 
,InvoicesE0.REMIT_TO_ADDRESS_NAME RES_REMIT_TO_ADDRESS_NAME
,InvoicesE0.SETTLEMENT_PRIORITY RES_PAYMENT_PRIORITY
,InvoicesE0.SETTLEMENT_PRIORITY RES_SETTLEMENT_PRIORITY
,InvoicesE0.UNIQUE_REMITTANCE_IDENTIFIER RES_UNIQUE_REMITTANCE_IDENTIFI
,InvoicesE0.URI_CHECK_DIGIT RES_UNIQUE_REMITTANCE_IDENTI_0
,InvoicesE0.PAYMENT_REASON_CODE RES_PAYMENT_REASON_CODE
,InvoicesE0.PAYMENT_REASON_COMMENTS RES_PAYMENT_REASON_COMMENTS
,InvoicesE0.REMITTANCE_MESSAGE1 RES_REMITTANCE_MESSAGE_1
,InvoicesE0.REMITTANCE_MESSAGE2 RES_REMITTANCE_MESSAGE_2
,InvoicesE0.REMITTANCE_MESSAGE3 RES_REMITTANCE_MESSAGE_3
,(SELECT CONDITION_GROUP_NAME
	FROM ZX_CONDITION_GROUPS_TL
	WHERE LANGUAGE = USERENV('LANG')
	AND CONDITION_GROUP_ID = InvoicesE0.AWT_GROUP_ID
	) RES_WITHHOLDING_TAX_GROUP
,'' RES_SHIP_TO_LOCATION
,InvoicesE0.TAXATION_COUNTRY RES_TAXATION_COUNTRY
,InvoicesE0.DOCUMENT_SUB_TYPE RES_DOCUMENT_SUB_TYPE
,InvoicesE0.TAX_INVOICE_INTERNAL_SEQ RES_TAX_INVOICE_INTERNAL_SEQUE
,InvoicesE0.SUPPLIER_TAX_INVOICE_NUMBER RES_SUPPLIER_TAX_INVOICE_NUMBE
,TO_CHAR(InvoicesE0.TAX_INVOICE_RECORDING_DATE,'YYYY/MM/DD') RES_TAX_INVOICE_RECORDING_DATE
,TO_CHAR(InvoicesE0.SUPPLIER_TAX_INVOICE_DATE,'YYYY/MM/DD') RES_SUPPLIER_TAX_INVOICE_DATE
,InvoicesE0.SUPPLIER_TAX_EXCHANGE_RATE RES_SUPPLIER_TAX_INVOICE_CONVE
,InvoicesE0.PORT_OF_ENTRY_CODE RES_PORT_OF_ENTRY_CODE
,InvoicesE0.CORRECTION_YEAR RES_CORRECTION_YEAR
,InvoicesE0.CORRECTION_PERIOD RES_CORRECTION_PERIOD
,InvoicesE0.IMPORT_DOCUMENT_NUMBER RES_IMPORT_DOCUMENT_NUMBER
,TO_CHAR(InvoicesE0.IMPORT_DOCUMENT_DATE,'YYYY/MM/DD') RES_IMPORT_DOCUMENT_DATE
,InvoicesE0.CONTROL_AMOUNT RES_TAX_CONTROL_AMOUNT
,'' RES_CALCULATE_TAX_DURING_IMPOR
,'' RES_ADD_TAX_TO_INVOICE_AMOUNT
,InvoicesE0.ATTRIBUTE_CATEGORY RES_ATTRIBUTE_CATEGORY
,InvoicesE0.ATTRIBUTE1 RES_ATTRIBUTE_1
,InvoicesE0.ATTRIBUTE2 RES_ATTRIBUTE_2
,InvoicesE0.ATTRIBUTE3 RES_ATTRIBUTE_3
,InvoicesE0.ATTRIBUTE4 RES_ATTRIBUTE_4
,InvoicesE0.ATTRIBUTE5 RES_ATTRIBUTE_5
,InvoicesE0.ATTRIBUTE6 RES_ATTRIBUTE_6
,InvoicesE0.ATTRIBUTE7 RES_ATTRIBUTE_7
,InvoicesE0.ATTRIBUTE8 RES_ATTRIBUTE_8
,InvoicesE0.ATTRIBUTE9 RES_ATTRIBUTE_9
,InvoicesE0.ATTRIBUTE10 RES_ATTRIBUTE_10
,InvoicesE0.ATTRIBUTE11 RES_ATTRIBUTE_11
,InvoicesE0.ATTRIBUTE12 RES_ATTRIBUTE_12
,InvoicesE0.ATTRIBUTE13 RES_ATTRIBUTE_13
,InvoicesE0.ATTRIBUTE14 RES_ATTRIBUTE_14
,InvoicesE0.ATTRIBUTE15 RES_ATTRIBUTE_15
,InvoicesE0.ATTRIBUTE_NUMBER1 RES_ATTRIBUTE_NUMBER_1
,InvoicesE0.ATTRIBUTE_NUMBER2 RES_ATTRIBUTE_NUMBER_2
,InvoicesE0.ATTRIBUTE_NUMBER3 RES_ATTRIBUTE_NUMBER_3
,InvoicesE0.ATTRIBUTE_NUMBER4 RES_ATTRIBUTE_NUMBER_4
,InvoicesE0.ATTRIBUTE_NUMBER5 RES_ATTRIBUTE_NUMBER_5
,InvoicesE0.ATTRIBUTE_DATE1 RES_ATTRIBUTE_DATE_1
,InvoicesE0.ATTRIBUTE_DATE2 RES_ATTRIBUTE_DATE_2
,InvoicesE0.ATTRIBUTE_DATE3 RES_ATTRIBUTE_DATE_3
,InvoicesE0.ATTRIBUTE_DATE4 RES_ATTRIBUTE_DATE_4
,InvoicesE0.ATTRIBUTE_DATE5 RES_ATTRIBUTE_DATE_5
,InvoicesE0.GLOBAL_ATTRIBUTE_CATEGORY RES_GLOBAL_ATTRIBUTE_CATEGORY
,InvoicesE0.GLOBAL_ATTRIBUTE1 RES_GLOBAL_ATTRIBUTE_1
,InvoicesE0.GLOBAL_ATTRIBUTE2 RES_GLOBAL_ATTRIBUTE_2
,InvoicesE0.GLOBAL_ATTRIBUTE3 RES_GLOBAL_ATTRIBUTE_3
,InvoicesE0.GLOBAL_ATTRIBUTE4 RES_GLOBAL_ATTRIBUTE_4
,InvoicesE0.GLOBAL_ATTRIBUTE5 RES_GLOBAL_ATTRIBUTE_5
,InvoicesE0.GLOBAL_ATTRIBUTE6 RES_GLOBAL_ATTRIBUTE_6
,InvoicesE0.GLOBAL_ATTRIBUTE7 RES_GLOBAL_ATTRIBUTE_7
,InvoicesE0.GLOBAL_ATTRIBUTE8 RES_GLOBAL_ATTRIBUTE_8
,InvoicesE0.GLOBAL_ATTRIBUTE9 RES_GLOBAL_ATTRIBUTE_9
,InvoicesE0.GLOBAL_ATTRIBUTE10 RES_GLOBAL_ATTRIBUTE_10
,InvoicesE0.GLOBAL_ATTRIBUTE11 RES_GLOBAL_ATTRIBUTE_11
,InvoicesE0.GLOBAL_ATTRIBUTE12 RES_GLOBAL_ATTRIBUTE_12
,InvoicesE0.GLOBAL_ATTRIBUTE13 RES_GLOBAL_ATTRIBUTE_13
,InvoicesE0.GLOBAL_ATTRIBUTE14 RES_GLOBAL_ATTRIBUTE_14
,InvoicesE0.GLOBAL_ATTRIBUTE15 RES_GLOBAL_ATTRIBUTE_15
,InvoicesE0.GLOBAL_ATTRIBUTE16 RES_GLOBAL_ATTRIBUTE_16
,InvoicesE0.GLOBAL_ATTRIBUTE17 RES_GLOBAL_ATTRIBUTE_17
,InvoicesE0.GLOBAL_ATTRIBUTE18 RES_GLOBAL_ATTRIBUTE_18
,InvoicesE0.GLOBAL_ATTRIBUTE19 RES_GLOBAL_ATTRIBUTE_19
,InvoicesE0.GLOBAL_ATTRIBUTE20 RES_GLOBAL_ATTRIBUTE_20
,InvoicesE0.GLOBAL_ATTRIBUTE_NUMBER1 RES_GLOBAL_ATTRIBUTE_NUMBER_1
,InvoicesE0.GLOBAL_ATTRIBUTE_NUMBER2 RES_GLOBAL_ATTRIBUTE_NUMBER_2
,InvoicesE0.GLOBAL_ATTRIBUTE_NUMBER3 RES_GLOBAL_ATTRIBUTE_NUMBER_3
,InvoicesE0.GLOBAL_ATTRIBUTE_NUMBER4 RES_GLOBAL_ATTRIBUTE_NUMBER_4
,InvoicesE0.GLOBAL_ATTRIBUTE_NUMBER5 RES_GLOBAL_ATTRIBUTE_NUMBER_5
,InvoicesE0.GLOBAL_ATTRIBUTE_DATE1 RES_GLOBAL_ATTRIBUTE_DATE_1
,InvoicesE0.GLOBAL_ATTRIBUTE_DATE2 RES_GLOBAL_ATTRIBUTE_DATE_2
,InvoicesE0.GLOBAL_ATTRIBUTE_DATE3 RES_GLOBAL_ATTRIBUTE_DATE_3
,InvoicesE0.GLOBAL_ATTRIBUTE_DATE4 RES_GLOBAL_ATTRIBUTE_DATE_4
,InvoicesE0.GLOBAL_ATTRIBUTE_DATE5 RES_GLOBAL_ATTRIBUTE_DATE_5
,InvoicesE0.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,InvoicesE0.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,InvoicesE0.CREATED_BY RSC_CREATED_BY
,InvoicesE0.CREATION_DATE RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,InvoicesE0.ORG_ID RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID
FROM AP_INVOICES_ALL InvoicesE0
WHERE InvoicesE0.PAYMENT_STATUS_FLAG != 'Y' 
AND (InvoicesE0.VENDOR_ID != -10016) -- Remove Employee type
AND EXISTS (SELECT 1 FROM AP_PAYMENT_SCHEDULES_ALL
	WHERE INVOICE_ID = InvoicesE0.INVOICE_ID
	AND NVL(AMOUNT_REMAINING,0) != 0)
AND AP_INVOICES_PKG.GET_POSTING_STATUS(InvoicesE0.INVOICE_ID) != 'N'