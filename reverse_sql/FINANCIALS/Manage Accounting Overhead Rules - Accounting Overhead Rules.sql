/* ****************************************************************************
* $Revision: 78229 $:
* $Author: pisan.jariyasettachok $:
* $Date: 2022-04-07 14:37:05 +0700 (Thu, 07 Apr 2022) $:
* $HeadURL: https://svn03.rapid4cloud.com/svn/a/dev/rapidesuite/controldata/FUSION_11.1.13/trunk/core/reverse_sql/FINANCIALS/Manage%20Accounting%20Overhead%20Rules%20-%20Accounting%20Overhead%20Rules.sql $:
* $Id: Manage Accounting Overhead Rules - Accounting Overhead Rules$:
* ****************************************************************************
* Description:
* ************************************************************************** */

-- RSC_PREREQUISITE_OBJECTS=CST_OVERHEAD_RULES

select Head.RULE_CODE RES_RULE_NAME
,CostOrgEO.COST_ORG_NAME RES_COST_ORGANIZATION
,(select COST_BOOK_CODE
	FROM CST_COST_BOOKS_VL CostBookEO
	where CostBookEO.COST_BOOK_ID =  Head.COST_BOOK_ID     
	) RES_COST_BOOK
,(SELECT EXPENSE_POOL_CODE
	FROM CST_EXPENSE_POOLS_VL
	WHERE EXPENSE_POOL_ID =  Head.EXPENSE_POOL_ID 
	) RES_EXPENSE_POOL
,(select COST_ELEMENT_CODE
	from CST_COST_ELEMENTS_VL CostElementsE0
	where CostElementsE0.COST_ELEMENT_ID = Head.COST_ELEMENT_ID
	) RES_COST_ELEMENT
,(SELECT MEANING
	FROM FND_LOOKUPS
	WHERE LOOKUP_TYPE = 'CST_TRANSACTION_GROUPS'
	AND LOOKUP_CODE =  Head.TRANSACTION_GROUP_ID 
	) RES_TRANSACTION_GROUP
,(CASE
	WHEN (Head.TRANSACTION_GROUP_ID = 5 AND Head.ABSORPTION_TYPE NOT IN (1))  THEN
		(SELECT BASE_TXN_TYPE_NAME
			FROM CST_INTERNAL_TXN_TYPES_VL
			WHERE BASE_TXN_TYPE_ID =  Head.TRANSACTION_TYPE_ID)
	ELSE
		(select distinct z.TRANSACTION_TYPE_NAME 
			from INV_TRANSACTION_TYPES z
			where z.TRANSACTION_TYPE_ID =  Head.TRANSACTION_TYPE_ID)
	END) RES_TRANSACTION_TYPE
,(select  LookupPEO.MEANING
	FROM FND_LOOKUPS LookupPEO
	WHERE LookupPEO.LOOKUP_TYPE = 'CST_QUANTITY_FLOW'
	and LookupPEO.LOOKUP_CODE = Head.TRANSACTION_FLOW     
	) RES_TRANSACTION_FLOW
,( select ORGANIZATION_NAME
	from INV_ORGANIZATION_DEFINITIONS_V
	where ORGANIZATION_ID = Head.INVENTORY_ORG_ID 
	) RES_INVENTORY_ORGANIZATION
,(select  distinct CST_CATEGORY_NAME
	from CST_XLA_CST_CATEGORIES_V
	where CST_CATEGORY_ID =  Head.CATEGORY_ID 
	) RES_CATEGORY_NAME
,( select ItemVL.ITEM_NUMBER
	from EGP_SYSTEM_ITEMS_VL ItemVL
	where  ItemVL.INVENTORY_ITEM_ID  = Head.INVENTORY_ITEM_ID  
	AND ItemVL.ORGANIZATION_ID =  Head.INVENTORY_ORG_ID
	) RES_ITEM
,(select  LookupPEO.MEANING
	FROM FND_LOOKUPS LookupPEO
	WHERE LookupPEO.LOOKUP_TYPE = 'CST_COST_DRIVER'
	and LookupPEO.LOOKUP_CODE = Head.COST_DRIVER 
	) RES_COST_BASIS
,(select distinct GROUP_CODE
	from CST_COST_ELEMENT_GRPS_VL
	where GROUP_ID  = head.COST_DRIVER_VALUE    
	) RES_BASED_ON
,(SELECT MEANING
	FROM FND_LOOKUPS
	WHERE LOOKUP_TYPE = 'CST_ABSORPTION_TYPE'
	AND LOOKUP_CODE =  Head.ABSORPTION_TYPE      
	) RES_ABSORPTION_TYPE
,(CASE
	/* Cannot decode this column due to value to decode is not allow in BIP*/
	WHEN Head.POSTED_FLAG = 'U' THEN
		(SELECT MEANING 
			FROM FND_LOOKUP_VALUES 
			WHERE LANGUAGE = USERENV('LANG')
			AND LOOKUP_TYPE = 'ANC_TYPE_RULE_ACTION' 
			AND LOOKUP_CODE = 'U')
	WHEN Head.POSTED_FLAG = 'P' THEN
		(SELECT MEANING 
			FROM FND_LOOKUP_VALUES 
			WHERE LANGUAGE = USERENV('LANG')
			AND LOOKUP_TYPE = 'CST_OVRUL_STATUS' 
			AND LOOKUP_CODE = 'Y')
	WHEN Head.POSTED_FLAG = 'C' THEN
		(SELECT MEANING 
			FROM FND_LOOKUP_VALUES 
			WHERE LANGUAGE = USERENV('LANG')
			AND LOOKUP_TYPE = 'DOO_PC_OPERATION' 
			AND LOOKUP_CODE = 'C')
	END) RES_STATUS
,Head.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,Head.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,Head.CREATED_BY RSC_CREATED_BY
,Head.CREATION_DATE RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,NULL RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM CST_OVERHEAD_RULES Head
,CST_COST_ORGS_V CostOrgEO
WHERE Head.COST_ORGANIZATION_ID = CostOrgEO.COST_ORG_ID(+)
Order by RES_RULE_NAME