/* ****************************************************************************
* $Revision: 78229 $:
* $Author: pisan.jariyasettachok $:
* $Date: 2022-04-07 14:37:05 +0700 (Thu, 07 Apr 2022) $:
* $HeadURL: https://svn03.rapid4cloud.com/svn/a/dev/rapidesuite/controldata/FUSION_11.1.13/trunk/core/reverse_sql/FINANCIALS/Manage%20Departments%20-%20Department%20Details.sql $:
* $Id: Manage Departments - Department Details.sql 78229 2022-04-07 07:37:05Z pisan.jariyasettachok $:
* ****************************************************************************
* Description:
* ************************************************************************** */


SELECT (
		CASE
		WHEN EXISTS
			(SELECT NULL
			FROM HR_ORG_UNIT_CLASSIFICATIONS_F OrgUnitClassificationDEO2
			WHERE OrgUnitClassificationDEO2.CLASSIFICATION_CODE != 'DEPARTMENT'
			--WHERE OrgUnitClassificationDEO2.CLASSIFICATION_CODE IN ('ENTERPRISE','HCM_DIVISION')
			AND OrganizationUnitDEO.ORGANIZATION_ID              = OrgUnitClassificationDEO2.ORGANIZATION_ID
			AND EXISTS
				(SELECT NULL
				FROM HR_ORG_UNIT_CLASSIFICATIONS_F OrgUnitClassificationDEO3
				WHERE OrgUnitClassificationDEO3.CLASSIFICATION_CODE = 'DEPARTMENT'
				AND OrgUnitClassificationDEO2.ORGANIZATION_ID       = OrgUnitClassificationDEO3.ORGANIZATION_ID
				AND OrgUnitClassificationDEO3.creation_date         > orgUnitClassificationDEO2.creation_date
				)
			)
		THEN 'Select an existing organization to define as a'
		ELSE 'Create new'
	END)                                                             AS RES_CREATE_BY
,TO_CHAR(OrganizationUnitDEO.EFFECTIVE_START_DATE,'DD-Mon-YYYY') AS RES_EFFECTIVE_START_DATE
, SetIdSetPEO.SET_NAME                                            AS RES_DEPARTMENT_SET
,(SELECT NAME 
	FROM HR_ORGANIZATION_UNITS_F_TL
	WHERE OrganizationUnitDEO.ORGANIZATION_ID      = ORGANIZATION_ID
	AND Language   = sys_context('USERENV','LANG')
	AND OrganizationUnitDEO.EFFECTIVE_START_DATE = EFFECTIVE_START_DATE
	AND OrganizationUnitDEO.EFFECTIVE_END_DATE   = EFFECTIVE_END_DATE) RES_NAME
,(
	CASE
		WHEN EXISTS
			(SELECT NULL
			FROM HR_ORG_UNIT_CLASSIFICATIONS_F OrgUnitClassificationDEO2
			WHERE OrgUnitClassificationDEO2.CLASSIFICATION_CODE != 'DEPARTMENT'
			AND OrganizationUnitDEO.ORGANIZATION_ID              = OrgUnitClassificationDEO2.ORGANIZATION_ID
			AND EXISTS
				(SELECT NULL
				FROM HR_ORG_UNIT_CLASSIFICATIONS_F OrgUnitClassificationDEO3
				WHERE OrgUnitClassificationDEO3.CLASSIFICATION_CODE = 'DEPARTMENT'
				AND OrgUnitClassificationDEO2.ORGANIZATION_ID       = OrgUnitClassificationDEO3.ORGANIZATION_ID
				AND OrgUnitClassificationDEO3.creation_date         > orgUnitClassificationDEO2.creation_date
				)
			)
		THEN
			(SELECT CLASSIFICATION_NAME
			FROM HR_ORG_UNIT_CLASSIFICATIONS_F OrgUnitClassificationDEO2
			,HR_ORG_CLASSIFICATIONS_VL OrgClassificationEO2
			WHERE OrgUnitClassificationDEO2.CLASSIFICATION_CODE != 'DEPARTMENT'
			AND OrgUnitClassificationDEO2.CLASSIFICATION_CODE    = OrgClassificationEO2.CLASSIFICATION_CODE
			AND OrganizationUnitDEO.ORGANIZATION_ID              = OrgUnitClassificationDEO2.ORGANIZATION_ID
			AND rownum                                          <= 1
			)
		ELSE NULL
	END)                         AS RES_CLASSIFICATION

, OrganizationUnitDEO.INTERNAL_ADDRESS_LINE AS RES_INTERNAL_ADDRESS_LINE
,(SELECT meaning
	FROM hr_lookups
	WHERE lookup_type = 'ACTIVE_INACTIVE'
	AND lookup_code   = OrgUnitClassificationDEO.STATUS
	)                               AS RES_STATUS
, ActionReasonsPEO.ACTION_REASON AS RES_ACTION_REASON
, LocationDPEO.LOCATION_NAME     AS RES_LOCATION_NAME
, LocationDPEO.INTERNAL_LOCATION_CODE     AS RES_LOCATION_CODE
	
,mrgInfoE0.ORG_INFORMATION1 AS RES_REPORTING_NAME
,(SELECT FULL_NAME
	FROM PER_PERSON_NAMES_F
	WHERE NAME_TYPE = 'GLOBAL'
	AND PERSON_ID   = mrgInfoE0.ORG_INFORMATION2
	AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
	) AS RES_MANAGER
,workDayInfoE0.ORG_INFORMATION1 AS RES_WORK_START_TIME
,workDayInfoE0.ORG_INFORMATION2 AS RES_WORK_END_TIME
,workDayInfoE0.ORG_INFORMATION_NUMBER1 AS RES_STANDARD_WORKING_HOURS
,(SELECT MEANING
	FROM HR_LOOKUPS
	WHERE LOOKUP_TYPE = 'FREQUENCY'
	AND lookup_code   = workDayInfoE0.ORG_INFORMATION4
	) AS RES_STANDARD_WORKING_HOURS_FRE
,(SELECT meaning
	FROM hcm_lookups
	WHERE lookup_type = 'YES_NO'
	AND lookup_code   = coperateInfoE0.ORG_INFORMATION1
	) AS RES_SPECIFIC_WORK_ACCIDENT_RAT
,OrganizationUnitDEO.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,OrganizationUnitDEO.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,OrganizationUnitDEO.CREATED_BY RSC_CREATED_BY
,OrganizationUnitDEO.CREATION_DATE RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,NULL RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,OrganizationUnitDEO.BUSINESS_GROUP_ID RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM HR_ALL_ORGANIZATION_UNITS_F OrganizationUnitDEO
,(SELECT * FROM HR_ORG_UNIT_CLASSIFICATIONS_F
	WHERE CLASSIFICATION_CODE = 'DEPARTMENT'
 	) OrgUnitClassificationDEO
,(SELECT ACTION_OCCURRENCE_ID
	,ORG_INFORMATION1
	,ORG_INFORMATION2
	FROM HR_ORGANIZATION_INFORMATION_F
	WHERE ORG_INFORMATION_CONTEXT = 'PER_ORG_MANAGER_INFO'
	AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
	) mrgInfoE0
,(SELECT ACTION_OCCURRENCE_ID
	,ORG_INFORMATION1
	,ORG_INFORMATION2
	,ORG_INFORMATION4
	,ORG_INFORMATION_NUMBER1
	FROM HR_ORGANIZATION_INFORMATION_F
	WHERE ORG_INFORMATION_CONTEXT = 'PER_WORK_DAY_INFO'
	) workDayInfoE0
,(SELECT ACTION_OCCURRENCE_ID
	,ORG_INFORMATION1
	FROM HR_ORGANIZATION_INFORMATION_F
	WHERE ORG_INFORMATION_CONTEXT = 'HRX_FR_DEPT_CORPORATE_INFO'
	) coperateInfoE0
, HR_LOCATIONS_ALL_F_VL LocationDPEO
, PER_ADDRESSES_F AddressDPEO
, PER_ACTION_OCCURRENCES ActionOccurrencesEO
, PER_ACTION_REASONS_VL ActionReasonsPEO
, FND_SETID_SETS_VL SetIdSetPEO
WHERE OrganizationUnitDEO.ORGANIZATION_ID    = OrgUnitClassificationDEO.ORGANIZATION_ID
AND(OrganizationUnitDEO.EFFECTIVE_START_DATE BETWEEN OrgUnitClassificationDEO.EFFECTIVE_START_DATE AND
	OrgUnitClassificationDEO.EFFECTIVE_END_DATE)
AND OrganizationUnitDEO.ACTION_OCCURRENCE_ID = mrgInfoE0.ACTION_OCCURRENCE_ID(+)
AND OrganizationUnitDEO.ACTION_OCCURRENCE_ID = workDayInfoE0.ACTION_OCCURRENCE_ID(+)
AND OrganizationUnitDEO.ACTION_OCCURRENCE_ID = coperateInfoE0.ACTION_OCCURRENCE_ID(+)
AND OrganizationUnitDEO.LOCATION_ID              = LocationDPEO.LOCATION_ID(+)
AND(OrganizationUnitDEO.ACTION_OCCURRENCE_ID     = ActionOccurrencesEO.ACTION_OCCURRENCE_ID(+)
AND ActionOccurrencesEO.ACTION_REASON_ID         = ActionReasonsPEO.ACTION_REASON_ID(+))
AND(OrganizationUnitDEO.EFFECTIVE_START_DATE BETWEEN LocationDPEO.EFFECTIVE_START_DATE(+) AND
	LocationDPEO.EFFECTIVE_END_DATE(+))
AND LocationDPEO.Address_Id = AddressDPEO.Address_Id(+)
AND(LocationDPEO.EFFECTIVE_START_DATE BETWEEN AddressDPEO.EFFECTIVE_START_DATE(+) AND AddressDPEO.EFFECTIVE_END_DATE(+)
	)
AND OrgUnitClassificationDEO.SET_ID              = SetIdSetPEO.SET_ID(+)
--AND SYSDATE BETWEEN OrganizationUnitDEO.EFFECTIVE_START_DATE AND OrganizationUnitDEO.EFFECTIVE_END_DATE
order by RES_NAME
,OrganizationUnitDEO.EFFECTIVE_START_DATE