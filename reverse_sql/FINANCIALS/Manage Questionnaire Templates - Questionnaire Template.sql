/* ****************************************************************************
 * $Revision: 78229 $:
 * $Author: pisan.jariyasettachok $:
 * $Date: 2022-04-07 14:37:05 +0700 (Thu, 07 Apr 2022) $:
 * $HeadURL: https://svn03.rapid4cloud.com/svn/a/dev/rapidesuite/controldata/FUSION_11.1.13/trunk/core/reverse_sql/FINANCIALS/Manage%20Questionnaire%20Templates%20-%20Questionnaire%20Template.sql $:
 * $Id: Manage Questionnaire Templates - Questionnaire Template.sql 78229 2022-04-07 07:37:05Z pisan.jariyasettachok $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */
 
 -- RSC_PREREQUISITE_OBJECTS=HRQ_QUESTIONNAIRES_VL
 
 WITH HRQ AS (SELECT QSTNR_TEMPLATE_ID,RESPONSE_TYPE_ID,ROW_NUMBER() OVER (PARTITION BY QSTNR_TEMPLATE_ID ORDER BY QSTNR_TMPLT_FORMAT_ID) AS ROW_NUMBER FROM HRQ_QSTNR_TMPLT_FORMATS)
 
 ,ALLOWED_RESPONSE AS (
				SELECT X1.QSTNR_TEMPLATE_ID
				,X1.RESPONSE_TYPE_ID RESPONSE_TYPE_ID1
				,X2.RESPONSE_TYPE_ID RESPONSE_TYPE_ID2
				,X3.RESPONSE_TYPE_ID RESPONSE_TYPE_ID3
				,X4.RESPONSE_TYPE_ID RESPONSE_TYPE_ID4
				,X5.RESPONSE_TYPE_ID RESPONSE_TYPE_ID5
				,X6.RESPONSE_TYPE_ID RESPONSE_TYPE_ID6
				,X7.RESPONSE_TYPE_ID RESPONSE_TYPE_ID7
				,X8.RESPONSE_TYPE_ID RESPONSE_TYPE_ID8
				,X9.RESPONSE_TYPE_ID RESPONSE_TYPE_ID9
				,X10.RESPONSE_TYPE_ID RESPONSE_TYPE_ID10				
				FROM (SELECT QSTNR_TEMPLATE_ID,RESPONSE_TYPE_ID FROM HRQ WHERE ROW_NUMBER = 1) X1
				,(SELECT QSTNR_TEMPLATE_ID,RESPONSE_TYPE_ID FROM HRQ WHERE ROW_NUMBER = 2) X2
				,(SELECT QSTNR_TEMPLATE_ID,RESPONSE_TYPE_ID FROM HRQ WHERE ROW_NUMBER = 3) X3
				,(SELECT QSTNR_TEMPLATE_ID,RESPONSE_TYPE_ID FROM HRQ WHERE ROW_NUMBER = 4) X4
				,(SELECT QSTNR_TEMPLATE_ID,RESPONSE_TYPE_ID FROM HRQ WHERE ROW_NUMBER = 5) X5
				,(SELECT QSTNR_TEMPLATE_ID,RESPONSE_TYPE_ID FROM HRQ WHERE ROW_NUMBER = 6) X6
				,(SELECT QSTNR_TEMPLATE_ID,RESPONSE_TYPE_ID FROM HRQ WHERE ROW_NUMBER = 7) X7
				,(SELECT QSTNR_TEMPLATE_ID,RESPONSE_TYPE_ID FROM HRQ WHERE ROW_NUMBER = 8) X8
				,(SELECT QSTNR_TEMPLATE_ID,RESPONSE_TYPE_ID FROM HRQ WHERE ROW_NUMBER = 9) X9
				,(SELECT QSTNR_TEMPLATE_ID,RESPONSE_TYPE_ID FROM HRQ WHERE ROW_NUMBER = 10) X10
				WHERE X1.QSTNR_TEMPLATE_ID = X2.QSTNR_TEMPLATE_ID(+)
				AND X1.QSTNR_TEMPLATE_ID = X3.QSTNR_TEMPLATE_ID(+)
				AND X1.QSTNR_TEMPLATE_ID = X4.QSTNR_TEMPLATE_ID(+)
				AND X1.QSTNR_TEMPLATE_ID = X5.QSTNR_TEMPLATE_ID(+)
				AND X1.QSTNR_TEMPLATE_ID = X6.QSTNR_TEMPLATE_ID(+)
				AND X1.QSTNR_TEMPLATE_ID = X7.QSTNR_TEMPLATE_ID(+)
				AND X1.QSTNR_TEMPLATE_ID = X8.QSTNR_TEMPLATE_ID(+)
				AND X1.QSTNR_TEMPLATE_ID = X9.QSTNR_TEMPLATE_ID(+)
				AND X1.QSTNR_TEMPLATE_ID = X10.QSTNR_TEMPLATE_ID(+)
				)
		
SELECT hrqQUESTIONAIREO.QUESTIONNAIRE_CODE RES_QUESTIONNAIRE_TEMPLATE_ID
,DECODE(hrqQUESTIONAIREO.SCORED_FLAG,'Y','Yes','No') RES_SCORE_QUESTIONNAIRE
,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE LOOKUP_CODE = hrqQUESTIONAIREO.CALC_RULE_CODE
	AND LOOKUP_TYPE = 'ORA_HRQ_QSTNR_CALC_RULE_TYPE' AND LANGUAGE = USERENV('LANG') 
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))) RES_OVERALL_SCORE_CALCULATION_
,hrqQUESTIONAIREO.NAME RES_NAME 
,(SELECT DISPLAY_NAME FROM PER_PERSON_NAMES_F WHERE PERSON_ID = hrqQUESTIONAIREO.OWNER AND NAME_TYPE = 'GLOBAL'
	AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND NVL(EFFECTIVE_END_DATE,TO_DATE('4512-12-31','YYYY-MM-DD'))) RES_OWNER
,hrqQUESTIONAIREO.DESCRIPTION RES_DESCRIPTION
,hrqSUBSCRIEO.NAME RES_SUBSCRIBER
,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE LOOKUP_CODE = hrqQUESTIONAIREO.STATUS
	AND LOOKUP_TYPE = 'HRQ_QUESTIONNAIRE_STATUS' AND LANGUAGE = USERENV('LANG') 
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))) RES_STATUS
,DECODE(hrqQUESTIONAIREO.IN_USE,'Y','Yes','No') RES_IN_USE
,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE LOOKUP_CODE = hrqQUESTIONAIREO.PRIVACY_FLAG
	AND LOOKUP_TYPE = 'HRQ_PRIVACY' AND LANGUAGE = USERENV('LANG') 
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD'))) RES_PRIVACY
,DECODE(hrqQSTNRETEMPEO.ALLOW_INTRO_CHG,'Y','Yes','No') RES_ALLOW_CHANGES_TO_INSTRUCTI
,REPLACE(REPLACE(REPLACE(hrqQUESTIONAIREO.INTRO_TEXT,'&','#AMP#'),'<','#OPENTAG#'),'>','#CLOSETAG#') RES_INSTRUCTIONS_AND_HELP_MATE
,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE LOOKUP_CODE = hrqQUESTIONAIREO.SECTION_ORDER
	AND LOOKUP_TYPE = 'HRQ_SECTION_ORDER' AND LANGUAGE = USERENV('LANG') 
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD')))  RES_SECTION_ORDER
,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE LOOKUP_CODE = hrqQUESTIONAIREO.SECTION_PRESENTATION
	AND LOOKUP_TYPE = 'HRQ_SECTION_PRESENTATION' AND LANGUAGE = USERENV('LANG') 
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD')))  RES_SECTION_PRESENTATION
,DECODE(hrqQUESTIONAIREO.PAGE_LAYOUT,'1','1 Column','2','2 Column') RES_PAGE_LAYOUT
,hrqQUESTIONAIREO.QSTNS_PER_PAGE RES_MAXIMUM_NUMBER_OF_QUESTION
,DECODE(hrqQSTNRETEMPEO.ALLOW_FORMAT_CHG,'Y','Yes','No') RES_ALLOW_CHANGES_TO_FORMAT_OP
,DECODE(hrqQSTNRETEMPEO.ALLOW_SECTION_CHG,'Y','Yes','No') RES_ALLOW_CHANGES_TO_SECTIONS
,(SELECT NAME FROM HRQ_RESPONSE_TYPES_VL WHERE RESPONSE_TYPE_ID = ALLOWED_RESPONSE.RESPONSE_TYPE_ID1) RES_ALLOWED_RESPONSE_TYPES_VAL
,(SELECT NAME FROM HRQ_RESPONSE_TYPES_VL WHERE RESPONSE_TYPE_ID = ALLOWED_RESPONSE.RESPONSE_TYPE_ID2) RES_ALLOWED_RESPONSE_TYPES_V_0
,(SELECT NAME FROM HRQ_RESPONSE_TYPES_VL WHERE RESPONSE_TYPE_ID = ALLOWED_RESPONSE.RESPONSE_TYPE_ID3) RES_ALLOWED_RESPONSE_TYPES_V_1
,(SELECT NAME FROM HRQ_RESPONSE_TYPES_VL WHERE RESPONSE_TYPE_ID = ALLOWED_RESPONSE.RESPONSE_TYPE_ID4) RES_ALLOWED_RESPONSE_TYPES_V_2
,(SELECT NAME FROM HRQ_RESPONSE_TYPES_VL WHERE RESPONSE_TYPE_ID = ALLOWED_RESPONSE.RESPONSE_TYPE_ID5) RES_ALLOWED_RESPONSE_TYPES_V_3
,(SELECT NAME FROM HRQ_RESPONSE_TYPES_VL WHERE RESPONSE_TYPE_ID = ALLOWED_RESPONSE.RESPONSE_TYPE_ID6) RES_ALLOWED_RESPONSE_TYPES_V_4
,(SELECT NAME FROM HRQ_RESPONSE_TYPES_VL WHERE RESPONSE_TYPE_ID = ALLOWED_RESPONSE.RESPONSE_TYPE_ID7) RES_ALLOWED_RESPONSE_TYPES_V_5
,(SELECT NAME FROM HRQ_RESPONSE_TYPES_VL WHERE RESPONSE_TYPE_ID = ALLOWED_RESPONSE.RESPONSE_TYPE_ID8) RES_ALLOWED_RESPONSE_TYPES_V_6
,(SELECT NAME FROM HRQ_RESPONSE_TYPES_VL WHERE RESPONSE_TYPE_ID = ALLOWED_RESPONSE.RESPONSE_TYPE_ID9) RES_ALLOWED_RESPONSE_TYPES_V_7
,(SELECT NAME FROM HRQ_RESPONSE_TYPES_VL WHERE RESPONSE_TYPE_ID = ALLOWED_RESPONSE.RESPONSE_TYPE_ID10) RES_ALLOWED_RESPONSE_TYPES_V_8


,hrqQUESTIONAIREO.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,hrqQUESTIONAIREO.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,hrqQUESTIONAIREO.CREATED_BY RSC_CREATED_BY
,hrqQUESTIONAIREO.CREATION_DATE RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,NULL RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM HRQ_QUESTIONNAIRES_VL hrqQUESTIONAIREO
,HRQ_SUBSCRIBERS_VL hrqSUBSCRIEO
,HRQ_QSTNR_TEMPLATES_VL hrqQSTNRETEMPEO
,ALLOWED_RESPONSE
WHERE hrqQUESTIONAIREO.QUESTIONNAIRE_ID = hrqQSTNRETEMPEO.QUESTIONNAIRE_ID
AND hrqQUESTIONAIREO.SUBSCRIBER_ID = hrqSUBSCRIEO.SUBSCRIBER_ID
AND hrqQUESTIONAIREO.QUESTIONNAIRE_ID = hrqQSTNRETEMPEO.QUESTIONNAIRE_ID
AND hrqQSTNRETEMPEO.QSTNR_TEMPLATE_ID = ALLOWED_RESPONSE.QSTNR_TEMPLATE_ID
ORDER BY hrqQUESTIONAIREO.QUESTIONNAIRE_CODE,hrqQUESTIONAIREO.NAME
	