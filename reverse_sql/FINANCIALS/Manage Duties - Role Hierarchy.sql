 /* ****************************************************************************
 * $Revision: 48884 $:
 * $Author: dhara.pithadiya $:
 * $Date: 2015-08-18 14:24:02 +0700 (Tue, 18 Aug 2015) $:
 * $HeadURL: http://svn01.rapidesuite.com:999/svn/a/dev/rapidesuite/controldata/FUSION_11.1.9/trunk/core/reverse_sql/FINANCIALS/Manage%20Transaction%20Types%20-%20Manage%20Transaction%20Types.sql $:
 * $Id: Manage Transaction Types - Manage Transaction Types.sql 48884 2015-08-18 07:24:02Z dhara.pithadiya $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */

-- RSC_PREREQUISITE_OBJECTS=ASE_APP_ROLE_VL

SELECT DutyRolesE0.ROLE_NAME RES_ROLE_NAME
,DutyRolesE0.CODE RES_ROLE_CODE
,(SELECT DISTINCT ROLE_NAME
	FROM ASE_ROLE_VL
	WHERE SYSDATE BETWEEN EFFECTIVE_START_DATE AND NVL(EFFECTIVE_END_DATE,TO_DATE('31-12-4712','DD-MM-YYYY'))
	AND CODE = INHERTIED_FROM_ROLE_CODE
	) RES_HIERARCHY_ROLE_NAME
,DATASEC1.INHERTIED_FROM_ROLE_CODE RES_HIERARCHY_ROLE_CODE
,(SELECT DISTINCT ROLE_NAME
	FROM ASE_ROLE_VL
	WHERE SYSDATE BETWEEN EFFECTIVE_START_DATE AND NVL(EFFECTIVE_END_DATE,TO_DATE('31-12-4712','DD-MM-YYYY'))
	AND CODE = DATASEC1.INHERITED_BY_ROLE_CODE
	) RES_INHERITED_BY_ROLE_NAME
,DATASEC1.INHERITED_BY_ROLE_CODE RES_INHERITED_BY_ROLE_CODE
-- Add decode the Created and Updated users due to this task alway update based on the sync for all record at once
,DECODE(DutyRolesE0.IS_SEEDED,'Y','SEED_DATA_FROM_APPLICATION',DutyRolesE0.LAST_UPDATED_BY)  RSC_LAST_UPDATED_BY
,DutyRolesE0.LAST_UPDATE_DATE  RSC_LAST_UPDATE_DATE
-- Add decode the Created and Updated users due to this task alway update based on the sync for all record at once
,DECODE(DutyRolesE0.IS_SEEDED,'Y','SEED_DATA_FROM_APPLICATION',DutyRolesE0.CREATED_BY)  RSC_CREATED_BY
,DutyRolesE0.CREATION_DATE  RSC_CREATION_DATE
,null RSC_LEDGER_ID
,null RSC_CHART_OF_ACCOUNTS_ID
,null RSC_BUSINESS_UNIT_ID
,null RSC_LEGAL_ENTITY_ID
,null RSC_ORGANIZATION_ID
,null RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM ASE_ROLE_VL DutyRolesE0
,(SELECT ActionsE0.ATTRIBUTE_VALUE_TEXT INHERITED_BY_ROLE_CODE
	,INHERTIED_FROM_ROLE_CODE.ATTR_VALUE INHERTIED_FROM_ROLE_CODE
	FROM ASE_STAGED_ACTION_VALUE ActionsE0
	,(SELECT ActionsE1.ATTRIBUTE_VALUE_TEXT ATTR_VALUE
		,ActionsE1.ACTION_ID
		FROM ASE_STAGED_ACTION_VALUE ActionsE1
		WHERE ActionsE1.ATTRIBUTE_NAME = 'INHERTIED_FROM_ROLE_CODE'
		AND ActionsE1.ATTRIBUTE_TYPE = 'java.lang.String'
		) INHERTIED_FROM_ROLE_CODE
	WHERE ActionsE0.ACTION_ID IN (SELECT ACTION_ID FROM ASE_STAGED_ACTION WHERE ACTION_TYPE = 'ROLE_ROLE_MEMBERSHIP' AND ACTION_NAME NOT LIKE 'D%')
	AND ActionsE0.ATTRIBUTE_NAME = 'INHERITED_BY_ROLE_CODE'
	AND ActionsE0.ATTRIBUTE_TYPE = 'java.lang.String'
	AND ActionsE0.ACTION_ID = INHERTIED_FROM_ROLE_CODE.ACTION_ID
	) DATASEC1
WHERE DutyRolesE0.CODE = DATASEC1.INHERITED_BY_ROLE_CODE
AND SYSDATE BETWEEN DutyRolesE0.EFFECTIVE_START_DATE AND NVL(DutyRolesE0.EFFECTIVE_END_DATE,TO_DATE('31-12-4712','DD-MM-YYYY'))
ORDER BY DutyRolesE0.ROLE_NAME