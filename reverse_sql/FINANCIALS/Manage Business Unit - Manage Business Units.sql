/* ****************************************************************************
 * $Revision: 78229 $:
 * $Author: pisan.jariyasettachok $:
 * $Date: 2022-04-07 14:37:05 +0700 (Thu, 07 Apr 2022) $:
 * $HeadURL: https://svn03.rapid4cloud.com/svn/a/dev/rapidesuite/controldata/FUSION_11.1.13/trunk/core/reverse_sql/FINANCIALS/Manage%20Business%20Unit%20-%20Manage%20Business%20Units.sql $:
 * $Id: Manage Business Unit - Manage Business Units.sql 78229 2022-04-07 07:37:05Z pisan.jariyasettachok $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */
 

select QRSLT.name RES_NAME,
QRSLT.LOCATION_NAME RES_LOCATION_NAME,
QRSLT.LOCATION_CODE RES_LOCATION_CODE,
QRSLT.LIST_NAME RES_MANAGER_NAME,
PEOPLE.EMAIL_ADDRESS RES_MANAGER_E_MAIL,
QRSLT.SET_CODE RES_DEFAULT_SET,
DECODE(QRSLT.STATUS,'A','Yes','No') RES_ACTIVE
,QRSLT.LAST_UPDATED_BY  RSC_LAST_UPDATED_BY
,QRSLT.LAST_UPDATE_DATE  RSC_LAST_UPDATE_DATE
,QRSLT.CREATED_BY  RSC_CREATED_BY
,QRSLT.CREATION_DATE  RSC_CREATION_DATE
,null RSC_LEDGER_ID
,null RSC_CHART_OF_ACCOUNTS_ID
,QRSLT.ORGANIZATION_ID RSC_BUSINESS_UNIT_ID
,QRSLT.LEGAL_ENTITY_ID RSC_LEGAL_ENTITY_ID
,null RSC_ORGANIZATION_ID
,QRSLT.BUSINESS_GROUP_ID RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

from  (
SELECT  
  BusinessUnitEO.ORGANIZATION_ID,
  BusinessUnitEO.BUSINESS_GROUP_ID,
  BusinessUnitEO.NAME,
  BusinessUnitEO.LOCATION_ID,
  LocationDPEO.LOCATION_NAME,
  LocationDPEO.INTERNAL_LOCATION_CODE LOCATION_CODE,
  LocationDPEO.DESCRIPTION,
  BusinessUnitDetailEO.ORG_INFORMATION1,
  PersonNameDPEO.LIST_NAME,
  BusinessUnitDetailEO.ORG_INFORMATION5,
  BusinessUnitEO.STATUS,
  BusinessUnitDetailEO.ORG_INFORMATION2,
  XleEntityProfiles.NAME AS NAME1,
  BusinessUnitDetailEO.ORG_INFORMATION3,
  GlLedgers.NAME AS NAME2,
  BusinessUnitDetailEO.ORG_INFORMATION4,
  SetIdSetPEO.SET_CODE,
  SetIdSetPEO.SET_NAME,
  BusinessUnitDetailEO.ORG_INFORMATION6,
  BusinessUnitDetailEO.ORG_INFORMATION7,
  FinancialsBusinessUnitPEO.SHORT_CODE AS SHORT_CODE1,
  FinancialsBusinessUnitPEO.BU_NAME    AS NAME3,
  BusinessUnitDetailEO.ORG_INFORMATION8,
  BusinessUnitDetailEO.ORG_INFORMATION9,
  BusinessUnitEO.LAST_UPDATED_BY,
  BusinessUnitEO.LAST_UPDATE_DATE,
  BusinessUnitEO.LAST_UPDATE_LOGIN,
  BusinessUnitEO.CREATED_BY,
  BusinessUnitEO.CREATION_DATE,
  BusinessUnitEO.CLASSIFICATION_CODE,
  BusinessUnitEO.EFFECTIVE_START_DATE,
  BusinessUnitEO.EFFECTIVE_END_DATE,
  BusinessUnitEO.LEGAL_ENTITY_ID,
  BusinessUnitDetailEO.ORG_INFORMATION_ID,
  BusinessUnitDetailEO.EFFECTIVE_START_DATE AS EFFECTIVE_START_DATE1,
  BusinessUnitDetailEO.EFFECTIVE_END_DATE   AS EFFECTIVE_END_DATE1,
  BusinessUnitDetailEO.ORG_INFORMATION_CONTEXT,
  BusinessUnitDetailEO.OBJECT_VERSION_NUMBER,
  BusinessUnitDetailEO.ORGANIZATION_ID     AS ORGANIZATION_ID1,
  BusinessUnitDetailEO.CLASSIFICATION_CODE AS CLASSIFICATION_CODE1,
  BusinessUnitEO.OBJECT_VERSION_NUMBER     AS OBJECT_VERSION_NUMBER1,
  XleEntityProfiles.LEGAL_ENTITY_ID        AS LEGAL_ENTITY_ID1,
  XleEntityProfiles.OBJECT_VERSION_NUMBER  AS OBJECT_VERSION_NUMBER2,
  GlLedgers.LEDGER_ID,
  GlLedgers.OBJECT_VERSION_NUMBER AS OBJECT_VERSION_NUMBER3,
  FinancialsBusinessUnitPEO.BU_ID AS BUSINESS_UNIT_ID1,
  SetIdSetPEO.SET_ID,
  LocationDPEO.LOCATION_ID          AS LOCATION_ID1,
  LocationDPEO.EFFECTIVE_START_DATE AS EFFECTIVE_START_DATE2,
  LocationDPEO.EFFECTIVE_END_DATE   AS EFFECTIVE_END_DATE2,
  PersonNameDPEO.PERSON_NAME_ID,
  PersonNameDPEO.OBJECT_VERSION_NUMBER AS OBJECT_VERSION_NUMBER4,
  PersonNameDPEO.EFFECTIVE_START_DATE  AS EFFECTIVE_START_DATE3,
  PERSONNAMEDPEO.EFFECTIVE_END_DATE    as EFFECTIVE_END_DATE3,
  (PERSONNAMEDPEO.LIST_NAME)           as MANAGER_NAME_ATTR
FROM FUSION.HR_ORGANIZATION_V BusinessUnitEO,
  FUSION.HR_ORG_DETAILS_BY_CLASS_V BusinessUnitDetailEO,
  FUSION.XLE_ENTITY_PROFILES XleEntityProfiles,
  FUSION.GL_LEDGERS GlLedgers,
  FUSION.FUN_FIN_BUSINESS_UNITS_V FinancialsBusinessUnitPEO,
  FUSION.FND_SETID_SETS_VL SetIdSetPEO,
  FUSION.HR_LOCATIONS_ALL_F_VL LocationDPEO,
  FUSION.PER_PERSON_NAMES_F_V PersonNameDPEO
WHERE (BusinessUnitEO.ORGANIZATION_ID            = BusinessUnitDetailEO.ORGANIZATION_ID)
AND (BusinessUnitEO.CLASSIFICATION_CODE          = BusinessUnitDetailEO.CLASSIFICATION_CODE)
AND BusinessUnitDetailEO.ORG_INFORMATION_CONTEXT = BusinessUnitEO.CLASSIFICATION_CODE
AND BusinessUnitEO.CLASSIFICATION_CODE           = 'FUN_BUSINESS_UNIT'
AND (BusinessUnitDetailEO.ORG_INFORMATION2       = XleEntityProfiles.LEGAL_ENTITY_ID(+))
AND (BusinessUnitDetailEO.ORG_INFORMATION3       = GlLedgers.LEDGER_ID(+))
AND (BusinessUnitDetailEO.ORG_INFORMATION7       = FinancialsBusinessUnitPEO.BU_ID(+))
AND (BusinessUnitDetailEO.ORG_INFORMATION4       = SetIdSetPEO.SET_ID(+))
AND (BusinessUnitEO.LOCATION_ID                  = LocationDPEO.LOCATION_ID(+))
and (BUSINESSUNITDETAILEO.ORG_INFORMATION1       = PERSONNAMEDPEO.PERSON_ID(+))
AND (sysdate BETWEEN BusinessUnitEO.EFFECTIVE_START_DATE AND BusinessUnitEO.EFFECTIVE_END_DATE)
AND (sysdate BETWEEN BusinessUnitDetailEO.EFFECTIVE_START_DATE AND BusinessUnitDetailEO.EFFECTIVE_END_DATE)
and (sysdate between LOCATIONDPEO.EFFECTIVE_START_DATE(+) and LOCATIONDPEO.EFFECTIVE_END_DATE(+))
and (sysdate between PERSONNAMEDPEO.EFFECTIVE_START_DATE(+) and PERSONNAMEDPEO.EFFECTIVE_END_DATE(+))) QRSLT ,
 (SELECT    
    AssignmentDPEO.ASSIGNMENT_ID,
    PersonDPEO.PERSON_ID,
    PersonNameDPEO.PERSON_NAME_ID,
    PersonDPEO.PERSON_NUMBER,
    PersonNameDPEO.LIST_NAME,
    DepartmentDPEO.NAME,
    JobDPEO.NAME AS JOB,
    EmailAddressPEO.EMAIL_ADDRESS,
    PhonePEO.PHONE_NUMBER,
    PhonePEO.SEARCH_PHONE_NUMBER,
    reverse(PhonePEO.SEARCH_PHONE_NUMBER) AS ReverseSearchPhoneNumber,
    LocationDTLPEO.LOCATION_NAME,
    AssignmentDPEO.ASSIGNMENT_NAME,
    AssignmentDPEO.ASSIGNMENT_NUMBER,
    AssignmentDPEO.PRIMARY_FLAG,
    AssignmentDPEO.ASSIGNMENT_TYPE,
    AssignmentDPEO.ASSIGNMENT_STATUS_TYPE,
    PersonNameDPEO.DISPLAY_NAME,
    LocationDPEO.LOCATION_ID
  FROM FUSION.PER_ALL_PEOPLE_F PersonDPEO,
    FUSION.PER_EMAIL_ADDRESSES EmailAddressPEO,
    FUSION.PER_DISPLAY_PHONES_V PhonePEO,
    FUSION.PER_PERSON_NAMES_F_V PersonNameDPEO,
    FUSION.PER_ALL_ASSIGNMENTS_M AssignmentDPEO,
    FUSION.PER_JOBS_F_TL JobDPEO,
    FUSION.HR_ORGANIZATION_UNITS_F_TL DepartmentDPEO,
    FUSION.PER_LOCATION_DETAILS_F_TL LocationDTLPEO,
    FUSION.PER_LOCATION_DETAILS_F LOCATIONDPEO
  WHERE sysdate BETWEEN PersonDPEO.EFFECTIVE_START_DATE AND PersonDPEO.EFFECTIVE_END_DATE
  AND EmailAddressPEO.EMAIL_ADDRESS_ID(+) = PersonDPEO.PRIMARY_EMAIL_ID
  AND PhonePEO.PHONE_ID(+)                = PersonDPEO.PRIMARY_PHONE_ID
  AND PERSONDPEO.PERSON_ID                = PERSONNAMEDPEO.PERSON_ID
  AND sysdate BETWEEN PersonNameDPEO.EFFECTIVE_START_DATE AND PersonNameDPEO.EFFECTIVE_END_DATE
  AND PersonDPEO.PERSON_ID                         = AssignmentDPEO.PERSON_ID (+)
  AND AssignmentDPEO.WORK_TERMS_ASSIGNMENT_ID (+) IS NOT NULL
  AND ASSIGNMENTDPEO.EFFECTIVE_LATEST_CHANGE (+)   = 'Y'
  AND sysdate BETWEEN AssignmentDPEO.EFFECTIVE_START_DATE(+) AND AssignmentDPEO.EFFECTIVE_END_DATE(+)
  AND (JOBDPEO.JOB_ID (+) = ASSIGNMENTDPEO.JOB_ID
  AND sysdate BETWEEN JobDPEO.EFFECTIVE_START_DATE(+) AND JobDPEO.EFFECTIVE_END_DATE(+)
  AND JobDPEO.language(+)                 = userenv('LANG'))
  AND (DEPARTMENTDPEO.ORGANIZATION_ID (+) = ASSIGNMENTDPEO.ORGANIZATION_ID
  AND sysdate BETWEEN DepartmentDPEO.EFFECTIVE_START_DATE(+) AND DepartmentDPEO.EFFECTIVE_END_DATE(+)
  AND DepartmentDPEO.language(+)    = userenv('LANG'))
  AND (LOCATIONDPEO.LOCATION_ID (+) = ASSIGNMENTDPEO.LOCATION_ID
  AND sysdate BETWEEN LocationDPEO.EFFECTIVE_START_DATE(+) AND LocationDPEO.EFFECTIVE_END_DATE(+)
  AND sysdate BETWEEN LocationDTLPEO.EFFECTIVE_START_DATE(+) AND LocationDTLPEO.EFFECTIVE_END_DATE(+)
  AND LOCATIONDPEO.LOCATION_DETAILS_ID= LOCATIONDTLPEO.LOCATION_DETAILS_ID(+)
  AND LocationDTLPEO.language(+)      = userenv('LANG'))
  ) PEOPLE 
  where QRSLT.PERSON_NAME_ID = PEOPLE.PERSON_NAME_ID(+)
order by QRSLT.name