/* ****************************************************************************
 * $Revision: 63805 $:
 * $Author: phermwit.seethong $:
 * $Date: 2017-09-12 15:37:52 +0700 (Tue, 12 Sep 2017) $:
 * $HeadURL: http://svn01.rapidesuite.com:999/svn/a/dev/rapidesuite/controldata/FUSION_11.1.13/trunk/core/reverse_sql/FINANCIALS/Manage%20Legal%20Addresses%20(Morocco)%20-%20Manage%20Legal%20Addresses.sql $:
 * $Id: Manage Legal Addresses (Morocco) - Manage Legal Addresses.sql 63805 2017-09-12 08:37:52Z phermwit.seethong $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */


SELECT DISTINCT HzPartiesE0.PARTY_NUMBER RES_REGISTRY_ID
,HzCustAccountsE0.ACCOUNT_NUMBER RES_ACCOUNT_NUMBER
,HzPartySitesE0.PARTY_SITE_NUMBER RES_SITE_NUMBER
,IbyExtBankAccountsE0.MASKED_BANK_ACCOUNT_NUM RES_BANK_ACCOUNTS_NUMBER
,IbyExtBankAccountsE0.BANK_ACCOUNT_NAME RES_BANK_ACCOUNTS_NAME
,legalEntitiesE0.NAME RES_LEGAL_ENTITY
,legalEntitiesE0.LEGAL_ENTITY_IDENTIFIER RES_LEGAL_ENTITY_IDENTIFIER
,debitAuthorizationsE0.CREDITOR_IDENTIFIER RES_IDENTIFICATION_NUMBER
,DECODE(debitAuthorizationsE0.PRIMARY_FLAG,'Y','Yes','No') RES_PRIMARY
,debitAuthorizationsE0.AUTHORIZATION_REFERENCE_NUMBER RES_REFERENCE_IDENTIFIER
,TO_CHAR(debitAuthorizationsE0.AUTH_SIGN_DATE,'DD-Mon-YYYY') RES_SIGNING_DATE
,TO_CHAR(debitAuthorizationsE0.AUTH_CANCEL_DATE,'DD-Mon-YYYY') RES_CANCELLATION_DATE
,(SElECT MEANING
	FROM FND_LOOKUPS
	WHERE LOOKUP_TYPE = 'IBY_DEBIT_AUTH_TRNS_TYPE'
	AND LOOKUP_CODE = debitAuthorizationsE0.PAYMENT_TYPE_CODE
	) RES_TRANSACTION_TYPE
,(SElECT MEANING
	FROM FND_LOOKUPS
	WHERE LOOKUP_TYPE = 'IBY_DEBIT_AUTH_TRNS_TYPE'
	AND LOOKUP_CODE = debitAuthorizationsE0.DEBIT_AUTH_FREQUENCY
	) RES_FREQUENCY
,TO_CHAR(debitAuthorizationsE0.DEBIT_AUTH_FNL_COLLTN_DATE,'DD-Mon-YYYY') RES_FINAL_COLLECTION_DATE
,debitAuthorizationsE0.AUTHORIZATION_REVISION_NUMBER RES_VERSION_NUMBER
,(SElECT MEANING
	FROM FND_LOOKUPS
	WHERE LOOKUP_TYPE = 'IBY_DEBIT_AUTH_AMEND_REASON'
	AND LOOKUP_CODE = debitAuthorizationsE0.AMENDMENT_REASON_CODE
	) RES_REASON_FOR_AMENDMENT
,(SElECT MEANING
	FROM FND_LOOKUPS
	WHERE LOOKUP_TYPE = 'IBY_EFT_IN_AUTH_METHOD'
	AND LOOKUP_CODE = debitAuthorizationsE0.DEBIT_AUTH_METHOD
	) RES_AUTHORIZATION_METHOD
,debitAuthorizationsE0.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,debitAuthorizationsE0.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE 
,debitAuthorizationsE0.CREATED_BY RSC_CREATED_BY
,debitAuthorizationsE0.CREATION_DATE RSC_CREATION_DATE
,null RSC_LEDGER_ID
,null RSC_CHART_OF_ACCOUNTS_ID
,buE0.BU_ID RSC_BUSINESS_UNIT_ID
,debitAuthorizationsE0.CREDITOR_LEGAL_ENTITY_ID RSC_LEGAL_ENTITY_ID
,null RSC_ORGANIZATION_ID
,null RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM HZ_PARTIES HzPartiesE0
,(SELECT PARTY_ID 
	FROM HZ_PARTY_USG_ASSIGNMENTS
	WHERE PARTY_USAGE_CODE = 'CUSTOMER'
	) HzPartyUsgAssignmentsE0
,(SELECT * FROM (SELECT ACCOUNT_NUMBER
	,PARTY_ID
	,CUST_ACCOUNT_ID
	,ROW_NUMBER() OVER(PARTITION BY PARTY_ID ORDER BY ACCOUNT_NUMBER) R1
	FROM HZ_CUST_ACCOUNTS)
	WHERE R1 = 1
	) HzCustAccountsE0
,(SELECT * FROM (SELECT PARTY_ID
	,PARTY_SITE_ID
	,PARTY_SITE_NUMBER
	,ROW_NUMBER() OVER(PARTITION BY PARTY_ID ORDER BY PARTY_SITE_NUMBER) R1
	FROM HZ_PARTY_SITES
	WHERE PARTY_SITE_ID IN (SELECT PARTY_SITE_ID FROM HZ_CUST_ACCT_SITES_ALL))
	WHERE R1 = 1
	) HzPartySitesE0
,HZ_CUST_ACCT_SITES_ALL HzCustAcctSitesAllE0
,HZ_CUST_SITE_USES_ALL HzCustSiteUsesAllE0
,IBY_EXTERNAL_PAYERS_ALL IbyExternalPayersAllE0
,IBY_PMT_INSTR_USES_ALL IbyPmtInstrUsesAllE0
,IBY_EXT_BANK_ACCOUNTS IbyExtBankAccountsE0
,CE_BANK_BRANCHES_V CeBankBranchesVE0
,IBY_DEBIT_AUTHORIZATIONS_F debitAuthorizationsE0
,XLE_ENTITY_PROFILES legalEntitiesE0
,FUN_ALL_BUSINESS_UNITS_V buE0
WHERE HzPartiesE0.PARTY_ID = HzPartyUsgAssignmentsE0.PARTY_ID
AND HzPartiesE0.PARTY_ID = HzCustAccountsE0.PARTY_ID
AND HzPartiesE0.PARTY_ID = HzPartySitesE0.PARTY_ID
AND HzPartySitesE0.PARTY_SITE_ID = HzCustAcctSitesAllE0.PARTY_SITE_ID
AND HzPartiesE0.PARTY_ID = IbyExternalPayersAllE0.PARTY_ID
AND HzCustAccountsE0.CUST_ACCOUNT_ID = IbyExternalPayersAllE0.CUST_ACCOUNT_ID
AND IbyExternalPayersAllE0.EXT_PAYER_ID = IbyPmtInstrUsesAllE0.EXT_PMT_PARTY_ID
AND IbyExternalPayersAllE0.EXT_PAYER_ID = IbyPmtInstrUsesAllE0.EXT_PMT_PARTY_ID
AND IbyPmtInstrUsesAllE0.INSTRUMENT_ID = IbyExtBankAccountsE0.EXT_BANK_ACCOUNT_ID
AND IbyExtBankAccountsE0.BANK_ID = CeBankBranchesVE0.BANK_PARTY_ID
AND IbyExtBankAccountsE0.BRANCH_ID = CeBankBranchesVE0.BRANCH_PARTY_ID
AND IbyExternalPayersAllE0.ACCT_SITE_USE_ID = HzCustSiteUsesAllE0.SITE_USE_ID
AND HzPartiesE0.PARTY_ID = debitAuthorizationsE0.DEBTOR_PARTY_ID
AND IbyExtBankAccountsE0.EXT_BANK_ACCOUNT_ID = debitAuthorizationsE0.EXTERNAL_BANK_ACCOUNT_ID
AND debitAuthorizationsE0.CREDITOR_LEGAL_ENTITY_ID = legalEntitiesE0.LEGAL_ENTITY_ID(+)
AND HzCustAcctSitesAllE0.SET_ID = buE0.DEFAULT_SET_ID(+)
ORDER BY HzPartiesE0.PARTY_NUMBER 
,HzCustAccountsE0.ACCOUNT_NUMBER 
,HzPartySitesE0.PARTY_SITE_NUMBER 