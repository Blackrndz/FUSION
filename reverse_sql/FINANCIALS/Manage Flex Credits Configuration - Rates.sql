/* ****************************************************************************
 * $Revision: 54943 $:
 * $Author: paul.wakefield $:
 * $Date: 2016-05-04 13:45:23 +0700 (Wed, 04 May 2016) $:
 * $HeadURL: http://svn01.rapidesuite.com:999/svn/a/dev/rapidesuite/controldata/FUSION_11.1.13.19/trunk/core/reverse_sql/FINANCIALS/Manage%20Trading%20Community%20Person%20Lookups%20-%20Standard%20Lookup%20Type.sql $:
 * $Id: Manage Trading Community Person Lookups - Standard Lookup Type.sql 54943 2016-05-04 06:45:23Z paul.wakefield $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */
 
SELECT benPLEO.NAME RES_PLAN_NAME
,benPGMEO.NAME RES_PROGRAM_NAME
,(SELECT NAME FROM HR_ORGANIZATION_UNITS
				WHERE SYSDATE BETWEEN DATE_FROM AND DATE_TO
				AND ORGANIZATION_ID = SAMELEGAL.POOLLEGAL) RES_LEGAL_EMPLOYER
,SAMELEGAL.POOLNAME RES_RATE_NAME_AS_POOL
,TO_CHAR(SAMELEGAL.EFFECTIVE_START_DATE,'DD-Mon-YYYY') RES_EFFECTIVE_START_DATE
,TO_CHAR(SAMELEGAL.EFFECTIVE_END_DATE,'DD-Mon-YYYY') RES_EFFECTIVE_END_DATE
,(SELECT ELEMENT_NAME FROM PAY_ELEMENT_TYPES_VL WHERE ELEMENT_TYPE_ID = SAMELEGAL.POOLELE
	AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND NVL(EFFECTIVE_END_DATE ,TO_DATE('31-12-4712','DD-MM-YYYY'))) RES_PAYROLL_ELEMENT_AS_POOL
,(SELECT NAME FROM PAY_INPUT_VALUES_VL WHERE INPUT_VALUE_ID = SAMELEGAL.POOLINPUT
	AND ELEMENT_TYPE_ID = SAMELEGAL.POOLELE
	AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND NVL(EFFECTIVE_END_DATE,TO_DATE('4712-12-31','YYYY-MM-DD'))) RES_ELEMENT_INPUT_VALUE_AS_POO
,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE LOOKUP_CODE = SAMELEGAL.POOLTX
	AND LANGUAGE = USERENV('LANG') AND LOOKUP_TYPE = 'BEN_TX_TYP'
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('31-12-4712','DD-MM-YYYY'))) RES_TAX_TYPE_CODE_AS_POOL
,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE LOOKUP_CODE = SAMELEGAL.POOLACTY
	AND LANGUAGE = USERENV('LANG') AND LOOKUP_TYPE = 'BEN_ACTY_TYP'
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('31-12-4712','DD-MM-YYYY'))) RES_ACTIVITY_TYPE_AS_POOL
,SAMELEGAL.CASHNAME RES_RATE_NAME_AS_CASH
,(SELECT ELEMENT_NAME FROM PAY_ELEMENT_TYPES_VL WHERE ELEMENT_TYPE_ID = SAMELEGAL.CASHELE
	AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND NVL(EFFECTIVE_END_DATE ,TO_DATE('31-12-4712','DD-MM-YYYY')))RES_PAYROLL_ELEMENT_AS_CASH
,(SELECT NAME FROM PAY_INPUT_VALUES_VL WHERE INPUT_VALUE_ID = SAMELEGAL.CASHINPUT
	AND ELEMENT_TYPE_ID = SAMELEGAL.CASHELE
	AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND NVL(EFFECTIVE_END_DATE,TO_DATE('4712-12-31','YYYY-MM-DD'))) RES_ELEMENT_INPUT_VALUE_AS_CAS
,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE LOOKUP_CODE = SAMELEGAL.CASHTX
	AND LANGUAGE = USERENV('LANG') AND LOOKUP_TYPE = 'BEN_TX_TYP'
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('31-12-4712','DD-MM-YYYY'))) RES_TAX_TYPE_CODE_AS_CASH
,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE LOOKUP_CODE = SAMELEGAL.CASHACTY
	AND LANGUAGE = USERENV('LANG') AND LOOKUP_TYPE = 'BEN_ACTY_TYP'
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('31-12-4712','DD-MM-YYYY'))) RES_ACTIVITY_TYPE_AS_CASH

,SAMELEGAL.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,SAMELEGAL.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,SAMELEGAL.CREATED_BY RSC_CREATED_BY
,SAMELEGAL.CREATION_DATE RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,NULL RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,benPLEO.LEGISLATION_CODE RSC_COUNTRY_ID

FROM BEN_PL_F benPLEO
,BEN_PLIP_F benPLIPEO
,BEN_PGM_F benPGMEO
,BEN_PL_TYP_F benPLTYPEO
,(SELECT benACTYPOOLE0.PLIP_ID
	,benACTYPOOLE0.EFFECTIVE_START_DATE
	,benACTYPOOLE0.EFFECTIVE_END_DATE
	,benACTYPOOLE0.NAME POOLNAME
	,benACTYPOOLE0.LEGAL_ENTITY_ID POOLLEGAL
	,benACTYPOOLE0.ELEMENT_TYPE_ID POOLELE
	,benACTYPOOLE0.INPUT_VALUE_ID POOLINPUT
	,benACTYPOOLE0.TX_TYP_CD POOLTX
	,benACTYPOOLE0.ACTY_TYP_CD POOLACTY
	,benACTYCASHE0.NAME CASHNAME
	,benACTYCASHE0.LEGAL_ENTITY_ID CASHLEGAL
	,benACTYCASHE0.ELEMENT_TYPE_ID CASHELE
	,benACTYCASHE0.INPUT_VALUE_ID CASHINPUT
	,benACTYCASHE0.TX_TYP_CD CASHTX
	,benACTYCASHE0.ACTY_TYP_CD CASHACTY
	,benACTYPOOLE0.LAST_UPDATED_BY 
	,benACTYPOOLE0.LAST_UPDATE_DATE 
	,benACTYPOOLE0.CREATED_BY 
	,benACTYPOOLE0.CREATION_DATE 
	FROM BEN_ACTY_BASE_RT_F benACTYPOOLE0
	,BEN_ACTY_BASE_RT_F benACTYCASHE0
	WHERE benACTYPOOLE0.LEGAL_ENTITY_ID = benACTYCASHE0.LEGAL_ENTITY_ID
	AND benACTYPOOLE0.FLEX_PLC_HLDR_RATE_CD ='FLXCR_PRVDD_RATE' 
	AND benACTYCASHE0.FLEX_PLC_HLDR_RATE_CD ='FLXCR_CASH_RATE'
	AND benACTYPOOLE0.CONTEXT_PGM_ID = benACTYCASHE0.CONTEXT_PGM_ID
	AND SYSDATE BETWEEN benACTYPOOLE0.EFFECTIVE_START_DATE AND benACTYPOOLE0.EFFECTIVE_END_DATE
	AND SYSDATE BETWEEN benACTYCASHE0.EFFECTIVE_START_DATE AND benACTYCASHE0.EFFECTIVE_END_DATE ) SAMELEGAL
	
WHERE benPLEO.PL_TYP_ID = benPLTYPEO.PL_TYP_ID 
AND benPLEO.PL_ID = benPLIPEO.PL_ID
AND benPLIPEO.PGM_ID = benPGMEO.PGM_ID
AND benPLEO.INVK_FLX_CR_PL_FLAG = 'Y'
AND benPLIPEO.PLIP_ID = SAMELEGAL.PLIP_ID
AND SYSDATE BETWEEN benPLEO.EFFECTIVE_START_DATE AND NVL(benPLEO.EFFECTIVE_END_DATE,TO_DATE('31-12-4712','DD-MM-YYYY'))
AND SYSDATE BETWEEN benPLIPEO.EFFECTIVE_START_DATE AND NVL(benPLIPEO.EFFECTIVE_END_DATE,TO_DATE('31-12-4712','DD-MM-YYYY'))
AND SYSDATE BETWEEN benPGMEO.EFFECTIVE_START_DATE AND NVL(benPGMEO.EFFECTIVE_END_DATE,TO_DATE('31-12-4712','DD-MM-YYYY'))

UNION


SELECT benPLEO.NAME RES_PLAN_NAME
,benPGMEO.NAME RES_PROGRAM_NAME
,(SELECT NAME FROM HR_ORGANIZATION_UNITS
				WHERE SYSDATE BETWEEN DATE_FROM AND DATE_TO
				AND ORGANIZATION_ID = benACTYPOOLE0.LEGAL_ENTITY_ID) RES_LEGAL_EMPLOYER
,benACTYPOOLE0.NAME RES_RATE_NAME_AS_POOL
,TO_CHAR(benACTYPOOLE0.EFFECTIVE_START_DATE,'DD-Mon-YYYY') RES_EFFECTIVE_START_DATE
,TO_CHAR(benACTYPOOLE0.EFFECTIVE_END_DATE,'DD-Mon-YYYY') RES_EFFECTIVE_END_DATE
,(SELECT ELEMENT_NAME FROM PAY_ELEMENT_TYPES_VL WHERE ELEMENT_TYPE_ID = benACTYPOOLE0.ELEMENT_TYPE_ID
	AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND NVL(EFFECTIVE_END_DATE ,TO_DATE('31-12-4712','DD-MM-YYYY'))) RES_PAYROLL_ELEMENT_AS_POOL
,(SELECT NAME FROM PAY_INPUT_VALUES_VL WHERE INPUT_VALUE_ID = benACTYPOOLE0.INPUT_VALUE_ID
	AND ELEMENT_TYPE_ID = benACTYPOOLE0.ELEMENT_TYPE_ID
	AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND NVL(EFFECTIVE_END_DATE,TO_DATE('4712-12-31','YYYY-MM-DD'))) RES_ELEMENT_INPUT_VALUE_AS_POO
,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE LOOKUP_CODE = benACTYPOOLE0.TX_TYP_CD
	AND LANGUAGE = USERENV('LANG') AND LOOKUP_TYPE = 'BEN_TX_TYP'
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('31-12-4712','DD-MM-YYYY'))) RES_TAX_TYPE_CODE_AS_POOL
,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE LOOKUP_CODE = benACTYPOOLE0.ACTY_TYP_CD
	AND LANGUAGE = USERENV('LANG') AND LOOKUP_TYPE = 'BEN_ACTY_TYP'
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('31-12-4712','DD-MM-YYYY'))) RES_ACTIVITY_TYPE_AS_POOL
,NULL RES_RATE_NAME_AS_CASH
,NULL RES_PAYROLL_ELEMENT_AS_CASH
,NULL RES_ELEMENT_INPUT_VALUE_AS_CAS
,NULL RES_TAX_TYPE_CODE_AS_CASH
,NULL RES_ACTIVITY_TYPE_AS_CASH

,benACTYPOOLE0.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,benACTYPOOLE0.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,benACTYPOOLE0.CREATED_BY RSC_CREATED_BY
,benACTYPOOLE0.CREATION_DATE RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,NULL RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM BEN_PL_F benPLEO
,BEN_PLIP_F benPLIPEO
,BEN_PGM_F benPGMEO
,BEN_PL_TYP_F benPLTYPEO
,(SELECT TMPA.* FROM BEN_ACTY_BASE_RT_F TMPA WHERE TMPA.FLEX_PLC_HLDR_RATE_CD ='FLXCR_PRVDD_RATE' 
	AND (TMPA.LEGAL_ENTITY_ID,TMPA.CONTEXT_PGM_ID) NOT IN (SELECT benACTYPOOLE0.LEGAL_ENTITY_ID,benACTYPOOLE0.CONTEXT_PGM_ID FROM BEN_ACTY_BASE_RT_F benACTYPOOLE0
									,BEN_ACTY_BASE_RT_F benACTYCASHE0
									WHERE benACTYPOOLE0.LEGAL_ENTITY_ID = benACTYCASHE0.LEGAL_ENTITY_ID
									AND benACTYPOOLE0.FLEX_PLC_HLDR_RATE_CD ='FLXCR_PRVDD_RATE' 
									AND benACTYCASHE0.FLEX_PLC_HLDR_RATE_CD ='FLXCR_CASH_RATE'
									AND SYSDATE BETWEEN benACTYPOOLE0.EFFECTIVE_START_DATE AND benACTYPOOLE0.EFFECTIVE_END_DATE
									AND SYSDATE BETWEEN benACTYCASHE0.EFFECTIVE_START_DATE AND benACTYCASHE0.EFFECTIVE_END_DATE)) benACTYPOOLE0

									
WHERE benPLEO.PL_TYP_ID = benPLTYPEO.PL_TYP_ID 
AND benPLEO.PL_ID = benPLIPEO.PL_ID
AND benPLIPEO.PGM_ID = benPGMEO.PGM_ID
AND benPLEO.INVK_FLX_CR_PL_FLAG = 'Y'
AND benPLIPEO.PLIP_ID = benACTYPOOLE0.PLIP_ID
AND SYSDATE BETWEEN benPLEO.EFFECTIVE_START_DATE AND NVL(benPLEO.EFFECTIVE_END_DATE,TO_DATE('31-12-4712','DD-MM-YYYY'))
AND SYSDATE BETWEEN benPLIPEO.EFFECTIVE_START_DATE AND NVL(benPLIPEO.EFFECTIVE_END_DATE,TO_DATE('31-12-4712','DD-MM-YYYY'))
AND SYSDATE BETWEEN benPGMEO.EFFECTIVE_START_DATE AND NVL(benPGMEO.EFFECTIVE_END_DATE,TO_DATE('31-12-4712','DD-MM-YYYY'))


UNION


SELECT benPLEO.NAME RES_PLAN_NAME
,benPGMEO.NAME RES_PROGRAM_NAME
,(SELECT NAME FROM HR_ORGANIZATION_UNITS
				WHERE SYSDATE BETWEEN DATE_FROM AND DATE_TO
				AND ORGANIZATION_ID = benACTYCASHE0.LEGAL_ENTITY_ID) RES_LEGAL_EMPLOYER
,NULL RES_RATE_NAME_AS_POOL
,TO_CHAR(benACTYCASHE0.EFFECTIVE_START_DATE,'DD-Mon-YYYY') RES_EFFECTIVE_START_DATE
,TO_CHAR(benACTYCASHE0.EFFECTIVE_END_DATE,'DD-Mon-YYYY') RES_EFFECTIVE_END_DATE
,NULL RES_PAYROLL_ELEMENT_AS_POOL
,NULL RES_ELEMENT_INPUT_VALUE_AS_POO
,NULL RES_TAX_TYPE_CODE_AS_POOL
,NULL RES_ACTIVITY_TYPE_AS_POOL
,benACTYCASHE0.NAME RES_RATE_NAME_AS_CASH
,(SELECT ELEMENT_NAME FROM PAY_ELEMENT_TYPES_VL WHERE ELEMENT_TYPE_ID = benACTYCASHE0.ELEMENT_TYPE_ID
	AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND NVL(EFFECTIVE_END_DATE ,TO_DATE('31-12-4712','DD-MM-YYYY'))) RES_PAYROLL_ELEMENT_AS_CASH
,(SELECT NAME FROM PAY_INPUT_VALUES_VL WHERE INPUT_VALUE_ID = benACTYCASHE0.INPUT_VALUE_ID
	AND ELEMENT_TYPE_ID = benACTYCASHE0.ELEMENT_TYPE_ID
	AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND NVL(EFFECTIVE_END_DATE,TO_DATE('4712-12-31','YYYY-MM-DD'))) RES_ELEMENT_INPUT_VALUE_AS_CAS
,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE LOOKUP_CODE = benACTYCASHE0.TX_TYP_CD
	AND LANGUAGE = USERENV('LANG') AND LOOKUP_TYPE = 'BEN_TX_TYP'
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('31-12-4712','DD-MM-YYYY'))) RES_TAX_TYPE_CODE_AS_CASH
,(SELECT MEANING FROM FND_LOOKUP_VALUES WHERE LOOKUP_CODE = benACTYCASHE0.ACTY_TYP_CD
	AND LANGUAGE = USERENV('LANG') AND LOOKUP_TYPE = 'BEN_ACTY_TYP'
	AND SYSDATE BETWEEN START_DATE_ACTIVE AND NVL(END_DATE_ACTIVE,TO_DATE('31-12-4712','DD-MM-YYYY'))) RES_ACTIVITY_TYPE_AS_CASH

,benACTYCASHE0.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,benACTYCASHE0.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,benACTYCASHE0.CREATED_BY RSC_CREATED_BY
,benACTYCASHE0.CREATION_DATE RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,NULL RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM BEN_PL_F benPLEO
,BEN_PLIP_F benPLIPEO
,BEN_PGM_F benPGMEO
,BEN_PL_TYP_F benPLTYPEO
,(SELECT TMPA.* FROM BEN_ACTY_BASE_RT_F TMPA WHERE TMPA.FLEX_PLC_HLDR_RATE_CD ='FLXCR_CASH_RATE' 
	AND (TMPA.LEGAL_ENTITY_ID,TMPA.CONTEXT_PGM_ID) NOT IN (SELECT benACTYCASHE0.LEGAL_ENTITY_ID,benACTYCASHE0.CONTEXT_PGM_ID FROM BEN_ACTY_BASE_RT_F benACTYPOOLE0
									,BEN_ACTY_BASE_RT_F benACTYCASHE0
									WHERE benACTYPOOLE0.LEGAL_ENTITY_ID = benACTYCASHE0.LEGAL_ENTITY_ID
									AND benACTYPOOLE0.FLEX_PLC_HLDR_RATE_CD ='FLXCR_PRVDD_RATE' 
									AND benACTYCASHE0.FLEX_PLC_HLDR_RATE_CD ='FLXCR_CASH_RATE'									
									AND SYSDATE BETWEEN benACTYPOOLE0.EFFECTIVE_START_DATE AND benACTYPOOLE0.EFFECTIVE_END_DATE
									AND SYSDATE BETWEEN benACTYCASHE0.EFFECTIVE_START_DATE AND benACTYCASHE0.EFFECTIVE_END_DATE)) benACTYCASHE0

									
WHERE benPLEO.PL_TYP_ID = benPLTYPEO.PL_TYP_ID 
AND benPLEO.PL_ID = benPLIPEO.PL_ID
AND benPLIPEO.PGM_ID = benPGMEO.PGM_ID
AND benPLEO.INVK_FLX_CR_PL_FLAG = 'Y'
AND benPLIPEO.PLIP_ID = benACTYCASHE0.PLIP_ID
AND SYSDATE BETWEEN benPLEO.EFFECTIVE_START_DATE AND NVL(benPLEO.EFFECTIVE_END_DATE,TO_DATE('31-12-4712','DD-MM-YYYY'))
AND SYSDATE BETWEEN benPLIPEO.EFFECTIVE_START_DATE AND NVL(benPLIPEO.EFFECTIVE_END_DATE,TO_DATE('31-12-4712','DD-MM-YYYY'))
AND SYSDATE BETWEEN benPGMEO.EFFECTIVE_START_DATE AND NVL(benPGMEO.EFFECTIVE_END_DATE,TO_DATE('31-12-4712','DD-MM-YYYY'))
								
ORDER BY RES_PLAN_NAME,RES_PROGRAM_NAME,RES_LEGAL_EMPLOYER