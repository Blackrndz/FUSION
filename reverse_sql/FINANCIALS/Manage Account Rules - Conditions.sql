/* ****************************************************************************
 * $Revision: 56649 $:
 * $Author: wuttipong.thongvises $:
 * $Date: 2016-07-12 11:20:44 +0700 (Tue, 12 Jul 2016) $:
 * $HeadURL: http://svn01.rapidesuite.com:999/svn/a/dev/rapidesuite/controldata/FUSION_11.1.12/branches/core/v2.2.0.0/reverse_sql/FINANCIALS/Currency%20Rates%20Manager%20-%20Rate%20Types.sql $:
 * $Id: Currency Rates Manager - Rate Types.sql 56649 2016-07-12 04:20:44Z wuttipong.thongvises $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */
 

WITH STATEMENT1 AS
	(SELECT SEGMENT_RULE_DETAIL_ID
	,' '||BRACKET_LEFT_CODE||DECODE(NAME,NULL,'',' "')
	||NAME||DECODE(NAME,NULL,'','"')||(CASE
		WHEN KEY_FLEXFIELD_FLAG = 'Y' THEN
			(CASE
				WHEN FLEXFIELD_SEGMENT_CODE IS NULL AND ((SELECT COUNT(*) CNT FROM XLA_SOURCES_VL WHERE NAME = XX.NAME) <= 1 OR (SELECT COUNT(*) CNT FROM XLA_SOURCES_VL WHERE SOURCE_CODE = XX.SOURCE_CODE) <= 1 )  THEN
					'."All"'
				WHEN FLEXFIELD_SEGMENT_CODE IS NULL AND ((SELECT COUNT(*) CNT FROM XLA_SOURCES_VL WHERE NAME = XX.NAME) > 1 OR (SELECT COUNT(*) CNT FROM XLA_SOURCES_VL WHERE SOURCE_CODE = XX.SOURCE_CODE) > 1 )  THEN
					'('||NVL((SELECT APPLICATION_SHORT_NAME FROM FND_APPLICATION WHERE APPLICATION_ID = XX.APPLICATION_ID)
						,(SELECT APPLICATION_NAME FROM XLA_SUBLEDGERS_TL WHERE LANGUAGE = USERENV('LANG') AND APPLICATION_ID = XX.APPLICATION_ID))||',S,S) '
				WHEN FLEXFIELD_SEGMENT_CODE IS NOT NULL THEN
					'."'||(SELECT NAME FROM FND_KF_SEGMENT_LABELS_VL
						WHERE APPLICATION_ID = XX.FLEXFIELD_APPLICATION_ID
						AND KEY_FLEXFIELD_CODE = XX.ID_FLEX_CODE
						AND SEGMENT_LABEL_CODE = XX.FLEXFIELD_SEGMENT_CODE)||'"'
					||(CASE 
						WHEN ((SELECT COUNT(*) CNT FROM XLA_SOURCES_VL WHERE NAME = XX.NAME) > 1 OR (SELECT COUNT(*) CNT FROM XLA_SOURCES_VL WHERE SOURCE_CODE = XX.SOURCE_CODE) > 1 )  THEN
							'('||NVL((SELECT APPLICATION_SHORT_NAME FROM FND_APPLICATION WHERE APPLICATION_ID = XX.APPLICATION_ID)
								,(SELECT APPLICATION_NAME FROM XLA_SUBLEDGERS_TL WHERE LANGUAGE = USERENV('LANG') AND APPLICATION_ID = XX.APPLICATION_ID))||',S,S) '
						END)
			END)
		WHEN (SELECT COUNT(*) CNT FROM XLA_SOURCES_VL WHERE NAME = XX.NAME) > 1 OR (SELECT COUNT(*) CNT FROM XLA_SOURCES_VL WHERE SOURCE_CODE = XX.SOURCE_CODE) > 1 THEN
			'('||NVL((SELECT APPLICATION_SHORT_NAME FROM FND_APPLICATION WHERE APPLICATION_ID = XX.APPLICATION_ID)
				,(SELECT APPLICATION_NAME FROM XLA_SUBLEDGERS_TL WHERE LANGUAGE = USERENV('LANG') AND APPLICATION_ID = XX.APPLICATION_ID))||',S,S) '
		END)
	||DECODE(NAME,NULL,'',' ')||DECODE(LINE_OPERATOR_CODE,'E','=','D','!=','N','Is null','X','Is not null','G','>','H','>=','L','<','M','<=')||DECODE(NAME,NULL,'',' ')
	||(CASE
			WHEN LOOKUP_TYPE IS NOT NULL AND XX.LOOKUP_TYPE = 'YES_NO' THEN
				(SELECT MEANING 
					FROM FND_LOOKUP_VALUES
					WHERE LOOKUP_TYPE = XX.LOOKUP_TYPE
					AND LOOKUP_CODE = VALUE_CONSTANT
					AND VIEW_APPLICATION_ID = XX.VIEW_APPLICATION_ID
					AND LANGUAGE = USERENV('LANG')
					AND SYSDATE BETWEEN NVL(START_DATE_ACTIVE,TO_DATE('1950-01-01','YYYY-MM-DD')) AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD')))
			WHEN LOOKUP_TYPE IS NOT NULL AND XX.LOOKUP_TYPE != 'YES_NO' THEN
				(SELECT MEANING 
					FROM FND_LOOKUP_VALUES
					WHERE LOOKUP_TYPE = XX.LOOKUP_TYPE
					AND LOOKUP_CODE = VALUE_CONSTANT
					AND VIEW_APPLICATION_ID = XX.VIEW_APPLICATION_ID
					AND LANGUAGE = USERENV('LANG')
					AND SYSDATE BETWEEN NVL(START_DATE_ACTIVE,TO_DATE('1950-01-01','YYYY-MM-DD')) AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD')))
			WHEN VALUE_SOURCE_CODE IS NOT NULL THEN
				'"'||(SELECT NAME
					FROM XLA_SOURCES_VL
					WHERE APPLICATION_ID = VALUE_SOURCE_APPLICATION_ID
					AND SOURCE_TYPE_CODE = VALUE_SOURCE_TYPE_CODE
					AND SOURCE_CODE = VALUE_SOURCE_CODE)||'"'
				
			WHEN VS_NAME IS NOT NULL THEN
				(CASE WHEN VALUE_TYPE_CODE = 'C' THEN
					(CASE
						WHEN VS_NAME = 'ORA_PO_TAB_CATEGORY_VS' THEN
							NVL((SELECT CATEGORY_NAME
								FROM EGP_CATEGORIES_VL
								WHERE TO_CHAR(CATEGORY_ID) = VALUE_CONSTANT),VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_PROJECT_TYPE_VS' THEN
							NVL((SELECT PROJECT_TYPE
								FROM PJF_PROJECT_TYPES_VL
								WHERE TO_CHAR(PROJECT_TYPE_ID) = VALUE_CONSTANT),VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_EXPENDITURE_TYPES_VS' THEN
							NVL((SELECT EXPENDITURE_TYPE_NAME
								FROM PJF_EXP_TYPES_VL
								WHERE TO_CHAR(EXPENDITURE_TYPE_ID) = VALUE_CONSTANT),VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_TRANSACTION_SOURCE_VS' THEN
							NVL((SELECT USER_TRANSACTION_SOURCE
								FROM PJF_TXN_SOURCES_VL
								WHERE TO_CHAR(TRANSACTION_SOURCE_ID) = VALUE_CONSTANT),VALUE_CONSTANT)
						WHEN VS_NAME = 'CST_XLA_BUSINESS_UNITS_VS' THEN
							NVL((SELECT BU_NAME
								FROM FUN_ALL_BUSINESS_UNITS_V 
								WHERE TO_CHAR(BU_ID) = VALUE_CONSTANT),VALUE_CONSTANT)
						WHEN VS_NAME IN('PJC_ORGANIZATION_VS','ORA_PJC_EXP_BU_VS')  THEN
							NVL((SELECT NAME
								FROM HR_ORGANIZATION_UNITS_F_TL 
								WHERE LANGUAGE = USERENV('LANG')
								and trunc(sysdate) between effective_start_date and effective_end_date
								AND TO_CHAR(ORGANIZATION_ID) = VALUE_CONSTANT),VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_EXPENDITURE_CATEGORY_VS' THEN
							NVL((SELECT EXPENDITURE_CATEGORY_NAME
								FROM PJF_EXP_CATEGORIES_TL 
								WHERE LANGUAGE = USERENV('LANG')
								AND TO_CHAR(EXPENDITURE_CATEGORY_ID) = VALUE_CONSTANT),VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_TRANSACTION_DOCUMENT_ENTRY_VS' THEN
							NVL((SELECT DOC_ENTRY_NAME
								FROM PJF_TXN_DOC_ENTRY_TL 
								WHERE LANGUAGE = USERENV('LANG')
								AND TO_CHAR(DOC_ENTRY_ID) = VALUE_CONSTANT),VALUE_CONSTANT)
						WHEN VS_NAME = 'PJB_EVENT_TYPE_VS' THEN
							NVL((SELECT EVENT_TYPE_NAME
								FROM PJF_EVENT_TYPES_TL 
								WHERE LANGUAGE = USERENV('LANG')
								AND TO_CHAR(EVENT_TYPE_ID) = VALUE_CONSTANT),VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_TRANSACTION_DOCUMENT_VS' THEN
							NVL((SELECT DOCUMENT_NAME
								FROM PJF_TXN_DOCUMENT_TL 
								WHERE LANGUAGE = USERENV('LANG')
								AND TO_CHAR(DOCUMENT_ID) = VALUE_CONSTANT),VALUE_CONSTANT)
						ELSE
							VALUE_CONSTANT
							--VALUE_TYPE_CODE||'##!'||VS_NAME||'!##'||VALUE_CONSTANT||'##'
					END)
				ELSE
					(CASE
						WHEN VS_NAME = 'ORA_PO_TAB_CATEGORY_VS' THEN
							(SELECT CATEGORY_NAME
								FROM EGP_CATEGORIES_VL
								WHERE TO_CHAR(CATEGORY_ID) = VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_PROJECT_TYPE_VS' THEN
							(SELECT PROJECT_TYPE
								FROM PJF_PROJECT_TYPES_VL
								WHERE TO_CHAR(PROJECT_TYPE_ID) = VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_EXPENDITURE_TYPES_VS' THEN
							(SELECT EXPENDITURE_TYPE_NAME
								FROM PJF_EXP_TYPES_VL
								WHERE TO_CHAR(EXPENDITURE_TYPE_ID) = VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_TRANSACTION_SOURCE_VS' THEN
							(SELECT USER_TRANSACTION_SOURCE
								FROM PJF_TXN_SOURCES_VL
								WHERE TO_CHAR(TRANSACTION_SOURCE_ID) = VALUE_CONSTANT)
						WHEN VS_NAME = 'CST_XLA_BUSINESS_UNITS_VS' THEN
							(SELECT BU_NAME
								FROM FUN_ALL_BUSINESS_UNITS_V 
								WHERE TO_CHAR(BU_ID) = VALUE_CONSTANT)
						WHEN VS_NAME IN('PJC_ORGANIZATION_VS','ORA_PJC_EXP_BU_VS')  THEN
							(SELECT NAME
								FROM HR_ORGANIZATION_UNITS_F_TL 
								WHERE LANGUAGE = USERENV('LANG')
								and trunc(sysdate) between effective_start_date and effective_end_date
								AND TO_CHAR(ORGANIZATION_ID) = VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_EXPENDITURE_CATEGORY_VS' THEN
							(SELECT EXPENDITURE_CATEGORY_NAME
								FROM PJF_EXP_CATEGORIES_TL 
								WHERE LANGUAGE = USERENV('LANG')
								AND TO_CHAR(EXPENDITURE_CATEGORY_ID) = VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_TRANSACTION_DOCUMENT_ENTRY_VS' THEN
							(SELECT DOC_ENTRY_NAME
								FROM PJF_TXN_DOC_ENTRY_TL 
								WHERE LANGUAGE = USERENV('LANG')
								AND TO_CHAR(DOC_ENTRY_ID) = VALUE_CONSTANT)
						WHEN VS_NAME = 'PJB_EVENT_TYPE_VS' THEN
							(SELECT EVENT_TYPE_NAME
								FROM PJF_EVENT_TYPES_TL 
								WHERE LANGUAGE = USERENV('LANG')
								AND TO_CHAR(EVENT_TYPE_ID) = VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_TRANSACTION_DOCUMENT_VS' THEN
							(SELECT DOCUMENT_NAME
								FROM PJF_TXN_DOCUMENT_TL 
								WHERE LANGUAGE = USERENV('LANG')
								AND TO_CHAR(DOCUMENT_ID) = VALUE_CONSTANT)
						ELSE
							VALUE_CONSTANT
							--VALUE_TYPE_CODE||'##!'||VS_NAME||'!##'||VALUE_CONSTANT||'##'
					END)
				END)
			ELSE
				VALUE_CONSTANT
		END)
	||DECODE(NAME,NULL,'',' ')||BRACKET_RIGHT_CODE||' '||DECODE(LOGICAL_OPERATOR_CODE,'A','''And''','O','''Or''') CONTEXT
	,LAST_UPDATED_BY
	,LAST_UPDATE_DATE
	,CREATED_BY
	,CREATION_DATE
	FROM (SELECT ConditionEO.SEGMENT_RULE_DETAIL_ID
		,ConditionEO.USER_SEQUENCE
		,ConditionEO.BRACKET_LEFT_CODE
		,ConditionEO.BRACKET_RIGHT_CODE
		,ConditionEO.VALUE_TYPE_CODE
		,SourceE0.NAME
		,SourceE0.SOURCE_CODE
		,SourceE0.KEY_FLEXFIELD_FLAG
		,SourceE0.APPLICATION_ID
		,(SELECT VALUE_SET_CODE FROM FND_VS_VALUE_SETS WHERE VALUE_SET_ID = SourceE0.FLEX_VALUE_SET_ID) VS_NAME
		,ROW_NUMBER() OVER (PARTITION BY SEGMENT_RULE_DETAIL_ID ORDER BY USER_SEQUENCE) SEQ1
		,ConditionEO.VALUE_CONSTANT
		,ConditionEO.VALUE_SOURCE_APPLICATION_ID
		,ConditionEO.VALUE_SOURCE_TYPE_CODE
		,ConditionEO.VALUE_SOURCE_CODE
		,ConditionEO.LINE_OPERATOR_CODE
		,ConditionEO.LOGICAL_OPERATOR_CODE
		,ConditionEO.FLEXFIELD_SEGMENT_CODE
		,SourceE0.FLEXFIELD_APPLICATION_ID
		,SourceE0.ID_FLEX_CODE
		,ConditionEO.LAST_UPDATED_BY
		,ConditionEO.LAST_UPDATE_DATE
		,ConditionEO.CREATED_BY
		,ConditionEO.CREATION_DATE
		,SourceE0.VIEW_APPLICATION_ID
		,SourceE0.LOOKUP_TYPE
		FROM XLA_CONDITIONS ConditionEO
		,XLA_SOURCES_VL SourceE0
		WHERE SourceE0.APPLICATION_ID(+) = ConditionEO.SOURCE_APPLICATION_ID
		AND SourceE0.SOURCE_TYPE_CODE(+) = ConditionEO.SOURCE_TYPE_CODE
		AND SourceE0.SOURCE_CODE(+) = ConditionEO.SOURCE_CODE) XX
	WHERE SEQ1 = 1)
,STATEMENT_CONCAT AS
	(SELECT SEGMENT_RULE_DETAIL_ID
	,' '||BRACKET_LEFT_CODE||DECODE(NAME,NULL,'',' "')
	||NAME||DECODE(NAME,NULL,'','"')||(CASE
		WHEN KEY_FLEXFIELD_FLAG = 'Y' THEN
			(CASE
				WHEN FLEXFIELD_SEGMENT_CODE IS NULL AND ((SELECT COUNT(*) CNT FROM XLA_SOURCES_VL WHERE NAME = XX.NAME) <= 1 OR (SELECT COUNT(*) CNT FROM XLA_SOURCES_VL WHERE SOURCE_CODE = XX.SOURCE_CODE) <= 1 )  THEN
					'."All"'
				WHEN FLEXFIELD_SEGMENT_CODE IS NULL AND ((SELECT COUNT(*) CNT FROM XLA_SOURCES_VL WHERE NAME = XX.NAME) > 1 OR (SELECT COUNT(*) CNT FROM XLA_SOURCES_VL WHERE SOURCE_CODE = XX.SOURCE_CODE) > 1 )  THEN
					'('||NVL((SELECT APPLICATION_SHORT_NAME FROM FND_APPLICATION WHERE APPLICATION_ID = XX.APPLICATION_ID)
						,(SELECT APPLICATION_NAME FROM XLA_SUBLEDGERS_TL WHERE LANGUAGE = USERENV('LANG') AND APPLICATION_ID = XX.APPLICATION_ID))||',S,S) '
				WHEN FLEXFIELD_SEGMENT_CODE IS NOT NULL THEN
					'."'||(SELECT NAME FROM FND_KF_SEGMENT_LABELS_VL
						WHERE APPLICATION_ID = XX.FLEXFIELD_APPLICATION_ID
						AND KEY_FLEXFIELD_CODE = XX.ID_FLEX_CODE
						AND SEGMENT_LABEL_CODE = XX.FLEXFIELD_SEGMENT_CODE)||'"'
					||(CASE 
						WHEN ((SELECT COUNT(*) CNT FROM XLA_SOURCES_VL WHERE NAME = XX.NAME) > 1 OR (SELECT COUNT(*) CNT FROM XLA_SOURCES_VL WHERE SOURCE_CODE = XX.SOURCE_CODE) > 1 )  THEN
							'('||NVL((SELECT APPLICATION_SHORT_NAME FROM FND_APPLICATION WHERE APPLICATION_ID = XX.APPLICATION_ID)
								,(SELECT APPLICATION_NAME FROM XLA_SUBLEDGERS_TL WHERE LANGUAGE = USERENV('LANG') AND APPLICATION_ID = XX.APPLICATION_ID))||',S,S) '
						END)
			END)
		WHEN (SELECT COUNT(*) CNT FROM XLA_SOURCES_VL WHERE NAME = XX.NAME) > 1 OR (SELECT COUNT(*) CNT FROM XLA_SOURCES_VL WHERE SOURCE_CODE = XX.SOURCE_CODE) > 1 THEN
			'('||NVL((SELECT APPLICATION_SHORT_NAME FROM FND_APPLICATION WHERE APPLICATION_ID = XX.APPLICATION_ID)
				,(SELECT APPLICATION_NAME FROM XLA_SUBLEDGERS_TL WHERE LANGUAGE = USERENV('LANG') AND APPLICATION_ID = XX.APPLICATION_ID))||',S,S) '
		END)
	||DECODE(NAME,NULL,'',' ')||DECODE(LINE_OPERATOR_CODE,'E','=','D','!=','N','Is null','X','Is not null','G','>','H','>=','L','<','M','<=')||DECODE(NAME,NULL,'',' ')
	||(CASE
			WHEN LOOKUP_TYPE IS NOT NULL AND XX.LOOKUP_TYPE = 'YES_NO' THEN
				(SELECT MEANING 
					FROM FND_LOOKUP_VALUES
					WHERE LOOKUP_TYPE = XX.LOOKUP_TYPE
					AND LOOKUP_CODE = VALUE_CONSTANT
					AND VIEW_APPLICATION_ID = XX.VIEW_APPLICATION_ID
					AND LANGUAGE = USERENV('LANG')
					AND SYSDATE BETWEEN NVL(START_DATE_ACTIVE,TO_DATE('1950-01-01','YYYY-MM-DD')) AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD')))
			WHEN LOOKUP_TYPE IS NOT NULL AND XX.LOOKUP_TYPE != 'YES_NO' THEN
				(SELECT MEANING 
					FROM FND_LOOKUP_VALUES
					WHERE LOOKUP_TYPE = XX.LOOKUP_TYPE
					AND LOOKUP_CODE = VALUE_CONSTANT
					AND VIEW_APPLICATION_ID = XX.VIEW_APPLICATION_ID
					AND LANGUAGE = USERENV('LANG')
					AND SYSDATE BETWEEN NVL(START_DATE_ACTIVE,TO_DATE('1950-01-01','YYYY-MM-DD')) AND NVL(END_DATE_ACTIVE,TO_DATE('4712-12-31','YYYY-MM-DD')))
			WHEN VALUE_SOURCE_CODE IS NOT NULL THEN
				'"'||(SELECT NAME
					FROM XLA_SOURCES_VL
					WHERE APPLICATION_ID = VALUE_SOURCE_APPLICATION_ID
					AND SOURCE_TYPE_CODE = VALUE_SOURCE_TYPE_CODE
					AND SOURCE_CODE = VALUE_SOURCE_CODE)||'"'
			WHEN VS_NAME IS NOT NULL THEN
				(CASE WHEN VALUE_TYPE_CODE = 'C' THEN
					(CASE
						WHEN VS_NAME = 'ORA_PO_TAB_CATEGORY_VS' THEN
							NVL((SELECT CATEGORY_NAME
								FROM EGP_CATEGORIES_VL
								WHERE TO_CHAR(CATEGORY_ID) = VALUE_CONSTANT),VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_PROJECT_TYPE_VS' THEN
							NVL((SELECT PROJECT_TYPE
								FROM PJF_PROJECT_TYPES_VL
								WHERE TO_CHAR(PROJECT_TYPE_ID) = VALUE_CONSTANT),VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_EXPENDITURE_TYPES_VS' THEN
							NVL((SELECT EXPENDITURE_TYPE_NAME
								FROM PJF_EXP_TYPES_VL
								WHERE TO_CHAR(EXPENDITURE_TYPE_ID) = VALUE_CONSTANT),VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_TRANSACTION_SOURCE_VS' THEN
							NVL((SELECT USER_TRANSACTION_SOURCE
								FROM PJF_TXN_SOURCES_VL
								WHERE TO_CHAR(TRANSACTION_SOURCE_ID) = VALUE_CONSTANT),VALUE_CONSTANT)
						WHEN VS_NAME = 'CST_XLA_BUSINESS_UNITS_VS' THEN
							NVL((SELECT BU_NAME
								FROM FUN_ALL_BUSINESS_UNITS_V 
								WHERE TO_CHAR(BU_ID) = VALUE_CONSTANT),VALUE_CONSTANT)
						WHEN VS_NAME IN('PJC_ORGANIZATION_VS','ORA_PJC_EXP_BU_VS')  THEN
							NVL((SELECT NAME
								FROM HR_ORGANIZATION_UNITS_F_TL 
								WHERE LANGUAGE = USERENV('LANG')
								and trunc(sysdate) between effective_start_date and effective_end_date
								AND TO_CHAR(ORGANIZATION_ID) = VALUE_CONSTANT),VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_EXPENDITURE_CATEGORY_VS' THEN
							NVL((SELECT EXPENDITURE_CATEGORY_NAME
								FROM PJF_EXP_CATEGORIES_TL 
								WHERE LANGUAGE = USERENV('LANG')
								AND TO_CHAR(EXPENDITURE_CATEGORY_ID) = VALUE_CONSTANT),VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_TRANSACTION_DOCUMENT_ENTRY_VS' THEN
							NVL((SELECT DOC_ENTRY_NAME
								FROM PJF_TXN_DOC_ENTRY_TL 
								WHERE LANGUAGE = USERENV('LANG')
								AND TO_CHAR(DOC_ENTRY_ID) = VALUE_CONSTANT),VALUE_CONSTANT)
						WHEN VS_NAME = 'PJB_EVENT_TYPE_VS' THEN
							NVL((SELECT EVENT_TYPE_NAME
								FROM PJF_EVENT_TYPES_TL 
								WHERE LANGUAGE = USERENV('LANG')
								AND TO_CHAR(EVENT_TYPE_ID) = VALUE_CONSTANT),VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_TRANSACTION_DOCUMENT_VS' THEN
							NVL((SELECT DOCUMENT_NAME
								FROM PJF_TXN_DOCUMENT_TL 
								WHERE LANGUAGE = USERENV('LANG')
								AND TO_CHAR(DOCUMENT_ID) = VALUE_CONSTANT),VALUE_CONSTANT)
						ELSE
							VALUE_CONSTANT
							--VALUE_TYPE_CODE||'##!'||VS_NAME||'!##'||VALUE_CONSTANT||'##'
					END)
				ELSE
					(CASE
						WHEN VS_NAME = 'ORA_PO_TAB_CATEGORY_VS' THEN
							(SELECT CATEGORY_NAME
								FROM EGP_CATEGORIES_VL
								WHERE TO_CHAR(CATEGORY_ID) = VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_PROJECT_TYPE_VS' THEN
							(SELECT PROJECT_TYPE
								FROM PJF_PROJECT_TYPES_VL
								WHERE TO_CHAR(PROJECT_TYPE_ID) = VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_EXPENDITURE_TYPES_VS' THEN
							(SELECT EXPENDITURE_TYPE_NAME
								FROM PJF_EXP_TYPES_VL
								WHERE TO_CHAR(EXPENDITURE_TYPE_ID) = VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_TRANSACTION_SOURCE_VS' THEN
							(SELECT USER_TRANSACTION_SOURCE
								FROM PJF_TXN_SOURCES_VL
								WHERE TO_CHAR(TRANSACTION_SOURCE_ID) = VALUE_CONSTANT)
						WHEN VS_NAME = 'CST_XLA_BUSINESS_UNITS_VS' THEN
							(SELECT BU_NAME
								FROM FUN_ALL_BUSINESS_UNITS_V 
								WHERE TO_CHAR(BU_ID) = VALUE_CONSTANT)
						WHEN VS_NAME IN('PJC_ORGANIZATION_VS','ORA_PJC_EXP_BU_VS')  THEN
							(SELECT NAME
								FROM HR_ORGANIZATION_UNITS_F_TL 
								WHERE LANGUAGE = USERENV('LANG')
								and trunc(sysdate) between effective_start_date and effective_end_date
								AND TO_CHAR(ORGANIZATION_ID) = VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_EXPENDITURE_CATEGORY_VS' THEN
							(SELECT EXPENDITURE_CATEGORY_NAME
								FROM PJF_EXP_CATEGORIES_TL 
								WHERE LANGUAGE = USERENV('LANG')
								AND TO_CHAR(EXPENDITURE_CATEGORY_ID) = VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_TRANSACTION_DOCUMENT_ENTRY_VS' THEN
							(SELECT DOC_ENTRY_NAME
								FROM PJF_TXN_DOC_ENTRY_TL 
								WHERE LANGUAGE = USERENV('LANG')
								AND TO_CHAR(DOC_ENTRY_ID) = VALUE_CONSTANT)
						WHEN VS_NAME = 'PJB_EVENT_TYPE_VS' THEN
							(SELECT EVENT_TYPE_NAME
								FROM PJF_EVENT_TYPES_TL 
								WHERE LANGUAGE = USERENV('LANG')
								AND TO_CHAR(EVENT_TYPE_ID) = VALUE_CONSTANT)
						WHEN VS_NAME = 'PJC_TRANSACTION_DOCUMENT_VS' THEN
							(SELECT DOCUMENT_NAME
								FROM PJF_TXN_DOCUMENT_TL 
								WHERE LANGUAGE = USERENV('LANG')
								AND TO_CHAR(DOCUMENT_ID) = VALUE_CONSTANT)
						ELSE
							VALUE_CONSTANT
							--VALUE_TYPE_CODE||'##!'||VS_NAME||'!##'||VALUE_CONSTANT||'##'
					END)
				END)
			ELSE
				VALUE_CONSTANT 
		END)
	||DECODE(NAME,NULL,'',' ')||BRACKET_RIGHT_CODE||' '||DECODE(LOGICAL_OPERATOR_CODE,'A','''And''','O','''Or''') CONTEXT
	,SEQ1
	FROM (SELECT ConditionEO.SEGMENT_RULE_DETAIL_ID
		,ConditionEO.USER_SEQUENCE
		,ConditionEO.BRACKET_LEFT_CODE
		,ConditionEO.BRACKET_RIGHT_CODE
		,ConditionEO.VALUE_TYPE_CODE
		,SourceE0.NAME
		,SourceE0.SOURCE_CODE
		,SourceE0.KEY_FLEXFIELD_FLAG
		,SourceE0.APPLICATION_ID
		,(SELECT VALUE_SET_CODE FROM FND_VS_VALUE_SETS WHERE VALUE_SET_ID = SourceE0.FLEX_VALUE_SET_ID) VS_NAME
		,ROW_NUMBER() OVER (PARTITION BY SEGMENT_RULE_DETAIL_ID ORDER BY USER_SEQUENCE) SEQ1
		,ConditionEO.VALUE_CONSTANT
		,ConditionEO.VALUE_SOURCE_APPLICATION_ID
		,ConditionEO.VALUE_SOURCE_TYPE_CODE
		,ConditionEO.VALUE_SOURCE_CODE
		,ConditionEO.LINE_OPERATOR_CODE
		,ConditionEO.LOGICAL_OPERATOR_CODE
		,ConditionEO.FLEXFIELD_SEGMENT_CODE
		,SourceE0.FLEXFIELD_APPLICATION_ID
		,SourceE0.ID_FLEX_CODE
		,SourceE0.VIEW_APPLICATION_ID
		,SourceE0.LOOKUP_TYPE
		FROM XLA_CONDITIONS ConditionEO
		,XLA_SOURCES_VL SourceE0
		WHERE SourceE0.APPLICATION_ID(+) = ConditionEO.SOURCE_APPLICATION_ID
		AND SourceE0.SOURCE_TYPE_CODE(+) = ConditionEO.SOURCE_TYPE_CODE
		AND SourceE0.SOURCE_CODE(+) = ConditionEO.SOURCE_CODE) XX
	WHERE SEQ1 BETWEEN 2 AND 35)

SELECT
	(SELECT APPLICATION_NAME
	FROM XLA_SUBLEDGERS_TL
	WHERE LANGUAGE = USERENV('LANG')
	AND APPLICATION_ID = XlaSegRulesVlE0.APPLICATION_ID
	) RES_SUBLEDGER_APPLICATION
,XlaSegRulesVlE0.NAME RES_NAME
,AccountRuleDetailEO.SEQ1 RES_PRIORITY
,STATEMENT1.CONTEXT
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 2)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 3)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 4)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 5)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 6)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 7)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 8)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 9)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 10)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 11)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 12)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 13)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 14)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 15)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 16)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 17)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 18)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 19)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 20)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 21)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 22)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 23)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 24)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 25)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 26)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 27)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 28)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 29)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 30)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 31)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 32)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 33)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 34)
	||(SELECT CONTEXT
		FROM STATEMENT_CONCAT
		WHERE SEGMENT_RULE_DETAIL_ID = AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID
		AND SEQ1 = 35)
	RES_CONDITIONS
,STATEMENT1.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,STATEMENT1.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,STATEMENT1.CREATED_BY RSC_CREATED_BY
,STATEMENT1.CREATION_DATE RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,XlaSegRulesVlE0.ACCOUNTING_COA_ID RSC_CHART_OF_ACCOUNTS_ID
,NULL RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM XLA_SEG_RULES_VL XlaSegRulesVlE0
,(SELECT SEGMENT_RULE_DETAIL_ID
	,ACCOUNTING_COA_ID
	,APPLICATION_ID
	,AMB_CONTEXT_CODE
	,SEGMENT_RULE_TYPE_CODE
	,SEGMENT_RULE_CODE
	,ROW_NUMBER() OVER(PARTITION BY SEGMENT_RULE_CODE,APPLICATION_ID ORDER BY USER_SEQUENCE) SEQ1
	FROM XLA_SEG_RULE_DETAILS) AccountRuleDetailEO
,STATEMENT1
WHERE XlaSegRulesVlE0.APPLICATION_ID = AccountRuleDetailEO.APPLICATION_ID
AND XlaSegRulesVlE0.AMB_CONTEXT_CODE = AccountRuleDetailEO.AMB_CONTEXT_CODE
AND XlaSegRulesVlE0.SEGMENT_RULE_TYPE_CODE = AccountRuleDetailEO.SEGMENT_RULE_TYPE_CODE
AND XlaSegRulesVlE0.SEGMENT_RULE_CODE = AccountRuleDetailEO.SEGMENT_RULE_CODE
AND AccountRuleDetailEO.SEGMENT_RULE_DETAIL_ID = STATEMENT1.SEGMENT_RULE_DETAIL_ID(+)
AND STATEMENT1.SEGMENT_RULE_DETAIL_ID IS NOT NULL
ORDER BY RES_SUBLEDGER_APPLICATION
,XlaSegRulesVlE0.NAME
,AccountRuleDetailEO.SEQ1