/* ****************************************************************************
 * $Revision: 78229 $:
 * $Author: pisan.jariyasettachok $:
 * $Date: 2022-04-07 14:37:05 +0700 (Thu, 07 Apr 2022) $:
 * $HeadURL: https://svn03.rapid4cloud.com/svn/a/dev/rapidesuite/controldata/FUSION_11.1.13/trunk/core/reverse_sql/FINANCIALS/Manage%20Payables%20Document%20Sequences%20-%20Assignment.sql $:
 * $Id: Manage Payables Document Sequences - Assignment.sql 78229 2022-04-07 07:37:05Z pisan.jariyasettachok $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */
 
SELECT QRSLT.DOC_SEQ_NAME RES_DOCUMENT_SEQUENCE_NAME
,null/*QRSLT.CATEGORY_CODE*/ RES_CATEGORY
,QRSLT.NAME RES_DOCUMENT_SEQUENCE_CATEGORY
,QRSLT.APPLICATION_NAME RES_APPLICATION
,QRSLT.METHOD_CODE_MEANING RES_METHOD
,TO_CHAR(QRSLT.START_DATE,'DD-Mon-YYYY') RES_START_DATE
,TO_CHAR(QRSLT.END_DATE,'DD-Mon-YYYY') RES_END_DATE
, DECODE(QRSLT.DETERMINANT_TYPE_MEANING, 'Business unit', QRSLT.Name1, 'Ledger', QRSLT.LEDGERNAME1, 'Legal entity', QRSLT.LEGALNAME, NULL) RES_VALUE 
,QRSLT.LEGAL_ENTITY_IDENTIFIER RES_LEGAL_ENTITY_IDENTIFIER
,QRSLT.LAST_UPDATED_BY  RSC_LAST_UPDATED_BY
,QRSLT.LAST_UPDATE_DATE  RSC_LAST_UPDATE_DATE
,QRSLT.CREATED_BY  RSC_CREATED_BY
,QRSLT.CREATION_DATE  RSC_CREATION_DATE
,(CASE
	WHEN QRSLT.DETERMINANT_TYPE = 'LEDGER' THEN
		QRSLT.DETERMINANT_VALUE
	ELSE	
		NULL
	END) RSC_LEDGER_ID
,null RSC_CHART_OF_ACCOUNTS_ID
,(CASE
	WHEN QRSLT.DETERMINANT_TYPE = 'BU' THEN
		QRSLT.DETERMINANT_VALUE
	ELSE	
		NULL
	END) RSC_BUSINESS_UNIT_ID
,(CASE
	WHEN QRSLT.DETERMINANT_TYPE = 'LE' THEN
		QRSLT.DETERMINANT_VALUE
	ELSE	
		NULL
	END) RSC_LEGAL_ENTITY_ID
,null RSC_ORGANIZATION_ID
,null RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM
	(SELECT DocumentSequencesEO.NAME Doc_SEQ_NAME
	,DocSequenceAssignmentsEO.DOC_SEQUENCE_ASSIGNMENT_ID
	,DocSequenceAssignmentsEO.DOC_SEQUENCE_ID
	,DocSequenceAssignmentsEO.APPLICATION_ID
	,DocSequenceAssignmentsEO.CATEGORY_CODE
	,DocSequenceAssignmentsEO.METHOD_CODE
	,(SELECT MEANING
		FROM FND_LOOKUP_VALUES
		WHERE LOOKUP_type = 'FND_DOCSEQ_ASSIGN_METHOD'
		AND LOOKUP_CODE   = DocSequenceAssignmentsEO.METHOD_CODE
		AND ENABLED_FLAG = 'Y'
	    AND LANGUAGE = USERENV('LANG')
		) METHOD_CODE_MEANING
    ,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LOOKUP_type = 'FND_DOC_SEQ_DETERMINANT_TYPE'
    AND lookup_code   = DOCUMENTSEQUENCESEO.DETERMINANT_TYPE
	AND ENABLED_FLAG = 'Y'
	    AND LANGUAGE = USERENV('LANG')
    ) DETERMINANT_TYPE_MEANING 
	,DOCUMENTSEQUENCESEO.DETERMINANT_TYPE
	,DocSequenceAssignmentsEO.START_DATE
	,DocSequenceAssignmentsEO.END_DATE
	,DocSequenceAssignmentsEO.DETERMINANT_VALUE
	,DocSequenceAssignmentsEO.LAST_UPDATE_DATE
	,DocSequenceAssignmentsEO.LAST_UPDATED_BY
	,DocSequenceAssignmentsEO.CREATED_BY
    ,DocSequenceAssignmentsEO.CREATION_DATE
	,DocSequenceAssignmentsEO.LAST_UPDATE_LOGIN
	,DocSequenceAssignmentsEO.ATTRIBUTE_CATEGORY
	,DocSequenceAssignmentsEO.ATTRIBUTE1
	,DocSequenceAssignmentsEO.ATTRIBUTE2
	,DocSequenceAssignmentsEO.ATTRIBUTE3
	,DocSequenceAssignmentsEO.ATTRIBUTE4
	,DocSequenceAssignmentsEO.ATTRIBUTE5
	,DocSequenceAssignmentsEO.ATTRIBUTE6
	,DocSequenceAssignmentsEO.ATTRIBUTE7
	,DocSequenceAssignmentsEO.ATTRIBUTE8
	,DocSequenceAssignmentsEO.ATTRIBUTE9
	,DocSequenceAssignmentsEO.ATTRIBUTE10
	,DocSequenceAssignmentsEO.ENTERPRISE_ID	
	,DocSequenceCategoriesPEO.NAME
	,DocSequenceCategoriesPEO.APPLICATION_ID AS APPLICATION_ID1
	,DocSequenceCategoriesPEO.CODE
	,DeterminantValueBUEO.NAME AS NAME1
	,DeterminantValueBUEO.ORGANIZATION_ID
	,DeterminantValueBUEO.EFFECTIVE_START_DATE
	,DeterminantValueBUEO.EFFECTIVE_END_DATE
	,DeterminantValueLedgerEO.NAME AS LEDGERNAME1
	,DeterminantValueLedgerEO.LEDGER_ID
	,DeterminantValueLegalEO.LEGAL_ENTITY_IDENTIFIER
	,DeterminantValueLegalEO.LEGAL_ENTITY_ID
	,DeterminantValueLegalEO.NAME AS LEGALNAME
	,ApplicationPEO.APPLICATION_NAME
	FROM FND_DOC_SEQUENCE_ASSIGNMENTS DocSequenceAssignmentsEO
	,FND_DOC_SEQUENCE_CATEGORIES DocSequenceCategoriesPEO
	,HR_ALL_ORGANIZATION_UNITS_F_VL DeterminantValueBUEO
	,GL_LEDGERS_PUBLIC_V DeterminantValueLedgerEO
	,XLE_FIRSTPARTY_INFORMATION_V DETERMINANTVALUELEGALEO
	,FND_DOCUMENT_SEQUENCES DOCUMENTSEQUENCESEO
	,FND_APPLICATION_VL APPLICATIONPEO
	WHERE DOCUMENTSEQUENCESEO.DOC_SEQUENCE_ID = DocSequenceAssignmentsEO.DOC_SEQUENCE_ID
	AND DocSequenceAssignmentsEO.APPLICATION_ID = APPLICATIONPEO.APPLICATION_ID
	AND(DocumentSequencesEO.MODULE_ID        IN
		(SELECT rf.child_module_id
		FROM fnd_appl_taxonomy_rf rf
		,fnd_appl_taxonomy at
		WHERE AT.MODULE_TYPE = 'APPLICATION'
		AND at.module_key    = 'AP'
		AND AT.MODULE_ID     = RF.ANCESTOR_MODULE_ID
		))
	AND DocSequenceAssignmentsEO.APPLICATION_ID    = DocSequenceCategoriesPEO.APPLICATION_ID
	AND DocSequenceAssignmentsEO.CATEGORY_CODE     = DocSequenceCategoriesPEO.CODE
	and DOCSEQUENCEASSIGNMENTSEO.DETERMINANT_VALUE = DETERMINANTVALUEBUEO.ORGANIZATION_ID(+)
	AND(sysdate BETWEEN DeterminantValueBUEO.EFFECTIVE_START_DATE(+) AND DeterminantValueBUEO.EFFECTIVE_END_DATE(+))
	AND DocSequenceAssignmentsEO.DETERMINANT_VALUE = DeterminantValueLedgerEO.LEDGER_ID(+)
	AND DOCSEQUENCEASSIGNMENTSEO.DETERMINANT_VALUE = DETERMINANTVALUELEGALEO.LEGAL_ENTITY_ID(+)
	) QRSLT
ORDER BY QRSLT.DOC_SEQ_NAME
,QRSLT.NAME