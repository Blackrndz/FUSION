/* ****************************************************************************
 * $Revision:  $:
 * $Author: Nasrullah Dusenmahamad $:
 * $Date: 2018-03-20  $:
 * $HeadURL: $:
 * $Id: Configure Exception Sets - Exception  $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */
 
-- RSC_PREREQUISITE_OBJECTS=HRR_TMPL_ANALYTIC_TYPES_VL
-- RSC_PREREQUISITE_OBJECTS=HRR_TMPL_ANLYT_BOX_LBLS_VL

 WITH TMP_RATING AS (SELECT COUNT(RATING_MODEL_ID) AS ROW_LEVEL,RATING_MODEL_ID FROM HRT_RATING_CATEGORIES_VL GROUP BY RATING_MODEL_ID)

SELECT talentRwTemplatesE0.NAME RES_TEMPLATE_NAME
,tmplANALYZOPTNE0.ANALYTIC_VIEW_NAME RES_VIEW_NAME
,(CASE WHEN tmplANALYZOPTNE0.ANALYTIC_VIEW_MODE = 'XY'
	THEN (SELECT TO_CHAR(ROW_LEVEL) FROM TMP_RATING WHERE RATING_MODEL_ID =(SELECT RATING_MODEL_ID FROM HRR_TMPL_METRIC_CONFIG_Vl WHERE METRIC_CODE  = tmplANALYZOPTNE0.VERTICAL_AXIS_CODE AND DASHBOARD_TMPL_ID = tmplANALYZOPTNE0.DASHBOARD_TMPL_ID ))
	ELSE tmplANALYZOPTNE0.VIEW_COLUMN_COUNT END)  RES_ROWS
,(CASE WHEN tmplANALYZOPTNE0.ANALYTIC_VIEW_MODE = 'XY'
	THEN (SELECT TO_CHAR(ROW_LEVEL) FROM TMP_RATING WHERE RATING_MODEL_ID =(SELECT RATING_MODEL_ID FROM HRR_TMPL_METRIC_CONFIG_Vl WHERE METRIC_CODE  = tmplANALYZOPTNE0.HORIZONTAL_AXIS_CODE AND DASHBOARD_TMPL_ID = tmplANALYZOPTNE0.DASHBOARD_TMPL_ID))
	ELSE tmplANALYZOPTNE0.VIEW_ROW_COUNT END) RES_COLUMNS
,(CASE WHEN tmplANALYZOPTNE0.ANALYTIC_VIEW_MODE = 'XY'
	THEN tmplANALYZBOXE0.BOX_SEQUENCE 
	ELSE tmplANALYZBOXRATEE0.BOX_SEQUENCE END) RES_BOX_SEQUENCE
,(CASE WHEN tmplANALYZOPTNE0.ANALYTIC_VIEW_MODE = 'XY'
	THEN tmplANALYZBOXE0.BOX_LABEL 
	ELSE (SELECT RATING_DESCRIPTION FROM HRT_RATING_LEVELS_VL WHERE RATING_LEVEL_ID = tmplANALYZBOXRATEE0.RATING_LEVEL_ID ) END) RES_BOX_MAPPING
,(CASE WHEN tmplANALYZOPTNE0.ANALYTIC_VIEW_MODE = 'XY'
	THEN tmplANALYZBOXE0.BOXCELL_BACKGROUND_COLOR 
	ELSE tmplANALYZBOXRATEE0.BOXCELL_BACKGROUND_COLOR END) RES_BOX_COLOR_CODE
--,SUBSTR(tmplANALYZBOXE0.BOXCELL_BACKGROUND_COLOR,2,LENGTH(tmplANALYZBOXE0.BOXCELL_BACKGROUND_COLOR)-1) RES_BOX_COLOR_CODE

,NVL(tmplANALYZBOXE0.LAST_UPDATED_BY,tmplANALYZBOXRATEE0.LAST_UPDATED_BY) RSC_LAST_UPDATED_BY
,NVL(tmplANALYZBOXE0.LAST_UPDATE_DATE,tmplANALYZBOXRATEE0.LAST_UPDATE_DATE) RSC_LAST_UPDATE_DATE
,NVL(tmplANALYZBOXE0.CREATED_BY,tmplANALYZBOXRATEE0.CREATED_BY) RSC_CREATED_BY
,NVL(tmplANALYZBOXE0.CREATION_DATE,tmplANALYZBOXRATEE0.CREATION_DATE) RSC_CREATION_DATE
,null RSC_LEDGER_ID
,null RSC_CHART_OF_ACCOUNTS_ID
,null RSC_BUSINESS_UNIT_ID
,null RSC_LEGAL_ENTITY_ID
,null RSC_ORGANIZATION_ID
,null RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM HRR_DASHBOARD_TMPLS_VL talentRwTemplatesE0
,HRR_TMPL_ANALYTIC_TYPES_VL tmplANALYZOPTNE0
,HRR_TMPL_ANLYT_BOX_LBLS_VL tmplANALYZBOXE0
,HRR_TMPL_ANLYT_BOX_RATINGS tmplANALYZBOXRATEE0
WHERE talentRwTemplatesE0.DASHBOARD_TMPL_ID = tmplANALYZOPTNE0.DASHBOARD_TMPL_ID
AND tmplANALYZOPTNE0.ANALYTIC_TYPE_ID = tmplANALYZBOXE0.ANALYTIC_TYPE_ID(+)
AND tmplANALYZOPTNE0.ANALYTIC_TYPE_ID = tmplANALYZBOXRATEE0.ANALYTIC_TYPE_ID(+)
ORDER BY talentRwTemplatesE0.NAME,tmplANALYZOPTNE0.ANALYTIC_VIEW_NAME,5