/* ****************************************************************************
 * $Revision:  $:
 * $Author: Nasrullah Dusenmahamad $:
 * $Date: 2018-03-20  $:
 * $HeadURL: $:
 * $Id: Configure Exception Sets - Exception  $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */
 
-- RSC_PREREQUISITE_OBJECTS=PAY_ORG_PAY_METHODS_F

SELECT leGrpsE0.NAME RES_LEGISLATIVE_DATA_GROUP
,(SELECT PARTY_NAME
    FROM HZ_PARTIES
    WHERE PARTY_ID = PartyPayMethodsE0.ORGANIZATION_ID
    ) RES_THIRD_PARTY_NAME
--,PartyPayMethodsE0.BASE_ORG_PAY_METHOD_NAME
,TO_CHAR(PartyPayMethodsE0.EFFECTIVE_START_DATE,'DD-Mon-YYYY') RES_EFFECTIVE_START_DATE
,(SELECT PARTY_NAME
    FROM HZ_PARTIES
    WHERE PARTY_ID = accountsE0.BANK_ID
    ) RES_BANK_NAME
,(SELECT PARTY_NAME
    FROM HZ_PARTIES
    WHERE PARTY_ID = accountsE0.BRANCH_ID
    ) RES_BANK_BRANCH
,(CASE
    WHEN PartyPayMethodsE0.BANK_ACCOUNT_ID = payAccountsE0.EXT_BANK_ACCOUNT_ID THEN
        'Yes'
    ELSE
        'No'
    END) RES_SELECTED_ACCOUNT
,accountsE0.BANK_ACCOUNT_NUM  RES_ACCOUNT_NUMBER
,accountsE0.CHECK_DIGITS RES_IBAN
,accountsE0.BANK_ACCOUNT_NAME RES_ACCOUNT_HOLDER
,accountsE0.SECONDARY_ACCOUNT_REFERENCE RES_BUILDING_SOCIETY_ROLL_NUMB
,bankDetailsE0.BRANCH_NUMBER RES_SORT_CODE
,bankDetailsE0.EFT_SWIFT_CODE RES_BIC_CODE


/*,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'IBY_ACCT_TYPE'
    AND LOOKUP_CODE = accountsE0.BANK_ACCOUNT_TYPE
    ) BANK_ACCOUNT_TYPE
,accountsE0.MASKED_BANK_ACCOUNT_NUM*/

,payAccountsE0.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,payAccountsE0.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,payAccountsE0.CREATED_BY RSC_CREATED_BY
,payAccountsE0.CREATION_DATE RSC_CREATION_DATE
,null RSC_LEDGER_ID
,null RSC_CHART_OF_ACCOUNTS_ID
,null RSC_BUSINESS_UNIT_ID
,null RSC_LEGAL_ENTITY_ID
,null RSC_ORGANIZATION_ID
,null RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM PAY_ORG_PAY_METHODS_F PartyPayMethodsE0
,PER_LEGISLATIVE_DATA_GROUPS_VL leGrpsE0
,PAY_PAYMENT_TYPES_VL paymentTypesE0
,IBY_ACCOUNT_OWNERS payAccountsE0
,IBY_EXT_BANK_ACCOUNTS accountsE0
,CE_INDEX_BANK_BRANCHES bankDetailsE0
WHERE SYSDATE BETWEEN PartyPayMethodsE0.EFFECTIVE_START_DATE AND PartyPayMethodsE0.EFFECTIVE_END_DATE
AND PartyPayMethodsE0.THIRD_PARTY_FLAG = 'Y'
AND PartyPayMethodsE0.LEGISLATIVE_DATA_GROUP_ID = leGrpsE0.LEGISLATIVE_DATA_GROUP_ID
AND PartyPayMethodsE0.PAYMENT_TYPE_ID = paymentTypesE0.BASE_PAYMENT_TYPE_ID
AND leGrpsE0.LEGISLATION_CODE = paymentTypesE0.LEGISLATION_CODE
AND paymentTypesE0.CATEGORY = 'MT'
AND PartyPayMethodsE0.ORGANIZATION_ID = payAccountsE0.ACCOUNT_OWNER_PARTY_ID
AND payAccountsE0.EXT_BANK_ACCOUNT_ID = accountsE0.EXT_BANK_ACCOUNT_ID
AND accountsE0.BANK_ID = bankDetailsE0.BANK_PARTY_ID(+)
AND accountsE0.BRANCH_ID = bankDetailsE0.BRANCH_PARTY_ID(+)
ORDER BY 1,2