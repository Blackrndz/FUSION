/* ****************************************************************************
 * $Revision: 78229 $:
 * $Author: pisan.jariyasettachok $:
 * $Date: 2022-04-07 14:37:05 +0700 (Thu, 07 Apr 2022) $:
 * $HeadURL: https://svn03.rapid4cloud.com/svn/a/dev/rapidesuite/controldata/FUSION_11.1.13/trunk/core/reverse_sql/FINANCIALS/Manage%20Legal%20Reporting%20Unit%20HCM%20Information%20-%20Legal%20Reporting%20Unit%20Details.sql $:
 * $Id: Manage Legal Reporting Unit HCM Information - Legal Reporting Unit Details.sql 78229 2022-04-07 07:37:05Z pisan.jariyasettachok $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */

 
SELECT orgsE0.NAME RES_REGISTRATION_NAME
,orgsE0.REGISTRATION_NUMBER RES_REGISTRATION_NUMBER
,TO_CHAR(orgsE0.EFFECTIVE_START_DATE,'DD-Mon-YYYY') RES_EFFECTIVE_START_DATE
,DECODE(TO_CHAR(orgsE0.EFFECTIVE_END_DATE,'DD-MM-YYYY'),'31-12-4712',NULL,TO_CHAR(orgsE0.EFFECTIVE_END_DATE,'DD-Mon-YYYY')) RES_EFFECTIVE_END_DATE
,(SELECT MEANING
    FROM FND_LOOKUPS
    WHERE LOOKUP_TYPE = 'CODE_STATUS'
    AND LOOKUP_CODE = orgsE0.STATUS
    ) RES_STATUS
,(SELECT ACTION_REASON
    FROM PER_ACTION_OCCURRENCES actOccE0
    ,PER_ACTION_REASONS_TL ActReasonsE0
    WHERE ActReasonsE0.LANGUAGE = USERENV('LANG')
    AND actOccE0.ACTION_REASON_ID = ActReasonsE0.ACTION_REASON_ID
    AND actOccE0.ACTION_OCCURRENCE_ID = orgsE0.ACTION_OCCURRENCE_ID
    ) RES_ACTION_REASON
,(CASE
    WHEN EXISTS (SELECT 1 FROM HR_ORG_DETAILS_BY_CLASS_V WHERE ORGANIZATION_ID = orgsE0.ORGANIZATION_ID AND CLASSIFICATION_CODE = 'HCM_REPORTING_ESTABLISHMENT') THEN
        'Yes'
    ELSE
        'No'
    END) RES_LEGAL_REPORTING_UNIT_CLASS
,(CASE
    WHEN EXISTS (SELECT 1 FROM HR_ORG_DETAILS_BY_CLASS_V WHERE ORGANIZATION_ID = orgsE0.ORGANIZATION_ID AND CLASSIFICATION_CODE = 'HCM_TRU') THEN
        'Yes'
    ELSE
        'No'
    END) RES_LEGAL_REPORTING_UNIT_CLA_0
,rptEstE0.ORG_INFORMATION1 RES_REPORTING_NAME
,(SELECT LIST_NAME
    FROM PER_PERSON_NAMES_F
    WHERE NAME_TYPE = 'GLOBAL'
    AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
    AND PERSON_ID = rptEstE0.ORG_INFORMATION2
    ) RES_MANAGER
,orgsE0.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,orgsE0.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,orgsE0.CREATED_BY RSC_CREATED_BY
,orgsE0.CREATION_DATE RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,NULL RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM (SELECT orgsE0.ORGANIZATION_ID
	,(SELECT NAME
		FROM XLE_ETB_PROFILES
		WHERE ESTABLISHMENT_ID = orgsE0.ESTABLISHMENT_ID
		) NAME
	,orgsE0.STATUS
	,orgsE0.ACTION_OCCURRENCE_ID
	--,orgsE0.NAME
	,orgsE0.EFFECTIVE_START_DATE
	,orgsE0.EFFECTIVE_END_DATE
	,REG.REGISTRATION_NUMBER
	,orgsE0.LAST_UPDATED_BY
	,orgsE0.LAST_UPDATE_DATE
	,orgsE0.CREATED_BY
	,orgsE0.CREATION_DATE
	FROM HR_ORGANIZATION_V orgsE0
	,XLE_REGISTRATIONS REG
	WHERE orgsE0.CLASSIFICATION_CODE = 'HCM_LRU'
	AND orgsE0.STATUS = 'A'
	AND orgsE0.ESTABLISHMENT_ID = REG.SOURCE_ID
	AND REG.IDENTIFYING_FLAG = 'Y'
	) orgsE0
,(SELECT * FROM HR_ORG_DETAILS_BY_CLASS_V
    WHERE CLASSIFICATION_CODE = 'HCM_REPORTING_ESTABLISHMENT'
    ) rptEstE0
WHERE orgsE0.ORGANIZATION_ID = rptEstE0.ORGANIZATION_ID(+)
AND orgsE0.EFFECTIVE_END_DATE BETWEEN rptEstE0.EFFECTIVE_START_DATE(+) AND rptEstE0.EFFECTIVE_END_DATE(+)
AND (EXISTS (SELECT 1 FROM HR_ORG_DETAILS_BY_CLASS_V WHERE ORGANIZATION_ID = orgsE0.ORGANIZATION_ID AND CLASSIFICATION_CODE = 'HCM_REPORTING_ESTABLISHMENT')
	OR EXISTS (SELECT 1 FROM HR_ORG_DETAILS_BY_CLASS_V WHERE ORGANIZATION_ID = orgsE0.ORGANIZATION_ID AND CLASSIFICATION_CODE = 'HCM_TRU'))
ORDER BY orgsE0.NAME
,orgsE0.EFFECTIVE_START_DATE