/* ****************************************************************************
* $Revision:  $:
* $Author: Nasrullah Dusenmahamad $:
* $Date: 2017-03-17  $:
* $HeadURL: $:
* $Id: Manage Category Descriptive Flexfields - Context Segments $:
* ****************************************************************************
* Description:
* ************************************************************************** */


SELECT coveragesE0.NAME RES_COVERAGE_NAME
,(SELECT NAME
    FROM BEN_PL_F
    WHERE coveragesE0.EFFECTIVE_END_DATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
    AND PL_ID = coveragesE0.CONTEXT_PL_ID
    ) RES_PLAN_NAME
,TO_CHAR(coveragesE0.EFFECTIVE_START_DATE,'DD-Mon-YYYY') RES_EFFECTIVE_START_DATE
,DECODE(TO_CHAR(coveragesE0.EFFECTIVE_END_DATE ,'DD-MM-YYYY'),'31-12-4712',NULL,TO_CHAR(coveragesE0.EFFECTIVE_END_DATE ,'DD-Mon-YYYY')) RES_EFFECTIVE_END_DATE
,(SELECT NAME
    FROM BEN_OPT_F
    WHERE coveragesE0.EFFECTIVE_END_DATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
    AND OPT_ID = coveragesE0.CONTEXT_OPT_ID
    ) RES_OPTION
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'BEN_COMP_OBJ'
    AND LOOKUP_CODE = coveragesE0.COMP_OBJ_TYPE
    ) RES_LEVEL
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'BEN_BNFT_TYP'
    AND LOOKUP_CODE = coveragesE0.BNFT_TYP_CD
    ) RES_TYPE
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'BEN_NNMNTRY_UOM'
    AND LOOKUP_CODE = coveragesE0.NNMNTRY_UOM
    ) RES_UNIT_OF_MEASURE
,DECODE(coveragesE0.VAL_OVRID_ALWD_FLAG,'Y','Yes','No') RES_ENABLE_MAXIMUM_COVERAGE_OV
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'BEN_CVG_MLT'
    AND LOOKUP_CODE = coveragesE0.CVG_MLT_CD
    ) RES_DETERMINATION_RULE


--Flat amount
,(CASE
    WHEN coveragesE0.CVG_MLT_CD IN ('FLFX') THEN
        DECODE(coveragesE0.ENTR_VAL_AT_ENRT_FLAG,'Y','Yes','No')
    END) RES_PARTICIPANTS_ENTER_VALUE_D
,(CASE
    WHEN coveragesE0.CVG_MLT_CD IN ('FLFX','FLFXPCL') THEN
        coveragesE0.VAL
    END) RES_FLAT_AMOUNT
    
    
--Multiple of compensation plus flat range
,(CASE
    WHEN coveragesE0.CVG_MLT_CD IN ('CLPFLRNG','CLRNG','FLPCLRNG','FLRNG')
        OR (coveragesE0.CVG_MLT_CD IN ('FLFX') AND coveragesE0.ENTR_VAL_AT_ENRT_FLAG ='Y') THEN
        coveragesE0.MN_VAL
    END) RES_MINIMUM
,(CASE
    WHEN coveragesE0.CVG_MLT_CD IN ('CLPFLRNG','CLRNG','FLPCLRNG','FLRNG')
        OR (coveragesE0.CVG_MLT_CD IN ('FLFX') AND coveragesE0.ENTR_VAL_AT_ENRT_FLAG ='Y') THEN
        coveragesE0.MX_VAL
    END) RES_MAXIMUM
,(CASE
    WHEN coveragesE0.CVG_MLT_CD IN ('CLPFLRNG','CLRNG','FLPCLRNG','FLRNG')
        OR (coveragesE0.CVG_MLT_CD IN ('FLFX') AND coveragesE0.ENTR_VAL_AT_ENRT_FLAG ='Y') THEN
        coveragesE0.INCRMT_VAL
    END) RES_INCREMENT_AMOUNT
,(CASE
    WHEN coveragesE0.CVG_MLT_CD IN ('CLPFLRNG','CLRNG','FLPCLRNG','FLRNG')
        OR (coveragesE0.CVG_MLT_CD IN ('FLFX') AND coveragesE0.ENTR_VAL_AT_ENRT_FLAG ='Y') THEN
        coveragesE0.DFLT_VAL
    END) RES_DEFAULT_VALUE
    

--Multiple of compensation
,(CASE
    WHEN coveragesE0.CVG_MLT_CD IN ('CL','CLPFLRNG','FLFXPCL') THEN
        coveragesE0.VAL
    END) RES_MULTIPLIER
,(CASE
    WHEN coveragesE0.CVG_MLT_CD IN ('CL','CLPFLRNG','CLRNG','FLFXPCL','FLPCLRNG') THEN
        (SELECT NAME
            FROM BEN_COMP_LVL_FCTR
            WHERE COMP_LVL_FCTR_ID = coveragesE0.COMP_LVL_FCTR_ID)
    END) RES_COMPENSATION_FACTOR
,(CASE
    WHEN coveragesE0.CVG_MLT_CD IN ('CL','CLPFLRNG','CLRNG','FLFXPCL','FLPCLRNG') THEN
        (SELECT MEANING
            FROM FND_LOOKUP_VALUES
            WHERE LANGUAGE = USERENV('LANG')
            AND LOOKUP_TYPE = 'BEN_RT_TYP'
            AND LOOKUP_CODE = coveragesE0.RT_TYP_CD)
    END) RES_OPERATOR
,(CASE
    WHEN coveragesE0.CVG_MLT_CD IN ('CL','CLPFLRNG','CLRNG','FLFXPCL','FLPCLRNG','FLRNG') THEN
        (SELECT MEANING
            FROM FND_LOOKUP_VALUES
            WHERE LANGUAGE = USERENV('LANG')
            AND LOOKUP_TYPE = 'BEN_RNDG'
            AND LOOKUP_CODE = coveragesE0.RNDG_CD)
    END) RES_ROUNDING_RULE
,(CASE
    WHEN coveragesE0.CVG_MLT_CD IN ('CL','CLPFLRNG','CLRNG','FLFXPCL','FLPCLRNG','FLRNG') THEN
        (SELECT FORMULA_NAME
            FROM FF_FORMULAS_TL
            WHERE LANGUAGE = USERENV('LANG')
            AND FORMULA_ID = coveragesE0.RNDG_RL)
    END) RES_ROUNDING_FORMULA
,(CASE
    WHEN coveragesE0.CVG_MLT_CD IN ('CL','CLPFLRNG','CLRNG','FLFXPCL','FLPCLRNG','FLRNG') THEN
        coveragesE0.LWR_LMT_VAL
    END) RES_LOW_LIMIT_VALUE
,(CASE
    WHEN coveragesE0.CVG_MLT_CD IN ('CL','CLPFLRNG','CLRNG','FLFXPCL','FLPCLRNG','FLRNG') THEN
        coveragesE0.UPR_LMT_VAL
    END) RES_HIGH_LIMIT_VALUE
,(CASE
    WHEN coveragesE0.CVG_MLT_CD IN ('CL','CLPFLRNG','CLRNG','FLFXPCL','FLPCLRNG','FLRNG') THEN
        (SELECT FORMULA_NAME
            FROM FF_FORMULAS_TL
            WHERE LANGUAGE = USERENV('LANG')
            AND FORMULA_ID = coveragesE0.LWR_LMT_CALC_RL)
    END) RES_LOW_LIMIT_VALUE_FORMULA
,(CASE
    WHEN coveragesE0.CVG_MLT_CD IN ('CL','CLPFLRNG','CLRNG','FLFXPCL','FLPCLRNG','FLRNG') THEN
        (SELECT FORMULA_NAME
            FROM FF_FORMULAS_TL
            WHERE LANGUAGE = USERENV('LANG')
            AND FORMULA_ID = coveragesE0.UPR_LMT_CALC_RL)
    END) RES_HIGH_LIMIT_VALUE_FORMULA


--Post enrollment calculation formula
,(CASE
    WHEN coveragesE0.CVG_MLT_CD IN ('ERL','RL') THEN
        (SELECT FORMULA_NAME
            FROM FF_FORMULAS_TL
            WHERE LANGUAGE = USERENV('LANG')
            AND FORMULA_ID = coveragesE0.VAL_CALC_RL)
    END) RES_VALUE_CALCULATION_FORMULA


,coveragesE0.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,coveragesE0.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,coveragesE0.CREATED_BY RSC_CREATED_BY
,coveragesE0.CREATION_DATE RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,NULL RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,coveragesE0.BUSINESS_GROUP_ID RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM BEN_CVG_AMT_CALC_MTHD_F coveragesE0
ORDER BY coveragesE0.NAME
,coveragesE0.EFFECTIVE_START_DATE