/* ****************************************************************************
 * $Revision: 78875 $:
 * $Author: tanawat.wongjan $:
 * $Date: 2022-06-27 14:11:47 +0700 (Mon, 27 Jun 2022) $:
 * $HeadURL: https://svn03.rapid4cloud.com/svn/a/dev/rapidesuite/controldata/FUSION_11.1.13/trunk/core/reverse_sql/FINANCIALS/Manage%20Benefit%20Plans%20-%20Enrollment.sql $:
 * $Id: Manage Benefit Plans - Enrollment.sql 78875 2022-06-27 07:11:47Z tanawat.wongjan $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */
 
-- RSC_PREREQUISITE_OBJECTS=BEN_PL_F

SELECT RES_PLAN_NAME
,RES_EFFECTIVE_START_DATE
,RES_EFFECTIVE_END_DATE
,RES_PLAN_OR_OPTION_NAME
,RES_PLAN_OR_OPTION_DESCRIPTION
,RES_ENROLLMENT_METHOD
,RES_AUTOMATIC_FORMULA
,RES_DEFAULT_ENROLLMENT_RULE
,RES_DEFAULT_ENROLLMENT_FORMULA
,RES_POST_ELECTION_FORMULA
,RES_REQUIRED_FORMULA
,RES_ENROLLMENT_RULE
,RES_AUTOMATIC_ENROLLMENT
,RES_REQUIRED
,RES_ASSIGN_ON_DEFAULT
,RES_ENROLLMENT_FORMULA
,RES_INTERIM_RULE
,RES_INTERIM_FORMULA
,RES_UNSUSPEND_ENROLLMENT_RULE
,RES_UNSUSPEND_ENROLLMENT_FORMU
,RES_UNSUSPEND_RATE_RULE
,RES_UNSUSPEND_RATE_FORMULA
,RES_IMPUTED_INCOME_CALCULATION
,RES_IMPUTED_INCOME_CALCULATI_0
,RES_ENABLE_ENROLLMENT_IN_BOTH_
,RES_ASSIGN_PLAN_OPTION_ON_DEFA
,RES_ALLOW_MAXIMUM_NUMBER_OF_PL
,RES_COVERAGE_START_DATE
,RES_COVERAGE_START_FORMULA
,RES_PREVIOUS_COVERAGE_END_DATE
,RES_PREVIOUS_COVERAGE_END_FORM
,RES_RATE_START_DATE
,RES_RATE_START_FORMULA
,RES_PREVIOUS_RATE_END_DATE
,RES_PREVIOUS_RATE_END_FORMULA
,RES_NO_MINIMUM
,RES_MINIMUM_NUMBER_OF_OPTIONS
,RES_NO_MAXIMUM
,RES_MAXIMUM_NUMBER_OF_OPTIONS
,RES_UNIT_OF_MEASURE
,RES_NUMBER_OF_UNITS_IN_PERIOD
,RES_REQUIRED_PERIOD_OF_ENROLLM
,RSC_LAST_UPDATED_BY
,RSC_LAST_UPDATE_DATE
,RSC_CREATED_BY
,RSC_CREATION_DATE
,null RSC_LEDGER_ID
,null RSC_CHART_OF_ACCOUNTS_ID
,null RSC_BUSINESS_UNIT_ID
,null RSC_LEGAL_ENTITY_ID
,null RSC_ORGANIZATION_ID
,null RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,RSC_COUNTRY_ID


FROM
 
(SELECT benPlansE0.NAME RES_PLAN_NAME
,TO_CHAR(benPlansE0.EFFECTIVE_START_DATE,'DD-Mon-YYYY') RES_EFFECTIVE_START_DATE
,DECODE(TO_CHAR(benPlansE0.EFFECTIVE_END_DATE,'DD-Mon-YYYY'),'31-12-4712',NULL,TO_CHAR(benPlansE0.EFFECTIVE_END_DATE,'DD-Mon-YYYY')) RES_EFFECTIVE_END_DATE
,benPlansE0.NAME RES_PLAN_OR_OPTION_NAME
,'Plan' RES_PLAN_OR_OPTION_DESCRIPTION
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'BEN_ENRT_MTHD'
    AND LOOKUP_CODE = benPlansE0.ENRT_MTHD_CD
    ) RES_ENROLLMENT_METHOD
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = benPlansE0.ENRT_RL
    ) RES_AUTOMATIC_FORMULA
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'BEN_DFLT_ENRT'
    AND LOOKUP_CODE = benPlansE0.NIP_DFLT_ENRT_CD
    ) RES_DEFAULT_ENROLLMENT_RULE
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = benPlansE0.NIP_DFLT_ENRT_DET_RL
    ) RES_DEFAULT_ENROLLMENT_FORMULA
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = benPlansE0.POSTELCN_EDIT_RL
    ) RES_POST_ELECTION_FORMULA
,NULL RES_REQUIRED_FORMULA
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'BEN_ENRT'
    AND LOOKUP_CODE = benPlansE0.ENRT_CD
    ) RES_ENROLLMENT_RULE
,NULL RES_AUTOMATIC_ENROLLMENT
,NULL RES_REQUIRED
,NULL RES_ASSIGN_ON_DEFAULT
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = benPlansE0.ENRT_RL
    ) RES_ENROLLMENT_FORMULA
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'BEN_DFLT_TO_ASN_PNDG_CTFN'
    AND LOOKUP_CODE = benPlansE0.DFLT_TO_ASN_PNDG_CTFN_CD
    ) RES_INTERIM_RULE
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = benPlansE0.DFLT_TO_ASN_PNDG_CTFN_RL
    ) RES_INTERIM_FORMULA
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'BEN_UNSSPND_ENRT'
    AND LOOKUP_CODE = benPlansE0.UNSSPND_ENRT_CD
    ) RES_UNSUSPEND_ENROLLMENT_RULE
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = benPlansE0.UNSSPND_RT_RL
    ) RES_UNSUSPEND_ENROLLMENT_FORMU
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'BEN_UNSSPND_ENRT'
    AND LOOKUP_CODE = benPlansE0.UNSSPND_RT_CD
    ) RES_UNSUSPEND_RATE_RULE
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = benPlansE0.UNSSPND_ENRT_RL
    ) RES_UNSUSPEND_RATE_FORMULA
,NULL RES_IMPUTED_INCOME_CALCULATION
,NULL RES_IMPUTED_INCOME_CALCULATI_0
/*,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'ORA_BEN_IMPTD_CVGAMT_EFFDT_CD'
    AND LOOKUP_CODE = benPlansE0.CONFIG_CHAR_6
    ) RES_IMPUTED_INCOME_CALCULATION
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = benPlansE0.UNSSPND_ENRT_RL
    ) RES_IMPUTED_INCOME_CALCULATI_0*/
,DECODE(benPlansE0.MAY_ENRL_PL_N_OIPL_FLAG,'Y','Yes','No') RES_ENABLE_ENROLLMENT_IN_BOTH_
,DECODE(benPlansE0.NIP_DFLT_FLAG,'Y','Yes','No') RES_ASSIGN_PLAN_OPTION_ON_DEFA
,DECODE(benPlansE0.DPNT_CVD_BY_OTHR_APLS_FLAG,'Y','Yes','No') RES_ALLOW_MAXIMUM_NUMBER_OF_PL
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'BEN_ENRT_CVG_STRT'
    AND LOOKUP_CODE = benPlansE0.ENRT_CVG_STRT_DT_CD
    ) RES_COVERAGE_START_DATE
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = benPlansE0.ENRT_CVG_STRT_DT_RL
    ) RES_COVERAGE_START_FORMULA
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'BEN_ENRT_CVG_END'
    AND LOOKUP_CODE = benPlansE0.ENRT_CVG_END_DT_CD
    ) RES_PREVIOUS_COVERAGE_END_DATE
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = benPlansE0.ENRT_CVG_END_DT_RL
    ) RES_PREVIOUS_COVERAGE_END_FORM
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'BEN_RT_STRT'
    AND LOOKUP_CODE = benPlansE0.RT_STRT_DT_CD
    ) RES_RATE_START_DATE
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = benPlansE0.RT_STRT_DT_RL
    ) RES_RATE_START_FORMULA
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'BEN_RT_END'
    AND LOOKUP_CODE = benPlansE0.RT_END_DT_CD
    ) RES_PREVIOUS_RATE_END_DATE
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = benPlansE0.RT_END_DT_RL
    ) RES_PREVIOUS_RATE_END_FORMULA
,DECODE(benPlansE0.NO_MN_OPTS_NUM_APLS_FLAG,'Y','Yes','No') RES_NO_MINIMUM
,benPlansE0.MN_OPTS_RQD_NUM RES_MINIMUM_NUMBER_OF_OPTIONS
,DECODE(benPlansE0.NO_MX_OPTS_NUM_APLS_FLAG,'Y','Yes','No') RES_NO_MAXIMUM
,benPlansE0.MX_OPTS_ALWD_NUM RES_MAXIMUM_NUMBER_OF_OPTIONS
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'BEN_RQD_PERD_ENRT_NENRT_TM_UOM'
    AND LOOKUP_CODE = benPlansE0.RQD_PERD_ENRT_NENRT_UOM
    ) RES_UNIT_OF_MEASURE
,benPlansE0.RQD_PERD_ENRT_NENRT_VAL RES_NUMBER_OF_UNITS_IN_PERIOD
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = benPlansE0.RQD_PERD_ENRT_NENRT_RL
    ) RES_REQUIRED_PERIOD_OF_ENROLLM
,benPlansE0.LAST_UPDATED_BY  RSC_LAST_UPDATED_BY
,benPlansE0.LAST_UPDATE_DATE  RSC_LAST_UPDATE_DATE
,benPlansE0.CREATED_BY  RSC_CREATED_BY
,benPlansE0.CREATION_DATE  RSC_CREATION_DATE
,null RSC_LEDGER_ID
,null RSC_CHART_OF_ACCOUNTS_ID
,null RSC_BUSINESS_UNIT_ID
,null RSC_LEGAL_ENTITY_ID
,null RSC_ORGANIZATION_ID
,null RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,benPlansE0.LEGISLATION_CODE RSC_COUNTRY_ID

FROM BEN_PL_F benPlansE0
,(SELECT NAME
	,PL_TYP_ID
    FROM BEN_PL_TYP_F
    WHERE SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
	AND OPT_TYP_CD != 'FLXCR'
	) planTypesE0
WHERE SYSDATE BETWEEN benPlansE0.EFFECTIVE_START_DATE AND benPlansE0.EFFECTIVE_END_DATE
AND benPlansE0.PL_TYP_ID = planTypesE0.PL_TYP_ID

UNION

SELECT benPlansE0.NAME RES_PLAN_NAME
,TO_CHAR(benPlansE0.EFFECTIVE_START_DATE,'DD-Mon-YYYY') RES_EFFECTIVE_START_DATE
,DECODE(TO_CHAR(benPlansE0.EFFECTIVE_END_DATE,'DD-Mon-YYYY'),'31-12-4712',NULL,TO_CHAR(benPlansE0.EFFECTIVE_END_DATE,'DD-Mon-YYYY')) RES_EFFECTIVE_END_DATE
,(SELECT NAME
    FROM BEN_OPT_F
    WHERE SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
    AND OPT_ID = optionsE0.OPT_ID
    ) RES_PLAN_OR_OPTION_NAME
,'Options' RES_PLAN_OR_OPTION_DESCRIPTION
,NULL RES_ENROLLMENT_METHOD
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = optionsE0.ENRT_RL
    ) RES_AUTOMATIC_FORMULA
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'BEN_DFLT_ENRT'
    AND LOOKUP_CODE = optionsE0.DFLT_ENRT_CD
    ) RES_DEFAULT_ENROLLMENT_RULE
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = optionsE0.DFLT_ENRT_DET_RL
    ) RES_DEFAULT_ENROLLMENT_FORMULA
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = optionsE0.POSTELCN_EDIT_RL
    ) RES_POST_ELECTION_FORMULA
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = optionsE0.RQD_PERD_ENRT_NENRT_RL
    ) RES_REQUIRED_FORMULA
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'BEN_ENRT'
    AND LOOKUP_CODE = optionsE0.ENRT_CD
    ) RES_ENROLLMENT_RULE
,DECODE(optionsE0.AUTO_ENRT_FLAG,'Y','Yes','No') RES_AUTOMATIC_ENROLLMENT
,DECODE(optionsE0.MNDTRY_FLAG,'Y','Yes','No') RES_REQUIRED
,DECODE(optionsE0.DFLT_FLAG,'Y','Yes','No') RES_ASSIGN_ON_DEFAULT
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = optionsE0.ENRT_RL
    ) RES_ENROLLMENT_FORMULA
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'BEN_DFLT_TO_ASN_PNDG_CTFN'
    AND LOOKUP_CODE = optionsE0.DFLT_TO_ASN_PNDG_CTFN_CD
    ) RES_INTERIM_RULE
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = optionsE0.DFLT_TO_ASN_PNDG_CTFN_RL
    ) RES_INTERIM_FORMULA
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'BEN_UNSSPND_ENRT'
    AND LOOKUP_CODE = optionsE0.UNSSPND_ENRT_CD
    ) RES_UNSUSPEND_ENROLLMENT_RULE
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = optionsE0.UNSSPND_RT_RL
    ) RES_UNSUSPEND_ENROLLMENT_FORMU
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'BEN_UNSSPND_ENRT'
    AND LOOKUP_CODE = optionsE0.UNSSPND_RT_CD
    ) RES_UNSUSPEND_RATE_RULE
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = optionsE0.UNSSPND_ENRT_RL
    ) RES_UNSUSPEND_RATE_FORMULA
,NULL RES_IMPUTED_INCOME_CALCULATION
,NULL RES_IMPUTED_INCOME_CALCULATI_0
/*,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'ORA_BEN_IMPTD_CVGAMT_EFFDT_CD'
    AND LOOKUP_CODE = benPlansE0.CONFIG_CHAR_6
    ) RES_IMPUTED_INCOME_CALCULATION
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = benPlansE0.UNSSPND_ENRT_RL
    ) RES_IMPUTED_INCOME_CALCULATI_0*/
,NULL RES_ENABLE_ENROLLMENT_IN_BOTH_
,NULL RES_ASSIGN_PLAN_OPTION_ON_DEFA
,NULL RES_ALLOW_MAXIMUM_NUMBER_OF_PL
,NULL RES_COVERAGE_START_DATE
,NULL RES_COVERAGE_START_FORMULA
,NULL RES_PREVIOUS_COVERAGE_END_DATE
,NULL RES_PREVIOUS_COVERAGE_END_FORM
,NULL RES_RATE_START_DATE
,NULL RES_RATE_START_FORMULA
,NULL RES_PREVIOUS_RATE_END_DATE
,NULL RES_PREVIOUS_RATE_END_FORMULA
,NULL RES_NO_MINIMUM
,NULL RES_MINIMUM_NUMBER_OF_OPTIONS
,NULL RES_NO_MAXIMUM
,NULL RES_MAXIMUM_NUMBER_OF_OPTIONS
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'BEN_RQD_PERD_ENRT_NENRT_TM_UOM'
    AND LOOKUP_CODE = optionsE0.RQD_PERD_ENRT_NENRT_UOM
    ) RES_UNIT_OF_MEASURE
,optionsE0.RQD_PERD_ENRT_NENRT_VAL RES_NUMBER_OF_UNITS_IN_PERIOD
,(SELECT FORMULA_NAME
    FROM FF_FORMULAS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND FORMULA_ID = optionsE0.RQD_PERD_ENRT_NENRT_RL
    ) RES_REQUIRED_PERIOD_OF_ENROLLM
,optionsE0.LAST_UPDATED_BY  RSC_LAST_UPDATED_BY
,optionsE0.LAST_UPDATE_DATE  RSC_LAST_UPDATE_DATE
,optionsE0.CREATED_BY  RSC_CREATED_BY
,optionsE0.CREATION_DATE  RSC_CREATION_DATE
,null RSC_LEDGER_ID
,null RSC_CHART_OF_ACCOUNTS_ID
,null RSC_BUSINESS_UNIT_ID
,null RSC_LEGAL_ENTITY_ID
,null RSC_ORGANIZATION_ID
,null RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,benPlansE0.LEGISLATION_CODE RSC_COUNTRY_ID

FROM BEN_PL_F benPlansE0
,(SELECT NAME
	,PL_TYP_ID
    FROM BEN_PL_TYP_F
    WHERE SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
	AND OPT_TYP_CD != 'FLXCR'
	) planTypesE0
,BEN_OIPL_F optionsE0
WHERE SYSDATE BETWEEN benPlansE0.EFFECTIVE_START_DATE AND benPlansE0.EFFECTIVE_END_DATE
AND benPlansE0.PL_TYP_ID = planTypesE0.PL_TYP_ID
AND benPlansE0.PL_ID = optionsE0.PL_ID
AND benPlansE0.EFFECTIVE_END_DATE BETWEEN optionsE0.EFFECTIVE_START_DATE AND optionsE0.EFFECTIVE_END_DATE

ORDER BY RES_PLAN_NAME
,RES_EFFECTIVE_START_DATE)