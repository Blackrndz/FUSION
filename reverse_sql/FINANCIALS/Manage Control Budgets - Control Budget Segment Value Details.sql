/* ****************************************************************************
 * $Revision$:
 * $Author$:
 * $Date$:
 * $HeadURL$:
 * $Id$:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */
 
-- RSC_PREREQUISITE_OBJECTS=XCC_CONTROL_BUDGETS

SELECT xccCONTROLBUDE0.NAME  RES_NAME
,xccRULE0.RULE_NAME RES_SUPPLEMENTAL_RULES_NAME
,segmentE0.SEGMENT_CODE RES_BUDGET_SEGMENT
,xccRULEFILTERVALE0.FILTER_CONDITION_VALUE RES_VALUE
,(SELECT DESCRIPTION FROM FND_VS_VALUES_VL WHERE VALUE_SET_ID = segmentE0.DEFAULT_VALUE_SET_ID
	AND VALUE = xccRULEFILTERVALE0.FILTER_CONDITION_VALUE) RES_DESCRIPTION


,xccRULEFILTERVALE0.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,xccRULEFILTERVALE0.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,xccRULEFILTERVALE0.CREATED_BY RSC_CREATED_BY
,xccRULEFILTERVALE0.CREATION_DATE RSC_CREATION_DATE
,xccCONTROLBUDE0.LEDGER_ID RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,NULL RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM XCC_CONTROL_BUDGETS xccCONTROLBUDE0
,XCC_CB_RULES xccRULE0
,XCC_CB_RULE_FILTER_CONDITIONS xccRULEFILTERE0
,XCC_CB_KEY_SEGMENTS xccKEYSEGE0
,XCC_CB_RULE_FILTER_COND_VALS  xccRULEFILTERVALE0
,(SELECT seg.DEFAULT_VALUE_SET_ID
,seg.SEGMENT_CODE
,seg.COLUMN_NAME
,strInst.STRUCTURE_INSTANCE_NUMBER
	FROM FND_KF_SEGMENTS_VL seg
	,FND_KF_STR_INSTANCES_VL strInst
	WHERE seg.STRUCTURE_ID                 = strInst.STRUCTURE_ID
	AND seg.ENABLED_FLAG                   = 'Y'
	AND strInst.ENABLED_FLAG               = 'Y'
	AND strInst.APPLICATION_ID             = 101
	AND strInst.KEY_FLEXFIELD_CODE         = 'GL#') segmentE0
WHERE xccCONTROLBUDE0.CONTROL_BUDGET_ID  = xccRULE0.CONTROL_BUDGET_ID 
AND xccRULE0.RULE_ID = xccRULEFILTERE0.RULE_ID
AND xccRULE0.CONTROL_BUDGET_ID = xccKEYSEGE0.CONTROL_BUDGET_ID
AND xccRULEFILTERE0.FILTER_CONDITION_CODE = xccKEYSEGE0.KEY_SEGMENT_COLUMN_NAME
AND xccRULEFILTERE0.FILTER_CONDITION_TYPE = 'BUDGET_GL_COA_SEGMENT'
AND xccRULEFILTERE0.RULE_FILTER_CONDITION_ID = xccRULEFILTERVALE0.RULE_FILTER_CONDITION_ID
AND segmentE0.STRUCTURE_INSTANCE_NUMBER  = xccCONTROLBUDE0.CHART_OF_ACCOUNTS_ID
AND segmentE0.COLUMN_NAME = xccKEYSEGE0.SOURCE_SEGMENT_COLUMN_NAME
ORDER BY xccCONTROLBUDE0.NAME,xccRULE0.RULE_NAME,segmentE0.SEGMENT_CODE