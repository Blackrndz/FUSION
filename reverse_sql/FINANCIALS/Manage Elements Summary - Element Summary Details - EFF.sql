/* ****************************************************************************
 * $Revision: 72914 $:
 * $Author: pisan.jariyasettachok $:
 * $Date: 2019-11-15 15:06:19 +0700 (Fri, 15 Nov 2019) $:
 * $HeadURL: http://svn01.rapidesuite.com:999/svn/a/dev/rapidesuite/controldata/FUSION_11.1.13/trunk/core/reverse_sql/FINANCIALS/Manage%20Document%20Sequences%20-%20Assignment.sql $:
 * $Id: Manage Document Sequences - Assignment.sql 72914 2019-11-15 08:06:19Z pisan.jariyasettachok $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */

-- VALUE_SET_LOGIC_TO_APPLY_FIELDS=RES_FIELD_VALUE

WITH EFF_STUCTURE AS ( SELECT valueSET.VALIDATION_TYPE,valueSET.VALUE_SET_CODE,EFF.CONTEXT_CODE,EFF.COLUMN_NAME,EFF.SEQUENCE_NUMBER,EFF.PROMPT
FROM FND_DF_SEGMENTS_VL EFF,FND_VS_VALUE_SETS valueSET 
WHERE EFF.VALUE_SET_ID = valueSET.VALUE_SET_ID AND EFF.ENABLED_FLAG = 'Y'
AND EFF.DESCRIPTIVE_FLEXFIELD_CODE = 'PAY_ELEMENT_INFORMATION_EFF')

SELECT RES_ELEMENT_NAME
,RES_LEGISLATIVE_DATA_GROUP
,RES_PRIMARY_CLASSIFICATION
,RES_SECONDARY_CLASSIFICATION
,RES_EFFECTIVE_START_DATE
,RES_FIELD_NAME
,(CASE WHEN VALIDATION_TYPE = 'TABLE' 
	THEN (VALUE_SET_CODE||'###R4C###'||RES_FIELD_VALUE)
	ELSE RES_FIELD_VALUE END) RES_FIELD_VALUE

,RSC_LAST_UPDATED_BY
,RSC_LAST_UPDATE_DATE
,RSC_CREATED_BY
,RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,NULL RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,NULL RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,RSC_COUNTRY_ID

	
FROM
(SELECT  elementsE0.ELEMENT_NAME RES_ELEMENT_NAME
,legislativeDataGrpsE0.NAME RES_LEGISLATIVE_DATA_GROUP
,(SELECT CLASSIFICATION_NAME
    FROM PAY_ELE_CLASSIFICATIONS_VL
	WHERE BASE_CLASSIFICATION_ID = elementsE0.CLASSIFICATION_ID
	AND LEGISLATION_CODE = legislativeDataGrpsE0.LEGISLATION_CODE
	AND SYSDATE BETWEEN DATE_FROM AND NVL(DATE_TO,TO_DATE('4712-12-31','YYYY-MM-DD'))
	) RES_PRIMARY_CLASSIFICATION
,(SELECT CLASSIFICATION_NAME
    FROM PAY_ELE_CLASSIFICATIONS_VL
    WHERE BASE_CLASSIFICATION_ID = elementsE0.SECONDARY_CLASSIFICATION_ID
	AND LEGISLATION_CODE = legislativeDataGrpsE0.LEGISLATION_CODE
	AND SYSDATE BETWEEN DATE_FROM AND NVL(DATE_TO,TO_DATE('4712-12-31','YYYY-MM-DD'))
    ) RES_SECONDARY_CLASSIFICATION
,TO_CHAR(elementsE0.EFFECTIVE_START_DATE,'DD-Mon-YYYY') RES_EFFECTIVE_START_DATE
,1 ROW_NUM
,SEQUENCE_NUMBER
,PROMPT RES_FIELD_NAME
,EFF_STUCTURE.VALIDATION_TYPE
,EFF_STUCTURE.VALUE_SET_CODE
,DECODE(EFF_STUCTURE.COLUMN_NAME
	,'EEI_INFORMATION1',elementsEXTRAE0.EEI_INFORMATION1
	,'EEI_INFORMATION2',elementsEXTRAE0.EEI_INFORMATION2
	,'EEI_INFORMATION3',elementsEXTRAE0.EEI_INFORMATION3
	,'EEI_INFORMATION4',elementsEXTRAE0.EEI_INFORMATION4
	,'EEI_INFORMATION5',elementsEXTRAE0.EEI_INFORMATION5
	,'EEI_INFORMATION6',elementsEXTRAE0.EEI_INFORMATION6
	,'EEI_INFORMATION7',elementsEXTRAE0.EEI_INFORMATION7
	,'EEI_INFORMATION8',elementsEXTRAE0.EEI_INFORMATION8
	,'EEI_INFORMATION9',elementsEXTRAE0.EEI_INFORMATION9
	,'EEI_INFORMATION10',elementsEXTRAE0.EEI_INFORMATION10
	,'EEI_INFORMATION11',elementsEXTRAE0.EEI_INFORMATION11
	,'EEI_INFORMATION12',elementsEXTRAE0.EEI_INFORMATION12
	,'EEI_INFORMATION13',elementsEXTRAE0.EEI_INFORMATION13
	,'EEI_INFORMATION14',elementsEXTRAE0.EEI_INFORMATION14
	,'EEI_INFORMATION15',elementsEXTRAE0.EEI_INFORMATION15
	,'EEI_INFORMATION16',elementsEXTRAE0.EEI_INFORMATION16
	,'EEI_INFORMATION17',elementsEXTRAE0.EEI_INFORMATION17
	,'EEI_INFORMATION18',elementsEXTRAE0.EEI_INFORMATION18
	,'EEI_INFORMATION19',elementsEXTRAE0.EEI_INFORMATION19
	,'EEI_INFORMATION20',elementsEXTRAE0.EEI_INFORMATION20
	,'EEI_INFORMATION21',elementsEXTRAE0.EEI_INFORMATION21
	,'EEI_INFORMATION22',elementsEXTRAE0.EEI_INFORMATION22
	,'EEI_INFORMATION23',elementsEXTRAE0.EEI_INFORMATION23
	,'EEI_INFORMATION24',elementsEXTRAE0.EEI_INFORMATION24
	,'EEI_INFORMATION25',elementsEXTRAE0.EEI_INFORMATION25
	,'EEI_INFORMATION26',elementsEXTRAE0.EEI_INFORMATION26
	,'EEI_INFORMATION27',elementsEXTRAE0.EEI_INFORMATION27
	,'EEI_INFORMATION28',elementsEXTRAE0.EEI_INFORMATION28
	,'EEI_INFORMATION29',elementsEXTRAE0.EEI_INFORMATION29
	,'EEI_INFORMATION30',elementsEXTRAE0.EEI_INFORMATION30
	,'EEI_ATTRIBUTE1',elementsEXTRAE0.EEI_ATTRIBUTE1
	,'EEI_ATTRIBUTE2',elementsEXTRAE0.EEI_ATTRIBUTE2
	,'EEI_ATTRIBUTE3',elementsEXTRAE0.EEI_ATTRIBUTE3
	,'EEI_ATTRIBUTE4',elementsEXTRAE0.EEI_ATTRIBUTE4
	,'EEI_ATTRIBUTE5',elementsEXTRAE0.EEI_ATTRIBUTE5
	,'EEI_ATTRIBUTE6',elementsEXTRAE0.EEI_ATTRIBUTE6
	,'EEI_ATTRIBUTE7',elementsEXTRAE0.EEI_ATTRIBUTE7
	,'EEI_ATTRIBUTE8',elementsEXTRAE0.EEI_ATTRIBUTE8
	,'EEI_ATTRIBUTE9',elementsEXTRAE0.EEI_ATTRIBUTE9
	,'EEI_ATTRIBUTE10',elementsEXTRAE0.EEI_ATTRIBUTE10
	,'EEI_ATTRIBUTE11',elementsEXTRAE0.EEI_ATTRIBUTE11
	,'EEI_ATTRIBUTE12',elementsEXTRAE0.EEI_ATTRIBUTE12
	,'EEI_ATTRIBUTE13',elementsEXTRAE0.EEI_ATTRIBUTE13
	,'EEI_ATTRIBUTE14',elementsEXTRAE0.EEI_ATTRIBUTE14
	,'EEI_ATTRIBUTE15',elementsEXTRAE0.EEI_ATTRIBUTE15
	,'EEI_ATTRIBUTE16',elementsEXTRAE0.EEI_ATTRIBUTE16
	,'EEI_ATTRIBUTE17',elementsEXTRAE0.EEI_ATTRIBUTE17
	,'EEI_ATTRIBUTE18',elementsEXTRAE0.EEI_ATTRIBUTE18
	,'EEI_ATTRIBUTE19',elementsEXTRAE0.EEI_ATTRIBUTE19
	,'EEI_ATTRIBUTE20',elementsEXTRAE0.EEI_ATTRIBUTE20
	,'EEI_INFORMATION_NUMBER1',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_NUMBER1)
	,'EEI_INFORMATION_NUMBER2',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_NUMBER2)
	,'EEI_INFORMATION_NUMBER3',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_NUMBER3)
	,'EEI_INFORMATION_NUMBER4',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_NUMBER4)
	,'EEI_INFORMATION_NUMBER5',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_NUMBER5)
	,'EEI_INFORMATION_NUMBER6',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_NUMBER6)
	,'EEI_INFORMATION_NUMBER7',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_NUMBER7)
	,'EEI_INFORMATION_NUMBER8',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_NUMBER8)
	,'EEI_INFORMATION_NUMBER9',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_NUMBER9)
	,'EEI_INFORMATION_NUMBER10',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_NUMBER10)
	,'EEI_INFORMATION_NUMBER11',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_NUMBER11)
	,'EEI_INFORMATION_NUMBER12',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_NUMBER12)
	,'EEI_INFORMATION_NUMBER13',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_NUMBER13)
	,'EEI_INFORMATION_NUMBER14',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_NUMBER14)
	,'EEI_INFORMATION_NUMBER15',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_NUMBER15)
	,'EEI_INFORMATION_NUMBER16',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_NUMBER16)
	,'EEI_INFORMATION_NUMBER17',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_NUMBER17)
	,'EEI_INFORMATION_NUMBER18',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_NUMBER18)
	,'EEI_INFORMATION_NUMBER19',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_NUMBER19)
	,'EEI_INFORMATION_NUMBER20',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_NUMBER20)
	,'EEI_INFORMATION_DATE1',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_DATE1,'DD-Mon-YYYY')
	,'EEI_INFORMATION_DATE2',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_DATE2,'DD-Mon-YYYY')
	,'EEI_INFORMATION_DATE3',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_DATE3,'DD-Mon-YYYY')
	,'EEI_INFORMATION_DATE4',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_DATE4,'DD-Mon-YYYY')
	,'EEI_INFORMATION_DATE5',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_DATE5,'DD-Mon-YYYY')
	,'EEI_INFORMATION_DATE6',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_DATE6,'DD-Mon-YYYY')
	,'EEI_INFORMATION_DATE7',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_DATE7,'DD-Mon-YYYY')
	,'EEI_INFORMATION_DATE8',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_DATE8,'DD-Mon-YYYY')
	,'EEI_INFORMATION_DATE9',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_DATE9,'DD-Mon-YYYY')
	,'EEI_INFORMATION_DATE10',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_DATE10,'DD-Mon-YYYY')
	,'EEI_INFORMATION_DATE11',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_DATE11,'DD-Mon-YYYY')
	,'EEI_INFORMATION_DATE12',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_DATE12,'DD-Mon-YYYY')
	,'EEI_INFORMATION_DATE13',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_DATE13,'DD-Mon-YYYY')
	,'EEI_INFORMATION_DATE14',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_DATE14,'DD-Mon-YYYY')
	,'EEI_INFORMATION_DATE15',TO_CHAR(elementsEXTRAE0.EEI_INFORMATION_DATE15,'DD-Mon-YYYY')) RES_FIELD_VALUE
	
,elementsEXTRAE0.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,elementsEXTRAE0.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,elementsEXTRAE0.CREATED_BY RSC_CREATED_BY
,elementsEXTRAE0.CREATION_DATE RSC_CREATION_DATE
,legislativeDataGrpsE0.LEGISLATION_CODE RSC_COUNTRY_ID

FROM PAY_ELEMENT_TYPES_VL elementsE0
,PAY_ELE_TYPE_EXTRA_INFO elementsEXTRAE0
,(SELECT NAME
    ,LEGISLATIVE_DATA_GROUP_ID
	,LEGISLATION_CODE
    FROM PER_LEGISLATIVE_DATA_GROUPS_VL
    ) legislativeDataGrpsE0
,EFF_STUCTURE
	
WHERE elementsE0.LEGISLATIVE_DATA_GROUP_ID = legislativeDataGrpsE0.LEGISLATIVE_DATA_GROUP_ID
AND elementsE0.ELEMENT_TYPE_ID = elementsEXTRAE0.ELEMENT_TYPE_ID
AND EFF_STUCTURE.CONTEXT_CODE = elementsEXTRAE0.EEI_INFORMATION_CATEGORY

UNION

SELECT elementsE0.ELEMENT_NAME RES_ELEMENT_NAME
,legislativeDataGrpsE0.NAME RES_LEGISLATIVE_DATA_GROUP
,(SELECT CLASSIFICATION_NAME
    FROM PAY_ELE_CLASSIFICATIONS_VL
	WHERE BASE_CLASSIFICATION_ID = elementsE0.CLASSIFICATION_ID
	AND LEGISLATION_CODE = legislativeDataGrpsE0.LEGISLATION_CODE
	) RES_PRIMARY_CLASSIFICATION
,(SELECT CLASSIFICATION_NAME
    FROM PAY_ELE_CLASSIFICATIONS_VL
    WHERE BASE_CLASSIFICATION_ID = elementsE0.SECONDARY_CLASSIFICATION_ID
	AND LEGISLATION_CODE = legislativeDataGrpsE0.LEGISLATION_CODE
    ) RES_SECONDARY_CLASSIFICATION
,TO_CHAR(elementsE0.EFFECTIVE_START_DATE,'DD-Mon-YYYY') RES_EFFECTIVE_START_DATE
,ROW_NUMBER() OVER (PARTITION BY elementsE0.ELEMENT_TYPE_ID,elementsE0.EFFECTIVE_START_DATE ORDER BY elementsEXTRAE0.LAST_UPDATE_DATE DESC) ROW_NUM
,NULL SEQUENCE_NUMBER
,'EeiInformation1' RES_FIELD_NAME
,NULL VALIDATION_TYPE
,NULL VALUE_SET_CODE
,elementsEXTRAE0.EEI_INFORMATION1 RES_FIELD_VALUE

,elementsEXTRAE0.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,elementsEXTRAE0.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,elementsEXTRAE0.CREATED_BY RSC_CREATED_BY
,elementsEXTRAE0.CREATION_DATE RSC_CREATION_DATE
,legislativeDataGrpsE0.LEGISLATION_CODE RSC_COUNTRY_ID

FROM PAY_ELEMENT_TYPES_VL elementsE0
,PAY_ELE_TYPE_EXTRA_INFO elementsEXTRAE0
,(SELECT NAME
    ,LEGISLATIVE_DATA_GROUP_ID
	,LEGISLATION_CODE
    FROM PER_LEGISLATIVE_DATA_GROUPS_VL
    ) legislativeDataGrpsE0
WHERE elementsE0.LEGISLATIVE_DATA_GROUP_ID = legislativeDataGrpsE0.LEGISLATIVE_DATA_GROUP_ID
AND elementsE0.ELEMENT_TYPE_ID = elementsEXTRAE0.ELEMENT_TYPE_ID 
	
UNION

SELECT elementsE0.ELEMENT_NAME RES_ELEMENT_NAME
,legislativeDataGrpsE0.NAME RES_LEGISLATIVE_DATA_GROUP
,(SELECT CLASSIFICATION_NAME
    FROM PAY_ELE_CLASSIFICATIONS_VL
	WHERE BASE_CLASSIFICATION_ID = elementsE0.CLASSIFICATION_ID
	AND LEGISLATION_CODE = legislativeDataGrpsE0.LEGISLATION_CODE
	) RES_PRIMARY_CLASSIFICATION
,(SELECT CLASSIFICATION_NAME
    FROM PAY_ELE_CLASSIFICATIONS_VL
    WHERE BASE_CLASSIFICATION_ID = elementsE0.SECONDARY_CLASSIFICATION_ID
	AND LEGISLATION_CODE = legislativeDataGrpsE0.LEGISLATION_CODE
    ) RES_SECONDARY_CLASSIFICATION
,TO_CHAR(elementsE0.EFFECTIVE_START_DATE,'DD-Mon-YYYY') RES_EFFECTIVE_START_DATE
,ROW_NUMBER() OVER (PARTITION BY elementsE0.ELEMENT_TYPE_ID,elementsE0.EFFECTIVE_START_DATE ORDER BY elementsEXTRAE0.LAST_UPDATE_DATE DESC) ROW_NUM
,NULL SEQUENCE_NUMBER
,'EeiInformation2' RES_FIELD_NAME
,NULL VALIDATION_TYPE
,NULL VALUE_SET_CODE
,elementsEXTRAE0.EEI_INFORMATION2 RES_FIELD_VALUE

,elementsEXTRAE0.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,elementsEXTRAE0.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,elementsEXTRAE0.CREATED_BY RSC_CREATED_BY
,elementsEXTRAE0.CREATION_DATE RSC_CREATION_DATE
,legislativeDataGrpsE0.LEGISLATION_CODE RSC_COUNTRY_ID

FROM PAY_ELEMENT_TYPES_VL elementsE0
,PAY_ELE_TYPE_EXTRA_INFO elementsEXTRAE0
,(SELECT NAME
    ,LEGISLATIVE_DATA_GROUP_ID
	,LEGISLATION_CODE
    FROM PER_LEGISLATIVE_DATA_GROUPS_VL
    ) legislativeDataGrpsE0
WHERE elementsE0.LEGISLATIVE_DATA_GROUP_ID = legislativeDataGrpsE0.LEGISLATIVE_DATA_GROUP_ID
AND elementsE0.ELEMENT_TYPE_ID = elementsEXTRAE0.ELEMENT_TYPE_ID 

)
WHERE RES_FIELD_VALUE IS NOT NULL
AND ROW_NUM = 1
ORDER BY RES_ELEMENT_NAME,RES_EFFECTIVE_START_DATE,SEQUENCE_NUMBER NULLS FIRST,RES_FIELD_NAME