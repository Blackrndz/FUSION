
/* ****************************************************************************
 * $Revision:  $:
 * $Author: Nasrullah Dusenmahamad $:
 * $Date: 2018-03-20  $:
 * $HeadURL: $:
 * $Id: Configure Exception Sets - Exception  $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */
 
-- RSC_PREREQUISITE_OBJECTS=HWM_TCATS_VL
-- REPLACE_HTML_KEYWORD = RES_INTERNAL_POSTING_DESCRIPTI

SELECT jobReqTemplatesE0.NAME RES_NAME
,jobReqTemplatesE0.REQUISITION_NUMBER RES_CODE
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'ORA_IRC_REQ_TEMPLATE_TYPE'
    AND LOOKUP_CODE = jobReqTemplatesE0.REQ_USAGE_TYPE 
	) RES_TYPE
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'ORA_IRC_OBJECT_STATUS'
    AND LOOKUP_CODE = jobReqTemplatesE0.OBJECT_STATUS  
	) RES_STATUS
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'ORA_IRC_RECRUITING_TYPE'
    AND LOOKUP_CODE = jobReqTemplatesE0.RECRUITING_TYPE_CODE
    ) RES_RECRUITING_TYPE
,(SELECT BU_NAME
    FROM FUN_ALL_BUSINESS_UNITS_V
    WHERE BU_ID = jobReqTemplatesE0.BUSINESS_UNIT_ID
    ) RES_BUSINESS_UNIT
,jobReqTemplatesE0.TITLE RES_REQUISITION_TITLE
,(SELECT DISPLAY_NAME
    FROM PER_PERSON_NAMES_F
    WHERE NAME_TYPE = 'GLOBAL'
    AND PERSON_ID = jobReqTemplatesE0.HIRING_MANAGER_ID
    ) RES_HIRING_MANAGER
,(SELECT DISPLAY_NAME
    FROM PER_PERSON_NAMES_F
    WHERE NAME_TYPE = 'GLOBAL'
	AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
    AND PERSON_ID = jobReqTemplatesE0.RECRUITER_ID
    ) RES_RECRUITER
	

--Posting Structure
,(SELECT NAME -->Not done
    FROM HR_ORGANIZATION_UNITS_F_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
    AND ORGANIZATION_ID = jobReqTemplatesE0.ORGANIZATION_ID
    ) RES_ORGANIZATION
,(SELECT (CASE WHEN GEOGRAPHY_ELEMENT10 IS NOT NULL THEN GEOGRAPHY_ELEMENT10||', ' END)||
        (CASE WHEN GEOGRAPHY_ELEMENT9 IS NOT NULL THEN GEOGRAPHY_ELEMENT9||', ' END)||
        (CASE WHEN GEOGRAPHY_ELEMENT8 IS NOT NULL THEN GEOGRAPHY_ELEMENT8||', ' END)||
        (CASE WHEN GEOGRAPHY_ELEMENT7 IS NOT NULL THEN GEOGRAPHY_ELEMENT7||', ' END)||
        (CASE WHEN GEOGRAPHY_ELEMENT6 IS NOT NULL THEN GEOGRAPHY_ELEMENT6||', ' END)||
        (CASE WHEN GEOGRAPHY_ELEMENT5 IS NOT NULL THEN GEOGRAPHY_ELEMENT5||', ' END)||
        (CASE WHEN GEOGRAPHY_ELEMENT4 IS NOT NULL THEN GEOGRAPHY_ELEMENT4||', ' END)||
        (CASE WHEN GEOGRAPHY_ELEMENT3 IS NOT NULL THEN GEOGRAPHY_ELEMENT3||', ' END)||
        (CASE WHEN GEOGRAPHY_ELEMENT2 IS NOT NULL THEN GEOGRAPHY_ELEMENT2||', ' END)||
        (CASE WHEN GEOGRAPHY_ELEMENT1 IS NOT NULL THEN GEOGRAPHY_ELEMENT1 END)
    FROM HZ_GEOGRAPHIES
    WHERE GEOGRAPHY_ID = geoMapsE0.GEOGRAPHY_ID
    ) RES_PRIMARY_LOCATION
,(SELECT JOB_FAMILY_NAME
    FROM PER_JOB_FAMILY_F_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
    AND JOB_FAMILY_ID = jobReqTemplatesE0.JOB_FAMILY_ID
    ) RES_JOB_FAMILY
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'JOB_FUNCTION_CODE'
    AND LOOKUP_CODE = jobReqTemplatesE0.JOB_FUNCTION_CODE
    ) RES_JOB_FUNCTION
    
    
--Offer Information
,(SELECT NAME
    FROM HR_ORGANIZATION_UNITS_F_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
    AND ORGANIZATION_ID = jobReqTemplatesE0.DEPARTMENT_ID
    ) RES_DEPARTMENT
,(SELECT LOCATION_NAME
    FROM PER_LOCATION_DETAILS_F_VL
    WHERE SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
    AND LOCATION_ID = jobReqTemplatesE0.LOCATION_ID
    ) RES_PRIMARY_WORK_LOCATION
,(SELECT NAME
    FROM PER_GRADES_F_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND SYSDATE BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE
    AND GRADE_ID = jobReqTemplatesE0.GRADE_ID
    ) RES_GRADE
,(SELECT NAME
    FROM HR_ORGANIZATION_UNITS
    WHERE SYSDATE BETWEEN DATE_FROM AND DATE_TO
    AND ORGANIZATION_ID = jobReqTemplatesE0.LEGAL_EMPLOYER_ID 
	) RES_LEGAL_EMPLOYER
    
    
--Budget
,(SELECT NAME
    FROM FND_CURRENCIES_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND CURRENCY_CODE = jobReqTemplatesE0.BUDGET_CURRENCY_CODE
    ) RES_BUDGET_CURRENCY
,jobReqTemplatesE0.EMPLOYEE_REFERRAL_BONUS RES_EMPLOYEE_REFERRAL_BONUS
,jobReqTemplatesE0.SOURCING_BUDGET RES_SOURCING_BUDGET
,jobReqTemplatesE0.TRAVEL_BUDGET RES_TRAVEL_BUDGET
,jobReqTemplatesE0.RELOCATION_BUDGET RES_RELOCATION_BUDGET


--Compensation
,(SELECT NAME
    FROM FND_CURRENCIES_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND CURRENCY_CODE = jobReqTemplatesE0.SALARY_CURRENCY_CODE
    ) RES_COMPENSATION_CURRENCY
,jobReqTemplatesE0.MIN_SALARY RES_MINIMUM_SALARY
,jobReqTemplatesE0.MAX_SALARY RES_MAXIMUM_SALARY
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'CMP_SALARY_BASIS'
    AND LOOKUP_CODE = jobReqTemplatesE0.SALARY_FREQUENCY_CODE
    ) RES_PAY_FREQUENCY


--Job Profile
,DECODE(profilesE0.ITEM_TEXT30_1,'Y','Yes','No') RES_TRAVEL_REQUIRED
,DECODE(profilesE0.ITEM_TEXT30_2,'Y','Yes','No') RES_INTERNATIONAL_TRAVEL_REQUI
,profilesE0.ITEM_NUMBER_1 RES_WORK_DURATION_MONTHS
,profilesE0.ITEM_NUMBER_2 RES_WORK_DURATION_YEARS
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'HRT_WORK_DAYS'
    AND LOOKUP_CODE = profilesE0.ITEM_TEXT30_14
     ) RES_WORK_DAYS



--Additional Details
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'PER_PERIOD_TYPE'
    AND LOOKUP_CODE = jobReqTemplatesE0.WORKER_TYPE_CODE
    ) RES_WORKER_TYPE
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'REGULAR_TEMPORARY'
    AND LOOKUP_CODE = jobReqTemplatesE0.REGULAR_TEMPORARY
    ) RES_REGULAR_OR_TEMPORARY
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'MANAGER_LEVEL'
    AND LOOKUP_CODE = jobReqTemplatesE0.MANAGER_LEVEL
    ) RES_MANAGEMENT_LEVEL
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'PART_FULL_TIME'
    AND LOOKUP_CODE = jobReqTemplatesE0.FULL_PART_TIME
    ) RES_FULL_TIME_OR_PART_TIME
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'ORA_IRC_JOB_SHIFT'
    AND LOOKUP_CODE = jobReqTemplatesE0.JOB_SHIFT_CODE
    ) RES_JOB_SHIFT
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'ORA_IRC_JOB_TYPE'
    AND LOOKUP_CODE = jobReqTemplatesE0.JOB_TYPE_CODE
    ) RES_JOB_TYPE
,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'HRT_EDUCATION_LEVEL'
    AND LOOKUP_CODE = jobReqTemplatesE0.STUDY_LEVEL_CODE
    ) RES_EDUCATION_LEVEL


--Posting Description
,REPLACE(REPLACE(REPLACE(jobReqTemplatesE0.INTERNAL_SHORT_DESC,'&','#AMP#'),'<','#OPENTAG#'),'>','#CLOSETAG#') RES_INTERNAL_POSTING_DESCRIPTI
,'' RES_ENTER_CUSTOM_INTERNAL_POST
,'' RES_SAME_DESCRIPTION_FOR_INTER
/*,jobReqTemplatesE0.INTERNAL_DESC_HTML 
,jobReqTemplatesE0.EXTERNAL_SHORT_DESC
,jobReqTemplatesE0.EXTERNAL_DESC_HTML*/


,jobReqTemplatesE0.INT_CONTACT_NAME RES_NAME_OF_INTERNAL_CONTACT
,jobReqTemplatesE0.INT_CONTACT_EMAIL RES_EMAIL_OF_INTERNAL_CONTACT
,jobReqTemplatesE0.EXT_CONTACT_NAME RES_NAME_OF_EXTERNAL_CONTACT
,jobReqTemplatesE0.EXT_CONTACT_EMAIL RES_EMAIL_OF_EXTERNAL_CONTACT


--Configuration
,(SELECT NAME
    FROM IRC_PROCESSES_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND PROCESS_ID = jobReqTemplatesE0.SUBS_PROCESS_TEMPLATE_ID
    ) RES_CANDIDATE_SELECTION_PROCES
,(SELECT APPLY_FLOW_NAME
    FROM IRC_APPLY_FLOWS_TL
    WHERE LANGUAGE = USERENV('LANG')
    AND APPLY_FLOW_ID = jobReqTemplatesE0.EXTERNAL_APPLY_FLOW_ID
    ) RES_EXTERNAL_APPLICATION_FLOW

,(SELECT MEANING
    FROM FND_LOOKUP_VALUES
    WHERE LANGUAGE = USERENV('LANG')
    AND LOOKUP_TYPE = 'ORA_IRC_REQ_AUTO_OPEN'
    AND LOOKUP_CODE = jobReqTemplatesE0.AUTO_OPEN_REQUISITION 
	) RES_AUTOMATICALLY_OPEN_REQUISI

,jobReqTemplatesE0.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,jobReqTemplatesE0.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,jobReqTemplatesE0.CREATED_BY RSC_CREATED_BY
,jobReqTemplatesE0.CREATION_DATE RSC_CREATION_DATE
,null RSC_LEDGER_ID
,null RSC_CHART_OF_ACCOUNTS_ID
,null RSC_BUSINESS_UNIT_ID
,null RSC_LEGAL_ENTITY_ID
,null RSC_ORGANIZATION_ID
,null RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM IRC_REQUISITIONS_VL jobReqTemplatesE0
,IRC_GEO_HIER_NODES geoMapsE0
,HRT_PROFILE_ITEMS profilesE0
WHERE jobReqTemplatesE0.REQ_USAGE_CODE = 'ORA_TEMPLATE'
AND jobReqTemplatesE0.GEOGRAPHY_NODE_ID = geoMapsE0.GEOGRAPHY_NODE_ID(+)
AND jobReqTemplatesE0.PROFILE_ID = profilesE0.PROFILE_ID(+)
ORDER BY jobReqTemplatesE0.REQUISITION_NUMBER