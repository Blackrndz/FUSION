/* ****************************************************************************
 * $Revision: 78229 $:
 * $Author: pisan.jariyasettachok $:
 * $Date: 2022-04-07 14:37:05 +0700 (Thu, 07 Apr 2022) $:
 * $HeadURL: https://svn03.rapid4cloud.com/svn/a/dev/rapidesuite/controldata/FUSION_11.1.13/trunk/core/reverse_sql/FINANCIALS/Manage%20Organization%20Payment%20Methods%20-%20Payment%20Sources.sql $:
 * $Id: Manage Organization Payment Methods - Payment Sources.sql 78229 2022-04-07 07:37:05Z pisan.jariyasettachok $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */
 
SELECT DISTINCT payORGPAYMETEO.ORG_PAYMENT_METHOD_NAME RES_NAME
,tmpEO.ORG_PAYMENT_METHOD_NAME RES_PAYMENT_SOURCE_NAME
,tmpEO.BANK_ACCOUNT_NAME RES_BANK_ACCOUNT_NAME
,tmpEO.BANK_NAME RES_BANK_NAME
,tmpEO.EFT_BUREAU_REFERENCE_TYPE RES_BANK_REFERENCE_TYPE
,tmpEO.EFT_BUREAU_REFERENCE RES_BANK_REFERENCE
,tmpEO.EFT_USER_NAME RES_COMPANY_NAME
,(CASE WHEN (SELECT LEGISLATION_CODE FROM PER_LEGISLATIVE_DATA_GROUPS_VL WHERE LEGISLATIVE_DATA_GROUP_ID = 
	tmpEO.LEGISLATIVE_DATA_GROUP_ID) IN ('AE','KWD','QAR') THEN 
	tmpEO.EFT_USER_REFERENCE_TYPE 
	ELSE 
		NULL END)RES_EMPLOYER_CODE 
,(CASE WHEN (SELECT LEGISLATION_CODE FROM PER_LEGISLATIVE_DATA_GROUPS_VL WHERE LEGISLATIVE_DATA_GROUP_ID = 
	tmpEO.LEGISLATIVE_DATA_GROUP_ID) NOT IN ('AE','KWD','QAR') THEN 
		tmpEO.EFT_USER_REFERENCE_TYPE 
	ELSE 
		NULL END)RES_COMPANY_REFERENCE_TYPE 
,(CASE WHEN payORGPAYMETEO.PAYMENT_TYPE_ID IN (SELECT BASE_PAYMENT_TYPE_ID FROM PAY_PAYMENT_TYPES_VL WHERE PAYMENT_TYPE_NAME IN ('BACS','International Transfer')
	AND LEGISLATION_CODE IN (SELECT LEGISLATION_CODE FROM PER_LEGISLATIVE_DATA_GROUPS_VL WHERE LEGISLATIVE_DATA_GROUP_ID = payORGPAYMETEO.LEGISLATIVE_DATA_GROUP_ID))
	THEN NULL
	ELSE tmpEO.EFT_USER_REFERENCE END) RES_COMPANY_REFERENCE
,DECODE(tmpEO.EFT_BALANCING_FLAG,'Y','Yes','No') RES_INCLUDE_BALANCING_ENTRIES
,(SELECT CATEGORY_NAME FROM PAY_REPORT_CATEGORIES_VL WHERE REPORT_CATEGORY_ID = tmpEO.EXT_DELIVERY_OPTION_ID) RES_REPORT_CATEGORY_FOR_WORKER
,(SELECT CATEGORY_NAME FROM PAY_REPORT_CATEGORIES_VL WHERE REPORT_CATEGORY_ID = tmpEO.THIRD_PARTY_DEL_OPTION_ID) RES_REPORT_CATEGORY_FOR_THIRD_
,tmpEO.EFT_TRANSACTION_LIMIT RES_TRANSACTION_LIMIT
,tmpEO.EFT_FILE_LIMIT RES_PAYMENT_LIMIT
,tmpEO.EFT_REFERENCE RES_PAYMENT_REFERENCE
,(CASE WHEN payORGPAYMETEO.PAYMENT_TYPE_ID IN (SELECT BASE_PAYMENT_TYPE_ID FROM PAY_PAYMENT_TYPES_VL WHERE PAYMENT_TYPE_NAME IN ('BACS','International Transfer')
	AND LEGISLATION_CODE IN (SELECT LEGISLATION_CODE FROM PER_LEGISLATIVE_DATA_GROUPS_VL WHERE LEGISLATIVE_DATA_GROUP_ID = payORGPAYMETEO.LEGISLATIVE_DATA_GROUP_ID))
	THEN NULL
	ELSE tmpEO.EFT_TEXT END) RES_PAYMENT_FREE_TEXT
,tmpEO.EFT_TEXT2 RES_ADDITIONAL_PAYMENT_TEXT
,(CASE WHEN payORGPAYMETEO.PAYMENT_TYPE_ID IN (SELECT BASE_PAYMENT_TYPE_ID FROM PAY_PAYMENT_TYPES_VL WHERE PAYMENT_TYPE_NAME IN ('BACS','International Transfer')
	AND LEGISLATION_CODE IN (SELECT LEGISLATION_CODE FROM PER_LEGISLATIVE_DATA_GROUPS_VL WHERE LEGISLATIVE_DATA_GROUP_ID = payORGPAYMETEO.LEGISLATIVE_DATA_GROUP_ID))
	THEN tmpEO.EFT_USER_REFERENCE 
	ELSE NULL END) RES_BACS_USER_NUMBER
,(CASE WHEN payORGPAYMETEO.PAYMENT_TYPE_ID IN (SELECT BASE_PAYMENT_TYPE_ID FROM PAY_PAYMENT_TYPES_VL WHERE PAYMENT_TYPE_NAME IN ('BACS','International Transfer')
	AND LEGISLATION_CODE IN (SELECT LEGISLATION_CODE FROM PER_LEGISLATIVE_DATA_GROUPS_VL WHERE LEGISLATIVE_DATA_GROUP_ID = payORGPAYMETEO.LEGISLATIVE_DATA_GROUP_ID))
	THEN tmpEO.EFT_TEXT 
	ELSE NULL END) RES_CONTRA_NARRATIVE

	
  ,tmpEO.LAST_UPDATED_BY  RSC_LAST_UPDATED_BY
  ,tmpEO.LAST_UPDATE_DATE  RSC_LAST_UPDATE_DATE
  ,tmpEO.CREATED_BY  RSC_CREATED_BY
  ,tmpEO.CREATION_DATE  RSC_CREATION_DATE
  ,null RSC_LEDGER_ID
  ,null RSC_CHART_OF_ACCOUNTS_ID
  ,null RSC_BUSINESS_UNIT_ID
  ,null RSC_LEGAL_ENTITY_ID
  ,null RSC_ORGANIZATION_ID
  ,null RSC_BUSINESS_GROUP_ID
  ,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID


FROM PAY_ORG_PAY_METHODS_VL payORGPAYMETEO
,
(SELECT tmppayORGPAYMETEO.PARENT_ORG_PAY_METHOD_ID
,tmppayORGPAYMETEO.LEGISLATIVE_DATA_GROUP_ID
,tmppayORGPAYMETEO.ORG_PAYMENT_METHOD_NAME 
,ceBankAccountsEO.BANK_ACCOUNT_NAME 
,bankBranchSimplePEO.BANK_NAME 
,tmppayORGPAYMETEO.EFT_BUREAU_REFERENCE_TYPE 
,tmppayORGPAYMETEO.EFT_BUREAU_REFERENCE 
,tmppayORGPAYMETEO.EFT_USER_NAME 
,tmppayORGPAYMETEO.EFT_USER_REFERENCE_TYPE 
,tmppayORGPAYMETEO.EFT_USER_REFERENCE 
,tmppayORGPAYMETEO.EFT_BALANCING_FLAG
,tmppayORGPAYMETEO.EXT_DELIVERY_OPTION_ID 
,tmppayORGPAYMETEO.THIRD_PARTY_DEL_OPTION_ID 
,tmppayORGPAYMETEO.EFT_TRANSACTION_LIMIT 
,tmppayORGPAYMETEO.EFT_FILE_LIMIT 
,tmppayORGPAYMETEO.EFT_REFERENCE 
,tmppayORGPAYMETEO.EFT_TEXT 
,tmppayORGPAYMETEO.EFT_TEXT2 
,tmppayORGPAYMETEO.LAST_UPDATED_BY  
,tmppayORGPAYMETEO.LAST_UPDATE_DATE  
,tmppayORGPAYMETEO.CREATED_BY  
,tmppayORGPAYMETEO.CREATION_DATE  
FROM 
PAY_ORG_PAY_METHODS_VL tmppayORGPAYMETEO
,CE_BANK_ACCOUNTS ceBankAccountsEO
,CE_BANK_BRANCHES_SIMPLE_V bankBranchSimplePEO
WHERE tmppayORGPAYMETEO.BANK_ACCOUNT_ID = ceBankAccountsEO.BANK_ACCOUNT_ID
AND ceBankAccountsEO.BANK_ID = bankBranchSimplePEO.BANK_PARTY_ID
--AND SYSDATE BETWEEN tmppayORGPAYMETEO.EFFECTIVE_START_DATE AND NVL(tmppayORGPAYMETEO.EFFECTIVE_END_DATE,TO_DATE('4712-12-31','YYYY-MM-DD'))
) tmpEO

WHERE payORGPAYMETEO.ORG_PAYMENT_METHOD_ID = tmpEO.PARENT_ORG_PAY_METHOD_ID
AND payORGPAYMETEO.PARENT_ORG_PAY_METHOD_ID IS NULL
--AND SYSDATE BETWEEN payORGPAYMETEO.EFFECTIVE_START_DATE AND NVL(payORGPAYMETEO.EFFECTIVE_END_DATE,TO_DATE('4712-12-31','YYYY-MM-DD'))

ORDER BY 1