/* ****************************************************************************
 * $Revision: 60928 $:
 * $Author: pisan.jariyasettachok $:
 * $Date: 2017-02-06 17:14:01 +0700 (Mon, 06 Feb 2017) $:
 * $HeadURL: http://svn01.rapidesuite.com:999/svn/a/dev/rapidesuite/controldata/FUSION_11.1.9/trunk/core/reverse_sql/FINANCIALS/Complete%20Primary%20to%20Secondary%20Ledger%20Mapping%20-%20Journal%20Conversion%20Rules.sql $:
 * $Id: Complete Primary to Secondary Ledger Mapping - Journal Conversion Rules.sql 60928 2017-02-06 10:14:01Z pisan.jariyasettachok $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */
 
-- RSC_PREREQUISITE_OBJECTS=MSC_EXCEPTION_VL
 
WITH MSC_DIMENSIONS AS (SELECT EXCEPTION_ID
	,'Customer' AS LEVEL_TYPE
	,CUSTOMER_DIM_ENABLED DIM_ENABLED
	,CUSTOMER_HIERARCHY HIERARCHY_ID
	,CUSTOMER_LEVEL LEVEL_ID
	FROM MSC_EXCEPTION_B

	UNION ALL

	SELECT EXCEPTION_ID
	,'Demand Class' AS LEVEL_TYPE
	,DEMAND_CLASS_DIM_ENABLED DIM_ENABLED
	,DEMAND_CLASS_HIERARCHY HIERARCHY_ID
	,DEMAND_CLASS_LEVEL LEVEL_ID
	FROM MSC_EXCEPTION_B

	/*UNION ALL

	SELECT EXCEPTION_ID
	,'EXCEPTION' AS LEVEL_TYPE
	,EXCEPTION_DIM_ENABLED DIM_ENABLED
	,EXCEPTION_HIERARCHY HIERARCHY_ID
	,EXCEPTION_LEVEL LEVEL_ID
	FROM MSC_EXCEPTION_B*/

	UNION ALL

	SELECT EXCEPTION_ID
	,'Order Type' AS LEVEL_TYPE
	,ORDER_TYPE_DIM_ENABLED DIM_ENABLED
	,ORDER_TYPE_HIERARCHY HIERARCHY_ID
	,ORDER_TYPE_LEVEL LEVEL_ID
	FROM MSC_EXCEPTION_B

	UNION ALL

	SELECT EXCEPTION_ID
	,'Plan' AS LEVEL_TYPE
	,PLAN_DIM_ENABLED DIM_ENABLED
	,PLAN_HIERARCHY HIERARCHY_ID
	,PLAN_LEVEL LEVEL_ID
	FROM MSC_EXCEPTION_B

	UNION ALL

	SELECT EXCEPTION_ID
	,'Product' AS LEVEL_TYPE
	,PRODUCT_DIM_ENABLED DIM_ENABLED
	,PRODUCT_HIERARCHY HIERARCHY_ID
	,PRODUCT_LEVEL LEVEL_ID
	FROM MSC_EXCEPTION_B

	UNION ALL

	SELECT EXCEPTION_ID
	,'Resource' AS LEVEL_TYPE
	,RESOURCE_DIM_ENABLED DIM_ENABLED
	,RESOURCE_HIERARCHY HIERARCHY_ID
	,RESOURCE_LEVEL LEVEL_ID
	FROM MSC_EXCEPTION_B

	UNION ALL

	SELECT EXCEPTION_ID
	,'Sales Organization' AS LEVEL_TYPE
	,SALES_ORGANIZATION_DIM_ENABLED DIM_ENABLED
	,SALES_ORGANIZATION_HIERARCHY HIERARCHY_ID
	,SALES_ORGANIZATION_LEVEL LEVEL_ID
	FROM MSC_EXCEPTION_B

	/*UNION ALL

	SELECT EXCEPTION_ID
	,'SCENARIO' AS LEVEL_TYPE
	,SCENARIO_DIM_ENABLED DIM_ENABLED
	,SCENARIO_HIERARCHY HIERARCHY_ID
	,SCENARIO_LEVEL LEVEL_ID
	FROM MSC_EXCEPTION_B*/

	UNION ALL

	SELECT EXCEPTION_ID
	,'Source' AS LEVEL_TYPE
	,SOURCE_DIM_ENABLED DIM_ENABLED
	,SOURCE_HIERARCHY HIERARCHY_ID
	,SOURCE_LEVEL LEVEL_ID
	FROM MSC_EXCEPTION_B

	UNION ALL

	SELECT EXCEPTION_ID
	,'Supplier' AS LEVEL_TYPE
	,SUPPLIER_DIM_ENABLED DIM_ENABLED
	,SUPPLIER_HIERARCHY HIERARCHY_ID
	,SUPPLIER_LEVEL LEVEL_ID
	FROM MSC_EXCEPTION_B

	UNION ALL

	SELECT EXCEPTION_ID
	,'Time' AS LEVEL_TYPE
	,TIME_DIM_ENABLED DIM_ENABLED
	,TIME_HIERARCHY HIERARCHY_ID
	,TIME_LEVEL LEVEL_ID
	FROM MSC_EXCEPTION_B

	UNION ALL

	SELECT EXCEPTION_ID
	,'Organiztion' AS LEVEL_TYPE
	,ORGANIZATION_DIM_ENABLED DIM_ENABLED
	,ORGANIZATION_HIERARCHY HIERARCHY_ID
	,ORGANIZATION_LEVEL LEVEL_ID
	FROM MSC_EXCEPTION_B)

SELECT ExceptionE0.NAME RES_EXCEPTION
,DECODE(ExceptionDetailE0.DIM_ENABLED,'1','Yes','No') RES_SELECTED
,ExceptionDetailE0.LEVEL_TYPE RES_DIMENSION
,(SELECT NAME
	FROM MSC_HIERARCHIES_TL
	WHERE HIERARCHY_ID = ExceptionDetailE0.HIERARCHY_ID
	AND LANGUAGE = USERENV('LANG')
	) RES_HIERARCHY
,(SELECT NAME
	FROM MSC_LEVELS_TL
	WHERE LEVEL_ID = ExceptionDetailE0.LEVEL_ID
	AND LANGUAGE = USERENV('LANG')
	) RES_LEVEL
,ExceptionE0.LAST_UPDATED_BY  RSC_LAST_UPDATED_BY
,ExceptionE0.LAST_UPDATE_DATE  RSC_LAST_UPDATE_DATE
,ExceptionE0.CREATED_BY  RSC_CREATED_BY
,ExceptionE0.CREATION_DATE  RSC_CREATION_DATE
,null RSC_LEDGER_ID
,null RSC_CHART_OF_ACCOUNTS_ID
,null RSC_BUSINESS_UNIT_ID
,null RSC_LEGAL_ENTITY_ID
,null RSC_ORGANIZATION_ID
,null RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM MSC_EXCEPTION_VL ExceptionE0
,MSC_DIMENSIONS ExceptionDetailE0
WHERE ExceptionE0.EXCEPTION_ID = ExceptionDetailE0.EXCEPTION_ID
ORDER BY ExceptionE0.NAME
,ExceptionDetailE0.LEVEL_TYPE