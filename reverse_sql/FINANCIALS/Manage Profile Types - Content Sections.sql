/* ****************************************************************************
 * $Revision: 78229 $:
 * $Author: pisan.jariyasettachok $:
 * $Date: 2022-04-07 14:37:05 +0700 (Thu, 07 Apr 2022) $:
 * $HeadURL: https://svn03.rapid4cloud.com/svn/a/dev/rapidesuite/controldata/FUSION_11.1.13/trunk/core/reverse_sql/FINANCIALS/Manage%20Profile%20Types%20-%20Content%20Sections.sql $:
 * $Id: Manage Profile Types - Content Sections.sql 78229 2022-04-07 07:37:05Z pisan.jariyasettachok $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */
 
--RSC_PREREQUISITE_OBJECTS=HRT_PROFILE_TYPES_VL
--RSC_PREREQUISITE_OBJECTS=HRT_PROFILE_TYP_SECTIONS_VL
 
SELECT profileTypesE0.PROFILE_TYPE_CODE RES_PROFILE_TYPE
,contentSelectionsE0.R1 RES_ORDER
,contentSelectionsE0.NAME RES_SECTION_NAME
,contentSelectionsE0.DESCRIPTION RES_SECTION_DESCRIPTION
,(SELECT template.NAME
	FROM HRT_PROFILE_TYPES_VL templateH
	,HRT_PROFILE_TYP_SECTIONS_VL template
	WHERE templateH.PROFILE_USAGE_CODE = 'T'
	AND templateH.PROFILE_TYPE_ID = template.PROFILE_TYPE_ID
	AND templateH.BUSINESS_GROUP_ID = template.BUSINESS_GROUP_ID
	AND template.CONTENT_TYPE_ID = contentSelectionsE0.CONTENT_TYPE_ID
	AND template.BUSINESS_GROUP_ID = contentSelectionsE0.BUSINESS_GROUP_ID
	) RES_TEMPLATE
,(CASE
	WHEN profileTypesE0.PROFILE_TYPE_CODE = 'PERSON' THEN
		DECODE(contentSelectionsE0.APPROVAL_REQUIRED_FLAG,'Y','Yes','N','No') 
	END) RES_APPROVAL_REQUIRED
,DECODE(contentSelectionsE0.ACTIVE_FLAG,'Y','Yes','No') RES_ACTIVE
,(CASE
	WHEN profileTypesE0.PROFILE_TYPE_CODE = 'PERSON' THEN
		DECODE(contentSelectionsE0.LINKEDIN_ENABLED_FLAG,'Y','Yes','N','No')
	END) RES_LINKEDIN_ENABLED
,contentSelectionsE0.LAST_UPDATED_BY RSC_LAST_UPDATED_BY
,contentSelectionsE0.LAST_UPDATE_DATE RSC_LAST_UPDATE_DATE
,contentSelectionsE0.CREATED_BY RSC_CREATED_BY
,contentSelectionsE0.CREATION_DATE RSC_CREATION_DATE
,NULL RSC_LEDGER_ID
,NULL RSC_CHART_OF_ACCOUNTS_ID
,NULL RSC_BUSINESS_UNIT_ID
,NULL RSC_LEGAL_ENTITY_ID
,NULL RSC_ORGANIZATION_ID
,profileTypesE0.BUSINESS_GROUP_ID RSC_BUSINESS_GROUP_ID
,NULL RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID

FROM HRT_PROFILE_TYPES_VL profileTypesE0
,(SELECT DISPLAY_ORDER
	,PROFILE_TYPE_ID
	,BUSINESS_GROUP_ID
	,CONTENT_TYPE_ID
	,NAME
	,DESCRIPTION
	,APPROVAL_REQUIRED_FLAG
	,ACTIVE_FLAG
	,LINKEDIN_ENABLED_FLAG
	,LAST_UPDATED_BY
	,LAST_UPDATE_DATE
	,CREATED_BY
	,CREATION_DATE
	,ROW_NUMBER() OVER(PARTITION BY PROFILE_TYPE_ID,BUSINESS_GROUP_ID ORDER BY NVL(DISPLAY_ORDER,0)) R1
	FROM HRT_PROFILE_TYP_SECTIONS_VL typeSelectionsE0
	WHERE NAME IS NOT NULL
	AND (SECURITY_CONTEXT NOT IN ('N_BOX_ASSIGNMENT','POTENTIAL','ADVANCEMENT_READINESS','RISK','PERFORMANCE_RATING','TALENT_SCORE','CRITICALITY')
		OR SECURITY_CONTEXT IS NULL)
	AND NOT EXISTS (SELECT 1 
		FROM HRT_CONTENT_TYPE_RLATS 
		WHERE RELATIONSHIP_CODE  = 'CHILD'
		AND CONTENT_TYPE_ID = typeSelectionsE0.CONTENT_TYPE_ID)
	--AND PARENT_SECTION_ID IS NULL
	) contentSelectionsE0
--,HRT_CONTENT_TYPES_VL contentsE0
WHERE profileTypesE0.PROFILE_USAGE_CODE NOT IN ('T','R')
AND profileTypesE0.PROFILE_TYPE_ID = contentSelectionsE0.PROFILE_TYPE_ID
AND profileTypesE0.BUSINESS_GROUP_ID = contentSelectionsE0.BUSINESS_GROUP_ID
/*AND contentSelectionsE0.CONTENT_TYPE_ID = contentsE0.CONTENT_TYPE_ID
AND contentSelectionsE0.BUSINESS_GROUP_ID = contentsE0.BUSINESS_GROUP_ID*/
ORDER BY profileTypesE0.PROFILE_TYPE_CODE
,contentSelectionsE0.R1 