/* ****************************************************************************
 * $Revision: 78566 $:
 * $Author: tanawat.wongjan $:
 * $Date: 2022-05-25 10:28:16 +0700 (Wed, 25 May 2022) $:
 * $HeadURL: https://svn03.rapid4cloud.com/svn/a/dev/rapidesuite/controldata/FUSION_11.1.13/trunk/core/reverse_sql/FINANCIALS/Manage%20Legal%20Reporting%20Unit%20Registrations%20-%20Registrations.sql $:
 * $Id: Manage Legal Reporting Unit Registrations - Registrations.sql 78566 2022-05-25 03:28:16Z tanawat.wongjan $:
 * ****************************************************************************
 * Description:
 * ************************************************************************** */


select DISTINCT XLEENTITYPROFILES.name RES_LEGAL_ENTITY
,XLEENTITYPROFILES.LEGAL_ENTITY_IDENTIFIER RES_LEGAL_ENTITY_IDENTIFIER
,XLEETBPROFILES.name RES_LEGAL_REPORTING_UNIT
,mainLegalNumbersE0.REGISTRATION_NUMBER RES_LEGAL_REPORTING_UNIT_REGIS
,XLEJURISDICTIONSVL.name RES_JURISDICTION
,GEOGRAPHYPEO.GEOGRAPHY_NAME RES_TERRITORY
,TRIM(REPLACE
		(REPLACE(LOCATIONDPEO.FORMATTED_ADDRESS,UPPER(TerritoryPEO.TERRITORY_SHORT_NAME)||'/','')
	,'/'||UPPER(TerritoryPEO.TERRITORY_SHORT_NAME),'')
	) RES_REGISTERED_ADDRESS
,XleRegistrations.REGISTERED_NAME RES_REGISTERED_NAME
,XLEREGISTRATIONS.ALTERNATE_REGISTERED_NAME RES_ALTERNATE_NAME
,XLEREGISTRATIONS.REGISTRATION_NUMBER RES_REGISTRATION_NUMBER
,DECODE(XLEREGISTRATIONS.IDENTIFYING_FLAG,'Y','Yes','No') RES_IDENTIFYING
,XLEREGISTRATIONS.PLACE_OF_REGISTRATION  RES_PLACE_OF_REGISTRATION
,PARTYPEO.PARTY_NAME RES_ISSUING_LEGAL_AUTHORITY
,HZ_FORMAT_PUB.FORMAT_ADDRESS(PARTYPEO.IDEN_ADDR_LOCATION_ID, null, null, ',', null, null, null, null) RES_ISSUING_LEGAL_AUTHORITY_AD
,TO_CHAR(XleRegistrations.EFFECTIVE_FROM,'DD-Mon-YYYY') RES_START_DATE
,TO_CHAR(XleRegistrations.EFFECTIVE_TO,'DD-Mon-YYYY') RES_END_DATE
,XLEREGISTRATIONS.LAST_UPDATED_BY  RSC_LAST_UPDATED_BY
,XLEREGISTRATIONS.LAST_UPDATE_DATE  RSC_LAST_UPDATE_DATE
,XLEREGISTRATIONS.CREATED_BY  RSC_CREATED_BY
,XLEREGISTRATIONS.CREATION_DATE  RSC_CREATION_DATE
,null RSC_LEDGER_ID
,null RSC_CHART_OF_ACCOUNTS_ID
,null RSC_BUSINESS_UNIT_ID
,XLEETBPROFILES.LEGAL_ENTITY_ID RSC_LEGAL_ENTITY_ID
,null RSC_ORGANIZATION_ID
,null RSC_BUSINESS_GROUP_ID
,XLEETBPROFILES.ENTERPRISE_ID RSC_ENTERPRISE_ID
,NULL RSC_COUNTRY_ID
 
from XLE_ETB_PROFILES XLEETBPROFILES
,XLE_ENTITY_PROFILES XleEntityProfiles
,XLE_REGISTRATIONS XleRegistrations
,XLE_JURISDICTIONS_VL XleJurisdictionsVl
,XLE_LOCATIONS_V LocationDPEO
,fusion.FND_TERRITORIES_VL TerritoryPEO
,HZ_PARTIES PartyPEO
,HZ_GEOGRAPHIES GeographyPEO
,XLE_LOOKUPS XleLookupPEO
,XLE_LOOKUPS XLELOOKUPPEO1
,(SELECT REG.REGISTRATION_NUMBER
	,EST.LEGAL_ENTITY_ID
	FROM XLE_ETB_PROFILES EST
	,XLE_REGISTRATIONS REG
	WHERE EST.ESTABLISHMENT_ID = REG.SOURCE_ID
	AND REG.IDENTIFYING_FLAG = 'Y'
	AND EST.MAIN_ESTABLISHMENT_FLAG = 'Y') mainLegalNumbersE0
where XLEETBPROFILES.LEGAL_ENTITY_ID  = XLEENTITYPROFILES.LEGAL_ENTITY_ID
and XleEtbProfiles.ESTABLISHMENT_ID   = XleRegistrations.SOURCE_ID
and (XleRegistrations.LOCATION_ID            = LocationDPEO.LOCATION_ID (+))
AND(XleRegistrations.ISSUING_AUTHORITY_ID     = PartyPEO.PARTY_ID(+))
AND(XleJurisdictionsVl.GEOGRAPHY_ID           = GeographyPEO.GEOGRAPHY_ID)
and(XLEJURISDICTIONSVL.JURISDICTION_ID        = XLEREGISTRATIONS.JURISDICTION_ID)
AND(XleRegistrations.SOURCE_TABLE             = 'XLE_ETB_PROFILES')
AND((XleJurisdictionsVl.REGISTRATION_CODE_LE  = XleLookupPEO.LOOKUP_CODE)
AND(XleLookupPEO.LOOKUP_TYPE                  = 'XLE_REG_CODE'))
AND((XleJurisdictionsVl.REGISTRATION_CODE_ETB = XleLookupPEO1.LOOKUP_CODE)
and(XLELOOKUPPEO1.LOOKUP_TYPE                 = 'XLE_REG_CODE_EST'))
AND XLEETBPROFILES.LEGAL_ENTITY_ID = mainLegalNumbersE0.LEGAL_ENTITY_ID
AND TerritoryPEO.territory_code         = LocationDPEO.country
ORDER BY XLEENTITYPROFILES.name
,XLEETBPROFILES.name